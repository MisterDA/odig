<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Async_durable__Durable (async_durable.Async_durable__Durable)</title><link rel="stylesheet" href="../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../index.html">async_durable</a> &#x00BB; Async_durable__Durable</nav><h1>Module <code>Async_durable__Durable</code></h1><p>Durable is designed to help recover from simple errors when using mutable data types that silently fail and can be easily rebuilt or created anew. A clear candidate is Rpc.Connection.t</p></header><dl><dt class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> 'a t</code></dt></dl><dl><dt class="spec value" id="val-create"><a href="#val-create" class="anchor"></a><code><span class="keyword">val</span> create : to_create:(unit <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="../../async_kernel/Async_kernel__/Deferred_or_error/index.html#type-t">Async_kernel.Deferred.Or_error.t</a>) <span>&#45;&gt;</span> is_broken:(<span class="type-var">'a</span> <span>&#45;&gt;</span> bool) <span>&#45;&gt;</span> ?&#8288;to_rebuild:(<span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="../../async_kernel/Async_kernel__/Deferred_or_error/index.html#type-t">Async_kernel.Deferred.Or_error.t</a>) <span>&#45;&gt;</span> unit <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-t">t</a></code></dt><dd><p><code>to_create</code> tells the Durable how to build a fresh 'a value.</p><p><code>is_broken</code> tests whether the current 'a value can be used. It should return true when you want the Durable to attempt to rebuild or recreate the 'a.</p><p><code>to_rebuild</code> Is called on the broken 'a. It should return a &quot;fixed&quot; 'a.</p><p>When the function <code>with_</code> below is called, it uses <code>is_broken</code> to test if the current Durable value is broken. If not, it calls either <code>to_create</code> or <code>to_rebuild</code>. If <code>to_rebuild</code> is None (as in the default case), the Durable will try to create a fresh value with <code>to_create</code>.</p><p><code>create</code> does not create the Durable value. The first call to <code>to_create</code> will be made on the first use of <code>with_</code>.</p></dd></dl><dl><dt class="spec value" id="val-create_or_fail"><a href="#val-create_or_fail" class="anchor"></a><code><span class="keyword">val</span> create_or_fail : to_create:(unit <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="../../async_kernel/Async_kernel__/Deferred_or_error/index.html#type-t">Async_kernel.Deferred.Or_error.t</a>) <span>&#45;&gt;</span> is_broken:(<span class="type-var">'a</span> <span>&#45;&gt;</span> bool) <span>&#45;&gt;</span> ?&#8288;to_rebuild:(<span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="../../async_kernel/Async_kernel__/Deferred_or_error/index.html#type-t">Async_kernel.Deferred.Or_error.t</a>) <span>&#45;&gt;</span> unit <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <a href="../../core_kernel/Core_kernel/Or_error/index.html#type-t">Core_kernel.Or_error.t</a> <a href="../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async_kernel.Deferred.t</a></code></dt><dd><p><code>create_or_fail</code> immediately calls <code>to_create</code>, returning an error if that first attempt fails. This function will also return an error if the initial durable value is broken.</p></dd></dl><dl><dt class="spec value" id="val-with_"><a href="#val-with_" class="anchor"></a><code><span class="keyword">val</span> with_ : <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> f:(<span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'b</span> <a href="../../async_kernel/Async_kernel__/Deferred_or_error/index.html#type-t">Async_kernel.Deferred.Or_error.t</a>) <span>&#45;&gt;</span> <span class="type-var">'b</span> <a href="../../async_kernel/Async_kernel__/Deferred_or_error/index.html#type-t">Async_kernel.Deferred.Or_error.t</a></code></dt><dd><p><code>with_</code> applies the given function to the Durable value if <code>is_broken</code> returns false. If <code>is_broken</code> return true, it first calls <code>to_create</code> or <code>to_rebuild</code>. This function will return an error if either <code>to_create</code> or <code>to_rebuild</code> returns an error, or if the rebuilt or recreated durable value is broken. <code>is_broken</code> is checked immediately before calling <code>f</code>.</p><p>We will only make one attempt to rebuild a broken value. If a call to <code>to_rebuild</code> returns <code>Error _</code>, we will drop the previously built value. The next call to <code>with_</code> will call <code>to_create</code>.</p><p><code>with_</code> will raise if <code>f</code> raises.</p></dd></dl></div></body></html>