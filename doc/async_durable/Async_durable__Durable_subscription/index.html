<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Async_durable__Durable_subscription (async_durable.Async_durable__Durable_subscription)</title><link rel="stylesheet" href="../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – <a href="../index.html">async_durable</a> &#x00BB; Async_durable__Durable_subscription</nav><h1>Module <code>Async_durable__Durable_subscription</code></h1><p>This module is designed to help processess maintain update subscriptions that will automatically recover from lost connections. It exposes to the client when the subscription has been lost or recovered, so the client can choose how to handle a lost connection.</p></header><div class="spec module" id="module-Update"><a href="#module-Update" class="anchor"></a><code><span class="keyword">module</span> <a href="Update/index.html">Update</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><dl><dt class="spec value" id="val-create"><a href="#val-create" class="anchor"></a><code><span class="keyword">val</span> create : <a href="../../async_rpc_kernel/Async_rpc_kernel__Rpc/Connection/index.html#type-t">Async_rpc_kernel.Rpc.Connection.t</a> <a href="../Async_durable__/Durable/index.html#type-t">Async_durable__.Durable.t</a> <span>&#45;&gt;</span> (<span class="type-var">'query</span>, <span class="type-var">'response</span>, <span class="type-var">'error</span>) <a href="../../async_rpc_kernel/Async_rpc_kernel__Rpc/Pipe_rpc/index.html#type-t">Async_rpc_kernel.Rpc.Pipe_rpc.t</a> <span>&#45;&gt;</span> query:<span class="type-var">'query</span> <span>&#45;&gt;</span> resubscribe_delay:<a href="../../core_kernel/Core_kernel__Time_intf/module-type-S/Time/Span/index.html#type-t">Core_kernel.Time.Span.t</a> <span>&#45;&gt;</span> (<span class="type-var">'response</span>, <span class="type-var">'error</span>) <a href="Update/index.html#type-t">Update.t</a> <a href="../../async_kernel/Async_kernel__Pipe/Reader/index.html#type-t">Async_kernel.Pipe.Reader.t</a></code></dt><dd><p><code>create</code> will immediately dispatch the the supplied <code>Rpc.Pipe_rpc.t</code> with <code>query</code> over the <code>Rpc.Connection.t Async_durable.t</code>. If a connection attempt fails or if the subscription closes, it waits <code>resubscribe_delay</code> and dispatches again to create a new subscription. The pipe returned by <code>create</code> contains all the responses that come over the internal subscription, as well as updates about the state of the <code>t</code>.</p><p>Closing the returned pipe will permanently close the subscription.</p></dd></dl><dl><dt class="spec value" id="val-create_or_fail"><a href="#val-create_or_fail" class="anchor"></a><code><span class="keyword">val</span> create_or_fail : <a href="../../async_rpc_kernel/Async_rpc_kernel__Rpc/Connection/index.html#type-t">Async_rpc_kernel.Rpc.Connection.t</a> <a href="../Async_durable__/Durable/index.html#type-t">Async_durable__.Durable.t</a> <span>&#45;&gt;</span> (<span class="type-var">'query</span>, <span class="type-var">'response</span>, <span class="type-var">'error</span>) <a href="../../async_rpc_kernel/Async_rpc_kernel__Rpc/Pipe_rpc/index.html#type-t">Async_rpc_kernel.Rpc.Pipe_rpc.t</a> <span>&#45;&gt;</span> query:<span class="type-var">'query</span> <span>&#45;&gt;</span> resubscribe_delay:<a href="../../core_kernel/Core_kernel__Time_intf/module-type-S/Time/Span/index.html#type-t">Core_kernel.Time.Span.t</a> <span>&#45;&gt;</span> ((<span class="type-var">'response</span>, <span class="type-var">'error</span>) <a href="Update/index.html#type-t">Update.t</a> <a href="../../async_kernel/Async_kernel__Pipe/Reader/index.html#type-t">Async_kernel.Pipe.Reader.t</a>, <span class="type-var">'error</span>) <a href="../../core_kernel/Core_kernel/Result/index.html#type-t">Core_kernel.Result.t</a> <a href="../../core_kernel/Core_kernel/Or_error/index.html#type-t">Core_kernel.Or_error.t</a> <a href="../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async_kernel.Deferred.t</a></code></dt><dd><p><code>create_or_fail</code> will return an <code>Error e</code> if the initial attempt to dispatch the supplied <code>Rpc.Pipe_rpc.t</code> does not succeed, or an <code>Ok (Error 'error)</code> if the initial dispatch returns a server side rpc error.</p></dd></dl></div></body></html>