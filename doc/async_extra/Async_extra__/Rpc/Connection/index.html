<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Connection (async_extra.Async_extra__.Rpc.Connection)</title><link rel="stylesheet" href="../../../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – <a href="../../../index.html">async_extra</a> &#x00BB; <a href="../../index.html">Async_extra__</a> &#x00BB; <a href="../index.html">Rpc</a> &#x00BB; Connection</nav><h1>Module <code>Rpc.Connection</code></h1></header><div><div class="spec include"><div class="doc"><details open="open"><summary><span class="def"><code><span class="keyword">include</span> <span class="keyword">module</span> <span class="keyword">type</span> <span class="keyword">of</span> <span class="keyword">sig</span> ... <span class="keyword">end</span></code></span></summary><dl><dt class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> t</code><code> = <a href="../../../../async_rpc_kernel/Async_rpc_kernel__Rpc/Connection/index.html#type-t">Async_rpc_kernel__Rpc.Connection.t</a></code></dt></dl><dl><dt class="spec value" id="val-sexp_of_t"><a href="#val-sexp_of_t" class="anchor"></a><code><span class="keyword">val</span> sexp_of_t : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../../../../sexplib0/Sexplib0/Sexp/index.html#type-t">Ppx_sexp_conv_lib.Sexp.t</a></code></dt></dl><div class="spec module" id="module-Heartbeat_config"><a href="#module-Heartbeat_config" class="anchor"></a><code><span class="keyword">module</span> <a href="Heartbeat_config/index.html">Heartbeat_config</a> = <a href="../../../../async_rpc_kernel/Async_rpc_kernel__Rpc/Connection/index.html#module-Heartbeat_config">Async_rpc_kernel__Rpc.Connection.Heartbeat_config</a></code></div><div class="spec module" id="module-Client_implementations"><a href="#module-Client_implementations" class="anchor"></a><code><span class="keyword">module</span> <a href="Client_implementations/index.html">Client_implementations</a> = <a href="../../../../async_rpc_kernel/Async_rpc_kernel__Rpc/Connection/index.html#module-Client_implementations">Async_rpc_kernel__Rpc.Connection.Client_implementations</a></code></div><dl><dt class="spec value" id="val-create"><a href="#val-create" class="anchor"></a><code><span class="keyword">val</span> create : ?&#8288;implementations:<span class="type-var">'s</span> <a href="../../../../async_rpc_kernel/Async_rpc_kernel__/Implementations/index.html#type-t">Async_rpc_kernel__.Implementations.t</a> <span>&#45;&gt;</span> connection_state:(<a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'s</span>) <span>&#45;&gt;</span> ?&#8288;handshake_timeout:<a href="../../../../core_kernel/Core_kernel__Time_ns/Span/index.html#type-t">Core_kernel.Time_ns.Span.t</a> <span>&#45;&gt;</span> ?&#8288;heartbeat_config:<a href="../../../../async_rpc_kernel/Async_rpc_kernel__Rpc/Connection/Heartbeat_config/index.html#type-t">Heartbeat_config.t</a> <span>&#45;&gt;</span> ?&#8288;description:<a href="../../../../core_kernel/Core_kernel/Info/index.html#type-t">Core_kernel.Info.t</a> <span>&#45;&gt;</span> <a href="../../../../async_rpc_kernel/Async_rpc_kernel__/Transport/index.html#type-t">Async_rpc_kernel__.Transport.t</a> <span>&#45;&gt;</span> (<a href="index.html#type-t">t</a>, <a href="../../../../base/Base/Exn/index.html#type-t">Core_kernel.Exn.t</a>) <a href="../../../../core_kernel/Core_kernel/Result/index.html#type-t">Core_kernel.Result.t</a> <a href="../../../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async_kernel.Deferred.t</a></code></dt><dt class="spec value" id="val-contains_magic_prefix"><a href="#val-contains_magic_prefix" class="anchor"></a><code><span class="keyword">val</span> contains_magic_prefix : bool <a href="../../../../bin_prot/Bin_prot/Type_class/index.html#type-reader">Bin_prot.Type_class.reader</a></code></dt><dt class="spec value" id="val-description"><a href="#val-description" class="anchor"></a><code><span class="keyword">val</span> description : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../../../../core_kernel/Core_kernel/Info/index.html#type-t">Core_kernel.Info.t</a></code></dt><dt class="spec value" id="val-add_heartbeat_callback"><a href="#val-add_heartbeat_callback" class="anchor"></a><code><span class="keyword">val</span> add_heartbeat_callback : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> (unit <span>&#45;&gt;</span> unit) <span>&#45;&gt;</span> unit</code></dt><dt class="spec value" id="val-close"><a href="#val-close" class="anchor"></a><code><span class="keyword">val</span> close : ?&#8288;streaming_responses_flush_timeout:<a href="../../../../core_kernel/Core_kernel__Time_ns/Span/index.html#type-t">Core_kernel.Time_ns.Span.t</a> <span>&#45;&gt;</span> ?&#8288;reason:<a href="../../../../core_kernel/Core_kernel/Info/index.html#type-t">Core_kernel.Info.t</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> unit <a href="../../../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async_kernel.Deferred.t</a></code></dt><dt class="spec value" id="val-close_finished"><a href="#val-close_finished" class="anchor"></a><code><span class="keyword">val</span> close_finished : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> unit <a href="../../../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async_kernel.Deferred.t</a></code></dt><dt class="spec value" id="val-close_reason"><a href="#val-close_reason" class="anchor"></a><code><span class="keyword">val</span> close_reason : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> on_close:[ `finished | `started ] <span>&#45;&gt;</span> <a href="../../../../core_kernel/Core_kernel/Info/index.html#type-t">Core_kernel.Info.t</a> <a href="../../../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async_kernel.Deferred.t</a></code></dt><dt class="spec value" id="val-is_closed"><a href="#val-is_closed" class="anchor"></a><code><span class="keyword">val</span> is_closed : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> bool</code></dt><dt class="spec value" id="val-bytes_to_write"><a href="#val-bytes_to_write" class="anchor"></a><code><span class="keyword">val</span> bytes_to_write : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> int</code></dt><dt class="spec value" id="val-flushed"><a href="#val-flushed" class="anchor"></a><code><span class="keyword">val</span> flushed : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> unit <a href="../../../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async_kernel.Deferred.t</a></code></dt><dt class="spec value" id="val-with_close"><a href="#val-with_close" class="anchor"></a><code><span class="keyword">val</span> with_close : ?&#8288;implementations:<span class="type-var">'s</span> <a href="../../../../async_rpc_kernel/Async_rpc_kernel__/Implementations/index.html#type-t">Async_rpc_kernel__.Implementations.t</a> <span>&#45;&gt;</span> ?&#8288;handshake_timeout:<a href="../../../../core_kernel/Core_kernel__Time_ns/Span/index.html#type-t">Core_kernel.Time_ns.Span.t</a> <span>&#45;&gt;</span> ?&#8288;heartbeat_config:<a href="../../../../async_rpc_kernel/Async_rpc_kernel__Rpc/Connection/Heartbeat_config/index.html#type-t">Heartbeat_config.t</a> <span>&#45;&gt;</span> connection_state:(<a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'s</span>) <span>&#45;&gt;</span> <a href="../../../../async_rpc_kernel/Async_rpc_kernel__/Transport/index.html#type-t">Async_rpc_kernel__.Transport.t</a> <span>&#45;&gt;</span> dispatch_queries:(<a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="../../../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async_kernel.Deferred.t</a>) <span>&#45;&gt;</span> on_handshake_error:[ `Call of <a href="../../../../base/Base/Exn/index.html#type-t">Core_kernel.Exn.t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="../../../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async_kernel.Deferred.t</a> | `Raise ] <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="../../../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async_kernel.Deferred.t</a></code></dt><dt class="spec value" id="val-server_with_close"><a href="#val-server_with_close" class="anchor"></a><code><span class="keyword">val</span> server_with_close : ?&#8288;handshake_timeout:<a href="../../../../core_kernel/Core_kernel__Time_ns/Span/index.html#type-t">Core_kernel.Time_ns.Span.t</a> <span>&#45;&gt;</span> ?&#8288;heartbeat_config:<a href="../../../../async_rpc_kernel/Async_rpc_kernel__Rpc/Connection/Heartbeat_config/index.html#type-t">Heartbeat_config.t</a> <span>&#45;&gt;</span> <a href="../../../../async_rpc_kernel/Async_rpc_kernel__/Transport/index.html#type-t">Async_rpc_kernel__.Transport.t</a> <span>&#45;&gt;</span> implementations:<span class="type-var">'s</span> <a href="../../../../async_rpc_kernel/Async_rpc_kernel__/Implementations/index.html#type-t">Async_rpc_kernel__.Implementations.t</a> <span>&#45;&gt;</span> connection_state:(<a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'s</span>) <span>&#45;&gt;</span> on_handshake_error:[ `Call of <a href="../../../../base/Base/Exn/index.html#type-t">Core_kernel.Exn.t</a> <span>&#45;&gt;</span> unit <a href="../../../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async_kernel.Deferred.t</a> | `Ignore | `Raise ] <span>&#45;&gt;</span> unit <a href="../../../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async_kernel.Deferred.t</a></code></dt></dl></details></div></div></div><dl><dt class="spec value" id="val-create"><a href="#val-create" class="anchor"></a><code><span class="keyword">val</span> create : ?&#8288;implementations:<span class="type-var">'s</span> <a href="../../../../async_rpc_kernel/Async_rpc_kernel__Rpc/Implementations/index.html#type-t">Implementations.t</a> <span>&#45;&gt;</span> connection_state:(<a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'s</span>) <span>&#45;&gt;</span> ?&#8288;max_message_size:int <span>&#45;&gt;</span> ?&#8288;handshake_timeout:<a href="../../../../core_kernel/Core_kernel__Time_intf/module-type-S/Time/Span/index.html#type-t">Core.Time.Span.t</a> <span>&#45;&gt;</span> ?&#8288;heartbeat_config:<a href="../../../../async_rpc_kernel/Async_rpc_kernel__Rpc/Connection/Heartbeat_config/index.html#type-t">Heartbeat_config.t</a> <span>&#45;&gt;</span> ?&#8288;description:<a href="../../../../core_kernel/Core_kernel/Info/index.html#type-t">Core.Info.t</a> <span>&#45;&gt;</span> <a href="../../../../async_unix/Async_unix/Reader/index.html#type-t">Async_extra__.Import.Reader.t</a> <span>&#45;&gt;</span> <a href="../../../../async_unix/Async_unix/Writer/index.html#type-t">Async_extra__.Import.Writer.t</a> <span>&#45;&gt;</span> (<a href="index.html#type-t">t</a>, <a href="../../../../base/Base/Exn/index.html#type-t">Core.Exn.t</a>) <a href="../../../../core_kernel/Core_kernel/Result/index.html#type-t">Core.Result.t</a> <a href="../../../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async_extra__.Import.Deferred.t</a></code></dt><dd><p>These functions are mostly the same as the ones with the same names in <code>Async_rpc_kernel.Rpc.Connection</code>; see <code>Connection_intf</code> in that library for documentation. The differences are that:</p><ul><li>they take an <code>Async_unix.Reader.t</code>, <code>Async_unix.Writer.t</code> and <code>max_message_size</code> instead of a <code>Transport.t</code></li><li>they use <code>Time</code> instead of <code>Time_ns</code></li></ul></dd></dl><dl><dt class="spec value" id="val-contains_magic_prefix"><a href="#val-contains_magic_prefix" class="anchor"></a><code><span class="keyword">val</span> contains_magic_prefix : <a href="../../../../async_unix/Async_unix/Reader/index.html#type-t">Async_extra__.Import.Reader.t</a> <span>&#45;&gt;</span> bool <a href="../../../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async_extra__.Import.Deferred.t</a></code></dt><dd><p>As of Feb 2017, the RPC protocol started to contain a magic number so that one can identify RPC communication. The bool returned by <code>contains_magic_prefix</code> says whether this magic number was observed.</p><p>This operation is a &quot;peek&quot; that does not advance any pointers associated with the reader. In particular, it makes sense to call <code>create</code> on a reader after calling this function.</p></dd></dl><dl><dt class="spec value" id="val-with_close"><a href="#val-with_close" class="anchor"></a><code><span class="keyword">val</span> with_close : ?&#8288;implementations:<span class="type-var">'s</span> <a href="../../../../async_rpc_kernel/Async_rpc_kernel__Rpc/Implementations/index.html#type-t">Implementations.t</a> <span>&#45;&gt;</span> ?&#8288;max_message_size:int <span>&#45;&gt;</span> ?&#8288;handshake_timeout:<a href="../../../../core_kernel/Core_kernel__Time_intf/module-type-S/Time/Span/index.html#type-t">Core.Time.Span.t</a> <span>&#45;&gt;</span> ?&#8288;heartbeat_config:<a href="../../../../async_rpc_kernel/Async_rpc_kernel__Rpc/Connection/Heartbeat_config/index.html#type-t">Heartbeat_config.t</a> <span>&#45;&gt;</span> connection_state:(<a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'s</span>) <span>&#45;&gt;</span> <a href="../../../../async_unix/Async_unix/Reader/index.html#type-t">Async_extra__.Import.Reader.t</a> <span>&#45;&gt;</span> <a href="../../../../async_unix/Async_unix/Writer/index.html#type-t">Async_extra__.Import.Writer.t</a> <span>&#45;&gt;</span> dispatch_queries:(<a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="../../../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async_extra__.Import.Deferred.t</a>) <span>&#45;&gt;</span> on_handshake_error:[ `Raise | `Call of <a href="../../../../base/Base/Exn/index.html#type-t">Core.Exn.t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="../../../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async_extra__.Import.Deferred.t</a> ] <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="../../../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async_extra__.Import.Deferred.t</a></code></dt><dt class="spec value" id="val-server_with_close"><a href="#val-server_with_close" class="anchor"></a><code><span class="keyword">val</span> server_with_close : ?&#8288;max_message_size:int <span>&#45;&gt;</span> ?&#8288;handshake_timeout:<a href="../../../../core_kernel/Core_kernel__Time_intf/module-type-S/Time/Span/index.html#type-t">Core.Time.Span.t</a> <span>&#45;&gt;</span> ?&#8288;heartbeat_config:<a href="../../../../async_rpc_kernel/Async_rpc_kernel__Rpc/Connection/Heartbeat_config/index.html#type-t">Heartbeat_config.t</a> <span>&#45;&gt;</span> <a href="../../../../async_unix/Async_unix/Reader/index.html#type-t">Async_extra__.Import.Reader.t</a> <span>&#45;&gt;</span> <a href="../../../../async_unix/Async_unix/Writer/index.html#type-t">Async_extra__.Import.Writer.t</a> <span>&#45;&gt;</span> implementations:<span class="type-var">'s</span> <a href="../../../../async_rpc_kernel/Async_rpc_kernel__Rpc/Implementations/index.html#type-t">Implementations.t</a> <span>&#45;&gt;</span> connection_state:(<a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'s</span>) <span>&#45;&gt;</span> on_handshake_error:[ `Raise | `Ignore | `Call of <a href="../../../../base/Base/Exn/index.html#type-t">Core.Exn.t</a> <span>&#45;&gt;</span> unit <a href="../../../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async_extra__.Import.Deferred.t</a> ] <span>&#45;&gt;</span> unit <a href="../../../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async_extra__.Import.Deferred.t</a></code></dt></dl><dl><dt class="spec type" id="type-transport_maker"><a href="#type-transport_maker" class="anchor"></a><code><span class="keyword">type</span> transport_maker</code><code> = <a href="../../../../async_unix/Async_unix/Fd/index.html#type-t">Async_extra__.Import.Fd.t</a> <span>&#45;&gt;</span> max_message_size:int <span>&#45;&gt;</span> <a href="../../Rpc_transport/index.html#type-t">Transport.t</a></code></dt><dd><p>A function creating a transport from a file descriptor. It is responsible for setting the low-level parameters of the underlying transport.</p><p>For instance to set up a transport using <code>Async.{Reader,Writer}</code> and set a buffer age limit on the writer, you can pass this to the functions of this module:</p><pre><code class="ml">~make_transport:(fun fd ~max_message_size -&gt;
  Rpc.Transport.of_fd fd ~max_message_size ~buffer_age_limit:`Unlimited)</code></pre></dd></dl><dl><dt class="spec type" id="type-on_handshake_error"><a href="#type-on_handshake_error" class="anchor"></a><code><span class="keyword">type</span> on_handshake_error</code> = <code>[ </code><table class="variant"><tr id="type-on_handshake_error.Raise" class="anchored"><td class="def constructor"><a href="#type-on_handshake_error.Raise" class="anchor"></a><code>| </code><code>`Raise</code></td></tr><tr id="type-on_handshake_error.Ignore" class="anchored"><td class="def constructor"><a href="#type-on_handshake_error.Ignore" class="anchor"></a><code>| </code><code>`Ignore</code></td></tr><tr id="type-on_handshake_error.Call" class="anchored"><td class="def constructor"><a href="#type-on_handshake_error.Call" class="anchor"></a><code>| </code><code>`Call <span class="keyword">of</span> <a href="../../../../base/Base/Exn/index.html#type-t">Core.Exn.t</a> <span>&#45;&gt;</span> unit</code></td></tr></table><code> ]</code></dt></dl><dl><dt class="spec value" id="val-serve"><a href="#val-serve" class="anchor"></a><code><span class="keyword">val</span> serve : implementations:<span class="type-var">'s</span> <a href="../../../../async_rpc_kernel/Async_rpc_kernel__Rpc/Implementations/index.html#type-t">Implementations.t</a> <span>&#45;&gt;</span> initial_connection_state:(<span class="type-var">'address</span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'s</span>) <span>&#45;&gt;</span> where_to_listen:(<span class="type-var">'address</span>, <span class="type-var">'listening_on</span>) <a href="../../../Async_extra/Tcp/Where_to_listen/index.html#type-t">Async_extra.Tcp.Where_to_listen.t</a> <span>&#45;&gt;</span> ?&#8288;max_connections:int <span>&#45;&gt;</span> ?&#8288;backlog:int <span>&#45;&gt;</span> ?&#8288;max_message_size:int <span>&#45;&gt;</span> ?&#8288;make_transport:<a href="index.html#type-transport_maker">transport_maker</a> <span>&#45;&gt;</span> ?&#8288;handshake_timeout:<a href="../../../../core_kernel/Core_kernel__Time_intf/module-type-S/Time/Span/index.html#type-t">Core.Time.Span.t</a> <span>&#45;&gt;</span> ?&#8288;heartbeat_config:<a href="../../../../async_rpc_kernel/Async_rpc_kernel__Rpc/Connection/Heartbeat_config/index.html#type-t">Heartbeat_config.t</a> <span>&#45;&gt;</span> ?&#8288;auth:(<span class="type-var">'address</span> <span>&#45;&gt;</span> bool) <span>&#45;&gt;</span> ?&#8288;on_handshake_error:<a href="index.html#type-on_handshake_error">on_handshake_error</a> <span>&#45;&gt;</span> unit <span>&#45;&gt;</span> (<span class="type-var">'address</span>, <span class="type-var">'listening_on</span>) <a href="../../../Async_extra/Tcp/Server/index.html#type-t">Async_extra.Tcp.Server.t</a> <a href="../../../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async_extra__.Import.Deferred.t</a></code></dt><dd><p><code>serve implementations ~port ?on_handshake_error ()</code> starts a server with the given implementation on <code>port</code>. The optional auth function will be called on all incoming connections with the address info of the client and will disconnect the client immediately if it returns false. This auth mechanism is generic and does nothing other than disconnect the client -- any logging or record of the reasons is the responsibility of the auth function itself.</p></dd></dl><dl><dt class="spec value" id="val-serve_with_transport"><a href="#val-serve_with_transport" class="anchor"></a><code><span class="keyword">val</span> serve_with_transport : handshake_timeout:<a href="../../../../core_kernel/Core_kernel__Time_intf/module-type-S/Time/Span/index.html#type-t">Core.Time.Span.t</a> option <span>&#45;&gt;</span> heartbeat_config:<a href="../../../../async_rpc_kernel/Async_rpc_kernel__Rpc/Connection/Heartbeat_config/index.html#type-t">Heartbeat_config.t</a> option <span>&#45;&gt;</span> implementations:<span class="type-var">'s</span> <a href="../../../../async_rpc_kernel/Async_rpc_kernel__Rpc/Implementations/index.html#type-t">Implementations.t</a> <span>&#45;&gt;</span> description:<a href="../../../../core_kernel/Core_kernel/Info/index.html#type-t">Core.Info.t</a> <span>&#45;&gt;</span> connection_state:(<a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'s</span>) <span>&#45;&gt;</span> on_handshake_error:<a href="index.html#type-on_handshake_error">on_handshake_error</a> <span>&#45;&gt;</span> <a href="../../Rpc_transport/index.html#type-t">Transport.t</a> <span>&#45;&gt;</span> unit <a href="../../../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async_extra__.Import.Deferred.t</a></code></dt><dt class="spec value" id="val-client"><a href="#val-client" class="anchor"></a><code><span class="keyword">val</span> client : ?&#8288;implementations:<span class="type-var">_</span> <a href="../../../../async_rpc_kernel/Async_rpc_kernel__Rpc/Connection/Client_implementations/index.html#type-t">Client_implementations.t</a> <span>&#45;&gt;</span> ?&#8288;max_message_size:int <span>&#45;&gt;</span> ?&#8288;make_transport:<a href="index.html#type-transport_maker">transport_maker</a> <span>&#45;&gt;</span> ?&#8288;handshake_timeout:<a href="../../../../core_kernel/Core_kernel__Time_intf/module-type-S/Time/Span/index.html#type-t">Core.Time.Span.t</a> <span>&#45;&gt;</span> ?&#8288;heartbeat_config:<a href="../../../../async_rpc_kernel/Async_rpc_kernel__Rpc/Connection/Heartbeat_config/index.html#type-t">Heartbeat_config.t</a> <span>&#45;&gt;</span> ?&#8288;description:<a href="../../../../core_kernel/Core_kernel/Info/index.html#type-t">Core.Info.t</a> <span>&#45;&gt;</span> <span class="type-var">_</span> <a href="../../../Async_extra/Tcp/Where_to_connect/index.html#type-t">Async_extra.Tcp.Where_to_connect.t</a> <span>&#45;&gt;</span> (<a href="index.html#type-t">t</a>, <a href="../../../../base/Base/Exn/index.html#type-t">Core.Exn.t</a>) <a href="../../../../core_kernel/Core_kernel/Result/index.html#type-t">Core.Result.t</a> <a href="../../../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async_extra__.Import.Deferred.t</a></code></dt><dd><p><code>client where_to_connect ()</code> connects to the server at <code>where_to_connect</code> and returns the connection or an Error if a connection could not be made. It is the responsibility of the caller to eventually call <code>close</code>.</p><p>In <code>client</code> and <code>with_client</code>, the <code>handshake_timeout</code> encompasses both the TCP connection timeout and the timeout for this module's own handshake.</p></dd></dl><dl><dt class="spec value" id="val-with_client"><a href="#val-with_client" class="anchor"></a><code><span class="keyword">val</span> with_client : ?&#8288;implementations:<span class="type-var">_</span> <a href="../../../../async_rpc_kernel/Async_rpc_kernel__Rpc/Connection/Client_implementations/index.html#type-t">Client_implementations.t</a> <span>&#45;&gt;</span> ?&#8288;max_message_size:int <span>&#45;&gt;</span> ?&#8288;make_transport:<a href="index.html#type-transport_maker">transport_maker</a> <span>&#45;&gt;</span> ?&#8288;handshake_timeout:<a href="../../../../core_kernel/Core_kernel__Time_intf/module-type-S/Time/Span/index.html#type-t">Core.Time.Span.t</a> <span>&#45;&gt;</span> ?&#8288;heartbeat_config:<a href="../../../../async_rpc_kernel/Async_rpc_kernel__Rpc/Connection/Heartbeat_config/index.html#type-t">Heartbeat_config.t</a> <span>&#45;&gt;</span> <span class="type-var">_</span> <a href="../../../Async_extra/Tcp/Where_to_connect/index.html#type-t">Async_extra.Tcp.Where_to_connect.t</a> <span>&#45;&gt;</span> (<a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="../../../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async_extra__.Import.Deferred.t</a>) <span>&#45;&gt;</span> (<span class="type-var">'a</span>, <a href="../../../../base/Base/Exn/index.html#type-t">Core.Exn.t</a>) <a href="../../../../core_kernel/Core_kernel/Result/index.html#type-t">Core.Result.t</a> <a href="../../../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async_extra__.Import.Deferred.t</a></code></dt><dd><p><code>with_client where_to_connect f</code> connects to the server at <code>where_to_connect</code> and runs f until an exception is thrown or until the returned Deferred is fulfilled.</p><p>NOTE: As with <code>with_close</code>, you should be careful when using this with <code>Pipe_rpc</code>. See <code>with_close</code> for more information.</p></dd></dl></div></body></html>