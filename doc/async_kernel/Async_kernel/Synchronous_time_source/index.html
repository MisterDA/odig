<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Synchronous_time_source (async_kernel.Async_kernel.Synchronous_time_source)</title><link rel="stylesheet" href="../../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../../index.html">async_kernel</a> &#x00BB; <a href="../index.html">Async_kernel</a> &#x00BB; Synchronous_time_source</nav><h1>Module <code>Async_kernel.Synchronous_time_source</code></h1><p>A synchronous version of <code>Async_kernel.Time_source</code>. <code>advance_by_alarms</code> runs alarms immediately, rather than enqueueing Async jobs.</p></header><div class="spec module" id="module-T1"><a href="#module-T1" class="anchor"></a><code><span class="keyword">module</span> <a href="T1/index.html">T1</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="spec module" id="module-Read_write"><a href="#module-Read_write" class="anchor"></a><code><span class="keyword">module</span> <a href="Read_write/index.html">Read_write</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><dl><dt class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> t</code><code> = <a href="../../../core_kernel/Core_kernel/index.html#type-read">Core_kernel.read</a> <a href="T1/index.html#type-t">T1.t</a></code></dt></dl><div><div class="spec include"><div class="doc"><details open="open"><summary><span class="def"><code><span class="keyword">include</span> <span class="keyword">sig</span> ... <span class="keyword">end</span></code></span></summary><dl><dt class="spec value" id="val-sexp_of_t"><a href="#val-sexp_of_t" class="anchor"></a><code><span class="keyword">val</span> sexp_of_t : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../../../sexplib0/Sexplib0/Sexp/index.html#type-t">Ppx_sexp_conv_lib.Sexp.t</a></code></dt></dl></details></div></div></div><div><div class="spec include"><div class="doc"><details open="open"><summary><span class="def"><code><span class="keyword">include</span> <a href="../../../base/Base/Invariant/index.html#module-type-S">Core_kernel.Invariant.S</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="../../../base/Base/Invariant/module-type-S/index.html#type-t">t</a> := <a href="index.html#type-t">t</a></code></span></summary><dl><dt class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> t</code></dt></dl><dl><dt class="spec value" id="val-invariant"><a href="#val-invariant" class="anchor"></a><code><span class="keyword">val</span> invariant : <a href="index.html#type-t">t</a> <a href="../../../base/Base__/Invariant_intf/index.html#type-inv">Base__.Invariant_intf.inv</a></code></dt></dl></details></div></div></div><dl><dt class="spec value" id="val-read_only"><a href="#val-read_only" class="anchor"></a><code><span class="keyword">val</span> read_only : [&gt; <a href="../../../core_kernel/Core_kernel/index.html#type-read">Core_kernel.read</a> ] <a href="T1/index.html#type-t">T1.t</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></dt></dl><dl><dt class="spec type" id="type-callback"><a href="#type-callback" class="anchor"></a><code><span class="keyword">type</span> callback</code><code> = unit <span>&#45;&gt;</span> unit</code></dt></dl><dl><dt class="spec value" id="val-create"><a href="#val-create" class="anchor"></a><code><span class="keyword">val</span> create : ?&#8288;timing_wheel_config:<a href="../../../core_kernel/Core_kernel__Timing_wheel_ns/Config/index.html#type-t">Core_kernel.Timing_wheel_ns.Config.t</a> <span>&#45;&gt;</span> now:<a href="../../Async_kernel__/Time_ns/index.html#type-t">Async_kernel__.Import.Time_ns.t</a> <span>&#45;&gt;</span> unit <span>&#45;&gt;</span> <a href="../../../core_kernel/Core_kernel/index.html#type-read_write">Core_kernel.read_write</a> <a href="T1/index.html#type-t">T1.t</a></code></dt><dd><p><code>create ~now ()</code> creates a new time source. The default <code>timing_wheel_config</code> has 100 microsecond precision, with levels of &gt;1s, &gt;1m, &gt;1h, &gt;1d.</p></dd></dl><dl><dt class="spec value" id="val-alarm_precision"><a href="#val-alarm_precision" class="anchor"></a><code><span class="keyword">val</span> alarm_precision : [&gt; <a href="../../../core_kernel/Core_kernel/index.html#type-read">Core_kernel.read</a> ] <a href="T1/index.html#type-t">T1.t</a> <span>&#45;&gt;</span> <a href="../../../core_kernel/Core_kernel__Time_ns_alternate_sexp/Span/index.html#type-t">Async_kernel__.Import.Time_ns.Span.t</a></code></dt><dt class="spec value" id="val-is_wall_clock"><a href="#val-is_wall_clock" class="anchor"></a><code><span class="keyword">val</span> is_wall_clock : [&gt; <a href="../../../core_kernel/Core_kernel/index.html#type-read">Core_kernel.read</a> ] <a href="T1/index.html#type-t">T1.t</a> <span>&#45;&gt;</span> bool</code></dt><dd><p><code>is_wall_clock</code> reports whether this time source represents 'wall clock' time, or some alternate source of time.</p></dd></dl><dl><dt class="spec value" id="val-now"><a href="#val-now" class="anchor"></a><code><span class="keyword">val</span> now : [&gt; <a href="../../../core_kernel/Core_kernel/index.html#type-read">Core_kernel.read</a> ] <a href="T1/index.html#type-t">T1.t</a> <span>&#45;&gt;</span> <a href="../../Async_kernel__/Time_ns/index.html#type-t">Async_kernel__.Import.Time_ns.t</a></code></dt><dd><p>The behavior of <code>now</code> is special for <code>wall_clock ()</code>; it always calls <code>Time_ns.now
    ()</code>, so it can return times that the time source has not yet been advanced to.</p></dd></dl><dl><dt class="spec value" id="val-timing_wheel_now"><a href="#val-timing_wheel_now" class="anchor"></a><code><span class="keyword">val</span> timing_wheel_now : [&gt; <a href="../../../core_kernel/Core_kernel/index.html#type-read">Core_kernel.read</a> ] <a href="T1/index.html#type-t">T1.t</a> <span>&#45;&gt;</span> <a href="../../Async_kernel__/Time_ns/index.html#type-t">Async_kernel__.Import.Time_ns.t</a></code></dt><dd><p>Removes the special behavior of <code>now</code> for <code>wall_clock ()</code>; it always returns the timing wheel's notion of now, which means that the following inequality always holds: <code>timing_wheel_now () &lt;= now ()</code>.</p></dd></dl><dl><dt class="spec value" id="val-advance_by_alarms"><a href="#val-advance_by_alarms" class="anchor"></a><code><span class="keyword">val</span> advance_by_alarms : [&gt; <a href="../../../core_kernel/Core_kernel/index.html#type-write">Core_kernel.write</a> ] <a href="T1/index.html#type-t">T1.t</a> <span>&#45;&gt;</span> to_:<a href="../../Async_kernel__/Time_ns/index.html#type-t">Async_kernel__.Import.Time_ns.t</a> <span>&#45;&gt;</span> unit <a href="../../../core_kernel/Core_kernel/Or_error/index.html#type-t">Core_kernel.Or_error.t</a></code></dt><dd><p><code>advance_by_alarms t ~to_</code> advances <code>t</code>'s time to <code>to_</code>, running callbacks for all alarms in <code>t</code> whose <code>at &lt;= to_</code>. Callbacks run in nondecreasing order of <code>at</code>. If <code>to_ &lt;= now t</code>, then <code>now t</code> does not change (and in particular does not go backward), but alarms with <code>at &lt;= to_</code> may still may fire.</p></dd></dl><dl><dt class="spec value" id="val-run_at"><a href="#val-run_at" class="anchor"></a><code><span class="keyword">val</span> run_at : [&gt; <a href="../../../core_kernel/Core_kernel/index.html#type-read">Core_kernel.read</a> ] <a href="T1/index.html#type-t">T1.t</a> <span>&#45;&gt;</span> <a href="../../Async_kernel__/Time_ns/index.html#type-t">Async_kernel__.Import.Time_ns.t</a> <span>&#45;&gt;</span> <a href="index.html#type-callback">callback</a> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>run_at t at f</code> schedules an alarm that will run <code>f</code> during the next subsequent <code>advance_by_alarms t ~to_</code> that causes <code>now t &gt;= at</code>. If <code>at &lt;= now t</code>, then <code>f</code> will to run at the next call to <code>advance_by_alarms</code>. <code>f</code> is allowed to do all <code>Synchronous_time_source</code> operations except for <code>advance_by_alarms</code> (because <code>f</code> is already running during <code>advance_by_alarms</code>. Adding alarms is not zero-alloc and the underlying events live in the OCaml heap.</p></dd></dl><dl><dt class="spec value" id="val-run_after"><a href="#val-run_after" class="anchor"></a><code><span class="keyword">val</span> run_after : [&gt; <a href="../../../core_kernel/Core_kernel/index.html#type-read">Core_kernel.read</a> ] <a href="T1/index.html#type-t">T1.t</a> <span>&#45;&gt;</span> <a href="../../../core_kernel/Core_kernel__Time_ns_alternate_sexp/Span/index.html#type-t">Async_kernel__.Import.Time_ns.Span.t</a> <span>&#45;&gt;</span> <a href="index.html#type-callback">callback</a> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>run_after t span f</code> is <code>run_at t (now t + span) f</code>.</p></dd></dl><dl><dt class="spec value" id="val-run_at_intervals"><a href="#val-run_at_intervals" class="anchor"></a><code><span class="keyword">val</span> run_at_intervals : [&gt; <a href="../../../core_kernel/Core_kernel/index.html#type-read">Core_kernel.read</a> ] <a href="T1/index.html#type-t">T1.t</a> <span>&#45;&gt;</span> <a href="../../../core_kernel/Core_kernel__Time_ns_alternate_sexp/Span/index.html#type-t">Async_kernel__.Import.Time_ns.Span.t</a> <span>&#45;&gt;</span> <a href="index.html#type-callback">callback</a> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>run_at_intervals t span f</code> causes <code>f</code> to run at intervals <code>now t + k * span</code>, for k = 0, 1, 2, etc. <code>run_at_intervals</code> raises if <code>span &lt; alarm_precision t</code>.</p></dd></dl><div class="spec module" id="module-Event"><a href="#module-Event" class="anchor"></a><code><span class="keyword">module</span> <a href="Event/index.html">Event</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><dl><dt class="spec value" id="val-default_timing_wheel_config"><a href="#val-default_timing_wheel_config" class="anchor"></a><code><span class="keyword">val</span> default_timing_wheel_config : <a href="../../../core_kernel/Core_kernel__Timing_wheel_ns/Config/index.html#type-t">Core_kernel.Timing_wheel_ns.Config.t</a></code></dt><dt class="spec value" id="val-wall_clock"><a href="#val-wall_clock" class="anchor"></a><code><span class="keyword">val</span> wall_clock : unit <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></dt><dd><p>A time source with <code>now t</code> given by wall-clock time (i.e. <code>Time_ns.now</code>), and automatically advanced at the start of each Async cycle. The wall clock uses the same timing wheel as that used by the Async scheduler, and is hence similarly affected by the <code>ASYNC_CONFIG</code> environment variable.</p></dd></dl></div></body></html>