<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Async_rpc_kernel__Versioned_rpc (async_rpc_kernel.Async_rpc_kernel__Versioned_rpc)</title><link rel="stylesheet" href="../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – <a href="../index.html">async_rpc_kernel</a> &#x00BB; Async_rpc_kernel__Versioned_rpc</nav><h1>Module <code>Async_rpc_kernel__Versioned_rpc</code></h1><p>Infrastructure code for managing RPCs that evolve over time to use different types at different versions.</p><p>Three scenarios are supported:</p><ul><li><p>The <em>caller</em> is responsible for managing versions and dispatches to callees that are written in a version-oblivious way.</p><p>The prototypical example of this scenario is a commander that needs to call out to many assistants for that same system. In this scenario, the assistants each implement a single version of the rpc and the commander has to take this into account.</p></li><li><p>The <em>callee</em> is responsible for managing versions and callers need not bother themselves with any versions.</p><p>The proto-typical example of this scenario is an assistant from one system calling out the commander of another system. In this scenario, the assistants each know a single version of the rpc to call and the commander has to implement them all.</p></li><li><p>Both <em>caller</em> and <em>callee</em> cooperate to decide which version to use, each one being able to use some subset of all possible versions.</p><p>The prototypical example of this scenario is when two systems developed independently with their rpc types defined in some shared library that has yet another independent rollout schedule. In this case one may roll out a new rpc version (V) in the shared library (L) and then the caller and callee systems can each upgrade to the new version of L supporting version V at their own pace, with version V only being exercised once both caller and callee have upgraded.</p></li></ul><p>In each scenario, it is desirable that the party responsible for managing versions be coded largely in terms of a single &quot;master&quot; version of the types involved, with all necessary type conversions relegated to a single module. <code>Versioned_rpc</code> is intended for implementing such a module.</p><p>Type coercions into and out of the model go in the directions indicated by the following diagram:</p><pre>        Caller converts                 Callee converts
        ===============                 ===============

            caller                        callee
            |       callee                |      callee
            |       |       caller        |      |       callee
            |       |       |             |      |       |
         ,--&gt;-- Q1 --&gt; R1 --&gt;-.      Q1 --&gt;-.    |    ,--&gt;-- R1
        /                      \             \   |   /
       Q ---&gt;-- Q2 --&gt; R2 --&gt;-- R    Q2 --&gt;-- Q --&gt; R ---&gt;-- R2
        \                      /             /       \
         `--&gt;-- Q3 --&gt; R3 --&gt;-´      Q3 --&gt;-´         `--&gt;-- R3</pre></header><dl><dt class="spec module" id="module-Menu"><a href="#module-Menu" class="anchor"></a><code><span class="keyword">module</span> <a href="Menu/index.html">Menu</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>Over-the-network discovery of rpc names and versions supported by a callee.</p></dd></dl><div class="spec module" id="module-Connection_with_menu"><a href="#module-Connection_with_menu" class="anchor"></a><code><span class="keyword">module</span> <a href="Connection_with_menu/index.html">Connection_with_menu</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><dl><dt class="spec module" id="module-Versioned_direct_stream_writer"><a href="#module-Versioned_direct_stream_writer" class="anchor"></a><code><span class="keyword">module</span> <a href="Versioned_direct_stream_writer/index.html">Versioned_direct_stream_writer</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>A <code>Versioned_direct_stream_writer.t</code> is an extension of an <code>Rpc.Direct_stream_writer</code>. @see <code>Rpc.Pipe_rpc.Direct_stream_writer</code> for documentation.</p></dd></dl><div class="spec module" id="module-Caller_converts"><a href="#module-Caller_converts" class="anchor"></a><code><span class="keyword">module</span> <a href="Caller_converts/index.html">Caller_converts</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="spec module" id="module-Callee_converts"><a href="#module-Callee_converts" class="anchor"></a><code><span class="keyword">module</span> <a href="Callee_converts/index.html">Callee_converts</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="spec module" id="module-Both_convert"><a href="#module-Both_convert" class="anchor"></a><code><span class="keyword">module</span> <a href="Both_convert/index.html">Both_convert</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div></div></body></html>