<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Log (async_unix.Async_unix.Log)</title><link rel="stylesheet" href="../../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – <a href="../../index.html">async_unix</a> &#x00BB; <a href="../index.html">Async_unix</a> &#x00BB; Log</nav><h1>Module <code>Async_unix.Log</code></h1><p>A library for general logging.</p><p>Although this module is fully Async-safe it exposes almost no Deferreds. This is partially a design choice to minimize the impact of logging in code, and partially the result of organic design (i.e., older versions of this interface did the same thing).</p><p>A (limited) <code>Blocking</code> module is supplied to accommodate the portion of a program that runs outside of Async.</p></header><div class="spec module" id="module-Level"><a href="#module-Level" class="anchor"></a><code><span class="keyword">module</span> <a href="Level/index.html">Level</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="spec module" id="module-Message"><a href="#module-Message" class="anchor"></a><code><span class="keyword">module</span> <a href="Message/index.html">Message</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="spec module" id="module-Rotation"><a href="#module-Rotation" class="anchor"></a><code><span class="keyword">module</span> <a href="Rotation/index.html">Rotation</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="spec module" id="module-Output"><a href="#module-Output" class="anchor"></a><code><span class="keyword">module</span> <a href="Output/index.html">Output</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="spec module" id="module-Blocking"><a href="#module-Blocking" class="anchor"></a><code><span class="keyword">module</span> <a href="Blocking/index.html">Blocking</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><dl><dt class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> t</code></dt></dl><div><div class="spec include"><div class="doc"><details open="open"><summary><span class="def"><code><span class="keyword">include</span> <span class="keyword">sig</span> ... <span class="keyword">end</span></code></span></summary><dl><dt class="spec value" id="val-sexp_of_t"><a href="#val-sexp_of_t" class="anchor"></a><code><span class="keyword">val</span> sexp_of_t : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../../../sexplib0/Sexplib0/Sexp/index.html#type-t">Ppx_sexp_conv_lib.Sexp.t</a></code></dt></dl></details></div></div></div><dl><dt class="spec module-type" id="module-type-Global_intf"><a href="#module-type-Global_intf" class="anchor"></a><code><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-Global_intf/index.html">Global_intf</a> = <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>An interface for singleton logs.</p></dd></dl><dl><dt class="spec module" id="module-Make_global"><a href="#module-Make_global" class="anchor"></a><code><span class="keyword">module</span> <a href="Make_global/index.html">Make_global</a> : <span class="keyword">functor</span> () <a href="index.html#module-type-Global_intf">Global_intf</a></code></dt><dd><p>This functor can be called to generate &quot;singleton&quot; logging modules.</p></dd></dl><dl><dt class="spec module" id="module-Global"><a href="#module-Global" class="anchor"></a><code><span class="keyword">module</span> <a href="Global/index.html">Global</a> : <a href="index.html#module-type-Global_intf">Global_intf</a></code></dt><dd><p>Programs that want simplistic single-channel logging can open this module. It provides a global logging facility to a single output type at a single level. More nuanced logging can be had by using the functions that operate on a distinct <code>Log.t</code> type.</p></dd></dl><dl><dt class="spec value" id="val-set_level_via_param"><a href="#val-set_level_via_param" class="anchor"></a><code><span class="keyword">val</span> set_level_via_param : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> unit <a href="../../../core/Core__Command/Param/index.html#type-t">Core.Command.Param.t</a></code></dt><dd><p>Sets the log level via a flag, if provided.</p></dd></dl><dl><dt class="spec value" id="val-set_level"><a href="#val-set_level" class="anchor"></a><code><span class="keyword">val</span> set_level : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="Level/index.html#type-t">Level.t</a> <span>&#45;&gt;</span> unit</code></dt><dd><p>Messages sent at a level less than the current level will not be output.</p></dd></dl><dl><dt class="spec value" id="val-level"><a href="#val-level" class="anchor"></a><code><span class="keyword">val</span> level : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="Level/index.html#type-t">Level.t</a></code></dt><dd><p>Returns the last level passed to <code>set_level</code>, which will be the log level checked as a threshold against the level of the next message sent.</p></dd></dl><dl><dt class="spec value" id="val-set_output"><a href="#val-set_output" class="anchor"></a><code><span class="keyword">val</span> set_output : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="Output/index.html#type-t">Output.t</a> list <span>&#45;&gt;</span> unit</code></dt><dd><p>Changes the output type of the log, which can be useful when daemonizing. The new output type will be applied to all subsequent messages.</p></dd></dl><dl><dt class="spec value" id="val-get_output"><a href="#val-get_output" class="anchor"></a><code><span class="keyword">val</span> get_output : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="Output/index.html#type-t">Output.t</a> list</code></dt><dt class="spec value" id="val-set_on_error"><a href="#val-set_on_error" class="anchor"></a><code><span class="keyword">val</span> set_on_error : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> [ `Raise | `Call of <a href="../../../core_kernel/Core_kernel/Error/index.html#type-t">Core.Error.t</a> <span>&#45;&gt;</span> unit ] <span>&#45;&gt;</span> unit</code></dt><dd><p>If <code>`Raise</code> is given, then background errors raised by logging will be raised to the monitor that was in scope when <code>create</code> was called. Errors can be redirected anywhere by providing <code>`Call f</code>.</p></dd></dl><dl><dt class="spec value" id="val-close"><a href="#val-close" class="anchor"></a><code><span class="keyword">val</span> close : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> unit <a href="../../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async_unix__.Import.Deferred.t</a></code></dt><dd><p>Any call that writes to a log after <code>close</code> is called will raise.</p></dd></dl><dl><dt class="spec value" id="val-is_closed"><a href="#val-is_closed" class="anchor"></a><code><span class="keyword">val</span> is_closed : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> bool</code></dt><dd><p>Returns true if <code>close</code> has been called.</p></dd></dl><dl><dt class="spec value" id="val-flushed"><a href="#val-flushed" class="anchor"></a><code><span class="keyword">val</span> flushed : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> unit <a href="../../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async_unix__.Import.Deferred.t</a></code></dt><dd><p>Returns a <code>Deferred.t</code> that is fulfilled when the last message delivered to <code>t</code> before the call to <code>flushed</code> is out the door.</p></dd></dl><dl><dt class="spec value" id="val-rotate"><a href="#val-rotate" class="anchor"></a><code><span class="keyword">val</span> rotate : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> unit <a href="../../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async_unix__.Import.Deferred.t</a></code></dt><dd><p>Informs the current <code>Output</code>s to rotate if possible.</p></dd></dl><dl><dt class="spec value" id="val-create"><a href="#val-create" class="anchor"></a><code><span class="keyword">val</span> create : level:<a href="Level/index.html#type-t">Level.t</a> <span>&#45;&gt;</span> output:<a href="Output/index.html#type-t">Output.t</a> list <span>&#45;&gt;</span> on_error:[ `Raise | `Call of <a href="../../../core_kernel/Core_kernel/Error/index.html#type-t">Core.Error.t</a> <span>&#45;&gt;</span> unit ] <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></dt><dd><p>Creates a new log. See <code>set_level</code>, <code>set_on_error</code> and <code>set_output</code> for more.</p></dd></dl><dl><dt class="spec value" id="val-raw"><a href="#val-raw" class="anchor"></a><code><span class="keyword">val</span> raw : ?&#8288;time:<a href="../../../core/Core__/Core_time_float/index.html#type-t">Core.Time.t</a> <span>&#45;&gt;</span> ?&#8288;tags:(string * string) list <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> (<span class="type-var">'a</span>, unit, string, unit) <a href="../../../core/Core/index.html#type-format4">Core.format4</a> <span>&#45;&gt;</span> <span class="type-var">'a</span></code></dt><dd><p>Printf-like logging for raw (no level) messages. Raw messages are still output with a timestamp.</p></dd></dl><dl><dt class="spec value" id="val-debug"><a href="#val-debug" class="anchor"></a><code><span class="keyword">val</span> debug : ?&#8288;time:<a href="../../../core/Core__/Core_time_float/index.html#type-t">Core.Time.t</a> <span>&#45;&gt;</span> ?&#8288;tags:(string * string) list <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> (<span class="type-var">'a</span>, unit, string, unit) <a href="../../../core/Core/index.html#type-format4">Core.format4</a> <span>&#45;&gt;</span> <span class="type-var">'a</span></code></dt><dd><p>Printf-like logging at the <code>`Debug</code> log level.</p></dd></dl><dl><dt class="spec value" id="val-info"><a href="#val-info" class="anchor"></a><code><span class="keyword">val</span> info : ?&#8288;time:<a href="../../../core/Core__/Core_time_float/index.html#type-t">Core.Time.t</a> <span>&#45;&gt;</span> ?&#8288;tags:(string * string) list <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> (<span class="type-var">'a</span>, unit, string, unit) <a href="../../../core/Core/index.html#type-format4">Core.format4</a> <span>&#45;&gt;</span> <span class="type-var">'a</span></code></dt><dd><p>Printf-like logging at the <code>`Info</code> log level.</p></dd></dl><dl><dt class="spec value" id="val-error"><a href="#val-error" class="anchor"></a><code><span class="keyword">val</span> error : ?&#8288;time:<a href="../../../core/Core__/Core_time_float/index.html#type-t">Core.Time.t</a> <span>&#45;&gt;</span> ?&#8288;tags:(string * string) list <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> (<span class="type-var">'a</span>, unit, string, unit) <a href="../../../core/Core/index.html#type-format4">Core.format4</a> <span>&#45;&gt;</span> <span class="type-var">'a</span></code></dt><dd><p>Printf-like logging at the <code>`Error</code> log level.</p></dd></dl><dl><dt class="spec value" id="val-printf"><a href="#val-printf" class="anchor"></a><code><span class="keyword">val</span> printf : ?&#8288;level:<a href="Level/index.html#type-t">Level.t</a> <span>&#45;&gt;</span> ?&#8288;time:<a href="../../../core/Core__/Core_time_float/index.html#type-t">Core.Time.t</a> <span>&#45;&gt;</span> ?&#8288;tags:(string * string) list <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> (<span class="type-var">'a</span>, unit, string, unit) <a href="../../../core/Core/index.html#type-format4">Core.format4</a> <span>&#45;&gt;</span> <span class="type-var">'a</span></code></dt><dd><p>Generalized printf-style logging.</p></dd></dl><dl><dt class="spec value" id="val-sexp"><a href="#val-sexp" class="anchor"></a><code><span class="keyword">val</span> sexp : ?&#8288;level:<a href="Level/index.html#type-t">Level.t</a> <span>&#45;&gt;</span> ?&#8288;time:<a href="../../../core/Core__/Core_time_float/index.html#type-t">Core.Time.t</a> <span>&#45;&gt;</span> ?&#8288;tags:(string * string) list <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../../../core_kernel/Core_kernel/Sexp/index.html#type-t">Core.Sexp.t</a> <span>&#45;&gt;</span> unit</code></dt><dd><p>Log sexps directly.</p></dd></dl><dl><dt class="spec value" id="val-string"><a href="#val-string" class="anchor"></a><code><span class="keyword">val</span> string : ?&#8288;level:<a href="Level/index.html#type-t">Level.t</a> <span>&#45;&gt;</span> ?&#8288;time:<a href="../../../core/Core__/Core_time_float/index.html#type-t">Core.Time.t</a> <span>&#45;&gt;</span> ?&#8288;tags:(string * string) list <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> unit</code></dt><dd><p>Logging of string values.</p></dd></dl><dl><dt class="spec value" id="val-message"><a href="#val-message" class="anchor"></a><code><span class="keyword">val</span> message : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="Message/index.html#type-t">Message.t</a> <span>&#45;&gt;</span> unit</code></dt><dd><p>Log a preexisting message.</p></dd></dl><dl><dt class="spec value" id="val-surround_s"><a href="#val-surround_s" class="anchor"></a><code><span class="keyword">val</span> surround_s : ?&#8288;level:<a href="Level/index.html#type-t">Level.t</a> <span>&#45;&gt;</span> ?&#8288;time:<a href="../../../core/Core__/Core_time_float/index.html#type-t">Core.Time.t</a> <span>&#45;&gt;</span> ?&#8288;tags:(string * string) list <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../../../core_kernel/Core_kernel/Sexp/index.html#type-t">Core.Sexp.t</a> <span>&#45;&gt;</span> (unit <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="../../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async_unix__.Import.Deferred.t</a>) <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="../../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async_unix__.Import.Deferred.t</a></code></dt><dd><p><code>surround t message f</code> logs <code>message</code> and a UUID once before calling <code>f</code> and again after <code>f</code> returns or raises. If <code>f</code> raises, the second message will include the exception, and <code>surround</code> itself will re-raise the exception tagged with <code>message</code>. As usual, the logging happens only if <code>level</code> exceeds the minimum level of <code>t</code>.</p></dd></dl><dl><dt class="spec value" id="val-surroundf"><a href="#val-surroundf" class="anchor"></a><code><span class="keyword">val</span> surroundf : ?&#8288;level:<a href="Level/index.html#type-t">Level.t</a> <span>&#45;&gt;</span> ?&#8288;time:<a href="../../../core/Core__/Core_time_float/index.html#type-t">Core.Time.t</a> <span>&#45;&gt;</span> ?&#8288;tags:(string * string) list <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> (<span class="type-var">'a</span>, unit, string, (unit <span>&#45;&gt;</span> <span class="type-var">'b</span> <a href="../../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async_unix__.Import.Deferred.t</a>) <span>&#45;&gt;</span> <span class="type-var">'b</span> <a href="../../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async_unix__.Import.Deferred.t</a>) <a href="../../../core/Core/index.html#type-format4">Core.format4</a> <span>&#45;&gt;</span> <span class="type-var">'a</span></code></dt><dt class="spec value" id="val-would_log"><a href="#val-would_log" class="anchor"></a><code><span class="keyword">val</span> would_log : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="Level/index.html#type-t">Level.t</a> option <span>&#45;&gt;</span> bool</code></dt><dd><p><code>would_log</code> returns true if a message at the given log level would be logged if sent immediately.</p></dd></dl><div class="spec module" id="module-Reader"><a href="#module-Reader" class="anchor"></a><code><span class="keyword">module</span> <a href="Reader/index.html">Reader</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div></div></body></html>