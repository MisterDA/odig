<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>S (async_unix.Async_unix__.Raw_scheduler.File_descr_watcher.S)</title><link rel="stylesheet" href="../../../../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../../../../index.html">async_unix</a> &#x00BB; <a href="../../../index.html">Async_unix__</a> &#x00BB; <a href="../../index.html">Raw_scheduler</a> &#x00BB; <a href="../index.html">File_descr_watcher</a> &#x00BB; S</nav><h1>Module type <code>File_descr_watcher.S</code></h1></header><div><div class="spec include"><div class="doc"><details open="open"><summary><span class="def"><code><span class="keyword">include</span> <a href="../../../File_descr_watcher_intf/index.html#module-type-S">Async_unix__.File_descr_watcher_intf.S</a></code></span></summary><dl><dt class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> t</code></dt><dd><p>A file-descr-watcher is essentially a map from <code>File_descr.t</code> to <code>bool
      Read_write.t</code>, which defines the set of file descriptors being watched, and for each file descriptor, whether it is being watched for read, write, or both. If a file descriptor is not being watched for either, it is not in the map.</p></dd></dl><div><div class="spec include"><div class="doc"><details open="open"><summary><span class="def"><code><span class="keyword">include</span> <span class="keyword">sig</span> ... <span class="keyword">end</span></code></span></summary><dl><dt class="spec value" id="val-sexp_of_t"><a href="#val-sexp_of_t" class="anchor"></a><code><span class="keyword">val</span> sexp_of_t : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../../../../../sexplib0/Sexplib0/Sexp/index.html#type-t">Ppx_sexp_conv_lib.Sexp.t</a></code></dt></dl></details></div></div></div><div><div class="spec include"><div class="doc"><details open="open"><summary><span class="def"><code><span class="keyword">include</span> <a href="../../../../../async_kernel/Async_kernel__/Async_invariant/index.html#module-type-S">Async_unix__.Import.Invariant.S</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="../../../../../async_kernel/Async_kernel__/Async_invariant/module-type-S/index.html#type-t">t</a> := <a href="index.html#type-t">t</a></code></span></summary><dl><dt class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> t</code></dt></dl><dl><dt class="spec value" id="val-invariant"><a href="#val-invariant" class="anchor"></a><code><span class="keyword">val</span> invariant : <a href="index.html#type-t">t</a> <a href="../../../../../base/Base__/Invariant_intf/index.html#type-inv">Base__.Invariant_intf.inv</a></code></dt></dl></details></div></div></div><dl><dt class="spec type" id="type-additional_create_args"><a href="#type-additional_create_args" class="anchor"></a><code><span class="keyword">type</span> 'a additional_create_args</code></dt><dd><p><code>additional_create_args</code> abstracts over the additional arguments to different file-descr-watcher's <code>create</code> function.</p></dd></dl><dl><dt class="spec value" id="val-create"><a href="#val-create" class="anchor"></a><code><span class="keyword">val</span> create : (num_file_descrs:int <span>&#45;&gt;</span> handle_fd_read_ready:(<a href="../../../../../core/Core__Core_unix/File_descr/index.html#type-t">Async_unix__.Import.File_descr.t</a> <span>&#45;&gt;</span> unit) <span>&#45;&gt;</span> handle_fd_write_ready:(<a href="../../../../../core/Core__Core_unix/File_descr/index.html#type-t">Async_unix__.Import.File_descr.t</a> <span>&#45;&gt;</span> unit) <span>&#45;&gt;</span> <a href="index.html#type-t">t</a>) <a href="index.html#type-additional_create_args">additional_create_args</a></code></dt><dd><p><code>create ~num_file_descrs</code> creates a new file-descr-watcher that is able to watch file descriptors in </p><pre><code class="ml">[0, num_file_descrs) </code></pre><p>.</p></dd></dl><dl><dt class="spec value" id="val-backend"><a href="#val-backend" class="anchor"></a><code><span class="keyword">val</span> backend : <a href="../../../../../async_kernel/Async_kernel__Async_kernel_config/File_descr_watcher/index.html#type-t">Async_unix__.Config.File_descr_watcher.t</a></code></dt><dt class="spec value" id="val-set"><a href="#val-set" class="anchor"></a><code><span class="keyword">val</span> set : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../../../../../core/Core__Core_unix/File_descr/index.html#type-t">Async_unix__.Import.File_descr.t</a> <span>&#45;&gt;</span> bool <a href="../../../Read_write/index.html#type-t">Async_unix__.Read_write.t</a> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>set</code> alters the map of file descriptors being watched. It will take effect on the next call to <code>thread_safe_check</code>. Calling <code>set fd</code> with <code>{ read = false, write =
      false }</code> removes <code>fd</code> from the map.</p></dd></dl><dl><dt class="spec value" id="val-iter"><a href="#val-iter" class="anchor"></a><code><span class="keyword">val</span> iter : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> f:(<a href="../../../../../core/Core__Core_unix/File_descr/index.html#type-t">Async_unix__.Import.File_descr.t</a> <span>&#45;&gt;</span> <a href="../../../../Async_unix__Read_write/Key/index.html#type-t">Async_unix__.Read_write.Key.t</a> <span>&#45;&gt;</span> unit) <span>&#45;&gt;</span> unit</code></dt><dd><p><code>iter t ~f</code> iterates over every file descriptor in the map, apply <code>f</code> to it once for each of {`Read,`Write} that it is being watched for.</p></dd></dl><dl><dt class="spec module" id="module-Pre"><a href="#module-Pre" class="anchor"></a><code><span class="keyword">module</span> <a href="Pre/index.html">Pre</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p><code>pre_check t</code> does whatever non-thread-safe work is necessary to prepare for the system call that checks file descriptors being ready for read or write. <code>pre_check</code> does not side effect <code>t</code>.</p></dd></dl><dl><dt class="spec value" id="val-pre_check"><a href="#val-pre_check" class="anchor"></a><code><span class="keyword">val</span> pre_check : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="Pre/index.html#type-t">Pre.t</a></code></dt></dl><dl><dt class="spec module" id="module-Check_result"><a href="#module-Check_result" class="anchor"></a><code><span class="keyword">module</span> <a href="Check_result/index.html">Check_result</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p><code>thread_safe_check t pre timeout span_or_unit</code> checks the file descriptors for their status and returns when at least one is available, or the <code>timeout, span_or_unit</code> passes. <code>thread_safe_check</code> does not side effect <code>t</code>. Unlike the rest of the functions in this module, <code>thread_safe_check</code> is thread safe.</p></dd></dl><dl><dt class="spec value" id="val-thread_safe_check"><a href="#val-thread_safe_check" class="anchor"></a><code><span class="keyword">val</span> thread_safe_check : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="Pre/index.html#type-t">Pre.t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="../../../File_descr_watcher_intf/Timeout/index.html#type-t">Async_unix__.File_descr_watcher_intf.Timeout.t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> <a href="Check_result/index.html#type-t">Check_result.t</a></code></dt><dt class="spec value" id="val-post_check"><a href="#val-post_check" class="anchor"></a><code><span class="keyword">val</span> post_check : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="Check_result/index.html#type-t">Check_result.t</a> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>post_check t check_result</code> calls the <code>handle_fd*</code> functions supplied to <code>create</code>:</p><p>1. for each file descriptor that is ready to be written to, then 2. for each file descriptor that is ready to be read from.</p><p>We handle writes before reads so that we get all the writes started going to the external world before we process all the reads. This will nicely batch together all the output based on the reads for the next writes.</p><p>It is guaranteed that it calls <code>handle_fd_read*</code> only on an <code>fd</code> that is watched for read as per <code>set</code>, and <code>handle_fd_write*</code> only on an <code>fd</code> that is watched for write as per <code>set</code>.</p></dd></dl><dl><dt class="spec value" id="val-reset_in_forked_process"><a href="#val-reset_in_forked_process" class="anchor"></a><code><span class="keyword">val</span> reset_in_forked_process : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> unit</code></dt></dl></details></div></div></div><dl><dt class="spec value" id="val-watcher"><a href="#val-watcher" class="anchor"></a><code><span class="keyword">val</span> watcher : <a href="index.html#type-t">t</a></code></dt></dl></div></body></html>