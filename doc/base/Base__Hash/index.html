<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Base__Hash (base.Base__Hash)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../index.html">base</a> &#x00BB; Base__Hash</nav><h1>Module <code>Base__Hash</code></h1></header><div class="spec module" id="module-F"><a href="#module-F" class="anchor"></a><code><span class="keyword">module </span>F : <span class="keyword">functor</span> (<a href="F/index.html#argument-1-Hash">Hash</a> : Base__.Hash_intf.S) <span>&#45;&gt;</span> Base__.Hash_intf.Full<span class="keyword"> with </span><span class="keyword">type </span><a href="index.html#module-F">F</a>.hash_value<span class="keyword"> = </span><a href="F/index.html#argument-1-Hash">Hash</a>.hash_value<span class="keyword"> and </span><span class="keyword">type </span><a href="index.html#module-F">F</a>.state<span class="keyword"> = </span><a href="F/index.html#argument-1-Hash">Hash</a>.state<span class="keyword"> and </span><span class="keyword">type </span><a href="index.html#module-F">F</a>.seed<span class="keyword"> = </span><a href="F/index.html#argument-1-Hash">Hash</a>.seed</code></div><div><div class="spec include"><div class="doc"><p>The code of ppx_hash is agnostic to the choice of hash algorithm that is used. However, it is not currently possible to mix various choices of hash algorithms in a given code base.</p><p>We experimented with:</p><ul><li>custom hash algorithms implemented in OCaml (a) and C (b);</li><li>OCaml's internal hash function (c) (which is a custom version of Murmur3, implemented in C)</li><li>siphash, a modern hash function implemented in C (d).</li></ul><p>Our findings were as follows:</p><ul><li>Implementing our own custom hash algorithms in OCaml and C yielded very little performance improvement over the (c) proposal, without providing the benefit of being a peer-reviewed, widely used hash function.</li></ul><ul><li>Siphash (a modern hash function with an internal state of 32 bytes) has a worse performance profile than (a,b,c) above (hashing takes more time). Since its internal state is bigger than an OCaml immediate value, one must either manage allocation of such state explicitly, or paying the cost of allocation each time a hash is computed. While being a supposedly good hash function (with good hash quality), this quality was not translated in measurable improvemenets in our macro benchmarks. (Also, based on the data available at the time of writing, it's unclear that other hash algorithms in this class would be more than marginally faster.)</li></ul><ul><li>By contrast, using the internal combinators of OCaml hash function means that we do not allocate (the internal state of this hash function is 32 bit) and have the same quality and performance as Hashtbl.hash.</li></ul><p>Hence, we are here making the choice of using this Internalhash (that is, Murmur3, the OCaml hash algorithm as of 4.03) as our hash algorithm. It means that the state of the hash function does not need to be preallocated, and makes for simpler use in hash tables and other structures.</p><details open="open"><summary><span class="def"><code><span class="keyword">include </span>Base__.Hash_intf.Full<span class="keyword"> with </span><span class="keyword">type </span><a href="index.html">Base__Hash</a>.state<span class="keyword"> = </span><span class="keyword">private </span>int<span class="keyword"> and </span><span class="keyword">type </span><a href="index.html">Base__Hash</a>.seed<span class="keyword"> = </span>int<span class="keyword"> and </span><span class="keyword">type </span><a href="index.html">Base__Hash</a>.hash_value<span class="keyword"> = </span>int</code></span></summary><dl><dt class="spec value" id="val-description"><a href="#val-description" class="anchor"></a><code><span class="keyword">val </span>description : string</code></dt></dl><dl><dt class="spec type" id="type-state"><a href="#type-state" class="anchor"></a><code><span class="keyword">type </span>state</code><code><span class="keyword"> = </span><span class="keyword">private </span>int</code></dt></dl><dl><dt class="spec value" id="val-fold_int"><a href="#val-fold_int" class="anchor"></a><code><span class="keyword">val </span>fold_int : <a href="index.html#type-state">state</a> <span>&#45;&gt;</span> int <span>&#45;&gt;</span> <a href="index.html#type-state">state</a></code></dt><dt class="spec value" id="val-fold_int64"><a href="#val-fold_int64" class="anchor"></a><code><span class="keyword">val </span>fold_int64 : <a href="index.html#type-state">state</a> <span>&#45;&gt;</span> int64 <span>&#45;&gt;</span> <a href="index.html#type-state">state</a></code></dt><dt class="spec value" id="val-fold_float"><a href="#val-fold_float" class="anchor"></a><code><span class="keyword">val </span>fold_float : <a href="index.html#type-state">state</a> <span>&#45;&gt;</span> float <span>&#45;&gt;</span> <a href="index.html#type-state">state</a></code></dt><dt class="spec value" id="val-fold_string"><a href="#val-fold_string" class="anchor"></a><code><span class="keyword">val </span>fold_string : <a href="index.html#type-state">state</a> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> <a href="index.html#type-state">state</a></code></dt></dl><dl><dt class="spec type" id="type-seed"><a href="#type-seed" class="anchor"></a><code><span class="keyword">type </span>seed</code><code><span class="keyword"> = </span>int</code></dt></dl><dl><dt class="spec value" id="val-alloc"><a href="#val-alloc" class="anchor"></a><code><span class="keyword">val </span>alloc : unit <span>&#45;&gt;</span> <a href="index.html#type-state">state</a></code></dt><dt class="spec value" id="val-reset"><a href="#val-reset" class="anchor"></a><code><span class="keyword">val </span>reset : ?&#8288;seed:<a href="index.html#type-seed">seed</a> <span>&#45;&gt;</span> <a href="index.html#type-state">state</a> <span>&#45;&gt;</span> <a href="index.html#type-state">state</a></code></dt></dl><dl><dt class="spec type" id="type-hash_value"><a href="#type-hash_value" class="anchor"></a><code><span class="keyword">type </span>hash_value</code><code><span class="keyword"> = </span>int</code></dt></dl><dl><dt class="spec value" id="val-get_hash_value"><a href="#val-get_hash_value" class="anchor"></a><code><span class="keyword">val </span>get_hash_value : <a href="index.html#type-state">state</a> <span>&#45;&gt;</span> <a href="index.html#type-hash_value">hash_value</a></code></dt></dl><div class="spec module" id="module-For_tests"><a href="#module-For_tests" class="anchor"></a><code><span class="keyword">module </span><a href="For_tests/index.html">For_tests</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><dl><dt class="spec type" id="type-folder"><a href="#type-folder" class="anchor"></a><code><span class="keyword">type </span>'a folder</code><code><span class="keyword"> = </span><a href="index.html#type-state">state</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> <a href="index.html#type-state">state</a></code></dt></dl><dl><dt class="spec value" id="val-create"><a href="#val-create" class="anchor"></a><code><span class="keyword">val </span>create : ?&#8288;seed:<a href="index.html#type-seed">seed</a> <span>&#45;&gt;</span> unit <span>&#45;&gt;</span> <a href="index.html#type-state">state</a></code></dt></dl><div class="spec module" id="module-Builtin"><a href="#module-Builtin" class="anchor"></a><code><span class="keyword">module </span><a href="Builtin/index.html">Builtin</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><dl><dt class="spec value" id="val-run"><a href="#val-run" class="anchor"></a><code><span class="keyword">val </span>run : ?&#8288;seed:<a href="index.html#type-seed">seed</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-folder">folder</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> <a href="index.html#type-hash_value">hash_value</a></code></dt></dl></details></div></div></div></div></body></html>