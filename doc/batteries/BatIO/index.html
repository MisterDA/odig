<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>BatIO (batteries.BatIO)</title><link rel="stylesheet" href="../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../index.html">batteries</a> &#x00BB; BatIO</nav><h1>Module <code>BatIO</code></h1><p>High-order abstract I/O.</p><p>This module deals with <a href="index.html#type-input"><code>input</code></a>s and <a href="index.html#type-output"><code>output</code></a>s. Inputs are manners of getting information from the outside world and into your program (for instance, reading from the network, from a file, etc.) Outputs are manners of getting information out from your program and into the outside world (for instance, sending something onto the network, onto a file, etc.) In other words, if you are looking for a way to modify files, read from the network, etc., you're in the right place.</p><p>To perform I/O, you first need to <em>open</em> your <a href="index.html#type-input"><code>input</code></a> or your <a href="index.html#type-output"><code>output</code></a>. Chances are that there is an <em>opening</em> operation for this task. Note that most opening operations are defined in their respective module. Operations for opening files are defined in module <code>File</code>, operations for opening communications with the network or with other processes are defined in module <a href="../../ocaml/Unix/index.html"><code>Unix</code></a>. Opening operations related to compression and decompression are defined in module <code>Compress</code>, etc.</p><p>Once you have opened an <a href="index.html#type-input"><code>input</code></a>, you may read the data it contains by using functions such as <a href="index.html#val-read"><code>read</code></a> (to read one character), <a href="index.html#val-nread"><code>nread</code></a> or <a href="index.html#val-input"><code>input</code></a> (to read one string) or one of the <code>read_*</code> functions. If you need not one information but a complete enumeration, for instance for processing many information before writing them, you may also convert the input into an enumeration, by using one of the <code>*s_of</code> functions.</p><p>Once you have opened an <a href="index.html#type-output"><code>output</code></a>, you may write data to this output by using functions scuh as <a href="index.html#val-write"><code>write</code></a> (to write one char), <a href="index.html#val-nwrite"><code>nwrite</code></a> or <a href="index.html#val-output"><code>output</code></a> (to write one string) or one of the <code>write_*</code> functions. If you have not just one piece of data but a complete enumeration, you may write this whole enumeration to the output by using one of the <code>write_*s</code> functions. Note that most operations on output are said to be <em>buffered</em>. This means that small writing operations may be automatically delayed and grouped into large writing operations, as these are generally faster and induce less wear on the hardware. Occasionally, you may wish to force all waiting operations to take place <em>now</em>. For this purpose, you may call function <a href="index.html#val-flush"><code>flush</code></a>.</p><p>Once you have finished using your <a href="index.html#type-input"><code>input</code></a> or your <a href="index.html#type-output"><code>output</code></a>, chances are that you will want to close it. This is not a strict necessity, as OCaml will eventually close it for you when it detects that you have no more need of that <a href="index.html#type-input"><code>input</code></a>/<a href="index.html#type-output"><code>output</code></a>, but this is generally a good policy, as this will let other programs access the resources which are currently allocated to that <a href="index.html#type-input"><code>input</code></a>/<a href="index.html#type-output"><code>output</code></a> -- typically, under Windows, if you are reading the contents of a file from a program, no other program may read the contents of that file simultaneously and you may also not rename or move the file to another directory. To close an <a href="index.html#type-input"><code>input</code></a>, use function <a href="index.html#val-close_in"><code>close_in</code></a> and to close an <a href="index.html#type-output"><code>output</code></a>, use function <a href="index.html#val-close_out"><code>close_out</code></a>.</p><p><b>Note</b> Some <a href="index.html#type-input"><code>input</code></a>s are built on top of other <a href="index.html#type-input"><code>input</code></a>s to provide transparent translations (e.g. on-the-fly decompression of a file or network information) and that some <a href="index.html#type-output"><code>output</code></a>s are built on top of other <a href="index.html#type-output"><code>output</code></a>s for the same purpose (e.g. on-the-fly compression of a file or network information). In this case, closing the &quot;outer&quot; <a href="index.html#type-input"><code>input</code></a>/<a href="index.html#type-output"><code>output</code></a> (e.g. the decompressor/compressor) will <em>not</em> close the &quot;inner&quot; <a href="index.html#type-input"><code>input</code></a>/<a href="index.html#type-output"><code>output</code></a> (e.g. access to the file or to the network). You will need to close the &quot;inner&quot; <a href="index.html#type-input"><code>input</code></a>/<a href="index.html#type-output"><code>output</code></a>, which will automatically flush the outer <a href="index.html#type-input"><code>input</code></a>/<a href="index.html#type-output"><code>output</code></a> and close it.</p><dl><dt>author</dt><dd>Nicolas Cannasse</dd></dl><dl><dt>author</dt><dd>David Teller</dd></dl><dl><dt>author</dt><dd>Philippe Strauss</dd></dl><dl><dt>author</dt><dd>Edgar Friendly</dd></dl><p>@documents BatInnerIO</p><nav class="toc"><ul><li><a href="#standard-inputs/outputs">Standard inputs/outputs</a></li><li><a href="#standard-api">Standard API</a></li><li><a href="#creation-of-batio-inputs/outputs">Creation of BatIO Inputs/Outputs</a></li><li><a href="#utilities">Utilities</a></li><li><a href="#binary-files-api">Binary files API</a></li><li><a href="#bits-api">Bits API</a></li><li><a href="#creating-new-types-of-inputs/outputs">Creating new types of inputs/outputs</a></li><li><a href="#for-compatibility-purposes">For compatibility purposes</a></li><li><a href="#generic-batio-object-wrappers">Generic BatIO Object Wrappers</a></li><li><a href="#enumeration-api">Enumeration API</a></li><li><a href="#thread-safety">Thread-safety</a></li><li><a href="#thread-safety-internals">Thread-safety internals</a></li></ul></nav></header><dl><dt class="spec type" id="type-input"><a href="#type-input" class="anchor"></a><code><span class="keyword">type</span> input</code><code> = <a href="../BatInnerIO/index.html#type-input">BatInnerIO.input</a></code></dt><dd><p>The abstract input type.</p></dd></dl><dl><dt class="spec type" id="type-output"><a href="#type-output" class="anchor"></a><code><span class="keyword">type</span> 'a output</code><code> = <span class="type-var">'a</span> <a href="../BatInnerIO/index.html#type-output">BatInnerIO.output</a></code></dt><dd><p>The abstract output type, <code>'a</code> is the accumulator data, it is returned when the <code>close_out</code> function is called.</p></dd></dl><dl><dt class="spec type" id="type-printer"><a href="#type-printer" class="anchor"></a><code><span class="keyword">type</span> ('a, 'b) printer</code><code> = <span class="type-var">'b</span> <a href="index.html#type-output">output</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> unit</code></dt><dd><p>The type of a printing function to print a <code>'a</code> to an output that produces <code>'b</code> as result.</p></dd></dl><dl><dt class="spec type" id="type-f_printer"><a href="#type-f_printer" class="anchor"></a><code><span class="keyword">type</span> 'a f_printer</code><code> = <a href="../../ocaml/Stdlib/Format/index.html#type-formatter">Stdlib.Format.formatter</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> unit</code></dt></dl><dl><dt class="spec exception" id="exception-No_more_input"><a href="#exception-No_more_input" class="anchor"></a><code><span class="keyword">exception</span> </code><code><span class="exception">No_more_input</span></code></dt><dd><p>This exception is raised when reading on an input with the <code>read</code> or <code>nread</code> functions while there is no available token to read.</p></dd></dl><dl><dt class="spec exception" id="exception-Input_closed"><a href="#exception-Input_closed" class="anchor"></a><code><span class="keyword">exception</span> </code><code><span class="exception">Input_closed</span></code></dt><dd><p>This exception is raised when reading on a closed input.</p></dd></dl><dl><dt class="spec exception" id="exception-Output_closed"><a href="#exception-Output_closed" class="anchor"></a><code><span class="keyword">exception</span> </code><code><span class="exception">Output_closed</span></code></dt><dd><p>This exception is raised when reading on a closed output.</p></dd></dl><section><header><h6 id="standard-inputs/outputs"><a href="#standard-inputs/outputs" class="anchor"></a>Standard inputs/outputs</h6></header><dl><dt class="spec value" id="val-stdin"><a href="#val-stdin" class="anchor"></a><code><span class="keyword">val</span> stdin : <a href="index.html#type-input">input</a></code></dt><dd><p>Standard input, as per Unix/Windows conventions (by default, keyboard).</p><p>Example: <code>if read_line stdin |&gt; Int.of_string &gt; 10 then failwith &quot;too big a number read&quot;; </code></p></dd></dl><dl><dt class="spec value" id="val-stdout"><a href="#val-stdout" class="anchor"></a><code><span class="keyword">val</span> stdout : unit <a href="index.html#type-output">output</a></code></dt><dd><p>Standard output, as per Unix/Windows conventions (by default, console).</p><p>Use this output to display regular messages. Example: <code>
       write_string stdout &quot;Enter your name:&quot;;
       let name = read_line stdin in
       write_line stdout (&quot;Your name is &quot; ^ name);
    </code></p></dd></dl><dl><dt class="spec value" id="val-stderr"><a href="#val-stderr" class="anchor"></a><code><span class="keyword">val</span> stderr : unit <a href="index.html#type-output">output</a></code></dt><dd><p>Standard error output, as per Unix/Windows conventions.</p><p>Use this output to display warnings and error messages.</p><p>Example: <code>
       write_line stderr &quot;Error on Internet - please delete google.com&quot;;
    </code></p></dd></dl><dl><dt class="spec value" id="val-stdnull"><a href="#val-stdnull" class="anchor"></a><code><span class="keyword">val</span> stdnull : unit <a href="index.html#type-output">output</a></code></dt><dd><p>An output which discards everything written to it.</p><p>Use this output to ignore messages.</p><p>Example: <code>
      let out_ch = if debug then stderr else stdnull in
      write_line out_ch &quot;Program running.&quot;;
    </code></p></dd></dl></section><section><header><h6 id="standard-api"><a href="#standard-api" class="anchor"></a>Standard API</h6></header><dl><dt class="spec value" id="val-read"><a href="#val-read" class="anchor"></a><code><span class="keyword">val</span> read : <a href="index.html#type-input">input</a> <span>&#45;&gt;</span> char</code></dt><dd><p>Read a single char from an input or raise <code>No_more_input</code> if no input is available.</p><p>Example: <code>let rec skip_line ch = if read ch = '\n' then skip_line ch else ();</code></p></dd></dl><dl><dt class="spec value" id="val-nread"><a href="#val-nread" class="anchor"></a><code><span class="keyword">val</span> nread : <a href="index.html#type-input">input</a> <span>&#45;&gt;</span> int <span>&#45;&gt;</span> string</code></dt><dd><p><code>nread i n</code> reads a string of size up to <code>n</code> from an input. The function will raise <code>No_more_input</code> if no input is available. It will raise <code>Invalid_argument</code> if <code>n</code> &lt; 0.</p><p>Example: <code>let read_md5 ch = nread ch 32</code></p></dd></dl><dl><dt class="spec value" id="val-really_nread"><a href="#val-really_nread" class="anchor"></a><code><span class="keyword">val</span> really_nread : <a href="index.html#type-input">input</a> <span>&#45;&gt;</span> int <span>&#45;&gt;</span> string</code></dt><dd><p><code>really_nread i n</code> reads a string of exactly <code>n</code> characters from the input. </p><dl><dt>raises No_more_input</dt><dd><p>if at least <code>n</code> characters are not available. </p><p>@raise Invalid_argument</p><p>if <code>n</code> &lt; 0.</p><p>Example: <code>let read_md5 ch = really_nread ch 32</code></p></dd></dl></dd></dl><dl><dt class="spec value" id="val-input"><a href="#val-input" class="anchor"></a><code><span class="keyword">val</span> input : <a href="index.html#type-input">input</a> <span>&#45;&gt;</span> <a href="../../ocaml/Stdlib/Bytes/index.html#type-t">Stdlib.Bytes.t</a> <span>&#45;&gt;</span> int <span>&#45;&gt;</span> int <span>&#45;&gt;</span> int</code></dt><dd><p><code>input i s p len</code> reads up to <code>len</code> characters from the given input, storing them in byte sequence <code>s</code>, starting at character number <code>p</code>. It returns the actual number of characters read (which may be 0) or raise <code>No_more_input</code> if no character can be read. It will raise <code>Invalid_argument</code> if <code>p</code> and <code>len</code> do not designate a valid subsequence of <code>s</code>.</p><p>Example: <code>let map_ch f ?(block_size=100) =
    let b = String.create block_size in
    try while true do
      let l = input ch b 0 block_size in
      f b 0 l;
    done with No_more_input -&gt; ()</code></p></dd></dl><dl><dt class="spec value" id="val-really_input"><a href="#val-really_input" class="anchor"></a><code><span class="keyword">val</span> really_input : <a href="index.html#type-input">input</a> <span>&#45;&gt;</span> <a href="../../ocaml/Stdlib/Bytes/index.html#type-t">Stdlib.Bytes.t</a> <span>&#45;&gt;</span> int <span>&#45;&gt;</span> int <span>&#45;&gt;</span> int</code></dt><dd><p><code>really_input ic s p len</code> reads exactly <code>len</code> characters from the input <code>ic</code>, storing them in the string <code>s</code>, starting at position <code>p</code>. For consistency with <a href="index.html#type-input"><code>BatIO.input</code></a> it returns <code>len</code>. </p><dl><dt>raises No_more_input</dt><dd><p>if at <code>len</code> characters are not available. </p><p>@raise Invalid_argument</p><p>if <code>p</code> and <code>len</code> do not designate a valid substring of <code>s</code>.</p><p>Example: <code>let _ = really_input stdin b 0 3</code></p></dd></dl></dd></dl><dl><dt class="spec value" id="val-close_in"><a href="#val-close_in" class="anchor"></a><code><span class="keyword">val</span> close_in : <a href="index.html#type-input">input</a> <span>&#45;&gt;</span> unit</code></dt><dd><p>Close the input. It can no longer be read from.</p><p>Example: <code>close_in network_in;</code></p></dd></dl><dl><dt class="spec value" id="val-write"><a href="#val-write" class="anchor"></a><code><span class="keyword">val</span> write : (char,Â <span class="type-var">_</span>) <a href="index.html#type-printer">printer</a></code></dt><dd><p>Write a single char to an output.</p><p>Example: <code>write stdout 'x';</code></p></dd></dl><dl><dt class="spec value" id="val-nwrite"><a href="#val-nwrite" class="anchor"></a><code><span class="keyword">val</span> nwrite : (string,Â <span class="type-var">_</span>) <a href="index.html#type-printer">printer</a></code></dt><dd><p>Write a string to an output.</p><p>Example: <code>nwrite stdout &quot;Enter your name: &quot;;</code></p></dd></dl><dl><dt class="spec value" id="val-output"><a href="#val-output" class="anchor"></a><code><span class="keyword">val</span> output : <span class="type-var">'a</span> <a href="index.html#type-output">output</a> <span>&#45;&gt;</span> <a href="../../ocaml/Stdlib/Bytes/index.html#type-t">Stdlib.Bytes.t</a> <span>&#45;&gt;</span> int <span>&#45;&gt;</span> int <span>&#45;&gt;</span> int</code></dt><dd><p><code>output o s p len</code> writes up to <code>len</code> characters from byte sequence <code>s</code>, starting at offset <code>p</code>. It returns the number of characters written. It will raise <code>Invalid_argument</code> if <code>p</code> and <code>len</code> do not designate a valid subsequence of <code>s</code>.</p><p>Example: <code>let written = output stdout (Bytes.to_string &quot;Foo Bar Baz&quot;) 2 4</code></p><p>This writes &quot;o Ba&quot; to stdout, and returns 4.</p></dd></dl><dl><dt class="spec value" id="val-output_substring"><a href="#val-output_substring" class="anchor"></a><code><span class="keyword">val</span> output_substring : <span class="type-var">'a</span> <a href="index.html#type-output">output</a> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> int <span>&#45;&gt;</span> int <span>&#45;&gt;</span> int</code></dt><dd><p>like <code>output</code> above, but outputs from a substring instead of a subsequence of bytes</p><dl><dt>since</dt><dd>2.8.0</dd></dl></dd></dl><dl><dt class="spec value" id="val-really_output"><a href="#val-really_output" class="anchor"></a><code><span class="keyword">val</span> really_output : <span class="type-var">'a</span> <a href="index.html#type-output">output</a> <span>&#45;&gt;</span> <a href="../../ocaml/Stdlib/Bytes/index.html#type-t">Stdlib.Bytes.t</a> <span>&#45;&gt;</span> int <span>&#45;&gt;</span> int <span>&#45;&gt;</span> int</code></dt><dd><p><code>really_output o s p len</code> writes exactly <code>len</code> characters from byte sequence <code>s</code> onto the the output, starting with the character at offset <code>p</code>. For consistency with <a href="index.html#type-output"><code>BatIO.output</code></a> it returns <code>len</code>. </p><dl><dt>raises Invalid_argument</dt><dd><p>if <code>p</code> and <code>len</code> do not designate a valid subsequence of <code>s</code>.</p><p>This function is useful for networking situations where the output buffer might fill resulting in not the entire substring being readied for transmission. Uses <code>output</code> internally, and will raise <code>Sys_blocked_io</code> in the case that any call returns 0.</p></dd></dl></dd></dl><dl><dt class="spec value" id="val-really_output_substring"><a href="#val-really_output_substring" class="anchor"></a><code><span class="keyword">val</span> really_output_substring : <span class="type-var">'a</span> <a href="index.html#type-output">output</a> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> int <span>&#45;&gt;</span> int <span>&#45;&gt;</span> int</code></dt><dd><p>like <code>really_output</code> above, but outputs from a substring instead of a subsequence of bytes</p><dl><dt>since</dt><dd>2.8.0</dd></dl></dd></dl><dl><dt class="spec value" id="val-flush"><a href="#val-flush" class="anchor"></a><code><span class="keyword">val</span> flush : <span class="type-var">'a</span> <a href="index.html#type-output">output</a> <span>&#45;&gt;</span> unit</code></dt><dd><p>Flush an output.</p><p>If previous write operations have caused errors, this may trigger an exception.</p><p>Example: <code>flush stdout;</code></p></dd></dl><dl><dt class="spec value" id="val-flush_all"><a href="#val-flush_all" class="anchor"></a><code><span class="keyword">val</span> flush_all : unit <span>&#45;&gt;</span> unit</code></dt><dd><p>Flush all outputs, ignore errors.</p><p>Example: <code>flush_all ();</code></p></dd></dl><dl><dt class="spec value" id="val-close_out"><a href="#val-close_out" class="anchor"></a><code><span class="keyword">val</span> close_out : <span class="type-var">'a</span> <a href="index.html#type-output">output</a> <span>&#45;&gt;</span> <span class="type-var">'a</span></code></dt><dd><p>Close the output and return its accumulator data.</p><p>The output is flushed before being closed and can no longer be written. Attempting to flush or write after the output has been closed will have no effect.</p><p>Example: <code>
    let strout = output_string () in
    write strout 'x';
    if 2+3&gt;5 then write strout &quot;y&quot;;
    print_string (close_out strout) </code></p></dd></dl></section><section><header><h6 id="creation-of-batio-inputs/outputs"><a href="#creation-of-batio-inputs/outputs" class="anchor"></a>Creation of BatIO Inputs/Outputs</h6><p>To open a file for reading/writing, see <span class="xref-unresolved" title="unresolved reference to &quot;File.open_in&quot;"><code>File</code>.open_in</span> and <span class="xref-unresolved" title="unresolved reference to &quot;File.open_out&quot;"><code>File</code>.open_out</span></p></header><dl><dt class="spec value" id="val-input_string"><a href="#val-input_string" class="anchor"></a><code><span class="keyword">val</span> input_string : string <span>&#45;&gt;</span> <a href="index.html#type-input">input</a></code></dt><dd><p>Create an input that will read from a string.</p><p>Example: <code>
    let inch = input_string &quot;1234554321&quot; in
    let str1 = nread inch 3 in (* &quot;123&quot; *)
    let str2 = nread inch 5 in (* &quot;45543&quot; *)
    let str3 = nread inch 2 in (* &quot;21&quot; *)
    try string_of_char(read inch) with BatIO.No_more_input -&gt; &quot;End of string&quot;;
    </code></p></dd></dl><dl><dt class="spec value" id="val-output_string"><a href="#val-output_string" class="anchor"></a><code><span class="keyword">val</span> output_string : unit <span>&#45;&gt;</span> string <a href="index.html#type-output">output</a></code></dt><dd><p>Create an output that will write into a string in an efficient way. When closed, the output returns all the data written into it.</p></dd></dl><dl><dt class="spec value" id="val-input_enum"><a href="#val-input_enum" class="anchor"></a><code><span class="keyword">val</span> input_enum : char <a href="../BatEnum/index.html#type-t">BatEnum.t</a> <span>&#45;&gt;</span> <a href="index.html#type-input">input</a></code></dt><dd><p>Create an input that will read from an <code>enum</code>.</p></dd></dl><dl><dt class="spec value" id="val-output_enum"><a href="#val-output_enum" class="anchor"></a><code><span class="keyword">val</span> output_enum : unit <span>&#45;&gt;</span> char <a href="../BatEnum/index.html#type-t">BatEnum.t</a> <a href="index.html#type-output">output</a></code></dt><dd><p>Create an output that will write into an <code>enum</code>. The final enum is returned when the output is closed.</p></dd></dl><dl><dt class="spec value" id="val-combine"><a href="#val-combine" class="anchor"></a><code><span class="keyword">val</span> combine : (<span class="type-var">'a</span> <a href="index.html#type-output">output</a> * <span class="type-var">'b</span> <a href="index.html#type-output">output</a>) <span>&#45;&gt;</span> (<span class="type-var">'a</span> * <span class="type-var">'b</span>) <a href="index.html#type-output">output</a></code></dt><dd><p><code>combine (a,b)</code> creates a new <code>output</code> <code>c</code> such that writing to <code>c</code> will actually write to both <code>a</code> and <code>b</code></p></dd></dl><dl><dt class="spec value" id="val-tab_out"><a href="#val-tab_out" class="anchor"></a><code><span class="keyword">val</span> tab_out : ?&#8288;tab:char <span>&#45;&gt;</span> int <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-output">output</a> <span>&#45;&gt;</span> unit <a href="index.html#type-output">output</a></code></dt><dd><p>Create an output shifted to the right by a number of spaces (or other character as specified by <code>tab</code>).</p><p><code>tab_out n out</code> produces a new output for writing into <code>out</code>, in which every new line starts with <code>n</code> spaces.</p><dl><dt>raises Invalid_argument</dt><dd><p>if <code>n</code> &lt; 0.</p><p>Closing <code>tab_out n out</code> does not close <code>out</code>. Rather, closing <code>out</code> closes <code>tab_out n out</code>.</p></dd></dl></dd></dl></section><section><header><h6 id="utilities"><a href="#utilities" class="anchor"></a>Utilities</h6></header><dl><dt class="spec value" id="val-read_all"><a href="#val-read_all" class="anchor"></a><code><span class="keyword">val</span> read_all : <a href="index.html#type-input">input</a> <span>&#45;&gt;</span> string</code></dt><dd><p>read all the contents of the input until <code>No_more_input</code> is raised.</p></dd></dl><dl><dt class="spec value" id="val-pipe"><a href="#val-pipe" class="anchor"></a><code><span class="keyword">val</span> pipe : unit <span>&#45;&gt;</span> <a href="index.html#type-input">input</a> * unit <a href="index.html#type-output">output</a></code></dt><dd><p>Create a pipe between an input and an ouput. Data written from the output can be read from the input.</p></dd></dl><dl><dt class="spec value" id="val-copy"><a href="#val-copy" class="anchor"></a><code><span class="keyword">val</span> copy : ?&#8288;buffer:int <span>&#45;&gt;</span> <a href="index.html#type-input">input</a> <span>&#45;&gt;</span> <span class="type-var">_</span> <a href="index.html#type-output">output</a> <span>&#45;&gt;</span> unit</code></dt><dd><p>Read everything from an input and copy it to an output.</p><dl><dt>parameter buffer</dt><dd><p>The size of the buffer to use for copying, in bytes. By default, this is 4,096b.</p></dd></dl></dd></dl><dl><dt class="spec value" id="val-pos_in"><a href="#val-pos_in" class="anchor"></a><code><span class="keyword">val</span> pos_in : <a href="index.html#type-input">input</a> <span>&#45;&gt;</span> <a href="index.html#type-input">input</a> * (unit <span>&#45;&gt;</span> int)</code></dt><dd><p>Create an input that provide a count function of the number of bytes read from it.</p></dd></dl><dl><dt class="spec value" id="val-progress_in"><a href="#val-progress_in" class="anchor"></a><code><span class="keyword">val</span> progress_in : <a href="index.html#type-input">input</a> <span>&#45;&gt;</span> (unit <span>&#45;&gt;</span> unit) <span>&#45;&gt;</span> <a href="index.html#type-input">input</a></code></dt><dd><p><code>progress_in inp f</code> create an input that calls <code>f ()</code> whenever some content is succesfully read from it.</p></dd></dl><dl><dt class="spec value" id="val-pos_out"><a href="#val-pos_out" class="anchor"></a><code><span class="keyword">val</span> pos_out : <span class="type-var">'a</span> <a href="index.html#type-output">output</a> <span>&#45;&gt;</span> unit <a href="index.html#type-output">output</a> * (unit <span>&#45;&gt;</span> int)</code></dt><dd><p>Create an output that provide a count function of the number of bytes written through it.</p></dd></dl><dl><dt class="spec value" id="val-progress_out"><a href="#val-progress_out" class="anchor"></a><code><span class="keyword">val</span> progress_out : <span class="type-var">'a</span> <a href="index.html#type-output">output</a> <span>&#45;&gt;</span> (unit <span>&#45;&gt;</span> unit) <span>&#45;&gt;</span> unit <a href="index.html#type-output">output</a></code></dt><dd><p><code>progress_out out f</code> create an output that calls <code>f ()</code> whenever some content is succesfully written to it.</p></dd></dl><dl><dt class="spec external" id="val-cast_output"><a href="#val-cast_output" class="anchor"></a><code><span class="keyword">val</span> cast_output : <span class="type-var">'a</span> <a href="index.html#type-output">output</a> <span>&#45;&gt;</span> unit <a href="index.html#type-output">output</a></code></dt><dd><p>You can safely transform any output to an unit output in a safe way by using this function.</p></dd></dl></section><section><header><h6 id="binary-files-api"><a href="#binary-files-api" class="anchor"></a>Binary files API</h6><p>Here is some API useful for working with binary files, in particular binary files generated by C applications. By default, encoding of multibyte integers is low-endian. The <a href="BigEndian/index.html"><code>BigEndian</code></a> module provide multibyte operations with other encoding.</p></header><dl><dt class="spec exception" id="exception-Overflow"><a href="#exception-Overflow" class="anchor"></a><code><span class="keyword">exception</span> </code><code><span class="exception">Overflow</span> <span class="keyword">of</span> string</code></dt><dd><p>Exception raised when a read or write operation cannot be completed.</p></dd></dl><dl><dt class="spec value" id="val-read_byte"><a href="#val-read_byte" class="anchor"></a><code><span class="keyword">val</span> read_byte : <a href="index.html#type-input">input</a> <span>&#45;&gt;</span> int</code></dt><dd><p>Read an unsigned 8-bit integer.</p></dd></dl><dl><dt class="spec value" id="val-read_signed_byte"><a href="#val-read_signed_byte" class="anchor"></a><code><span class="keyword">val</span> read_signed_byte : <a href="index.html#type-input">input</a> <span>&#45;&gt;</span> int</code></dt><dd><p>Read an signed 8-bit integer.</p></dd></dl><dl><dt class="spec value" id="val-read_ui16"><a href="#val-read_ui16" class="anchor"></a><code><span class="keyword">val</span> read_ui16 : <a href="index.html#type-input">input</a> <span>&#45;&gt;</span> int</code></dt><dd><p>Read an unsigned 16-bit word.</p></dd></dl><dl><dt class="spec value" id="val-read_i16"><a href="#val-read_i16" class="anchor"></a><code><span class="keyword">val</span> read_i16 : <a href="index.html#type-input">input</a> <span>&#45;&gt;</span> int</code></dt><dd><p>Read a signed 16-bit word.</p></dd></dl><dl><dt class="spec value" id="val-read_i32"><a href="#val-read_i32" class="anchor"></a><code><span class="keyword">val</span> read_i32 : <a href="index.html#type-input">input</a> <span>&#45;&gt;</span> int</code></dt><dd><p>Read a signed 32-bit integer. </p><dl><dt>raises Overflow</dt><dd><p>if the read integer cannot be represented as an OCaml 31-bit integer.</p></dd></dl></dd></dl><dl><dt class="spec value" id="val-read_real_i32"><a href="#val-read_real_i32" class="anchor"></a><code><span class="keyword">val</span> read_real_i32 : <a href="index.html#type-input">input</a> <span>&#45;&gt;</span> int32</code></dt><dd><p>Read a signed 32-bit integer as an OCaml int32.</p></dd></dl><dl><dt class="spec value" id="val-read_i64"><a href="#val-read_i64" class="anchor"></a><code><span class="keyword">val</span> read_i64 : <a href="index.html#type-input">input</a> <span>&#45;&gt;</span> int64</code></dt><dd><p>Read a signed 64-bit integer as an OCaml int64.</p></dd></dl><dl><dt class="spec value" id="val-read_float"><a href="#val-read_float" class="anchor"></a><code><span class="keyword">val</span> read_float : <a href="index.html#type-input">input</a> <span>&#45;&gt;</span> float</code></dt><dd><p>Read an IEEE single precision floating point value.</p></dd></dl><dl><dt class="spec value" id="val-read_double"><a href="#val-read_double" class="anchor"></a><code><span class="keyword">val</span> read_double : <a href="index.html#type-input">input</a> <span>&#45;&gt;</span> float</code></dt><dd><p>Read an IEEE double precision floating point value.</p></dd></dl><dl><dt class="spec value" id="val-read_string"><a href="#val-read_string" class="anchor"></a><code><span class="keyword">val</span> read_string : <a href="index.html#type-input">input</a> <span>&#45;&gt;</span> string</code></dt><dd><p>Read a null-terminated string.</p></dd></dl><dl><dt class="spec value" id="val-read_line"><a href="#val-read_line" class="anchor"></a><code><span class="keyword">val</span> read_line : <a href="index.html#type-input">input</a> <span>&#45;&gt;</span> string</code></dt><dd><p>Read a LF or CRLF terminated string. If the source runs out of input before a LF is found, returns a string of the remaining input. Will raise <code>No_more_input</code> only if no characters are available.</p></dd></dl><dl><dt class="spec value" id="val-write_byte"><a href="#val-write_byte" class="anchor"></a><code><span class="keyword">val</span> write_byte : (int,Â <span class="type-var">_</span>) <a href="index.html#type-printer">printer</a></code></dt><dd><p>Write an unsigned 8-bit byte.</p></dd></dl><dl><dt class="spec value" id="val-write_ui16"><a href="#val-write_ui16" class="anchor"></a><code><span class="keyword">val</span> write_ui16 : (int,Â <span class="type-var">_</span>) <a href="index.html#type-printer">printer</a></code></dt><dd><p>Write an unsigned 16-bit word.</p></dd></dl><dl><dt class="spec value" id="val-write_i16"><a href="#val-write_i16" class="anchor"></a><code><span class="keyword">val</span> write_i16 : (int,Â <span class="type-var">_</span>) <a href="index.html#type-printer">printer</a></code></dt><dd><p>Write a signed 16-bit word.</p></dd></dl><dl><dt class="spec value" id="val-write_i32"><a href="#val-write_i32" class="anchor"></a><code><span class="keyword">val</span> write_i32 : (int,Â <span class="type-var">_</span>) <a href="index.html#type-printer">printer</a></code></dt><dd><p>Write a signed 32-bit integer.</p></dd></dl><dl><dt class="spec value" id="val-write_real_i32"><a href="#val-write_real_i32" class="anchor"></a><code><span class="keyword">val</span> write_real_i32 : (int32,Â <span class="type-var">_</span>) <a href="index.html#type-printer">printer</a></code></dt><dd><p>Write an OCaml int32.</p></dd></dl><dl><dt class="spec value" id="val-write_i64"><a href="#val-write_i64" class="anchor"></a><code><span class="keyword">val</span> write_i64 : (int64,Â <span class="type-var">_</span>) <a href="index.html#type-printer">printer</a></code></dt><dd><p>Write an OCaml int64.</p></dd></dl><dl><dt class="spec value" id="val-write_double"><a href="#val-write_double" class="anchor"></a><code><span class="keyword">val</span> write_double : (float,Â <span class="type-var">_</span>) <a href="index.html#type-printer">printer</a></code></dt><dd><p>Write an IEEE double precision floating point value.</p></dd></dl><dl><dt class="spec value" id="val-write_float"><a href="#val-write_float" class="anchor"></a><code><span class="keyword">val</span> write_float : (float,Â <span class="type-var">_</span>) <a href="index.html#type-printer">printer</a></code></dt><dd><p>Write an IEEE single precision floating point value.</p></dd></dl><dl><dt class="spec value" id="val-write_string"><a href="#val-write_string" class="anchor"></a><code><span class="keyword">val</span> write_string : (string,Â <span class="type-var">_</span>) <a href="index.html#type-printer">printer</a></code></dt><dd><p>Write a string and append an null character.</p></dd></dl><dl><dt class="spec value" id="val-write_line"><a href="#val-write_line" class="anchor"></a><code><span class="keyword">val</span> write_line : (string,Â <span class="type-var">_</span>) <a href="index.html#type-printer">printer</a></code></dt><dd><p>Write a line and append a line end.</p><p>This adds the correct line end for your operating system. That is, if you are writing to a file and your system imposes that files should end lines with character LF (or <code>'\n'</code>), as Unix, then a LF is inserted at the end of the line. If your system favors CRLF (or <code>'\r\n'</code>), then this is what will be inserted.</p></dd></dl><dl><dt class="spec module" id="module-BigEndian"><a href="#module-BigEndian" class="anchor"></a><code><span class="keyword">module</span> <a href="BigEndian/index.html">BigEndian</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>Same operations as module <a href="index.html"><code>BatIO</code></a>, but with big-endian encoding</p></dd></dl></section><section><header><h6 id="bits-api"><a href="#bits-api" class="anchor"></a>Bits API</h6><p>This enable you to read and write from an BatIO bit-by-bit or several bits at the same time.</p></header><dl><dt class="spec type" id="type-in_bits"><a href="#type-in_bits" class="anchor"></a><code><span class="keyword">type</span> in_bits</code></dt><dt class="spec type" id="type-out_bits"><a href="#type-out_bits" class="anchor"></a><code><span class="keyword">type</span> out_bits</code></dt></dl><dl><dt class="spec exception" id="exception-Bits_error"><a href="#exception-Bits_error" class="anchor"></a><code><span class="keyword">exception</span> </code><code><span class="exception">Bits_error</span></code></dt></dl><dl><dt class="spec value" id="val-input_bits"><a href="#val-input_bits" class="anchor"></a><code><span class="keyword">val</span> input_bits : <a href="index.html#type-input">input</a> <span>&#45;&gt;</span> <a href="index.html#type-in_bits">in_bits</a></code></dt><dd><p>Read bits from an input</p></dd></dl><dl><dt class="spec value" id="val-output_bits"><a href="#val-output_bits" class="anchor"></a><code><span class="keyword">val</span> output_bits : <span class="type-var">'a</span> <a href="index.html#type-output">output</a> <span>&#45;&gt;</span> <a href="index.html#type-out_bits">out_bits</a></code></dt><dd><p>Write bits to an output</p></dd></dl><dl><dt class="spec value" id="val-read_bits"><a href="#val-read_bits" class="anchor"></a><code><span class="keyword">val</span> read_bits : <a href="index.html#type-in_bits">in_bits</a> <span>&#45;&gt;</span> int <span>&#45;&gt;</span> int</code></dt><dd><p>Read up to 31 bits, raise Bits_error if n &lt; 0 or n &gt; 31</p></dd></dl><dl><dt class="spec value" id="val-write_bits"><a href="#val-write_bits" class="anchor"></a><code><span class="keyword">val</span> write_bits : <a href="index.html#type-out_bits">out_bits</a> <span>&#45;&gt;</span> nbits:int <span>&#45;&gt;</span> int <span>&#45;&gt;</span> unit</code></dt><dd><p>Write up to 31 bits represented as a value, raise Bits_error if nbits &lt; 0 or nbits &gt; 31 or the value representation excess nbits.</p></dd></dl><dl><dt class="spec value" id="val-flush_bits"><a href="#val-flush_bits" class="anchor"></a><code><span class="keyword">val</span> flush_bits : <a href="index.html#type-out_bits">out_bits</a> <span>&#45;&gt;</span> unit</code></dt><dd><p>Flush remaining unwritten bits, adding up to 7 bits which values 0.</p></dd></dl><dl><dt class="spec value" id="val-drop_bits"><a href="#val-drop_bits" class="anchor"></a><code><span class="keyword">val</span> drop_bits : <a href="index.html#type-in_bits">in_bits</a> <span>&#45;&gt;</span> unit</code></dt><dd><p>Drop up to 7 buffered bits and restart to next input character.</p></dd></dl></section><section><header><h6 id="creating-new-types-of-inputs/outputs"><a href="#creating-new-types-of-inputs/outputs" class="anchor"></a>Creating new types of inputs/outputs</h6></header><dl><dt class="spec value" id="val-create_in"><a href="#val-create_in" class="anchor"></a><code><span class="keyword">val</span> create_in : read:(unit <span>&#45;&gt;</span> char) <span>&#45;&gt;</span> input:(<a href="../../ocaml/Stdlib/Bytes/index.html#type-t">Stdlib.Bytes.t</a> <span>&#45;&gt;</span> int <span>&#45;&gt;</span> int <span>&#45;&gt;</span> int) <span>&#45;&gt;</span> close:(unit <span>&#45;&gt;</span> unit) <span>&#45;&gt;</span> <a href="index.html#type-input">input</a></code></dt><dd><p>Fully create an input by giving all the needed functions.</p><p><b>Note</b> Do <em>not</em> use this function for creating an input which reads from one or more underlying inputs. Rather, use <a href="index.html#val-wrap_in"><code>wrap_in</code></a>.</p></dd></dl><dl><dt class="spec value" id="val-wrap_in"><a href="#val-wrap_in" class="anchor"></a><code><span class="keyword">val</span> wrap_in : read:(unit <span>&#45;&gt;</span> char) <span>&#45;&gt;</span> input:(<a href="../../ocaml/Stdlib/Bytes/index.html#type-t">Stdlib.Bytes.t</a> <span>&#45;&gt;</span> int <span>&#45;&gt;</span> int <span>&#45;&gt;</span> int) <span>&#45;&gt;</span> close:(unit <span>&#45;&gt;</span> unit) <span>&#45;&gt;</span> underlying:<a href="index.html#type-input">input</a> list <span>&#45;&gt;</span> <a href="index.html#type-input">input</a></code></dt><dd><p>Fully create an input reading from other inputs by giving all the needed functions.</p><p>This function is a more general version of <a href="index.html#val-create_in"><code>create_in</code></a> which also handles dependency management between inputs.</p><p><b>Note</b> When you create an input which reads from another input, function <code>close</code> should <em>not</em> close the inputs of <code>underlying</code>. Doing so is a common error, which could result in inadvertently closing <a href="index.html#val-stdin"><code>stdin</code></a> or a network socket, etc.</p></dd></dl><dl><dt class="spec value" id="val-inherit_in"><a href="#val-inherit_in" class="anchor"></a><code><span class="keyword">val</span> inherit_in : ?&#8288;read:(unit <span>&#45;&gt;</span> char) <span>&#45;&gt;</span> ?&#8288;input:(<a href="../../ocaml/Stdlib/Bytes/index.html#type-t">Stdlib.Bytes.t</a> <span>&#45;&gt;</span> int <span>&#45;&gt;</span> int <span>&#45;&gt;</span> int) <span>&#45;&gt;</span> ?&#8288;close:(unit <span>&#45;&gt;</span> unit) <span>&#45;&gt;</span> <a href="index.html#type-input">input</a> <span>&#45;&gt;</span> <a href="index.html#type-input">input</a></code></dt><dd><p>Simplified and optimized version of <a href="index.html#val-wrap_in"><code>wrap_in</code></a> which may be used whenever only one input appears as dependency.</p><p><code>inherit_in inp</code> will return an input identical to <code>inp</code>. <code>inherit_in ~read inp</code> will return an input identical to <code>inp</code> except for method <code>read</code>, etc.</p><p>You do not need to close <code>inp</code> in <code>close</code>.</p></dd></dl><dl><dt class="spec value" id="val-create_out"><a href="#val-create_out" class="anchor"></a><code><span class="keyword">val</span> create_out : write:(char <span>&#45;&gt;</span> unit) <span>&#45;&gt;</span> output:(<a href="../../ocaml/Stdlib/Bytes/index.html#type-t">Stdlib.Bytes.t</a> <span>&#45;&gt;</span> int <span>&#45;&gt;</span> int <span>&#45;&gt;</span> int) <span>&#45;&gt;</span> flush:(unit <span>&#45;&gt;</span> unit) <span>&#45;&gt;</span> close:(unit <span>&#45;&gt;</span> <span class="type-var">'a</span>) <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-output">output</a></code></dt><dd><p>Fully create an output by giving all the needed functions.</p><dl><dt>parameter write</dt><dd><p>Write one character to the output (see <a href="index.html#val-write"><code>write</code></a>).</p></dd></dl><dl><dt>parameter output</dt><dd><p>Write a (sub)string to the output (see <a href="index.html#type-output"><code>output</code></a>).</p></dd></dl><dl><dt>parameter flush</dt><dd><p>Flush any buffers of this output (see <a href="index.html#val-flush"><code>flush</code></a>).</p></dd></dl><dl><dt>parameter close</dt><dd><p>Close this output. The output will be automatically flushed.</p><p><b>Note</b> Do <em>not</em> use this function for creating an output which writes to one or more underlying outputs. Rather, use <a href="index.html#val-wrap_out"><code>wrap_out</code></a>.</p></dd></dl></dd></dl><dl><dt class="spec value" id="val-wrap_out"><a href="#val-wrap_out" class="anchor"></a><code><span class="keyword">val</span> wrap_out : write:(char <span>&#45;&gt;</span> unit) <span>&#45;&gt;</span> output:(<a href="../../ocaml/Stdlib/Bytes/index.html#type-t">Stdlib.Bytes.t</a> <span>&#45;&gt;</span> int <span>&#45;&gt;</span> int <span>&#45;&gt;</span> int) <span>&#45;&gt;</span> flush:(unit <span>&#45;&gt;</span> unit) <span>&#45;&gt;</span> close:(unit <span>&#45;&gt;</span> <span class="type-var">'a</span>) <span>&#45;&gt;</span> underlying:<span class="type-var">'b</span> <a href="index.html#type-output">output</a> list <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-output">output</a></code></dt><dd><p>Fully create an output that writes to one or more underlying outputs.</p><p>This function is a more general version of <a href="index.html#val-create_out"><code>create_out</code></a>, which also handles dependency management between outputs.</p><p>To illustrate the need for dependency management, let us consider the following values:</p><ul><li>an output <code>out</code></li><li>a function <code>f : _ output -&gt; _ output</code>, using <a href="index.html#val-create_out"><code>create_out</code></a> to create a new output for writing some data to an underyling output (for instance, a function comparale to <a href="index.html#val-tab_out"><code>tab_out</code></a> or a function performing transparent compression or transparent traduction between encodings)</li></ul><p>With these values, let us consider the following scenario</p><ul><li>a new output <code>f out</code> is created</li><li>some data is written to <code>f out</code> but not flushed</li><li>output <code>out</code> is closed, perhaps manually or as a consequence of garbage-collection, or because the program has ended</li><li>data written to <code>f out</code> is flushed.</li></ul><p>In this case, data reaches <code>out</code> only after <code>out</code> has been closed. Despite appearances, it is quite easy to reach such situation, especially in short programs.</p><p>If, instead, <code>f</code> uses <code>wrap_out</code>, then when output <code>out</code> is closed, <code>f out</code> is first automatically flushed and closed, which avoids the issue.</p><dl><dt>parameter write</dt><dd><p>Write one character to the output (see <a href="index.html#val-write"><code>write</code></a>).</p></dd></dl><dl><dt>parameter output</dt><dd><p>Write a (sub)string to the output (see <a href="index.html#type-output"><code>output</code></a>).</p></dd></dl><dl><dt>parameter flush</dt><dd><p>Flush any buffers of this output (see <a href="index.html#val-flush"><code>flush</code></a>).</p></dd></dl><dl><dt>parameter close</dt><dd><p>Close this output. The output will be automatically flushed.</p></dd></dl><dl><dt>parameter underlying</dt><dd><p>The list of outputs to which the new output will write.</p><p><b>Note</b> Function <code>close</code> should <em>not</em> close <code>underlying</code> yourself. This is a common mistake which may cause sockets or standard output to be closed while they are still being used by another part of the program.</p></dd></dl></dd></dl><dl><dt class="spec value" id="val-inherit_out"><a href="#val-inherit_out" class="anchor"></a><code><span class="keyword">val</span> inherit_out : ?&#8288;write:(char <span>&#45;&gt;</span> unit) <span>&#45;&gt;</span> ?&#8288;output:(<a href="../../ocaml/Stdlib/Bytes/index.html#type-t">Stdlib.Bytes.t</a> <span>&#45;&gt;</span> int <span>&#45;&gt;</span> int <span>&#45;&gt;</span> int) <span>&#45;&gt;</span> ?&#8288;flush:(unit <span>&#45;&gt;</span> unit) <span>&#45;&gt;</span> ?&#8288;close:(unit <span>&#45;&gt;</span> unit) <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-output">output</a> <span>&#45;&gt;</span> unit <a href="index.html#type-output">output</a></code></dt><dd><p>Simplified and optimized version of <a href="index.html#val-wrap_out"><code>wrap_out</code></a> whenever only one output appears as dependency.</p><p><code>inherit_out out</code> will return an output identical to <code>out</code>. <code>inherit_out ~write out</code> will return an output identical to <code>out</code> except for its <code>write</code> method, etc.</p><p>You do not need to close <code>out</code> in <code>close</code>.</p></dd></dl></section><section><header><h6 id="for-compatibility-purposes"><a href="#for-compatibility-purposes" class="anchor"></a>For compatibility purposes</h6></header><dl><dt class="spec value" id="val-input_channel"><a href="#val-input_channel" class="anchor"></a><code><span class="keyword">val</span> input_channel : ?&#8288;autoclose:bool <span>&#45;&gt;</span> ?&#8288;cleanup:bool <span>&#45;&gt;</span> <a href="../../ocaml/Stdlib/index.html#type-in_channel">Stdlib.in_channel</a> <span>&#45;&gt;</span> <a href="index.html#type-input">input</a></code></dt><dd><p>Create an input that will read from a channel.</p><dl><dt>parameter autoclose</dt><dd><p>If true or unspecified, the <a href="index.html#type-input"><code>input</code></a> will be automatically closed when the underlying <code>in_channel</code> has reached its end.</p></dd></dl><dl><dt>parameter cleanup</dt><dd><p>If true, the channel will be automatically closed when the <a href="index.html#type-input"><code>input</code></a> is closed. Otherwise, you will need to close the channel manually.</p></dd></dl></dd></dl><dl><dt class="spec value" id="val-output_channel"><a href="#val-output_channel" class="anchor"></a><code><span class="keyword">val</span> output_channel : ?&#8288;cleanup:bool <span>&#45;&gt;</span> <a href="../../ocaml/Stdlib/index.html#type-out_channel">Stdlib.out_channel</a> <span>&#45;&gt;</span> unit <a href="index.html#type-output">output</a></code></dt><dd><p>Create an output that will write into a channel.</p><dl><dt>parameter cleanup</dt><dd><p>If true, the channel will be automatically closed when the <a href="index.html#type-output"><code>output</code></a> is closed. Otherwise, you will need to close the channel manually.</p></dd></dl></dd></dl><dl><dt class="spec value" id="val-to_input_channel"><a href="#val-to_input_channel" class="anchor"></a><code><span class="keyword">val</span> to_input_channel : <a href="index.html#type-input">input</a> <span>&#45;&gt;</span> <a href="../../ocaml/Stdlib/index.html#type-in_channel">Stdlib.in_channel</a></code></dt><dd><p>Create a channel that will read from an input.</p><p><b>Note</b> This function is extremely costly and is provided essentially for debugging purposes or for reusing legacy libraries which can't be adapted. As a general rule, if you can avoid using this function, don't use it.</p></dd></dl></section><section><header><h6 id="generic-batio-object-wrappers"><a href="#generic-batio-object-wrappers" class="anchor"></a>Generic BatIO Object Wrappers</h6><p>These OO Wrappers have been written to provide easy support of BatIO by external librairies. If you want your library to support BatIO without actually requiring Batteries to compile, you can implement the classes <code>in_channel</code>, <code>out_channel</code>, <code>poly_in_channel</code> and/or <code>poly_out_channel</code> which are the common BatIO specifications established for ExtLib, OCamlNet and Camomile.</p><p>(see http://www.ocaml-programming.de/tmp/BatIO-Classes.html for more details).</p><p><b>Note</b> In this version of Batteries Included, the object wrappers are <em>not</em> closed automatically by garbage-collection.</p></header><div class="spec class" id="class-in_channel"><a href="#class-in_channel" class="anchor"></a><code><span class="keyword">class</span> <a href="class-in_channel/index.html">in_channel</a> : <a href="index.html#type-input">input</a> <span>&#45;&gt;</span> <span class="keyword">object</span> ... <span class="keyword">end</span></code></div><div class="spec class" id="class-out_channel"><a href="#class-out_channel" class="anchor"></a><code><span class="keyword">class</span> <a href="class-out_channel/index.html">out_channel</a> : <span class="type-var">'a</span> <a href="index.html#type-output">output</a> <span>&#45;&gt;</span> <span class="keyword">object</span> ... <span class="keyword">end</span></code></div><div class="spec class" id="class-in_chars"><a href="#class-in_chars" class="anchor"></a><code><span class="keyword">class</span> <a href="class-in_chars/index.html">in_chars</a> : <a href="index.html#type-input">input</a> <span>&#45;&gt;</span> <span class="keyword">object</span> ... <span class="keyword">end</span></code></div><div class="spec class" id="class-out_chars"><a href="#class-out_chars" class="anchor"></a><code><span class="keyword">class</span> <a href="class-out_chars/index.html">out_chars</a> : <span class="type-var">'a</span> <a href="index.html#type-output">output</a> <span>&#45;&gt;</span> <span class="keyword">object</span> ... <span class="keyword">end</span></code></div><dl><dt class="spec value" id="val-from_in_channel"><a href="#val-from_in_channel" class="anchor"></a><code><span class="keyword">val</span> from_in_channel : <a href="class-in_channel/index.html">in_channel</a> <span>&#45;&gt;</span> <a href="index.html#type-input">input</a></code></dt><dt class="spec value" id="val-from_out_channel"><a href="#val-from_out_channel" class="anchor"></a><code><span class="keyword">val</span> from_out_channel : <a href="class-out_channel/index.html">out_channel</a> <span>&#45;&gt;</span> unit <a href="index.html#type-output">output</a></code></dt><dt class="spec value" id="val-from_in_chars"><a href="#val-from_in_chars" class="anchor"></a><code><span class="keyword">val</span> from_in_chars : <a href="class-in_chars/index.html">in_chars</a> <span>&#45;&gt;</span> <a href="index.html#type-input">input</a></code></dt><dt class="spec value" id="val-from_out_chars"><a href="#val-from_out_chars" class="anchor"></a><code><span class="keyword">val</span> from_out_chars : <a href="class-out_chars/index.html">out_chars</a> <span>&#45;&gt;</span> unit <a href="index.html#type-output">output</a></code></dt></dl></section><section><header><h6 id="enumeration-api"><a href="#enumeration-api" class="anchor"></a>Enumeration API</h6></header><dl><dt class="spec value" id="val-bytes_of"><a href="#val-bytes_of" class="anchor"></a><code><span class="keyword">val</span> bytes_of : <a href="index.html#type-input">input</a> <span>&#45;&gt;</span> int <a href="../BatEnum/index.html#type-t">BatEnum.t</a></code></dt><dd><p>Read an enumeration of unsigned 8-bit integers.</p></dd></dl><dl><dt class="spec value" id="val-signed_bytes_of"><a href="#val-signed_bytes_of" class="anchor"></a><code><span class="keyword">val</span> signed_bytes_of : <a href="index.html#type-input">input</a> <span>&#45;&gt;</span> int <a href="../BatEnum/index.html#type-t">BatEnum.t</a></code></dt><dd><p>Read an enumeration of signed 8-bit integers.</p></dd></dl><dl><dt class="spec value" id="val-ui16s_of"><a href="#val-ui16s_of" class="anchor"></a><code><span class="keyword">val</span> ui16s_of : <a href="index.html#type-input">input</a> <span>&#45;&gt;</span> int <a href="../BatEnum/index.html#type-t">BatEnum.t</a></code></dt><dd><p>Read an enumeration of unsigned 16-bit words.</p></dd></dl><dl><dt class="spec value" id="val-i16s_of"><a href="#val-i16s_of" class="anchor"></a><code><span class="keyword">val</span> i16s_of : <a href="index.html#type-input">input</a> <span>&#45;&gt;</span> int <a href="../BatEnum/index.html#type-t">BatEnum.t</a></code></dt><dd><p>Read an enumartion of signed 16-bit words.</p></dd></dl><dl><dt class="spec value" id="val-i32s_of"><a href="#val-i32s_of" class="anchor"></a><code><span class="keyword">val</span> i32s_of : <a href="index.html#type-input">input</a> <span>&#45;&gt;</span> int <a href="../BatEnum/index.html#type-t">BatEnum.t</a></code></dt><dd><p>Read an enumeration of signed 32-bit integers. </p><dl><dt>raises Overflow</dt><dd><p>if the read integer cannot be represented as an OCaml 31-bit integer.</p></dd></dl></dd></dl><dl><dt class="spec value" id="val-real_i32s_of"><a href="#val-real_i32s_of" class="anchor"></a><code><span class="keyword">val</span> real_i32s_of : <a href="index.html#type-input">input</a> <span>&#45;&gt;</span> int32 <a href="../BatEnum/index.html#type-t">BatEnum.t</a></code></dt><dd><p>Read an enumeration of signed 32-bit integers as OCaml <code>int32</code>s.</p></dd></dl><dl><dt class="spec value" id="val-i64s_of"><a href="#val-i64s_of" class="anchor"></a><code><span class="keyword">val</span> i64s_of : <a href="index.html#type-input">input</a> <span>&#45;&gt;</span> int64 <a href="../BatEnum/index.html#type-t">BatEnum.t</a></code></dt><dd><p>Read an enumeration of signed 64-bit integers as OCaml <code>int64</code>s.</p></dd></dl><dl><dt class="spec value" id="val-doubles_of"><a href="#val-doubles_of" class="anchor"></a><code><span class="keyword">val</span> doubles_of : <a href="index.html#type-input">input</a> <span>&#45;&gt;</span> float <a href="../BatEnum/index.html#type-t">BatEnum.t</a></code></dt><dd><p>Read an enumeration of IEEE double precision floating point values.</p></dd></dl><dl><dt class="spec value" id="val-floats_of"><a href="#val-floats_of" class="anchor"></a><code><span class="keyword">val</span> floats_of : <a href="index.html#type-input">input</a> <span>&#45;&gt;</span> float <a href="../BatEnum/index.html#type-t">BatEnum.t</a></code></dt><dd><p>Read an enumeration of IEEE single precision floating point values.</p></dd></dl><dl><dt class="spec value" id="val-strings_of"><a href="#val-strings_of" class="anchor"></a><code><span class="keyword">val</span> strings_of : <a href="index.html#type-input">input</a> <span>&#45;&gt;</span> string <a href="../BatEnum/index.html#type-t">BatEnum.t</a></code></dt><dd><p>Read an enumeration of null-terminated strings.</p></dd></dl><dl><dt class="spec value" id="val-lines_of"><a href="#val-lines_of" class="anchor"></a><code><span class="keyword">val</span> lines_of : <a href="index.html#type-input">input</a> <span>&#45;&gt;</span> string <a href="../BatEnum/index.html#type-t">BatEnum.t</a></code></dt><dd><p>Read an enumeration of LF or CRLF terminated strings.</p></dd></dl><dl><dt class="spec value" id="val-lines_of2"><a href="#val-lines_of2" class="anchor"></a><code><span class="keyword">val</span> lines_of2 : <a href="index.html#type-input">input</a> <span>&#45;&gt;</span> string <a href="../BatEnum/index.html#type-t">BatEnum.t</a></code></dt><dd><p>Read an enumeration of LF or CRLF terminated strings.</p></dd></dl><dl><dt class="spec value" id="val-chunks_of"><a href="#val-chunks_of" class="anchor"></a><code><span class="keyword">val</span> chunks_of : int <span>&#45;&gt;</span> <a href="index.html#type-input">input</a> <span>&#45;&gt;</span> string <a href="../BatEnum/index.html#type-t">BatEnum.t</a></code></dt><dd><p>Read an input as an enumeration of strings of given length. If the input isn't a multiple of that length, the final string will be smaller than the rest.</p></dd></dl><dl><dt class="spec value" id="val-chars_of"><a href="#val-chars_of" class="anchor"></a><code><span class="keyword">val</span> chars_of : <a href="index.html#type-input">input</a> <span>&#45;&gt;</span> char <a href="../BatEnum/index.html#type-t">BatEnum.t</a></code></dt><dd><p>Read an enumeration of Latin-1 characters.</p><p><b>Note</b> Usually faster than calling <code>read</code> several times.</p></dd></dl><dl><dt class="spec value" id="val-bits_of"><a href="#val-bits_of" class="anchor"></a><code><span class="keyword">val</span> bits_of : <a href="index.html#type-in_bits">in_bits</a> <span>&#45;&gt;</span> int <a href="../BatEnum/index.html#type-t">BatEnum.t</a></code></dt><dd><p>Read an enumeration of bits</p></dd></dl><dl><dt class="spec value" id="val-write_bitss"><a href="#val-write_bitss" class="anchor"></a><code><span class="keyword">val</span> write_bitss : nbits:int <span>&#45;&gt;</span> <a href="index.html#type-out_bits">out_bits</a> <span>&#45;&gt;</span> int <a href="../BatEnum/index.html#type-t">BatEnum.t</a> <span>&#45;&gt;</span> unit</code></dt><dd><p>Write an enumeration of bits</p></dd></dl><dl><dt class="spec value" id="val-default_buffer_size"><a href="#val-default_buffer_size" class="anchor"></a><code><span class="keyword">val</span> default_buffer_size : int</code></dt><dd><p>The default size for internal buffers.</p></dd></dl></section><section><header><h6 id="thread-safety"><a href="#thread-safety" class="anchor"></a>Thread-safety</h6></header><dl><dt class="spec value" id="val-synchronize_in"><a href="#val-synchronize_in" class="anchor"></a><code><span class="keyword">val</span> synchronize_in : ?&#8288;lock:<a href="../BatConcurrent/index.html#type-lock">BatConcurrent.lock</a> <span>&#45;&gt;</span> <a href="index.html#type-input">input</a> <span>&#45;&gt;</span> <a href="index.html#type-input">input</a></code></dt><dd><p><code>synchronize_in inp</code> produces a new <a href="index.html#type-input"><code>input</code></a> which reads from <code>input</code> in a thread-safe way. In other words, a lock prevents two distinct threads from reading from that input simultaneously, something which would potentially wreak havoc otherwise</p><dl><dt>parameter lock</dt><dd><p>An optional lock. If none is provided, the lock will be specific to this <code>input</code>. Specifiying a custom lock may be useful to associate one common lock for several inputs and/or outputs, for instance in the case of pipes.</p></dd></dl></dd></dl><dl><dt class="spec value" id="val-synchronize_out"><a href="#val-synchronize_out" class="anchor"></a><code><span class="keyword">val</span> synchronize_out : ?&#8288;lock:<a href="../BatConcurrent/index.html#type-lock">BatConcurrent.lock</a> <span>&#45;&gt;</span> <span class="type-var">_</span> <a href="index.html#type-output">output</a> <span>&#45;&gt;</span> unit <a href="index.html#type-output">output</a></code></dt><dd><p><code>synchronize_out out</code> produces a new <a href="index.html#type-output"><code>output</code></a> which writes to <code>output</code> in a thread-safe way. In other words, a lock prevents two distinct threads from writing to that output simultaneously, something which would potentially wreak havoc otherwise</p><dl><dt>parameter lock</dt><dd><p>An optional lock. If none is provided, the lock will be specific to this <code>output</code>. Specifiying a custom lock may be useful to associate one common lock for several inputs and/or outputs, for instance in the case of pipes.</p></dd></dl></dd></dl></section><section><header><h6 id="thread-safety-internals"><a href="#thread-safety-internals" class="anchor"></a>Thread-safety internals</h6><p>Unless you are attempting to adapt Batteries Included to a new model of concurrency, you probably won't need this.</p></header><dl><dt class="spec value" id="val-lock"><a href="#val-lock" class="anchor"></a><code><span class="keyword">val</span> lock : <a href="../BatConcurrent/index.html#type-lock">BatConcurrent.lock</a> <a href="../../ocaml/Stdlib/index.html#type-ref">Stdlib.ref</a></code></dt><dd><p>A lock used to synchronize internal operations.</p><p>By default, this is <a href="../BatConcurrent/index.html#val-nolock"><code>BatConcurrent.nolock</code></a>. However, if you're using a version of Batteries compiled in threaded mode, this uses <a href="../BatMutex/index.html"><code>BatMutex</code></a>. If you're attempting to use Batteries with another concurrency model, set the lock appropriately.</p></dd></dl><dl><dt class="spec value" id="val-lock_factory"><a href="#val-lock_factory" class="anchor"></a><code><span class="keyword">val</span> lock_factory : (unit <span>&#45;&gt;</span> <a href="../BatConcurrent/index.html#type-lock">BatConcurrent.lock</a>) <a href="../../ocaml/Stdlib/index.html#type-ref">Stdlib.ref</a></code></dt><dd><p>A factory used to create locks. This is used transparently by <a href="index.html#val-synchronize_in"><code>synchronize_in</code></a> and <a href="index.html#val-synchronize_out"><code>synchronize_out</code></a>.</p><p>By default, this always returns <a href="../BatConcurrent/index.html#val-nolock"><code>BatConcurrent.nolock</code></a>. However, if you're using a version of Batteries compiled in threaded mode, this uses <a href="../BatMutex/index.html"><code>BatMutex</code></a>.</p></dd></dl><dl><dt class="spec value" id="val-to_string"><a href="#val-to_string" class="anchor"></a><code><span class="keyword">val</span> to_string : (<span class="type-var">'a</span>,Â string) <a href="index.html#type-printer">printer</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> string</code></dt><dt class="spec value" id="val-to_f_printer"><a href="#val-to_f_printer" class="anchor"></a><code><span class="keyword">val</span> to_f_printer : (<span class="type-var">'a</span>,Â <span class="type-var">_</span>) <a href="index.html#type-printer">printer</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-f_printer">f_printer</a></code></dt></dl></section></div></body></html>