<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>BatPrintf (batteries.BatPrintf)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – <a href="../index.html">batteries</a> &#x00BB; BatPrintf</nav><h1>Module <code>BatPrintf</code></h1><p>Formatted output functions (also known as unparsing).</p><dl><dt>author</dt><dd>Xavier Leroy</dd></dl><dl><dt>author</dt><dd>Pierre Weiss</dd></dl><dl><dt>author</dt><dd>David Teller</dd></dl><nav class="toc"><ul><li><a href="#general-overview">General overview</a></li><li><a href="#formats">Formats</a></li><li><a href="#common-functions">Common functions</a></li><li><a href="#general-functions">General functions</a></li><li><a href="#functions-with-continuations">Functions with continuations</a></li><li><a href="#about-formats">About formats</a></li><li><a href="#format4">Format4</a></li><li><a href="#format">Format</a></li><li><a href="#important">Important</a></li></ul></nav></header><section><header><h6 id="general-overview"><a href="#general-overview" class="anchor"></a>General overview</h6><p>The functions of this module produce output according to a <span class="xref-unresolved" title="unresolved reference to &quot;Pervasives.format&quot;"><code>Pervasives</code>.format</span>, as described below. Some functions write to the standard output (i.e. the screen), some to error channels, some to strings or to buffers, or some to abstract outputs.</p><p><b>Note</b> The types used in this module are confusing at first. If you are a beginner, you should probably ignore them in a first time and concentrate on formats.</p><p>For a first explanation, we will concentrate on function <a href="index.html#val-printf"><code>printf</code></a>. As all the functions in this module, the behavior of <a href="index.html#val-printf"><code>printf</code></a> is dictated by a <a href="index.html#format"><span>Format</span></a>. This format is a string, composed of regular text and directives, and which dictates how to interpret the other arguments passed to the function. Every directive starts with character <code>%</code>. The most common directive is <code>%s</code>, which serves to display a string, something quite useful for pretty-printing or translation. Anther common directive is <code>%i</code>, which serves to display an integer.</p><p>For instance, <code>&quot;foobar&quot;</code> is a format with no directive. Calling <code>printf &quot;foobar&quot;</code> prints <code>&quot;foobar&quot;</code> on the screen and returns <code>()</code>. On the other hand, <code>&quot;%s&quot;</code> is a format with one directive for printing strings. <code>printf &quot;%s&quot;</code> does nothing yet but returns a function with type <code>string -&gt; unit</code>. In turn, <code>printf &quot;%s&quot;
   &quot;foobar&quot;</code> prints <code>&quot;foobar&quot;</code> on the screen and returns <code>()</code>. The main interest of this module is that directives may be combined together and with text, to allow more complex printing. For instance <code>printf &quot;(%s)\n&quot;</code> is a function with type <code>string -&gt; unit</code> which, when passed string <code>&quot;foobar&quot;</code> prints <code>&quot;(foobar)&quot;</code> and ends the line. Similarly, <code>printf &quot;Here's the result: %s.\n\tComputation
   took %i seconds.\n&quot; &quot;foobar&quot; 5</code> prints</p><pre><code class="ml">Here's the result: foobar
         Computation took 5 seconds.</code></pre><p>Note that <code>\n</code> (the newline character) and <code>\t</code> (the tabulation) are not specific to this module but rather part of the conventions on characters strings in OCaml.</p><p>Other directives and functions make this module extremely useful for printing, pretty-printing and translation of messages to the user's language. For more information, see the documentation of <a href="index.html#format"><span>Format</span></a> and the various functions.</p></header></section><section><header><h6 id="formats"><a href="#formats" class="anchor"></a>Formats</h6></header><dl><dt class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><code><span class="keyword">type </span>('a, 'b, 'c) t</code><code><span class="keyword"> = </span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>, <span class="type-var">'c</span>) Pervasives.format</code></dt><dd><p>The format to use for displaying the various arguments passed to the function.</p><p>Syntactically, the format is a character string which contains two types of objects: plain characters, which are simply copied, and directives, each of which causes the conversion and printing of arguments.</p><h6 id="simple-directives"><a href="#simple-directives" class="anchor"></a>Simple directives</h6><p>All directives start with the <code>%</code> character. In their simplest form, a directive is <code>%</code> followed by exactly one character:</p><ul><li><code>%d</code>, <code>%i</code>, <code>%n</code>, <code>%l</code>, <code>%L</code>, or <code>%N</code>: convert an integer argument to signed decimal.</li><li><code>%u</code>: convert an integer argument to unsigned decimal.</li><li><code>%x</code>: convert an integer argument to unsigned hexadecimal, using lowercase letters.</li><li><code>%X</code>: convert an integer argument to unsigned hexadecimal, using uppercase letters.</li><li><code>%o</code>: convert an integer argument to unsigned octal.</li><li><code>%s</code>: insert a string argument.</li><li><code>%S</code>: insert a string argument in OCaml syntax (double quotes, escapes).</li><li><code>%c</code>: insert a character argument.</li><li><code>%C</code>: insert a character argument in OCaml syntax (single quotes, escapes).</li><li><code>%f</code>: convert a floating-point argument to decimal notation, in the style <code>dddd.ddd</code>.</li><li><code>%F</code>: convert a floating-point argument to OCaml syntax (<code>dddd.</code> or <code>dddd.ddd</code> or <code>d.ddd e+-dd</code>).</li><li><code>%e</code> or <code>%E</code>: convert a floating-point argument to decimal notation, in the style <code>d.ddd e+-dd</code> (mantissa and exponent).</li><li><code>%g</code> or <code>%G</code>: convert a floating-point argument to decimal notation, in style <code>%f</code> or <code>%e</code>, <code>E</code> (whichever is more compact).</li><li><code>%B</code>: convert a boolean argument to the string <code>true</code> or <code>false</code></li><li><code>%b</code>: convert a boolean argument (for backward compatibility; do not use in new programs).</li><li><code>%ld</code>, <code>%li</code>, <code>%lu</code>, <code>%lx</code>, <code>%lX</code>, <code>%lo</code>: convert an <code>int32</code> argument to the format specified by the second letter (decimal, hexadecimal, etc).</li><li><code>%nd</code>, <code>%ni</code>, <code>%nu</code>, <code>%nx</code>, <code>%nX</code>, <code>%no</code>: convert a <code>nativeint</code> argument to the format specified by the second letter.</li><li><code>%Ld</code>, <code>%Li</code>, <code>%Lu</code>, <code>%Lx</code>, <code>%LX</code>, <code>%Lo</code>: convert an <code>int64</code> argument to the format specified by the second letter.</li><li><code>!</code>: take no argument and flush the output.</li><li><code>%</code>: take no argument and output one <code>%</code> character.</li><li><code>,</code>: the no-op delimiter for conversion specifications</li></ul><h6 id="unparsers"><a href="#unparsers" class="anchor"></a>Unparsers</h6><ul><li><code>%a</code>: user-defined printer. Typically, this printer corresponds to two arguments: a printing function <code>f</code>, with type <code>'a output -&gt; 'c -&gt; unit</code> and the item <code>x</code> you want to print, with type <code>'c</code>. Item <code>x</code> will be printing by calling <code>f out x</code>, where <code>out</code> is the output you are currently using -- if you are calling <a href="index.html#val-printf"><code>printf</code></a>, this output is the standard output (i.e. the screen), if you are calling <a href="index.html#val-eprintf"><code>eprintf</code></a>, this will be the error channel, if you are calling <a href="index.html#val-fprintf"><code>fprintf</code></a>, this will be the output you provided yourself, etc. More generally, if your <a href="index.html#format"><span>Format</span></a> has type <code>('a, 'b, 'd) format</code> or <code>('a, 'b, 'd, 'e) format4</code>, the printing function <code>f</code> must have type <code>'b -&gt; 'c -&gt; 'd</code>, where <code>x</code> has type <code>'d</code>.</li><li><code>%t</code>: same as <code>%a</code> but takes only a printing function <code>f</code>, without an item. If your <a href="index.html#format"><span>Format</span></a> has type <code>('a, 'b, 'd) format</code> or <code>('a, 'b, 'd, 'e) format4</code>, function <code>f</code> must have type <code>'b -&gt; 'd</code>.</li></ul><h6 id="formatting-formats"><a href="#formatting-formats" class="anchor"></a>Formatting formats</h6><ul><li><code>%\{ fmt %\}</code>: convert a <a href="index.html#format"><span>Format</span></a> to a string. The format argument must have the same type as the internal format string <code>fmt</code>. In other words, <code>printf &quot;%\{ %s %\}&quot;</code> accepts an argument whose type must be the same as that of format <code>&quot;%s&quot;</code>, and prints that format argument as if it were a character string.</li><li><code>%( fmt %)</code>: format string substitution. Takes a format string argument and substitutes it to the internal format string <code>fmt</code> to print following arguments. The argument must have the same type as <code>fmt</code>. <code>printf &quot;%\{ %s %\}&quot;</code> accepts an argument whose type must be the same as that of format <code>&quot;%s&quot;</code>, and uses that argument to print the following arguments.</li></ul><h6 id="additional-options"><a href="#additional-options" class="anchor"></a>Additional options</h6><p>The general format of directives is</p><p><code>% [flags] [width] [.precision] type</code></p><p><code>type</code> is one of <code>d</code>, <code>i</code>, <code>n</code>, <code>l</code>, <code>L</code>, <code>N</code>, <code>u</code>, <code>x</code> ..., <code>( fmt %)</code> and behaves as explained above.</p><p>The optional <code>flags</code> are:</p><ul><li><code>-</code>: left-justify the output (default is right justification).</li><li><code>0</code>: for numerical conversions, pad with zeroes instead of spaces.</li><li><code>+</code>: for numerical conversions, prefix number with a <code>+</code> sign if positive.</li><li>space: for numerical conversions, prefix number with a space if positive.</li><li><code>#</code>: request an alternate formatting style for numbers.</li></ul><p>The optional <code>width</code> is an integer indicating the minimal width of the result. For instance, <code>%6d</code> prints an integer, prefixing it with spaces to fill at least 6 characters.</p><p>The optional <code>precision</code> is a dot <code>.</code> followed by an integer indicating how many digits follow the decimal point in the <code>%f</code>, <code>%e</code>, and <code>%E</code> conversions. For instance, <code>%.4f</code> prints a <code>float</code> with 4 fractional digits.</p><p>The integer in a <code>width</code> or <code>precision</code> can also be specified as <code>*</code>, in which case an extra integer argument is taken to specify the corresponding <code>width</code> or <code>precision</code>. This integer argument precedes immediately the argument to print. For instance, <code>%.*f</code> prints a <code>float</code> with as many fractional digits as the value of the argument given before the float.</p></dd></dl></section><section><header><h6 id="common-functions"><a href="#common-functions" class="anchor"></a>Common functions</h6></header><dl><dt class="spec value" id="val-printf"><a href="#val-printf" class="anchor"></a><code><span class="keyword">val </span>printf : (<span class="type-var">'b</span>, <span class="type-var">'a</span> BatInnerIO.output, unit) <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'b</span></code></dt><dd><p>The usual <code>printf</code> function, prints to the standard output <code>stdout</code>, i.e. normally to the screen. If you are lost, this is probably the function you're looking for.</p></dd></dl><dl><dt class="spec value" id="val-eprintf"><a href="#val-eprintf" class="anchor"></a><code><span class="keyword">val </span>eprintf : (<span class="type-var">'b</span>, <span class="type-var">'a</span> BatInnerIO.output, unit) <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'b</span></code></dt><dd><p>The usual <code>eprintf</code> function, prints to the standard error output <code>stderr</code>, used to display warnings and errors. Otherwise identical to <a href="index.html#val-printf"><code>printf</code></a>.</p></dd></dl><dl><dt class="spec value" id="val-sprintf"><a href="#val-sprintf" class="anchor"></a><code><span class="keyword">val </span>sprintf : (<span class="type-var">'a</span>, unit, string) <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span></code></dt><dd><p>A function which doesn't print its result but returns it as a string. Useful for building messages, for translation purposes or for display in a window, for instance.</p><p>While this function is quite convenient, don't abuse it to create very large strings such as files, that's not its role. For this kind of usage, prefer the more modular and usually faster <a href="index.html#val-fprintf"><code>fprintf</code></a>.</p><p>Note that any function called with <code>%a</code> should return strings, i.e. should have type <code>unit -&gt; string</code>.</p></dd></dl><dl><dt class="spec value" id="val-sprintf2"><a href="#val-sprintf2" class="anchor"></a><code><span class="keyword">val </span>sprintf2 : (<span class="type-var">'a</span>, <span class="type-var">'b</span> BatInnerIO.output, unit, string) Pervasives.format4 <span>&#45;&gt;</span> <span class="type-var">'a</span></code></dt><dd><p>A function which doesn't print its result but returns it as a string. Useful for building messages, for translation purposes or for display in a window, for instance.</p><p>While this function is quite convenient, don't abuse it to create very large strings such as files, that's not its role. For this kind of usage, prefer the more modular and usually faster <a href="index.html#val-fprintf"><code>fprintf</code></a>. Note that any function called with <code>%a</code> should be able to print its result, i.e. should have type <code>'b output -&gt; unit</code>.</p><p>Warning: a partial application of this function can only be used once, because the <span class="xref-unresolved" title="unresolved reference to &quot;BatInnerIO.output&quot;"><code>BatInnerIO</code>.output</span> that it uses is closed afterwards. Example: <code>let f = sprintf2 &quot;%a&quot; Int.print in [f 1; f 2]</code> will fail.</p></dd></dl></section><section><header><h6 id="general-functions"><a href="#general-functions" class="anchor"></a>General functions</h6></header><dl><dt class="spec value" id="val-fprintf"><a href="#val-fprintf" class="anchor"></a><code><span class="keyword">val </span>fprintf : <span class="type-var">'a</span> BatInnerIO.output <span>&#45;&gt;</span> (<span class="type-var">'b</span>, <span class="type-var">'a</span> BatInnerIO.output, unit) <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'b</span></code></dt><dd><p>General function. This function prints to any output. Typically, if you are attempting to build a large output such as a file, this is probably the function you are looking for. If you are writing a pretty-printer, this is probably the function you are looking for. If you are you are looking for a function to use for argument <code>%a</code> with <a href="index.html#val-printf"><code>printf</code></a>, <a href="index.html#val-eprintf"><code>eprintf</code></a>, <a href="index.html#val-sprintf2"><code>sprintf2</code></a>, <a href="index.html#val-ifprintf"><code>ifprintf</code></a>, <a href="index.html#val-bprintf2"><code>bprintf2</code></a>, <a href="index.html#val-kfprintf"><code>kfprintf</code></a>, <a href="index.html#val-ksprintf2"><code>ksprintf2</code></a>, <a href="index.html#val-kbprintf2"><code>kbprintf2</code></a> or any other function with type <code>(_, _ output, unit) format</code> or <code>(_, _ output, unit, _) format4</code>, this is also probably the function you are looking for.</p></dd></dl><dl><dt class="spec value" id="val-ifprintf"><a href="#val-ifprintf" class="anchor"></a><code><span class="keyword">val </span>ifprintf : <span class="type-var">_</span> <span>&#45;&gt;</span> (<span class="type-var">'b</span>, <span class="type-var">'a</span> BatInnerIO.output, unit) <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'b</span></code></dt><dd><p>As <a href="index.html#val-fprintf"><code>fprintf</code></a> but doesn't actually print anything. Sometimes useful for debugging.</p></dd></dl><dl><dt class="spec value" id="val-bprintf"><a href="#val-bprintf" class="anchor"></a><code><span class="keyword">val </span>bprintf : Buffer.t <span>&#45;&gt;</span> (<span class="type-var">'a</span>, Buffer.t, unit) <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span></code></dt><dd><p>As <a href="index.html#val-fprintf"><code>fprintf</code></a>, but with buffers instead of outputs. In particular, any unparser called with <code>%a</code> should write to a buffer rather than to an output</p></dd></dl><dl><dt class="spec value" id="val-bprintf2"><a href="#val-bprintf2" class="anchor"></a><code><span class="keyword">val </span>bprintf2 : Buffer.t <span>&#45;&gt;</span> (<span class="type-var">'b</span>, <span class="type-var">'a</span> BatInnerIO.output, unit) <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'b</span></code></dt><dd><p>As <a href="index.html#val-printf"><code>printf</code></a> but writes to a buffer instead of printing to the output. By opposition to <a href="index.html#val-bprintf"><code>bprintf</code></a>, only the result is changed with respect to <a href="index.html#val-printf"><code>printf</code></a>, not the inner workings.</p></dd></dl></section><section><header><h6 id="functions-with-continuations"><a href="#functions-with-continuations" class="anchor"></a>Functions with continuations</h6></header><dl><dt class="spec value" id="val-kfprintf"><a href="#val-kfprintf" class="anchor"></a><code><span class="keyword">val </span>kfprintf : (<span class="type-var">'a</span> BatInnerIO.output <span>&#45;&gt;</span> <span class="type-var">'b</span>) <span>&#45;&gt;</span> <span class="type-var">'a</span> BatInnerIO.output <span>&#45;&gt;</span> (<span class="type-var">'c</span>, <span class="type-var">'a</span> BatInnerIO.output, unit, <span class="type-var">'b</span>) Pervasives.format4 <span>&#45;&gt;</span> <span class="type-var">'c</span></code></dt><dd><p>Same as <code>fprintf</code>, but instead of returning immediately, passes the <code>output</code> to its first argument at the end of printing.</p></dd></dl><dl><dt class="spec value" id="val-ksprintf"><a href="#val-ksprintf" class="anchor"></a><code><span class="keyword">val </span>ksprintf : (string <span>&#45;&gt;</span> <span class="type-var">'a</span>) <span>&#45;&gt;</span> (<span class="type-var">'b</span>, unit, string, <span class="type-var">'a</span>) Pervasives.format4 <span>&#45;&gt;</span> <span class="type-var">'b</span></code></dt><dd><p>Same as <code>sprintf</code> above, but instead of returning the string, passes it to the first argument.</p></dd></dl><dl><dt class="spec value" id="val-ksprintf2"><a href="#val-ksprintf2" class="anchor"></a><code><span class="keyword">val </span>ksprintf2 : (string <span>&#45;&gt;</span> <span class="type-var">'b</span>) <span>&#45;&gt;</span> (<span class="type-var">'c</span>, <span class="type-var">'a</span> BatInnerIO.output, unit, <span class="type-var">'b</span>) Pervasives.format4 <span>&#45;&gt;</span> <span class="type-var">'c</span></code></dt><dd><p>Same as <code>sprintf</code> above, but instead of returning the string, passes it to the first argument.</p><p>Same as <code>sprintf2</code> above, but instead of returning the string, passes it to the first argument.</p></dd></dl><dl><dt class="spec value" id="val-kbprintf"><a href="#val-kbprintf" class="anchor"></a><code><span class="keyword">val </span>kbprintf : (Buffer.t <span>&#45;&gt;</span> <span class="type-var">'a</span>) <span>&#45;&gt;</span> Buffer.t <span>&#45;&gt;</span> (<span class="type-var">'b</span>, Buffer.t, unit, <span class="type-var">'a</span>) Pervasives.format4 <span>&#45;&gt;</span> <span class="type-var">'b</span></code></dt><dd><p>Same as <code>bprintf</code>, but instead of returning immediately, passes the buffer to its first argument at the end of printing.</p></dd></dl><dl><dt class="spec value" id="val-kbprintf2"><a href="#val-kbprintf2" class="anchor"></a><code><span class="keyword">val </span>kbprintf2 : (Buffer.t <span>&#45;&gt;</span> <span class="type-var">'b</span>) <span>&#45;&gt;</span> Buffer.t <span>&#45;&gt;</span> (<span class="type-var">'c</span>, <span class="type-var">'a</span> BatInnerIO.output, unit, <span class="type-var">'b</span>) Pervasives.format4 <span>&#45;&gt;</span> <span class="type-var">'c</span></code></dt><dd><p>Same as <code>bprintf2</code>, but instead of returning immediately, passes the buffer to its first argument at the end of printing.</p></dd></dl><dl><dt class="spec value" id="val-kprintf"><a href="#val-kprintf" class="anchor"></a><code><span class="keyword">val </span>kprintf : (string <span>&#45;&gt;</span> <span class="type-var">'a</span>) <span>&#45;&gt;</span> (<span class="type-var">'b</span>, unit, string, <span class="type-var">'a</span>) Pervasives.format4 <span>&#45;&gt;</span> <span class="type-var">'b</span></code></dt><dd><dl><dt>deprecated</dt><dd><p>This is a deprecated synonym for <code>ksprintf</code>.</p></dd></dl></dd></dl></section><section><header><h6 id="about-formats"><a href="#about-formats" class="anchor"></a>About formats</h6><p>You only need to read this if you intend to create your new printf-like functions, which happens generally by toying with <code>mkprintf</code>.</p></header></section><section><header><h6 id="format4"><a href="#format4" class="anchor"></a>Format4</h6><p><code>('a, 'b, 'c, 'd) format4</code> is the type of arguments for <code>printf</code>-style functions such that</p><ul><li><p><code>'a</code> is the type of arguments, with a return type of <code>'d</code></p><ul><li>if your format looks like <code>&quot;%s&quot;</code>, <code>'a</code> is <code>string -&gt; 'd</code></li><li>if your format looks like <code>&quot;%s%s&quot;</code>, <code>'a</code> is <code>string -&gt; string -&gt; 'd</code></li><li>...</li></ul></li><li><p><code>'b</code> is the type of the first argument given to unparsers (i.e. functions introduced with <code>%a</code> or <code>%t</code>)</p><ul><li>if your unparsers take a <code>unit</code> argument, <code>'b</code> should be <code>unit</code></li><li>if your unparsers take a <code>string output</code>, <code>'b</code> should be <code>string output</code></li><li>...</li></ul></li><li><p><code>'c</code> is the <b>final</b> return type of unparsers</p><ul><li>if you have an unparser introduced with <code>%t</code> and its result has type <code>unit</code>, <code>'c</code> should be <code>unit</code></li><li>if you have an unparser introduced with <code>%a</code> and its type is <code>string output -&gt; string -&gt; unit</code>, <code>'c</code> should be <code>unit</code></li><li>...</li></ul></li><li><code>'d</code> is the final return value of the function once all arguments have been printed</li></ul></header></section><section><header><h6 id="format"><a href="#format" class="anchor"></a>Format</h6><p><code>('a, 'b, 'c) format</code> or <code>('a, 'b, 'c) t</code> is just a shortcut for <code>('a, 'b, 'c, 'c) format4</code>.</p></header></section><section><header><h6 id="important"><a href="#important" class="anchor"></a>Important</h6><p>Note that <span class="xref-unresolved" title="unresolved reference to &quot;Obj.magic&quot;"><code>Obj</code>.magic</span> is involved behind this, so be careful.</p></header></section></div></body></html>