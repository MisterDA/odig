<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Arg (bos.Bos.OS.Arg)</title><link rel="stylesheet" href="../../../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – <a href="../../../index.html">bos</a> &#x00BB; <a href="../../index.html">Bos</a> &#x00BB; <a href="../index.html">OS</a> &#x00BB; Arg</nav><h1>Module <code>OS.Arg</code></h1><p>Quick and dirty program arguments parsing.</p><p>This is for quick hacks and scripts. If your program evolves to a tool for end users you should rather use <code>Cmdliner</code> to parse your command lines: it generates man pages and its parsing is more flexible and user friendly. The syntax of command lines parsed by this module is a subset of what <code>Cmdliner</code> is able to parse so migrating there should not be a problem for existing invocations of your program.</p><p>This module supports short and long options with option arguments either glued to the option or specified as the next program argument. It also supports the <code>--</code> program argument to notify that subsequent arguments have to be treated as positional arguments. Parsing functions always respond to the <code>-h</code>, <code>-help</code> or <code>--help</code> flags by showing the program's usage and command line options documentation.</p><p>See the <a href="index.html#argbasics"><span>basics</span></a>.</p><p><b>Warning.</b> This module is not thread-safe.</p><nav class="toc"><ul><li><a href="#executable-name">Executable name</a></li><li><a href="#conv">Argument converters</a></li><li><a href="#queries">Flag and option queries</a></li><li><a href="#parse">Parsing</a></li><li><a href="#predefconvs">Predefined argument converters</a></li><li><a href="#argbasics">Basics</a></li></ul></nav></header><section><header><h2 id="executable-name"><a href="#executable-name" class="anchor"></a>Executable name</h2></header><dl><dt class="spec value" id="val-exec"><a href="#val-exec" class="anchor"></a><code><span class="keyword">val</span> exec : string</code></dt><dd><p><code>exec</code> is the name of the executable. This is <code>Sys.argv.(0)</code> if <code>Sys.argv</code> is non-empty or <span class="xref-unresolved" title="unresolved reference to &quot;Sys.executable_name&quot;"><code>Sys</code>.executable_name</span> otherwise.</p></dd></dl></section><section><header><h2 id="conv"><a href="#conv" class="anchor"></a>Argument converters</h2><p>Argument converters transform string arguments of the command line to OCaml values. Consult the predefined <a href="index.html#predefconvs"><span>converters</span></a>.</p></header><dl><dt class="spec type" id="type-conv"><a href="#type-conv" class="anchor"></a><code><span class="keyword">type</span> 'a conv</code></dt><dd><p>The type for argument converters.</p></dd></dl><dl><dt class="spec value" id="val-conv"><a href="#val-conv" class="anchor"></a><code><span class="keyword">val</span> conv : ?&#8288;docv:string <span>&#45;&gt;</span> (string <span>&#45;&gt;</span> (<span class="type-var">'a</span>, <a href="../../../../rresult/Rresult/R/index.html#type-msg">Rresult.R.msg</a>) <a href="../../../../result/Result/index.html#type-result">Result.result</a>) <span>&#45;&gt;</span> (<a href="../../../../ocaml/Stdlib/Format/index.html#type-formatter">Stdlib.Format.formatter</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> unit) <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-conv">conv</a></code></dt><dd><p><code>conv ~docv parse print</code> is an argument converter parsing values with <code>parse</code> and printing them with <code>print</code>. <code>docv</code> is a documentation meta-variable used in the documentation to stand for the argument value, defaults to <code>&quot;VALUE&quot;</code>.</p></dd></dl><dl><dt class="spec value" id="val-conv_parser"><a href="#val-conv_parser" class="anchor"></a><code><span class="keyword">val</span> conv_parser : <span class="type-var">'a</span> <a href="index.html#type-conv">conv</a> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> (<span class="type-var">'a</span>, <a href="../../../../rresult/Rresult/R/index.html#type-msg">Rresult.R.msg</a>) <a href="../../../../result/Result/index.html#type-result">Result.result</a></code></dt><dd><p><code>conv_parser c</code> is <code>c</code>'s parser.</p></dd></dl><dl><dt class="spec value" id="val-conv_printer"><a href="#val-conv_printer" class="anchor"></a><code><span class="keyword">val</span> conv_printer : <span class="type-var">'a</span> <a href="index.html#type-conv">conv</a> <span>&#45;&gt;</span> <a href="../../../../ocaml/Stdlib/Format/index.html#type-formatter">Stdlib.Format.formatter</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>conv_printer c</code> is <code>c</code>'s printer.</p></dd></dl><dl><dt class="spec value" id="val-conv_docv"><a href="#val-conv_docv" class="anchor"></a><code><span class="keyword">val</span> conv_docv : <span class="type-var">'a</span> <a href="index.html#type-conv">conv</a> <span>&#45;&gt;</span> string</code></dt><dd><p><code>conv_printer c</code> is <code>c</code>'s documentation meta-variable.</p></dd></dl><dl><dt class="spec value" id="val-parser_of_kind_of_string"><a href="#val-parser_of_kind_of_string" class="anchor"></a><code><span class="keyword">val</span> parser_of_kind_of_string : kind:string <span>&#45;&gt;</span> (string <span>&#45;&gt;</span> <span class="type-var">'a</span> option) <span>&#45;&gt;</span> string <span>&#45;&gt;</span> (<span class="type-var">'a</span>, <a href="../../../../rresult/Rresult/R/index.html#type-msg">Rresult.R.msg</a>) <a href="../../../../result/Result/index.html#type-result">Result.result</a></code></dt><dd><p><code>parser_of_kind_of_string ~kind kind_of_string</code> is an argument parser using the <code>kind_of_string</code> function for parsing and <code>kind</code> for errors (e.g. could be <code>&quot;an integer&quot;</code> for an <code>int</code> parser).</p></dd></dl><dl><dt class="spec value" id="val-some"><a href="#val-some" class="anchor"></a><code><span class="keyword">val</span> some : ?&#8288;none:string <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-conv">conv</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> option <a href="index.html#type-conv">conv</a></code></dt><dd><p><code>some none c</code> is like the converter <code>c</code> but wraps its result in <code>Some</code>. This is used for command line arguments that default to <code>None</code> when absent. <code>none</code> is what should be printed by the printer for <code>None</code> (defaults to <code>&quot;&quot;</code>).</p></dd></dl></section><section><header><h2 id="queries"><a href="#queries" class="anchor"></a>Flag and option queries</h2><p><b>Flag and option names.</b> They are specified without dashes. A one character name defines a short option; <code>&quot;d&quot;</code> is <code>-d</code>. Longer names define long options <code>&quot;debug&quot;</code> is <code>--debug</code>.</p><p><b>Option argument specification.</b> On the command line, option arguments are either specified as the next program argument or glued to the option. For short options gluing is done directly: <code>-farchive.tar</code>. For long options an <code>&quot;=&quot;</code> characters stands between the option and the value: <code>--file=archive.tar</code>.</p><p><b>Warning.</b> These functions are effectful invoking them twice on the same option names will result in parse errors. All the following functions raise <code>Invalid_argument</code> if they are invoked after <a href="index.html#parse"><span>parsing</span></a>.</p></header><dl><dt class="spec value" id="val-flag"><a href="#val-flag" class="anchor"></a><code><span class="keyword">val</span> flag : ?&#8288;doc:string <span>&#45;&gt;</span> ?&#8288;env:string <span>&#45;&gt;</span> string list <span>&#45;&gt;</span> bool</code></dt><dd><p><code>flag ~doc ~env names</code> is <code>true</code> if one of the flags in <code>names</code> is present on the command line <em>at most once</em> and <code>false</code> otherwise.</p><p>If there is no flag on the command line and <code>env</code> is specified and defined in the environment, its value is parsed with <a href="../Env/index.html#val-bool"><code>Env.bool</code></a> and the resulting value is used. <code>doc</code> is a documentation string.</p></dd></dl><dl><dt class="spec value" id="val-flag_all"><a href="#val-flag_all" class="anchor"></a><code><span class="keyword">val</span> flag_all : ?&#8288;doc:string <span>&#45;&gt;</span> ?&#8288;env:string <span>&#45;&gt;</span> string list <span>&#45;&gt;</span> int</code></dt><dd><p><code>flag_all</code> is like <a href="index.html#val-flag"><code>flag</code></a> but counts the number of occurences of the flag on the command line. If there is no flag on the command line and <code>env</code> is specified and defined in the environment, its value is parsed with <a href="../Env/index.html#val-bool"><code>Env.bool</code></a> and converted to an integer.</p></dd></dl><dl><dt class="spec value" id="val-opt"><a href="#val-opt" class="anchor"></a><code><span class="keyword">val</span> opt : ?&#8288;docv:string <span>&#45;&gt;</span> ?&#8288;doc:string <span>&#45;&gt;</span> ?&#8288;env:string <span>&#45;&gt;</span> string list <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-conv">conv</a> <span>&#45;&gt;</span> absent:<span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'a</span></code></dt><dd><p><code>opt ~docv ~doc ~env names c ~absent</code> is a value defined by the value of an optional argument that may appear <em>at most once</em> on the command line under one of the names specified by <code>names</code>.</p><p>The argument of the option is converted with <code>c</code> and <code>absent</code> is used if the option is absent from the command line. If there is no option on the command line and <code>env</code> is specified and defined in the environment, its value is parsed with <code>parse</code> and that value is used instead of <code>absent</code>.</p><p><code>doc</code> is is a documentation string. <code>docv</code> a documentation meta-variable used in the documentation to stand for the option argument, if unspecified <code>c</code>'s <a href="index.html#val-conv_docv"><code>conv_docv</code></a> is used. In <code>doc</code> occurences of the substring <code>&quot;$(docv)&quot;</code> in are replaced by the value of <code>docv</code>.</p></dd></dl><dl><dt class="spec value" id="val-opt_all"><a href="#val-opt_all" class="anchor"></a><code><span class="keyword">val</span> opt_all : ?&#8288;docv:string <span>&#45;&gt;</span> ?&#8288;doc:string <span>&#45;&gt;</span> ?&#8288;env:string <span>&#45;&gt;</span> string list <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-conv">conv</a> <span>&#45;&gt;</span> absent:<span class="type-var">'a</span> list <span>&#45;&gt;</span> <span class="type-var">'a</span> list</code></dt><dd><p><code>opt_all</code> is like <a href="index.html#val-opt"><code>opt</code></a> but the optional argument can be repeated.</p></dd></dl></section><section><header><h2 id="parse"><a href="#parse" class="anchor"></a>Parsing</h2><p><b>Note.</b> Before parsing make sure you have invoked all the <a href="index.html#queries"><span>queries</span></a>.</p><p><b>Warning.</b> All the following functions raise <code>Invalid_argument</code> if they are reinvoked after <a href="index.html#parse"><span>parsing</span></a>.</p></header><dl><dt class="spec value" id="val-parse_opts"><a href="#val-parse_opts" class="anchor"></a><code><span class="keyword">val</span> parse_opts : ?&#8288;doc:string <span>&#45;&gt;</span> ?&#8288;usage:string <span>&#45;&gt;</span> unit <span>&#45;&gt;</span> unit</code></dt><dd><p><code>parse_opts ()</code> can:</p><ul><li>Return <code>()</code> if no command line error occured and <code>-help</code> or <code>--help</code> was not specified.</li><li>Never return and exit the program with <code>0</code> after having printed the help on <code>stdout</code>.</li><li>Never return and exit the program with <code>1</code> after having printed an error on <code>stderr</code> if a parsing error occured.</li></ul><p>A parsing error occurs either if an option parser failed, if a non repeatable option was specified more than once, if there is an unknown option on the line, if there is a positional argument on the command line (use <a href="index.html#parse"><span>Parsing</span></a> to parse them). <code>usage</code> is the command argument synopsis (default is automatically inferred). <code>doc</code> is a documentation string for the program.</p></dd></dl><dl><dt class="spec value" id="val-parse"><a href="#val-parse" class="anchor"></a><code><span class="keyword">val</span> parse : ?&#8288;doc:string <span>&#45;&gt;</span> ?&#8288;usage:string <span>&#45;&gt;</span> pos:<span class="type-var">'a</span> <a href="index.html#type-conv">conv</a> <span>&#45;&gt;</span> unit <span>&#45;&gt;</span> <span class="type-var">'a</span> list</code></dt><dd><p><code>parse ~pos</code> is like <a href="index.html#val-parse_opts"><code>parse_opts</code></a> but returns and converts the positional arguments with <code>pos</code> rather than error on them. Note that any thing that comes after a <code>--</code> argument on the command line is deemed to be a positional argument.</p></dd></dl></section><section><header><h2 id="predefconvs"><a href="#predefconvs" class="anchor"></a>Predefined argument converters</h2></header><dl><dt class="spec value" id="val-string"><a href="#val-string" class="anchor"></a><code><span class="keyword">val</span> string : string <a href="index.html#type-conv">conv</a></code></dt><dd><p><code>string</code> converts a string argument. This never errors.</p></dd></dl><dl><dt class="spec value" id="val-path"><a href="#val-path" class="anchor"></a><code><span class="keyword">val</span> path : <a href="../../../../fpath/Fpath/index.html#type-t">Fpath.t</a> <a href="index.html#type-conv">conv</a></code></dt><dd><p><code>path</code> converts a path argument using <a href="../../../../fpath/Fpath/index.html#val-of_string"><code>Fpath.of_string</code></a>.</p></dd></dl><dl><dt class="spec value" id="val-bin"><a href="#val-bin" class="anchor"></a><code><span class="keyword">val</span> bin : <a href="../../Cmd/index.html#type-t">Cmd.t</a> <a href="index.html#type-conv">conv</a></code></dt><dd><p><code>bin</code> is <a href="index.html#val-string"><code>string</code></a> mapped by <span class="xref-unresolved" title="unresolved reference to &quot;Cmd.v&quot;"><a href="../index.html#module-Cmd"><code>Cmd</code></a>.v</span>.</p></dd></dl><dl><dt class="spec value" id="val-cmd"><a href="#val-cmd" class="anchor"></a><code><span class="keyword">val</span> cmd : <a href="../../Cmd/index.html#type-t">Cmd.t</a> <a href="index.html#type-conv">conv</a></code></dt><dd><p><code>cmd</code> converts a <b>non-empty</b> command line with <span class="xref-unresolved" title="unresolved reference to &quot;Cmd.of_string&quot;"><a href="../index.html#module-Cmd"><code>Cmd</code></a>.of_string</span></p></dd></dl><dl><dt class="spec value" id="val-char"><a href="#val-char" class="anchor"></a><code><span class="keyword">val</span> char : char <a href="index.html#type-conv">conv</a></code></dt><dd><p><code>char</code> converts a single character.</p></dd></dl><dl><dt class="spec value" id="val-bool"><a href="#val-bool" class="anchor"></a><code><span class="keyword">val</span> bool : bool <a href="index.html#type-conv">conv</a></code></dt><dd><p><code>bool</code> converts a boolean with <span class="xref-unresolved" title="unresolved reference to &quot;String.to_bool&quot;"><code>String</code>.to_bool</span>.</p></dd></dl><dl><dt class="spec value" id="val-int"><a href="#val-int" class="anchor"></a><code><span class="keyword">val</span> int : int <a href="index.html#type-conv">conv</a></code></dt><dd><p><code>int</code> converts an integer with <span class="xref-unresolved" title="unresolved reference to &quot;String.to_int&quot;"><code>String</code>.to_int</span>.</p></dd></dl><dl><dt class="spec value" id="val-nativeint"><a href="#val-nativeint" class="anchor"></a><code><span class="keyword">val</span> nativeint : nativeint <a href="index.html#type-conv">conv</a></code></dt><dd><p><code>int</code> converts a <code>nativeint</code> with <span class="xref-unresolved" title="unresolved reference to &quot;String.to_nativeint&quot;"><code>String</code>.to_nativeint</span>.</p></dd></dl><dl><dt class="spec value" id="val-int32"><a href="#val-int32" class="anchor"></a><code><span class="keyword">val</span> int32 : int32 <a href="index.html#type-conv">conv</a></code></dt><dd><p><code>int32</code> converts an <code>int32</code> with <span class="xref-unresolved" title="unresolved reference to &quot;String.to_int32&quot;"><code>String</code>.to_int32</span>.</p></dd></dl><dl><dt class="spec value" id="val-int64"><a href="#val-int64" class="anchor"></a><code><span class="keyword">val</span> int64 : int64 <a href="index.html#type-conv">conv</a></code></dt><dd><p><code>int64</code> converts an <code>int64</code> with <span class="xref-unresolved" title="unresolved reference to &quot;String.to_int64&quot;"><code>String</code>.to_int64</span>.</p></dd></dl><dl><dt class="spec value" id="val-float"><a href="#val-float" class="anchor"></a><code><span class="keyword">val</span> float : float <a href="index.html#type-conv">conv</a></code></dt><dd><p><code>float</code> converts an float with <span class="xref-unresolved" title="unresolved reference to &quot;String.to_float&quot;"><code>String</code>.to_float</span>.</p></dd></dl><dl><dt class="spec value" id="val-enum"><a href="#val-enum" class="anchor"></a><code><span class="keyword">val</span> enum : (string * <span class="type-var">'a</span>) list <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-conv">conv</a></code></dt><dd><p><code>enum l p</code> converts values such that string names in <code>l</code> map to the corresponding value of type <code>'a</code>.</p><p><b>Warning.</b> The type <code>'a</code> must be comparable with <span class="xref-unresolved" title="unresolved reference to &quot;Pervasives.compare&quot;"><code>Pervasives</code>.compare</span>.</p><dl><dt>raises Invalid_argument</dt><dd><p>if <code>l</code> is empty.</p></dd></dl></dd></dl><dl><dt class="spec value" id="val-list"><a href="#val-list" class="anchor"></a><code><span class="keyword">val</span> list : ?&#8288;sep:string <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-conv">conv</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> list <a href="index.html#type-conv">conv</a></code></dt><dd><p><code>list ~sep c</code> converts a list of <code>c</code>. For parsing the argument is first <span class="xref-unresolved" title="unresolved reference to &quot;String.cuts&quot;"><code>String</code>.cuts</span><code> ~sep</code> and the resulting string list is converted using <code>c</code>.</p></dd></dl><dl><dt class="spec value" id="val-array"><a href="#val-array" class="anchor"></a><code><span class="keyword">val</span> array : ?&#8288;sep:string <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-conv">conv</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> array <a href="index.html#type-conv">conv</a></code></dt><dd><p><code>array ~sep c</code> is like <a href="index.html#val-list"><code>list</code></a> but returns an array instead.</p></dd></dl><dl><dt class="spec value" id="val-pair"><a href="#val-pair" class="anchor"></a><code><span class="keyword">val</span> pair : ?&#8288;sep:string <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-conv">conv</a> <span>&#45;&gt;</span> <span class="type-var">'b</span> <a href="index.html#type-conv">conv</a> <span>&#45;&gt;</span> (<span class="type-var">'a</span> * <span class="type-var">'b</span>) <a href="index.html#type-conv">conv</a></code></dt><dd><p><code>pair ~sep fst snd</code> converts a pair of <code>fst</code> and <code>snd</code>. For parsing the argument is <span class="xref-unresolved" title="unresolved reference to &quot;String.cut&quot;"><code>String</code>.cut</span><code> ~sep</code> and the resulting strings are converted using <code>fst</code> and <code>snd</code>.</p></dd></dl></section><section><header><h2 id="argbasics"><a href="#argbasics" class="anchor"></a>Basics</h2><p>To parse a command line, <b>first</b> perform all the option <a href="index.html#queries"><span>queries</span></a> and then invoke one of the <a href="index.html#parse"><span>parsing</span></a> functions. Do not invoke any query after parsing has been done, this will raise <code>Invalid_argument</code>. This leads to the following program structure:</p><pre><code class="ml">(* It is possible to define things at the toplevel as follows. But do not
   abuse this. The following flag, if unspecified on the command line, can
   also be specified with the DEBUG environment variable. *)
let debug = OS.Arg.(flag [&quot;g&quot;; &quot;debug&quot;] ~env:&quot;DEBUG&quot; ~doc:&quot;debug mode.&quot;)
...

let main () =
  let depth =
    OS.Arg.(opt [&quot;d&quot;; &quot;depth&quot;] int ~absent:2 ~doc:&quot;recurses $(docv) times.&quot;)
  in
  let pos_args = OS.Arg.(parse ~pos:string ()) in
  (* No command line error or help request occured, run the program. *)
  ...

let main () = main ()</code></pre></header></section></div></body></html>