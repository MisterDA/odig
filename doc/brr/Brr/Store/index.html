<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Store (brr.Brr.Store)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../../index.html">brr</a> &#x00BB; <a href="../index.html">Brr</a> &#x00BB; Store</nav><h1>Module <code>Brr.Store</code></h1><p>Persistent storage.</p><p>Persisent key-value store implemented over <a href="http://www.w3.org/TR/webstorage/">webstorage</a>. Safe if no one tampers with the storage outside of the program. FIXME/TODO this still relies on the jsoo representation, add safer keys with type indexed codecs.</p><nav class="toc"><ul><li><a href="#storage-scope">Storage scope</a></li><li><a href="#keys">Keys</a></li><li><a href="#storage">Storage</a></li><li><a href="#versioning">Versioning</a></li></ul></nav></header><section><header><h2 id="storage-scope"><a href="#storage-scope" class="anchor"></a>Storage scope</h2></header><dl><dt class="spec type" id="type-scope"><a href="#type-scope" class="anchor"></a><code><span class="keyword">type </span>scope</code><span class="keyword"> = </span><code>[ </code><table class="variant"><tr id="type-scope.Session" class="anchored"><td class="def constructor"><a href="#type-scope.Session" class="anchor"></a><code><span class="keyword">| </span></code><code>`Session</code></td></tr><tr id="type-scope.Persist" class="anchored"><td class="def constructor"><a href="#type-scope.Persist" class="anchor"></a><code><span class="keyword">| </span></code><code>`Persist</code></td></tr></table><code> ]</code></dt><dd><p>The storage scope.</p></dd></dl><dl><dt class="spec value" id="val-support"><a href="#val-support" class="anchor"></a><code><span class="keyword">val </span>support : <a href="index.html#type-scope">scope</a> <span>&#45;&gt;</span> bool</code></dt><dd><p><code>support scope</code> is <code>true</code> iff values can be stored in <code>scope</code>.</p></dd></dl></section><section><header><h2 id="keys"><a href="#keys" class="anchor"></a>Keys</h2></header><dl><dt class="spec type" id="type-key"><a href="#type-key" class="anchor"></a><code><span class="keyword">type </span>'a key</code></dt><dd><p>The type for keys whose lookup value is 'a</p></dd></dl><dl><dt class="spec value" id="val-key"><a href="#val-key" class="anchor"></a><code><span class="keyword">val </span>key : ?&#8288;ns:<a href="../Jstr/index.html#type-t">Jstr.t</a> <span>&#45;&gt;</span> unit <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-key">key</a></code></dt><dd><p><code>key ~ns ()</code> is a new storage key in namespace <code>ns</code>. If <code>ns</code> is unspecified, the key lives in a global namespace.</p><p><b>Warning.</b> Reordering invocations of <a href="index.html#type-key"><code>key</code></a> in the same namespace will most of the time corrupt existing storage. This means that all <a href="index.html#type-key"><code>key</code></a> calls should always be performed at initialization time. <a href="index.html#val-force_version"><code>Store.force_version</code></a> can be used to easily version your store and aleviate this problem.</p></dd></dl></section><section><header><h2 id="storage"><a href="#storage" class="anchor"></a>Storage</h2><p>In the functions below <code>scope</code> defaults to <code>`Persist</code>.</p></header><dl><dt class="spec value" id="val-mem"><a href="#val-mem" class="anchor"></a><code><span class="keyword">val </span>mem : ?&#8288;scope:<a href="index.html#type-scope">scope</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-key">key</a> <span>&#45;&gt;</span> bool</code></dt><dd><p><code>mem k</code> is <code>true</code> iff <code>k</code> has a mapping.</p></dd></dl><dl><dt class="spec value" id="val-add"><a href="#val-add" class="anchor"></a><code><span class="keyword">val </span>add : ?&#8288;scope:<a href="index.html#type-scope">scope</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-key">key</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>add k v</code> maps <code>k</code> to <code>v</code>.</p></dd></dl><dl><dt class="spec value" id="val-rem"><a href="#val-rem" class="anchor"></a><code><span class="keyword">val </span>rem : ?&#8288;scope:<a href="index.html#type-scope">scope</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-key">key</a> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>rem k</code> unbinds <code>k</code>.</p></dd></dl><dl><dt class="spec value" id="val-find"><a href="#val-find" class="anchor"></a><code><span class="keyword">val </span>find : ?&#8288;scope:<a href="index.html#type-scope">scope</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-key">key</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> option</code></dt><dd><p><code>find k</code> is <code>k</code>'s mapping in <code>m</code>, if any.</p></dd></dl><dl><dt class="spec value" id="val-get"><a href="#val-get" class="anchor"></a><code><span class="keyword">val </span>get : ?&#8288;scope:<a href="index.html#type-scope">scope</a> <span>&#45;&gt;</span> ?&#8288;absent:<span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-key">key</a> <span>&#45;&gt;</span> <span class="type-var">'a</span></code></dt><dd><p><code>get k</code> is <code>k</code>'s mapping. If <code>absent</code> is provided and <code>m</code> has not binding for <code>k</code>, <code>absent</code> is returned.</p><dl><dt>raises Invalid_argument</dt><dd><p>if <code>k</code> is not bound and <code>absent</code> is unspecified or if <code>scope</code> is not <a href="index.html#val-support"><code>support</code></a>ed.</p></dd></dl></dd></dl><dl><dt class="spec value" id="val-clear"><a href="#val-clear" class="anchor"></a><code><span class="keyword">val </span>clear : ?&#8288;scope:<a href="index.html#type-scope">scope</a> <span>&#45;&gt;</span> unit <span>&#45;&gt;</span> unit</code></dt><dd><p><code>clear ()</code>, clears all mapping.</p></dd></dl></section><section><header><h2 id="versioning"><a href="#versioning" class="anchor"></a>Versioning</h2></header><dl><dt class="spec value" id="val-force_version"><a href="#val-force_version" class="anchor"></a><code><span class="keyword">val </span>force_version : ?&#8288;scope:<a href="index.html#type-scope">scope</a> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> unit</code></dt><dd><p><code>force_version v</code> checks that the version of the store is <code>v</code>. If it's not it <a href="index.html#val-clear"><code>clear</code></a>s the store and sets the version to <code>v</code>.</p></dd></dl></section></div></body></html>