<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Message (capnp.Capnp__.BuilderOps.Make.2-RWM.Message)</title><link rel="stylesheet" href="../../../../../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../../../../../index.html">capnp</a> &#x00BB; <a href="../../../../index.html">Capnp__</a> &#x00BB; <a href="../../../index.html">BuilderOps</a> &#x00BB; <a href="../../index.html">Make</a> &#x00BB; <a href="../index.html">2-RWM</a> &#x00BB; Message</nav><h1>Module <code>2-RWM.Message</code></h1></header><div><div class="spec include"><div class="doc"><details open="open"><summary><span class="def"><code><span class="keyword">include</span> <a href="../../../../../Capnp/MessageSig/index.html#module-type-MESSAGE">Capnp.MessageSig.MESSAGE</a> <span class="keyword">with</span> <span class="keyword">type</span> 'a <a href="../../../../../Capnp/MessageSig/module-type-MESSAGE/index.html#type-segment_t">segment_t</a> := <span class="type-var">'a</span> <a href="../Segment/index.html#type-t">Segment.t</a></code></span></summary><dl><dt class="spec type" id="type-storage_t"><a href="#type-storage_t" class="anchor"></a><code><span class="keyword">type</span> storage_t</code></dt><dd><p><code>storage_t</code> is the type of the underlying storage associated with this segment (e.g. &quot;bytes&quot;).</p></dd></dl><dl><dt class="spec type" id="type-storage_descr_t"><a href="#type-storage_descr_t" class="anchor"></a><code><span class="keyword">type</span> storage_descr_t</code><code> = </code><code>{</code><table class="record"><tr id="type-storage_descr_t.segment" class="anchored"><td class="def field"><a href="#type-storage_descr_t.segment" class="anchor"></a><code>segment : <a href="index.html#type-storage_t">storage_t</a>;</code></td></tr><tr id="type-storage_descr_t.bytes_consumed" class="anchored"><td class="def field"><a href="#type-storage_descr_t.bytes_consumed" class="anchor"></a><code>bytes_consumed : int;</code></td></tr></table><code>}</code></dt><dt class="spec type" id="type-segment_t"><a href="#type-segment_t" class="anchor"></a><code><span class="keyword">type</span> -'cap segment_t</code></dt><dt class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> -'cap t</code></dt><dd><p><code>'cap t</code> is the type of a message. The <code>'cap</code> annotation is type <code>ro</code> for read-only segments, and type <code>rw</code> for read/write segments.</p></dd></dl><dl><dt class="spec value" id="val-create"><a href="#val-create" class="anchor"></a><code><span class="keyword">val</span> create : int <span>&#45;&gt;</span> <a href="../../../../../Capnp/MessageSig/index.html#type-rw">Capnp.MessageSig.rw</a> <a href="index.html#type-t">t</a></code></dt><dd><p><code>create size</code> allocates a new zero-filled single-segment message of at least <code>size</code> bytes, raising an exception if storage cannot be allocated.</p></dd></dl><dl><dt class="spec value" id="val-release"><a href="#val-release" class="anchor"></a><code><span class="keyword">val</span> release : <span class="type-var">'cap</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>release m</code> immediately releases the storage for all segments of message <code>m</code>, potentially making the storage available for future allocations. After releasing a storage segment, the behavior of the accessor functions is undefined.</p></dd></dl><dl><dt class="spec value" id="val-num_segments"><a href="#val-num_segments" class="anchor"></a><code><span class="keyword">val</span> num_segments : <span class="type-var">'cap</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> int</code></dt><dd><p><code>num_segments m</code> obtains the number of segments associated with message <code>m</code>.</p></dd></dl><dl><dt class="spec value" id="val-total_size"><a href="#val-total_size" class="anchor"></a><code><span class="keyword">val</span> total_size : <span class="type-var">'cap</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> int</code></dt><dd><p><code>total_size m</code> gets the total size of the message, in bytes, across all segments.</p></dd></dl><dl><dt class="spec value" id="val-total_alloc_size"><a href="#val-total_alloc_size" class="anchor"></a><code><span class="keyword">val</span> total_alloc_size : <span class="type-var">'cap</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> int</code></dt><dd><p><code>total_alloc_size m</code> gets total size of the underlying storage for the message, in bytes, across all segments. (This is at least as large as the value returned by <code>total_size</code>.</p></dd></dl><dl><dt class="spec value" id="val-get_segment"><a href="#val-get_segment" class="anchor"></a><code><span class="keyword">val</span> get_segment : <span class="type-var">'cap</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> int <span>&#45;&gt;</span> <span class="type-var">'cap</span> <a href="index.html#type-segment_t">segment_t</a></code></dt><dd><p><code>get_segment m i</code> gets zero-indexed segment <code>i</code> associated with message <code>m</code>.</p><dl><dt>raises Invalid_argument</dt><dd><p>if the index is out of bounds.</p></dd></dl></dd></dl><dl><dt class="spec value" id="val-readonly"><a href="#val-readonly" class="anchor"></a><code><span class="keyword">val</span> readonly : <span class="type-var">'cap</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../../../../../Capnp/MessageSig/index.html#type-ro">Capnp.MessageSig.ro</a> <a href="index.html#type-t">t</a></code></dt><dd><p><code>readonly m</code> obtains a view of message <code>m</code> which is read-only qualified.</p></dd></dl><dl><dt class="spec value" id="val-of_storage"><a href="#val-of_storage" class="anchor"></a><code><span class="keyword">val</span> of_storage : <a href="index.html#type-storage_t">storage_t</a> list <span>&#45;&gt;</span> <a href="../../../../../Capnp/MessageSig/index.html#type-rw">Capnp.MessageSig.rw</a> <a href="index.html#type-t">t</a></code></dt><dd><p><code>of_storage chunks</code> constructs a read/write message which uses the list of storage <code>chunks</code> as the underlying storage media for the message segments.</p></dd></dl><dl><dt class="spec value" id="val-to_storage"><a href="#val-to_storage" class="anchor"></a><code><span class="keyword">val</span> to_storage : <span class="type-var">'cap</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-storage_descr_t">storage_descr_t</a> list</code></dt><dd><p><code>to_storage m</code> retrieves a list of the storage elements associated with the message segments.</p></dd></dl><dl><dt class="spec value" id="val-with_message"><a href="#val-with_message" class="anchor"></a><code><span class="keyword">val</span> with_message : <span class="type-var">'cap</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> f:(<span class="type-var">'cap</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span>) <span>&#45;&gt;</span> <span class="type-var">'a</span></code></dt><dd><p><code>with_message m ~f</code> first evaluates <code>f m</code>, then invokes <code>release m</code>, then returns the result of the application of <code>f</code>. If <code>f m</code> raises an exception, the exception will be propagated after a call to <code>release</code>.</p></dd></dl><dl><dt class="spec value" id="val-with_attachments"><a href="#val-with_attachments" class="anchor"></a><code><span class="keyword">val</span> with_attachments : <a href="../../../../../Capnp/MessageSig/index.html#type-attachments">Capnp.MessageSig.attachments</a> <span>&#45;&gt;</span> <span class="type-var">'cap</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'cap</span> <a href="index.html#type-t">t</a></code></dt><dd><p><code>with_attachments attachments m</code> is a message sharing the same storage as <code>m</code>, but with the given attachments. If <code>m</code> is mutable, it should not be used after calling this. Effectively, <code>attachments</code> is a constructor argument, but it isn't known until slightly after the message is constructed.</p></dd></dl><dl><dt class="spec value" id="val-get_attachments"><a href="#val-get_attachments" class="anchor"></a><code><span class="keyword">val</span> get_attachments : <span class="type-var">'cap</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../../../../../Capnp/MessageSig/index.html#type-attachments">Capnp.MessageSig.attachments</a></code></dt><dd><p><code>get_attachments m</code> returns the handler previously set in <code>with_attachments</code>, or <code>No_attachments</code> if no attachments were given.</p></dd></dl></details></div></div></div></div></body></html>