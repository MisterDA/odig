<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>IO (capnp.Capnp_unix.IO)</title><link rel="stylesheet" href="../../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../../index.html">capnp</a> &#x00BB; <a href="../index.html">Capnp_unix</a> &#x00BB; IO</nav><h1>Module <code>Capnp_unix.IO</code></h1></header><dl><dt class="spec exception" id="exception-Unsupported_message_frame"><a href="#exception-Unsupported_message_frame" class="anchor"></a><code><span class="keyword">exception</span> </code><code><span class="exception">Unsupported_message_frame</span></code></dt></dl><div class="spec module" id="module-WriteContext"><a href="#module-WriteContext" class="anchor"></a><code><span class="keyword">module</span> <a href="WriteContext/index.html">WriteContext</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="spec module" id="module-ReadContext"><a href="#module-ReadContext" class="anchor"></a><code><span class="keyword">module</span> <a href="ReadContext/index.html">ReadContext</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><dl><dt class="spec value" id="val-create_write_context_for_fd"><a href="#val-create_write_context_for_fd" class="anchor"></a><code><span class="keyword">val</span> create_write_context_for_fd : ?&#8288;restart:bool <span>&#45;&gt;</span> compression:<a href="../../Capnp/Codecs/index.html#type-compression_t">Capnp.Codecs.compression_t</a> <span>&#45;&gt;</span> <a href="../../../ocaml/Unix/index.html#type-file_descr">Unix.file_descr</a> <span>&#45;&gt;</span> <a href="../../../ocaml/Unix/index.html#type-file_descr">Unix.file_descr</a> <a href="WriteContext/index.html#type-t">WriteContext.t</a></code></dt><dd><p><code>create_write_context_for_fd ~compression fd</code> creates a context for writing messages to the given file descriptor using the specified <code>compression</code> format. If <code>restart</code> is set to <code>true</code> (default), then writes failing with error code Unix.EINTR will be automatically restarted.</p></dd></dl><dl><dt class="spec value" id="val-create_write_context_for_channel"><a href="#val-create_write_context_for_channel" class="anchor"></a><code><span class="keyword">val</span> create_write_context_for_channel : compression:<a href="../../Capnp/Codecs/index.html#type-compression_t">Capnp.Codecs.compression_t</a> <span>&#45;&gt;</span> <a href="../../../ocaml/Stdlib/Pervasives/index.html#type-out_channel">Stdlib.Pervasives.out_channel</a> <span>&#45;&gt;</span> <a href="../../../ocaml/Stdlib/Pervasives/index.html#type-out_channel">Stdlib.Pervasives.out_channel</a> <a href="WriteContext/index.html#type-t">WriteContext.t</a></code></dt><dd><p><code>create_write_context_for_channel ~compression chan</code> creates a context for writing messages to the given buffered output channel using the specified <code>compression</code> format.</p></dd></dl><dl><dt class="spec value" id="val-create_read_context_for_fd"><a href="#val-create_read_context_for_fd" class="anchor"></a><code><span class="keyword">val</span> create_read_context_for_fd : ?&#8288;restart:bool <span>&#45;&gt;</span> compression:<a href="../../Capnp/Codecs/index.html#type-compression_t">Capnp.Codecs.compression_t</a> <span>&#45;&gt;</span> <a href="../../../ocaml/Unix/index.html#type-file_descr">Unix.file_descr</a> <span>&#45;&gt;</span> <a href="../../../ocaml/Unix/index.html#type-file_descr">Unix.file_descr</a> <a href="ReadContext/index.html#type-t">ReadContext.t</a></code></dt><dd><p><code>create_read_context_for_fd ~compression fd</code> creates a context for reading messages from the given file descriptor using the specified <code>compression</code> method. If <code>restart</code> is set to <code>true</code> (default), then writes failing with error code Unix.EINTR will be automatically restarted.</p></dd></dl><dl><dt class="spec value" id="val-create_read_context_for_channel"><a href="#val-create_read_context_for_channel" class="anchor"></a><code><span class="keyword">val</span> create_read_context_for_channel : compression:<a href="../../Capnp/Codecs/index.html#type-compression_t">Capnp.Codecs.compression_t</a> <span>&#45;&gt;</span> <a href="../../../ocaml/Stdlib/Pervasives/index.html#type-in_channel">Stdlib.Pervasives.in_channel</a> <span>&#45;&gt;</span> <a href="../../../ocaml/Stdlib/Pervasives/index.html#type-in_channel">Stdlib.Pervasives.in_channel</a> <a href="ReadContext/index.html#type-t">ReadContext.t</a></code></dt><dd><p><code>create_read_context_for_channel ~compression chan</code> creates a context for reading messages from the given input channel using the specified <code>compression</code> method.</p></dd></dl><dl><dt class="spec value" id="val-write_message_to_fd"><a href="#val-write_message_to_fd" class="anchor"></a><code><span class="keyword">val</span> write_message_to_fd : ?&#8288;restart:bool <span>&#45;&gt;</span> compression:<a href="../../Capnp/Codecs/index.html#type-compression_t">Capnp.Codecs.compression_t</a> <span>&#45;&gt;</span> <span class="type-var">'cap</span> <a href="../../Capnp__Message/BytesMessage/Message/index.html#type-t">Capnp.Message.BytesMessage.Message.t</a> <span>&#45;&gt;</span> <a href="../../../ocaml/Unix/index.html#type-file_descr">Unix.file_descr</a> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>write_message_to_fd ~compression message fd</code> writes the specified <code>message</code> to the given file descriptor, using the specified <code>compression</code> method. If <code>restart</code> is set to <code>true</code> (default), then writes failing with error code Unix.EINTR will be automatically restarted.</p><p>EAGAIN/EWOULDBLOCK are handled automatically.</p><dl><dt>raises Unix.Unix_error</dt><dd><p>if a write fails</p></dd></dl></dd></dl><dl><dt class="spec value" id="val-write_message_to_channel"><a href="#val-write_message_to_channel" class="anchor"></a><code><span class="keyword">val</span> write_message_to_channel : compression:<a href="../../Capnp/Codecs/index.html#type-compression_t">Capnp.Codecs.compression_t</a> <span>&#45;&gt;</span> <span class="type-var">'cap</span> <a href="../../Capnp__Message/BytesMessage/Message/index.html#type-t">Capnp.Message.BytesMessage.Message.t</a> <span>&#45;&gt;</span> <a href="../../../ocaml/Stdlib/Pervasives/index.html#type-out_channel">Stdlib.Pervasives.out_channel</a> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>write_message_to_channel ~compression message chan</code> writes the specified <code>message</code> to the given buffered I/O channel, using the specified <code>compression</code> method.</p></dd></dl><dl><dt class="spec value" id="val-write_message_to_file"><a href="#val-write_message_to_file" class="anchor"></a><code><span class="keyword">val</span> write_message_to_file : ?&#8288;perm:int <span>&#45;&gt;</span> compression:<a href="../../Capnp/Codecs/index.html#type-compression_t">Capnp.Codecs.compression_t</a> <span>&#45;&gt;</span> <span class="type-var">'cap</span> <a href="../../Capnp__Message/BytesMessage/Message/index.html#type-t">Capnp.Message.BytesMessage.Message.t</a> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> unit</code></dt><dd><p><code>write_message_to_file ~compression message filename</code> writes the specified <code>message</code> to a file with the given <code>filename</code>, using the requested <code>compression</code> method. The optional <code>perm</code> specifies the file creation mode, in case a new file must be created.</p></dd></dl><dl><dt class="spec value" id="val-write_message_to_file_robust"><a href="#val-write_message_to_file_robust" class="anchor"></a><code><span class="keyword">val</span> write_message_to_file_robust : ?&#8288;perm:int <span>&#45;&gt;</span> compression:<a href="../../Capnp/Codecs/index.html#type-compression_t">Capnp.Codecs.compression_t</a> <span>&#45;&gt;</span> <span class="type-var">'cap</span> <a href="../../Capnp__Message/BytesMessage/Message/index.html#type-t">Capnp.Message.BytesMessage.Message.t</a> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> unit</code></dt><dd><p>As <code>write_message_to_file</code>, but the file is constructed transactionally by writing to a temporary file and renaming to the <code>filename</code>, and <code>Unix.fsync</code> is used carefully to ensure durability of the write.</p><p>The overhead of <code>rename</code> and <code>fsync</code> may lead to reduced throughput relative to <code>write_message_to_file</code>.</p><dl><dt>raises Unix.Unix_error</dt><dd><p>if <code>write</code>, <code>fsync</code>, or <code>rename</code> operations fail.</p></dd></dl></dd></dl><dl><dt class="spec value" id="val-read_single_message_from_fd"><a href="#val-read_single_message_from_fd" class="anchor"></a><code><span class="keyword">val</span> read_single_message_from_fd : ?&#8288;restart:bool <span>&#45;&gt;</span> compression:<a href="../../Capnp/Codecs/index.html#type-compression_t">Capnp.Codecs.compression_t</a> <span>&#45;&gt;</span> <a href="../../../ocaml/Unix/index.html#type-file_descr">Unix.file_descr</a> <span>&#45;&gt;</span> <a href="../../Capnp/Message/index.html#type-rw">Capnp.Message.rw</a> <a href="../../Capnp__Message/BytesMessage/Message/index.html#type-t">Capnp.Message.BytesMessage.Message.t</a> option</code></dt><dd><p><code>read_single_message_from_fd ~compression fd</code> attempts to read a single message from the specified file descriptor, using the given <code>compression</code> method. If <code>restart</code> is set to <code>true</code> (default), then writes failing with error code Unix.EINTR will be automatically restarted.</p><p>EAGAIN/EWOULDBLOCK are handled automatically.</p><p>This function is appropriate to use only when 0 or 1 messages are expected to be available from the descriptor; if additional messages are available, some message data could be lost. Use <code>create_XXX_read_context_for_fd</code> to correctly handle a stream of messages.</p><dl><dt>returns</dt><dd><p>Some message, or None if end-of-file was reached before a message could be decoded.</p></dd></dl><dl><dt>raises Unix.Unix_error</dt><dd><p>if a read fails</p></dd></dl><dl><dt>raises Unsupported_message_frame</dt><dd><p>if the frame header describes a segment count or segment size that is too large for the implementation</p></dd></dl></dd></dl><dl><dt class="spec value" id="val-read_single_message_from_channel"><a href="#val-read_single_message_from_channel" class="anchor"></a><code><span class="keyword">val</span> read_single_message_from_channel : compression:<a href="../../Capnp/Codecs/index.html#type-compression_t">Capnp.Codecs.compression_t</a> <span>&#45;&gt;</span> <a href="../../../ocaml/Stdlib/Pervasives/index.html#type-in_channel">Stdlib.Pervasives.in_channel</a> <span>&#45;&gt;</span> <a href="../../Capnp/Message/index.html#type-rw">Capnp.Message.rw</a> <a href="../../Capnp__Message/BytesMessage/Message/index.html#type-t">Capnp.Message.BytesMessage.Message.t</a> option</code></dt><dd><p><code>read_single_message_from_channel ~compression chan</code> attempts to read a single message from the specified input channel, using the given <code>compression</code> method.</p><p>This function is appropriate to use only when 0 or 1 messages are expected to be available from the channel; if additional messages are available, some message data could be lost. Use <code>create_XXX_read_context_for_channel</code> to correctly handle a stream of messages.</p><dl><dt>returns</dt><dd><p>Some message, or None if end-of-file was reached before a message could be decoded.</p></dd></dl><dl><dt>raises Unsupported_message_frame</dt><dd><p>if the frame header describes a segment count or segment size that is too large for the implementation</p></dd></dl></dd></dl><dl><dt class="spec value" id="val-read_message_from_file"><a href="#val-read_message_from_file" class="anchor"></a><code><span class="keyword">val</span> read_message_from_file : compression:<a href="../../Capnp/Codecs/index.html#type-compression_t">Capnp.Codecs.compression_t</a> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> <a href="../../Capnp/Message/index.html#type-rw">Capnp.Message.rw</a> <a href="../../Capnp__Message/BytesMessage/Message/index.html#type-t">Capnp.Message.BytesMessage.Message.t</a> option</code></dt><dd><p><code>read_message_from_file ~compression filename</code> attempts to read a message from the file with the given <code>filename</code>, using the requested <code>compression</code> method.</p><dl><dt>returns</dt><dd><p>Some message, or None if the file does not contain a complete message frame.</p></dd></dl></dd></dl></div></body></html>