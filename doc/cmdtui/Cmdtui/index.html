<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Cmdtui (cmdtui.Cmdtui)</title><link rel="stylesheet" href="../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – <a href="../index.html">cmdtui</a> &#x00BB; Cmdtui</nav><h1>Module <code>Cmdtui</code></h1><p>interactive command completion and execution for building REPLs</p><p><em>v0.4.3 — <a href="https://gitlab.com/edwintorok/cmdtui">homepage</a></em></p><p>Consult the <a href="index.html#basics"><span>basics</span></a>, and <a href="index.html#examples"><span>examples</span></a>.</p><nav class="toc"><ul><li><a href="#cmdtui">Cmdtui</a><ul><li><a href="#command-argument-types">Command argument types</a></li></ul></li><li><a href="#basics">Basics</a></li><li><a href="#examples">Examples</a></li></ul></nav></header><section><header><h2 id="cmdtui"><a href="#cmdtui" class="anchor"></a>Cmdtui</h2></header><dl><dt class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> 'a t</code></dt><dd><p>the type for command declarations</p></dd></dl><dl><dt class="spec value" id="val-const"><a href="#val-const" class="anchor"></a><code><span class="keyword">val</span> const : <span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-t">t</a></code></dt><dd><p><code>const v</code> is a command that evaluates to <code>v</code>. You should use this to start your command definition by providing a function (the action), for example: <code>const f</code></p></dd></dl><dl><dt class="spec value" id="val-($)"><a href="#val-($)" class="anchor"></a><code><span class="keyword">val</span> ($) : (<span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'b</span>) <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'b</span> <a href="index.html#type-t">t</a></code></dt><dd><p><code>f $ v</code> is a command that evaluates to applying <code>v</code> to <code>f</code>. You should use this to declare function parameters, for example:</p><pre><code class="ml">let f a = a + 1
let cmd = Cmdtui.(const f $ int)</code></pre></dd></dl><dl><dt class="spec value" id="val-commands"><a href="#val-commands" class="anchor"></a><code><span class="keyword">val</span> commands : ?&#8288;help:((string * string) list <span>&#45;&gt;</span> <span class="type-var">'a</span>) <span>&#45;&gt;</span> (string * (<a href="../../ocaml/Stdlib/Arg/index.html#type-doc">Stdlib.Arg.doc</a> * <span class="type-var">'a</span> <a href="index.html#type-t">t</a>)) list <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-t">t</a></code></dt><dd><p><code>commands ?help spec</code> builds multiple commands from <code>spec</code>.</p><p><code>spec</code> is a list with <code>command_name, (doc, cmd_spec)</code> tuples.</p><p>The first element of the <code>args</code> array is used to look up the <code>command_name</code> in <code>spec</code>, and then the rest of the array is used to build the arguments for the command action. <code>doc</code> is used when showing the built-in help (the <code>help</code> command). <code>help</code> is the command invoked to display the help (default: none).</p><p>For example:</p><pre><code class="ml">let showf f = Printf.printf &quot;%.3f\n&quot; f
let add a b = a +. b
let cmd = Cmdtui.(commands [
    &quot;showf&quot;, &quot;prints its floating point argument&quot;, (const showf $ float);
    &quot;add&quot;, &quot;adds a floating point number&quot;, (const add $ float $ float)
  ])</code></pre></dd></dl><dl><dt class="spec value" id="val-eval"><a href="#val-eval" class="anchor"></a><code><span class="keyword">val</span> eval : <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> string array <span>&#45;&gt;</span> <span class="type-var">'a</span></code></dt><dd><p><code>eval spec args</code> evaluates the command <code>args</code> using <code>spec</code>.</p><p>If the command cannot be found or there are more elements in <code>args</code> than the command is declared with then <code>Failure</code> is raised. If there are fewer arguments then <code>Invalid_argument</code> is raised.</p></dd></dl><dl><dt class="spec type" id="type-completion"><a href="#type-completion" class="anchor"></a><code><span class="keyword">type</span> completion</code><code> = </code><code>{</code><table class="record"><tr id="type-completion.desc" class="anchored"><td class="def field"><a href="#type-completion.desc" class="anchor"></a><code>desc : string option;</code></td></tr><tr id="type-completion.choices" class="anchored"><td class="def field"><a href="#type-completion.choices" class="anchor"></a><code>choices : string list option;</code></td></tr></table><code>}</code></dt></dl><dl><dt class="spec value" id="val-completion"><a href="#val-completion" class="anchor"></a><code><span class="keyword">val</span> completion : <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> string array <span>&#45;&gt;</span> <a href="index.html#type-completion">completion</a> option</code></dt><dd><p><code>completion spec args</code> returns possible completions if any given the (partial) input string in <code>args</code></p></dd></dl><section><header><h3 id="command-argument-types"><a href="#command-argument-types" class="anchor"></a>Command argument types</h3></header><dl><dt class="spec value" id="val-int"><a href="#val-int" class="anchor"></a><code><span class="keyword">val</span> int : int <a href="index.html#type-t">t</a></code></dt><dd><p>integer argument</p></dd></dl><dl><dt class="spec value" id="val-float"><a href="#val-float" class="anchor"></a><code><span class="keyword">val</span> float : float <a href="index.html#type-t">t</a></code></dt><dd><p>floating point argument</p></dd></dl><dl><dt class="spec value" id="val-string"><a href="#val-string" class="anchor"></a><code><span class="keyword">val</span> string : string <a href="index.html#type-t">t</a></code></dt><dd><p>string point argument</p></dd></dl><dl><dt class="spec value" id="val-enum"><a href="#val-enum" class="anchor"></a><code><span class="keyword">val</span> enum : desc:string <span>&#45;&gt;</span> (string * <span class="type-var">'a</span>) list <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-t">t</a></code></dt><dd><p><code>enum desc lst</code> is an argument with all possible values from <code>lst</code>. These are automatically considered as completions. <code>desc</code> is the name you give to this argument type and is shown as a hint.</p></dd></dl><dl><dt class="spec value" id="val-conv"><a href="#val-conv" class="anchor"></a><code><span class="keyword">val</span> conv : ?&#8288;desc:string <span>&#45;&gt;</span> ?&#8288;choices:(unit <span>&#45;&gt;</span> string list) <span>&#45;&gt;</span> (string <span>&#45;&gt;</span> <span class="type-var">'a</span>) <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-t">t</a></code></dt><dd><p><code>conv ?desc ?choices of_string</code> is a custom argument of type <code>'a</code> that uses <code>of_string</code> to parse user provided arguments, with optional description <code>desc</code>. Possible completions can be computed dynamically if you supply a <code>choices</code> function.</p></dd></dl><dl><dt class="spec value" id="val-split"><a href="#val-split" class="anchor"></a><code><span class="keyword">val</span> split : string <span>&#45;&gt;</span> string array</code></dt><dd><p><code>split line</code> splits an input <code>line</code> into arguments suitable for <a href="index.html#val-eval"><code>eval</code></a> and <a href="index.html#type-completion"><code>completion</code></a>.</p></dd></dl></section></section><section><header><h2 id="basics"><a href="#basics" class="anchor"></a>Basics</h2><p>Using this module you can declare interactive command actions, their parameters (with types and dynamic completion).</p><p>Given a partial input string you can query for a completion using <a href="index.html#type-completion"><code>completion</code></a>. Given a full input string you can evaluate the command with all its parameters using <a href="index.html#val-eval"><code>eval</code></a>. Help can be autogenerated from a list of commands using <a href="index.html#val-commands"><code>commands</code></a>.</p><p>This module doesn't depend on any particular terminal UI library.</p><p>For a quick start support is provided for <code>lambda-term</code> in the <code>cmdtui_lambda_term</code> subpackage's <code>Cmdtui_lambda_term</code> module. This allows to build an application: by just defining a <code>`a Cmdtui.t</code>, you get:</p><ul><li>shows a prompt</li><li>reads input from the user</li><li>shows hints for type parameters</li><li>provide built-in help for existing commands and key bindings</li><li>executes the command on pressing enter</li><li>binds F10 to exit</li></ul></header></section><section><header><h2 id="examples"><a href="#examples" class="anchor"></a>Examples</h2><p>Example using <code>cmdtui_lambda_term</code>:</p><pre><code class="ml">open Lwt
let show state = Printf.printf &quot;%.3f\n&quot; f; return_unit
let add a state = return (state +. a)
let cmds = Cmdtui.(commands ~help:Cmdtui_lambda_term.display_help [
    &quot;showf&quot;, &quot;prints the state (floating point)&quot;, (const show);
    &quot;add&quot;, &quot;adds a number to the current state&quot;, (const add $ float)
  ])
let () = Cmdtui_lambda_term.run ~prompt:&quot;test&quot; cmds 0.</code></pre><pre>$ ocamlfind ocamlopt $(opam config var cmdtui:doc)/example.ml \
   -package cmdtui.lambda-term -linkpkg -o example
$ ./example</pre><p>results in this:</p><pre>────────────────────────────────────────────────────
test &gt; add 42
example.native: [DEBUG] evaluating command [|add; 42

────────────────────────────────────────────────────
test &gt; show
example.native: [DEBUG] evaluating command [|show|] 
42.000                                              

────────────────────────────────────────────────────
test &gt; add 1
example.native: [DEBUG] evaluating command [|add; 1|

────────────────────────────────────────────────────
test &gt; show
example.native: [DEBUG] evaluating command [|show|] 
43.000                                              

────────────────────────────────────────────────────
test &gt; add
┌───────────────────────────────────────────────────
│float                                              
└───────────────────────────────────────────────────</pre></header></section></div></body></html>