<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Command (core.Core__.Command)</title><link rel="stylesheet" href="../../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – <a href="../../index.html">core</a> &#x00BB; <a href="../index.html">Core__</a> &#x00BB; Command</nav><h1>Module <code>Core__.Command</code></h1></header><aside><p>Purely functional command line parsing.</p><p>Here is a simple example:</p><pre><code class="ml">let () =
  let open Command.Let_syntax in
  Command.basic
    ~summary:&quot;cook eggs&quot;
    [%map_open
      let num_eggs =
        flag &quot;num-eggs&quot; (required int) ~doc:&quot;COUNT cook this many eggs&quot;
      and style =
        flag &quot;style&quot; (required (Arg_type.create Egg_style.of_string))
          ~doc:&quot;OVER-EASY|SUNNY-SIDE-UP style of eggs&quot;
      and recipient =
        anon (&quot;recipient&quot; %: string)
      in
      fun () -&gt;
        (* TODO: implement egg-cooking in ocaml *)
        failwith &quot;no eggs today&quot;
    ]
  |&gt; Command.run</code></pre><p><b>Note</b>: <a href="Param/index.html"><span><code>Command.Param</code></span></a> has replaced <a href="Spec/index.html"><span><code>Command.Spec</code> (DEPRECATED)</span></a> and should be used in all new code.</p></aside><dl><dt class="spec module" id="module-Arg_type"><a href="#module-Arg_type" class="anchor"></a><code><span class="keyword">module</span> <a href="Arg_type/index.html">Arg_type</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>Argument types.</p></dd></dl><dl><dt class="spec module" id="module-Flag"><a href="#module-Flag" class="anchor"></a><code><span class="keyword">module</span> <a href="Flag/index.html">Flag</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>Command-line flag specifications.</p></dd></dl><dl><dt class="spec module" id="module-Anons"><a href="#module-Anons" class="anchor"></a><code><span class="keyword">module</span> <a href="Anons/index.html">Anons</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>Anonymous command-line argument specification.</p></dd></dl><dl><dt class="spec module" id="module-Param"><a href="#module-Param" class="anchor"></a><code><span class="keyword">module</span> <a href="Param/index.html">Param</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>Command-line parameter specification.</p></dd></dl><div class="spec module" id="module-Let_syntax"><a href="#module-Let_syntax" class="anchor"></a><code><span class="keyword">module</span> <a href="Let_syntax/index.html">Let_syntax</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span> <span class="keyword">with</span> <span class="keyword">type</span> 'a <a href="Let_syntax/index.html#type-t">t</a> := <span class="type-var">'a</span> <a href="Param/index.html#type-t">Param.t</a></code></div><dl><dt class="spec module" id="module-Spec"><a href="#module-Spec" class="anchor"></a><code><span class="keyword">module</span> <a href="Spec/index.html">Spec</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>The old interface for command-line specifications -- <b>Do Not Use</b>.</p></dd></dl><dl><dt class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> t</code></dt><dd><p>Commands which can be combined into a hierarchy of subcommands.</p></dd></dl><dl><dt class="spec type" id="type-basic_spec_command"><a href="#type-basic_spec_command" class="anchor"></a><code><span class="keyword">type</span> ('main, 'result) basic_spec_command</code><code> = summary:string <span>&#45;&gt;</span> ?&#8288;readme:(unit <span>&#45;&gt;</span> string) <span>&#45;&gt;</span> (<span class="type-var">'main</span>, unit <span>&#45;&gt;</span> <span class="type-var">'result</span>) <a href="Spec/index.html#type-t">Spec.t</a> <span>&#45;&gt;</span> <span class="type-var">'main</span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></dt></dl><dl><dt class="spec value" id="val-basic_spec"><a href="#val-basic_spec" class="anchor"></a><code><span class="keyword">val</span> basic_spec : (<span class="type-var">'main</span>, unit) <a href="index.html#type-basic_spec_command">basic_spec_command</a></code></dt><dd><p><code>basic_spec ~summary ?readme spec main</code> is a basic command that executes a function <code>main</code> which is passed parameters parsed from the command line according to <code>spec</code>. <code>summary</code> is to contain a short one-line description of its behavior. <code>readme</code> is to contain any longer description of its behavior that will go on that command's help screen.</p></dd></dl><dl><dt class="spec type" id="type-basic_command"><a href="#type-basic_command" class="anchor"></a><code><span class="keyword">type</span> 'result basic_command</code><code> = summary:string <span>&#45;&gt;</span> ?&#8288;readme:(unit <span>&#45;&gt;</span> string) <span>&#45;&gt;</span> (unit <span>&#45;&gt;</span> <span class="type-var">'result</span>) <a href="Param/index.html#type-t">Param.t</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></dt></dl><dl><dt class="spec value" id="val-basic"><a href="#val-basic" class="anchor"></a><code><span class="keyword">val</span> basic : unit <a href="index.html#type-basic_command">basic_command</a></code></dt><dd><p>Same general behavior as <code>basic_spec</code>, but takes a command line specification built up using <code>Params</code> instead of <code>Spec</code>.</p></dd></dl><dl><dt class="spec value" id="val-group"><a href="#val-group" class="anchor"></a><code><span class="keyword">val</span> group : summary:string <span>&#45;&gt;</span> ?&#8288;readme:(unit <span>&#45;&gt;</span> string) <span>&#45;&gt;</span> ?&#8288;preserve_subcommand_order:unit <span>&#45;&gt;</span> ?&#8288;body:(path:string list <span>&#45;&gt;</span> unit) <span>&#45;&gt;</span> (string * <a href="index.html#type-t">t</a>) list <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></dt><dd><p><code>group ~summary subcommand_alist</code> is a compound command with named subcommands, as found in <code>subcommand_alist</code>. <code>summary</code> is to contain a short one-line description of the command group. <code>readme</code> is to contain any longer description of its behavior that will go on that command's help screen.</p><p>NOTE: subcommand names containing underscores will be rejected; use dashes instead.</p><p><code>body</code> is called when no additional arguments are passed -- in particular, when no subcommand is passed. Its <code>path</code> argument is the subcommand path by which the group command was reached.</p></dd></dl><dl><dt class="spec value" id="val-lazy_group"><a href="#val-lazy_group" class="anchor"></a><code><span class="keyword">val</span> lazy_group : summary:string <span>&#45;&gt;</span> ?&#8288;readme:(unit <span>&#45;&gt;</span> string) <span>&#45;&gt;</span> ?&#8288;preserve_subcommand_order:unit <span>&#45;&gt;</span> ?&#8288;body:(path:string list <span>&#45;&gt;</span> unit) <span>&#45;&gt;</span> (string * <a href="index.html#type-t">t</a>) list <a href="../../../core_kernel/Core_kernel/Lazy/index.html#type-t">Core__.Import.Lazy.t</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></dt><dd><p><code>lazy_group</code> is the same as <code>group</code>, except that the list of subcommands may be generated lazily.</p></dd></dl><dl><dt class="spec value" id="val-exec"><a href="#val-exec" class="anchor"></a><code><span class="keyword">val</span> exec : summary:string <span>&#45;&gt;</span> ?&#8288;readme:(unit <span>&#45;&gt;</span> string) <span>&#45;&gt;</span> ?&#8288;child_subcommand:string list <span>&#45;&gt;</span> path_to_exe:[ `Absolute of string | `Relative_to_argv0 of string | `Relative_to_me of string ] <span>&#45;&gt;</span> unit <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></dt><dd><p><code>exec ~summary ~path_to_exe</code> runs <code>exec</code> on the executable at <code>path_to_exe</code>. If <code>path_to_exe</code> is <code>`Absolute path</code> then <code>path</code> is executed without any further qualification. If it is <code>`Relative_to_me path</code> then <code>Filename.dirname
    Sys.executable_name ^ &quot;/&quot; ^ path</code> is executed instead. All of the usual caveats about <code>Sys.executable_name</code> apply: specifically, it may only return an absolute path in Linux. On other operating systems it will return <code>Sys.argv.(0)</code>. If it is <code>`Relative_to_argv0 path</code> then <code>Sys.argv.(0) ^ &quot;/&quot; ^ path</code> is executed.</p><p>The <code>child_subcommand</code> argument allows referencing a subcommand one or more levels below the top-level of the child executable. It should <em>not</em> be used to pass flags or anonymous arguments to the child.</p><p>Care has been taken to support nesting multiple executables built with Command. In particular, recursive help and autocompletion should work as expected.</p><p>NOTE: Non-Command executables can be used with this function but will still be executed when <code>help -recursive</code> is called or autocompletion is attempted (despite the fact that neither will be particularly helpful in this case). This means that if you have a shell script called &quot;reboot-everything.sh&quot; that takes no arguments and reboots everything no matter how it is called, you shouldn't use it with <code>exec</code>.</p><p>Additionally, no loop detection is attempted, so if you nest an executable within itself, <code>help -recursive</code> and autocompletion will hang forever (although actually running the subcommand will work).</p></dd></dl><dl><dt class="spec value" id="val-of_lazy"><a href="#val-of_lazy" class="anchor"></a><code><span class="keyword">val</span> of_lazy : <a href="index.html#type-t">t</a> <a href="../../../core_kernel/Core_kernel/Lazy/index.html#type-t">Core__.Import.Lazy.t</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></dt><dd><p><code>of_lazy thunk</code> constructs a lazy command that is forced only when necessary to run it or extract its shape.</p></dd></dl><dl><dt class="spec value" id="val-summary"><a href="#val-summary" class="anchor"></a><code><span class="keyword">val</span> summary : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> string</code></dt><dd><p>Extracts the summary string for a command.</p></dd></dl><div class="spec module" id="module-Shape"><a href="#module-Shape" class="anchor"></a><code><span class="keyword">module</span> <a href="Shape/index.html">Shape</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><dl><dt class="spec value" id="val-shape"><a href="#val-shape" class="anchor"></a><code><span class="keyword">val</span> shape : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="Shape/index.html#type-t">Shape.t</a></code></dt><dd><p>Exposes the shape of a command.</p></dd></dl><dl><dt class="spec value" id="val-run"><a href="#val-run" class="anchor"></a><code><span class="keyword">val</span> run : ?&#8288;version:string <span>&#45;&gt;</span> ?&#8288;build_info:string <span>&#45;&gt;</span> ?&#8288;argv:string list <span>&#45;&gt;</span> ?&#8288;extend:(string list <span>&#45;&gt;</span> string list) <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> unit</code></dt><dd><p>Runs a command against <code>Sys.argv</code>, or <code>argv</code> if it is specified.</p><p><code>extend</code> can be used to add extra command line arguments to basic subcommands of the command. <code>extend</code> will be passed the (fully expanded) path to a command, and its output will be appended to the list of arguments being processed. For example, suppose a program like this is compiled into <code>exe</code>:</p><pre><code class="ml">let bar = Command.basic ...
            let foo = Command.group ~summary:... [&quot;bar&quot;, bar]
let main = Command.group ~summary:... [&quot;foo&quot;, foo]
             Command.run ~extend:(fun _ -&gt; [&quot;-baz&quot;]) main</code></pre><p>Then if a user ran <code>exe f b</code>, <code>extend</code> would be passed <code>[&quot;foo&quot;; &quot;bar&quot;]</code> and <code>&quot;-baz&quot;</code> would be appended to the command line for processing by <code>bar</code>. This can be used to add a default flags section to a user config file.</p></dd></dl><dl><dt class="spec module" id="module-Deprecated"><a href="#module-Deprecated" class="anchor"></a><code><span class="keyword">module</span> <a href="Deprecated/index.html">Deprecated</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p><code>Deprecated</code> should be used only by <code>Core_extended.Deprecated_command</code>. At some point it will go away.</p></dd></dl></div></body></html>