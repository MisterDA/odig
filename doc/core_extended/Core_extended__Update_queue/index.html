<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Core_extended__Update_queue (core_extended.Core_extended__Update_queue)</title><link rel="stylesheet" href="../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – <a href="../index.html">core_extended</a> &#x00BB; Core_extended__Update_queue</nav><h1>Module <code>Core_extended__Update_queue</code></h1><p>A <code>'state t</code> keeps track of updates of type <code>'state -&gt; 'state</code> queued to it and runs them sequentially.</p><p>This has the primary feature that if an update itself schedules another update, that other update will be run after the first update has finished.</p><p>For example, consider the code:</p><pre><code class="ml">let x = create ~init:1 () in
    enqueue_update x (fun x -&gt;
    enqueue_update (fun x -&gt; x + 1);
    x + 1)</code></pre><p>At the end, <code>x</code>'s state will be 2, as you would expect. However, suppose you did this with an <code>int ref</code>:</p><pre><code class="ml">let x = ref 1 in
    let update_x f = x := f !x in
    update_x (fun x -&gt;
      update_x (fun x -&gt; x + 1);
      x + 1
    )</code></pre><p>At the end of this, <code>!x</code> would be 1.</p><p>Another feature is that the initial value does not have to be specified at creation. If it is not, enqueued updates will be kept around until an initial value is specified with <code>init</code>.</p></header><dl><dt class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> ('perm, 'state) t</code></dt></dl><dl><dt class="spec value" id="val-create"><a href="#val-create" class="anchor"></a><code><span class="keyword">val</span> create : ?&#8288;init:<span class="type-var">'state</span> <span>&#45;&gt;</span> unit <span>&#45;&gt;</span> ([&lt; <span class="type-var">_</span> <a href="../../core/Core/index.html#type-perms">Core.perms</a> ], <span class="type-var">'state</span>) <a href="index.html#type-t">t</a></code></dt><dt class="spec value" id="val-init"><a href="#val-init" class="anchor"></a><code><span class="keyword">val</span> init : (<a href="../../core/Core/index.html#type-read_write">Core.read_write</a>, <span class="type-var">'state</span>) <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'state</span> <span>&#45;&gt;</span> unit</code></dt><dt class="spec value" id="val-enqueue"><a href="#val-enqueue" class="anchor"></a><code><span class="keyword">val</span> enqueue : (<a href="../../core/Core/index.html#type-read_write">Core.read_write</a>, <span class="type-var">'state</span>) <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> (<span class="type-var">'state</span> <span>&#45;&gt;</span> <span class="type-var">'state</span>) <span>&#45;&gt;</span> unit</code></dt><dt class="spec value" id="val-watch"><a href="#val-watch" class="anchor"></a><code><span class="keyword">val</span> watch : (<span class="type-var">_</span>, <span class="type-var">'state</span>) <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> f:(<span class="type-var">'state</span> <span>&#45;&gt;</span> unit) <span>&#45;&gt;</span> unit</code></dt><dd><p><code>watch t f</code> will call <code>f</code> every time that that <code>t</code>'s state is updated. <code>f</code> should not call <code>enqueue_update</code>.</p></dd></dl><dl><dt class="spec value" id="val-map"><a href="#val-map" class="anchor"></a><code><span class="keyword">val</span> map : (<span class="type-var">_</span>, <span class="type-var">'state1</span>) <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> f:(<span class="type-var">'state1</span> <span>&#45;&gt;</span> <span class="type-var">'state2</span>) <span>&#45;&gt;</span> (<a href="../../core/Core/index.html#type-read">Core.read</a>, <span class="type-var">'state2</span>) <a href="index.html#type-t">t</a></code></dt><dt class="spec value" id="val-read_only"><a href="#val-read_only" class="anchor"></a><code><span class="keyword">val</span> read_only : ([&gt; <a href="../../core/Core/index.html#type-read">Core.read</a> ], <span class="type-var">'state</span>) <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> (<a href="../../core/Core/index.html#type-read">Core.read</a>, <span class="type-var">'state</span>) <a href="index.html#type-t">t</a></code></dt></dl></div></body></html>