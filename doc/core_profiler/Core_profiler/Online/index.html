<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Online (core_profiler.Core_profiler.Online)</title><link rel="stylesheet" href="../../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – <a href="../../index.html">core_profiler</a> &#x00BB; <a href="../index.html">Core_profiler</a> &#x00BB; Online</nav><h1>Module <code>Core_profiler.Online</code></h1></header><aside><p>Use this module for online tracking of perf metrics. When using this module, the metrics are written out to stdout every second. There is no mertric file generated for offline analysis. The rate at which metrics are dumped to stdout is controlled by the environment variable <code>CORE_PROFILER=PRINT_INTERVAL=N</code> where <code>N</code> is the integer number of seconds to wait between outputs.</p><p><code>Profiler.don't_check_env</code> is a no-op, provided for compatibility with <code>Offline</code>'s interface. <code>Time_stamp_counter</code> calibration is liable to happen occasionally when calling <code>at</code>. <code>safe_to_delay</code> checks if it will be necessary soon, and does it in advance. If possible, call <code>safe_to_delay</code> (fairly regularly) from a time-insensitive point in code (or at least, outside any deltas / groups) to reduce the number of spurious jumps in time deltas.</p><p>This is how much the online probes cost. I don't know how much I trust these metrics, but here they are:</p><ol><li>./inline_benchmarks_runner -q 3 -mat online ┌─────────────────────────────────────────────────────┬──────────┬────────────┐ │ Name │ Time/Run │ Percentage │ ├─────────────────────────────────────────────────────┼──────────┼────────────┤ │ <code>online.ml:Fstats:Fstats</code> update_in_place │ 12.96ns │ 6.94% │ │ <code>online.ml:Timer</code> at │ 11.56ns │ 6.19% │ │ <code>online.ml:Timer</code> group_point_at (0 sources) │ 13.31ns │ 7.13% │ │ <code>online.ml:Timer</code> group_point_at (1 sources) │ 22.91ns │ 12.27% │ │ <code>online.ml:Timer</code> group_point_at (2 sources) │ 40.45ns │ 21.66% │ │ <code>online.ml:Timer</code> group_reset │ 11.58ns │ 6.20% │ │ <code>online.ml:Probe</code> at │ 17.94ns │ 9.61% │ │ <code>online.ml:Probe</code> group_point_at (0 sources) │ 12.03ns │ 6.44% │ │ <code>online.ml:Probe</code> group_point_at (1 sources) │ 21.35ns │ 11.43% │ │ <code>online.ml:Probe</code> group_point_at (2 sources) │ 32.17ns │ 17.22% │ │ <code>online.ml:Probe</code> group_reset │ 11.32ns │ 6.06% │ │ <code>online.ml:Delta_timer</code> start_async │ 11.52ns │ 6.17% │ │ <code>online.ml:Delta_timer</code> stop_async │ 21.99ns │ 11.77% │ │ <code>online.ml:Delta_timer</code> start │ 11.63ns │ 6.23% │ │ <code>online.ml:Delta_timer</code> stop │ 21.99ns │ 11.77% │ │ <code>online.ml:Delta_timer.wrap_sync</code> nop │ 2.87ns │ 1.54% │ │ <code>online.ml:Delta_timer.wrap_sync</code> wrapped_nop │ 45.51ns │ 24.37% │ │ <code>online.ml:Delta_timer.wrap_sync</code> count_256 │ 146.13ns │ 78.25% │ │ <code>online.ml:Delta_timer.wrap_sync</code> wrapped_count_256 │ 186.75ns │ 100.00% │ │ <code>online.ml:Delta_probe</code> start │ 3.16ns │ 1.69% │ │ <code>online.ml:Delta_probe</code> stop │ 17.59ns │ 9.42% │ │ <code>online.ml:Delta_probe</code> start_async │ 2.96ns │ 1.58% │ │ <code>online.ml:Delta_probe</code> stop_async │ 17.26ns │ 9.24% │ └─────────────────────────────────────────────────────┴──────────┴────────────┘</li></ol></aside><div><div class="spec include"><div class="doc"><details open="open"><summary><span class="def"><code><span class="keyword">include</span> <a href="../../Core_profiler_disabled/Intf/index.html#module-type-Profiler_intf">Core_profiler_disabled.Intf.Profiler_intf</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="../../Core_profiler_disabled/Intf/module-type-Profiler_intf/Delta_timer/index.html#type-state">Delta_timer.state</a> = <span class="keyword">private</span> <a href="../../../core/Core__/Core_time_ns/index.html#type-t">Core.Time_ns.t</a> <span class="keyword">and</span> <span class="keyword">type</span> <a href="../../Core_profiler_disabled/Intf/module-type-Profiler_intf/Delta_probe/index.html#type-state">Delta_probe.state</a> = <span class="keyword">private</span> int</code></span></summary><div class="spec module" id="module-Profiler"><a href="#module-Profiler" class="anchor"></a><code><span class="keyword">module</span> <a href="Profiler/index.html">Profiler</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><dl><dt class="spec module" id="module-Timer"><a href="#module-Timer" class="anchor"></a><code><span class="keyword">module</span> <a href="Timer/index.html">Timer</a> : <a href="../../Core_profiler_disabled/Intf/index.html#module-type-Probe">Core_profiler_disabled.Intf.Probe</a> <span class="keyword">with</span> <span class="keyword">type</span> 'a <a href="../../Core_profiler_disabled/Intf/module-type-Probe/index.html#type-create_args">create_args</a> := <span class="type-var">'a</span> <a href="../../Core_profiler_disabled/Intf/index.html#type-timer_create_args">Core_profiler_disabled.Intf.timer_create_args</a> <span class="keyword">and</span> <span class="keyword">type</span> 'a <a href="../../Core_profiler_disabled/Intf/module-type-Probe/index.html#type-record_args">record_args</a> := <span class="type-var">'a</span> <a href="../../Core_profiler_disabled/Intf/index.html#type-timer_record_args">Core_profiler_disabled.Intf.timer_record_args</a></code></dt><dd><p>A <code>Timer</code> contains only a time stamp and no extra information; however, it is useful because (in <code>Offline</code>) the current time is recorded when measurements are made.</p></dd></dl><dl><dt class="spec module" id="module-Probe"><a href="#module-Probe" class="anchor"></a><code><span class="keyword">module</span> <a href="Probe/index.html">Probe</a> : <a href="../../Core_profiler_disabled/Intf/index.html#module-type-Probe">Core_profiler_disabled.Intf.Probe</a> <span class="keyword">with</span> <span class="keyword">type</span> 'a <a href="../../Core_profiler_disabled/Intf/module-type-Probe/index.html#type-create_args">create_args</a> := <span class="type-var">'a</span> <a href="../../Core_profiler_disabled/Intf/index.html#type-probe_create_args">Core_profiler_disabled.Intf.probe_create_args</a> <span class="keyword">and</span> <span class="keyword">type</span> 'a <a href="../../Core_profiler_disabled/Intf/module-type-Probe/index.html#type-record_args">record_args</a> := <span class="type-var">'a</span> <a href="../../Core_profiler_disabled/Intf/index.html#type-probe_record_args">Core_profiler_disabled.Intf.probe_record_args</a></code></dt><dd><p>A <code>Probe</code> records some integer value that is passed to <code>at</code> along with a timestamp.</p></dd></dl><dl><dt class="spec module" id="module-Delta_probe"><a href="#module-Delta_probe" class="anchor"></a><code><span class="keyword">module</span> <a href="Delta_probe/index.html">Delta_probe</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span> <span class="keyword">with</span> <span class="keyword">type</span> <a href="Delta_probe/index.html#type-state">state</a> = <span class="keyword">private</span> int</code></dt><dd><p><code>Delta_probe</code> is an optimized two-probe group to track changes to some counter.</p></dd></dl><dl><dt class="spec module" id="module-Delta_timer"><a href="#module-Delta_timer" class="anchor"></a><code><span class="keyword">module</span> <a href="Delta_timer/index.html">Delta_timer</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span> <span class="keyword">with</span> <span class="keyword">type</span> <a href="Delta_timer/index.html#type-state">state</a> = <span class="keyword">private</span> <a href="../../../core/Core__/Core_time_ns/index.html#type-t">Core.Time_ns.t</a></code></dt><dd><p><code>Delta_timer</code> is an optimized two-probe group to track time differences between calls to <code>start</code> and <code>stop</code>.</p></dd></dl></details></div></div></div></div></body></html>