<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Crowbar (crowbar.Crowbar)</title><link rel="stylesheet" href="../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – <a href="../index.html">crowbar</a> &#x00BB; Crowbar</nav><h1>Module <code>Crowbar</code></h1><h2 id="top"><a href="#top" class="anchor"></a>Types</h2><nav class="toc"><ul><li><a href="#generators">Generators</a><ul><li><a href="#simple_generators">Simple Generators</a></li><li><a href="#generator_functions">Functions on Generators</a></li></ul></li><li><a href="#printing">Printing</a></li><li><a href="#testing">Testing</a><ul><li><a href="#aborting">Aborting Tests</a></li><li><a href="#failing">Failing</a></li><li><a href="#asserting">Asserting Properties</a></li></ul></li></ul></nav></header><dl><dt class="spec type" id="type-gen"><a href="#type-gen" class="anchor"></a><code><span class="keyword">type</span> 'a gen</code></dt><dd><p><code>'a gen</code> knows how to generate <code>'a</code> for use in Crowbar tests.</p></dd></dl><dl><dt class="spec type" id="type-gens"><a href="#type-gens" class="anchor"></a><code><span class="keyword">type</span> ('k, 'res) gens</code><code> = </code><table class="variant"><tr id="type-gens.([])" class="anchored"><td class="def constructor"><a href="#type-gens.([])" class="anchor"></a><code>| </code><code><span class="constructor">([])</span> : (<span class="type-var">'res</span>, <span class="type-var">'res</span>) <a href="index.html#type-gens">gens</a></code></td></tr><tr id="type-gens.(::)" class="anchored"><td class="def constructor"><a href="#type-gens.(::)" class="anchor"></a><code>| </code><code><span class="constructor">(::)</span> : <span class="type-var">'a</span> <a href="index.html#type-gen">gen</a> * (<span class="type-var">'k</span>, <span class="type-var">'res</span>) <a href="index.html#type-gens">gens</a> <span>&#45;&gt;</span> (<span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'k</span>, <span class="type-var">'res</span>) <a href="index.html#type-gens">gens</a></code></td><td class="doc"><p>multiple generators are passed to functions using a listlike syntax. for example, <code>map [int; int] (fun a b -&gt; a + b)</code></p></td></tr></table></dt><dt class="spec type" id="type-printer"><a href="#type-printer" class="anchor"></a><code><span class="keyword">type</span> 'a printer</code><code> = <a href="../../ocaml/Stdlib/Format/index.html#type-formatter">Stdlib.Format.formatter</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> unit</code></dt><dd><p>pretty-printers for items generated by Crowbar; useful for the user in translating test failures into bugfixes.</p></dd></dl><section><header><h2 id="generators"><a href="#generators" class="anchor"></a>Generators</h2></header><section><header><h3 id="simple_generators"><a href="#simple_generators" class="anchor"></a>Simple Generators</h3></header><dl><dt class="spec value" id="val-int"><a href="#val-int" class="anchor"></a><code><span class="keyword">val</span> int : int <a href="index.html#type-gen">gen</a></code></dt><dd><p><code>int</code> generates an integer ranging from min_int to max_int, inclusive. If you need integers from a smaller domain, consider using <a href="index.html#val-range"><code>range</code></a>.</p></dd></dl><dl><dt class="spec value" id="val-uint8"><a href="#val-uint8" class="anchor"></a><code><span class="keyword">val</span> uint8 : int <a href="index.html#type-gen">gen</a></code></dt><dd><p><code>uint8</code> generates an unsigned byte, ranging from 0 to 255 inclusive.</p></dd></dl><dl><dt class="spec value" id="val-int8"><a href="#val-int8" class="anchor"></a><code><span class="keyword">val</span> int8 : int <a href="index.html#type-gen">gen</a></code></dt><dd><p><code>int8</code> generates a signed byte, ranging from -128 to 127 inclusive.</p></dd></dl><dl><dt class="spec value" id="val-int32"><a href="#val-int32" class="anchor"></a><code><span class="keyword">val</span> int32 : <a href="../../ocaml/Stdlib/Int32/index.html#type-t">Stdlib.Int32.t</a> <a href="index.html#type-gen">gen</a></code></dt><dd><p><code>int32</code> generates a 32-bit signed integer.</p></dd></dl><dl><dt class="spec value" id="val-int64"><a href="#val-int64" class="anchor"></a><code><span class="keyword">val</span> int64 : <a href="../../ocaml/Stdlib/Int64/index.html#type-t">Stdlib.Int64.t</a> <a href="index.html#type-gen">gen</a></code></dt><dd><p><code>int64</code> generates a 64-bit signed integer.</p></dd></dl><dl><dt class="spec value" id="val-float"><a href="#val-float" class="anchor"></a><code><span class="keyword">val</span> float : float <a href="index.html#type-gen">gen</a></code></dt><dd><p><code>float</code> generates a double-precision floating-point number.</p></dd></dl><dl><dt class="spec value" id="val-bytes"><a href="#val-bytes" class="anchor"></a><code><span class="keyword">val</span> bytes : string <a href="index.html#type-gen">gen</a></code></dt><dd><p><code>bytes</code> generates a string of arbitrary length (including zero-length strings).</p></dd></dl><dl><dt class="spec value" id="val-bool"><a href="#val-bool" class="anchor"></a><code><span class="keyword">val</span> bool : bool <a href="index.html#type-gen">gen</a></code></dt><dd><p><code>bool</code> generates a yes or no answer.</p></dd></dl><dl><dt class="spec value" id="val-range"><a href="#val-range" class="anchor"></a><code><span class="keyword">val</span> range : int <span>&#45;&gt;</span> int <a href="index.html#type-gen">gen</a></code></dt><dd><p><code>range n</code> is a generator for integers between 0 (inclusive) and <code>n</code> (exclusive). <code>range n</code> will raise <code>Invalid_argument</code> for <code>n &lt;= 0</code>.</p></dd></dl></section><section><header><h3 id="generator_functions"><a href="#generator_functions" class="anchor"></a>Functions on Generators</h3></header><dl><dt class="spec value" id="val-map"><a href="#val-map" class="anchor"></a><code><span class="keyword">val</span> map : (<span class="type-var">'f</span>, <span class="type-var">'a</span>) <a href="index.html#type-gens">gens</a> <span>&#45;&gt;</span> <span class="type-var">'f</span> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-gen">gen</a></code></dt><dd><p><code>map gens map_fn</code> provides a means for creating generators using other generators' output. For example, one might generate a Char.t from a <a href="index.html#val-uint8"><code>uint8</code></a>:</p><pre><code class="ml">open Crowbar
let char_gen : Char.t gen = map [uint8] Char.chr</code></pre></dd></dl><dl><dt class="spec value" id="val-unlazy"><a href="#val-unlazy" class="anchor"></a><code><span class="keyword">val</span> unlazy : <span class="type-var">'a</span> <a href="index.html#type-gen">gen</a> <a href="../../ocaml/Stdlib/Lazy/index.html#type-t">Stdlib.Lazy.t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-gen">gen</a></code></dt><dd><p><code>unlazy gen</code> forces the generator <code>gen</code>. It is useful when defining generators for recursive data types:</p><pre><code class="ml">open Crowbar
type a = A of int | Self of a
let rec a_gen = lazy (
  choose [
    map [int] (fun i -&gt; A i);
    map [(unlazy a_gen)] (fun s -&gt; Self s);
  ])
let lazy a_gen = a_gen</code></pre></dd></dl><dl><dt class="spec value" id="val-fix"><a href="#val-fix" class="anchor"></a><code><span class="keyword">val</span> fix : (<span class="type-var">'a</span> <a href="index.html#type-gen">gen</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-gen">gen</a>) <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-gen">gen</a></code></dt><dd><p><code>fix fn</code> applies the function <code>fn</code>. It is useful when defining generators for recursive data types:</p><pre><code class="ml">open Crowbar
type a = A of int | Self of a
let rec a_gen = fix (fun a_gen -&gt;
    choose [
    map [int] (fun i -&gt; A i);
    map [a_gen] (fun s -&gt; Self s);
  ])</code></pre></dd></dl><dl><dt class="spec value" id="val-const"><a href="#val-const" class="anchor"></a><code><span class="keyword">val</span> const : <span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-gen">gen</a></code></dt><dd><p><code>const a</code> always generates <code>a</code>.</p></dd></dl><dl><dt class="spec value" id="val-choose"><a href="#val-choose" class="anchor"></a><code><span class="keyword">val</span> choose : <span class="type-var">'a</span> <a href="index.html#type-gen">gen</a> <a href="index.html#type-list">list</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-gen">gen</a></code></dt><dd><p><code>choose gens</code> chooses a generator arbitrarily from <code>gens</code>.</p></dd></dl><dl><dt class="spec value" id="val-option"><a href="#val-option" class="anchor"></a><code><span class="keyword">val</span> option : <span class="type-var">'a</span> <a href="index.html#type-gen">gen</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> option <a href="index.html#type-gen">gen</a></code></dt><dd><p><code>option gen</code> generates either <code>None</code> or <code>Some x</code>, where <code>x</code> is the item generated by <code>gen</code>.</p></dd></dl><dl><dt class="spec value" id="val-list"><a href="#val-list" class="anchor"></a><code><span class="keyword">val</span> list : <span class="type-var">'a</span> <a href="index.html#type-gen">gen</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-list">list</a> <a href="index.html#type-gen">gen</a></code></dt><dd><p><code>list gen</code> makes a generator for lists using <code>gen</code>. Lists may be empty; for non-empty lists, use <a href="index.html#val-list1"><code>list1</code></a>.</p></dd></dl><dl><dt class="spec value" id="val-list1"><a href="#val-list1" class="anchor"></a><code><span class="keyword">val</span> list1 : <span class="type-var">'a</span> <a href="index.html#type-gen">gen</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-list">list</a> <a href="index.html#type-gen">gen</a></code></dt><dd><p><code>list1 gen</code> makes non-empty list generators. For potentially empty lists, use <a href="index.html#type-list"><code>list</code></a>.</p></dd></dl><dl><dt class="spec value" id="val-with_printer"><a href="#val-with_printer" class="anchor"></a><code><span class="keyword">val</span> with_printer : <span class="type-var">'a</span> <a href="index.html#type-printer">printer</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-gen">gen</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-gen">gen</a></code></dt><dd><p><code>with_printer printer gen</code> generates the same values as <code>gen</code>. If <code>gen</code> is used to create a failing test case and the test was reached by calling <code>check_eq</code> without <code>pp</code> set, <code>printer</code> will be used to print the failing test case.</p></dd></dl></section></section><section><header><h2 id="printing"><a href="#printing" class="anchor"></a>Printing</h2></header><dl><dt class="spec value" id="val-pp"><a href="#val-pp" class="anchor"></a><code><span class="keyword">val</span> pp : <a href="../../ocaml/Stdlib/Format/index.html#type-formatter">Stdlib.Format.formatter</a> <span>&#45;&gt;</span> (<span class="type-var">'a</span>, <a href="../../ocaml/Stdlib/Format/index.html#type-formatter">Stdlib.Format.formatter</a>, unit) <a href="../../ocaml/Stdlib/index.html#type-format">Stdlib.format</a> <span>&#45;&gt;</span> <span class="type-var">'a</span></code></dt><dt class="spec value" id="val-pp_int"><a href="#val-pp_int" class="anchor"></a><code><span class="keyword">val</span> pp_int : int <a href="index.html#type-printer">printer</a></code></dt><dt class="spec value" id="val-pp_int32"><a href="#val-pp_int32" class="anchor"></a><code><span class="keyword">val</span> pp_int32 : <a href="../../ocaml/Stdlib/Int32/index.html#type-t">Stdlib.Int32.t</a> <a href="index.html#type-printer">printer</a></code></dt><dt class="spec value" id="val-pp_int64"><a href="#val-pp_int64" class="anchor"></a><code><span class="keyword">val</span> pp_int64 : <a href="../../ocaml/Stdlib/Int64/index.html#type-t">Stdlib.Int64.t</a> <a href="index.html#type-printer">printer</a></code></dt><dt class="spec value" id="val-pp_float"><a href="#val-pp_float" class="anchor"></a><code><span class="keyword">val</span> pp_float : float <a href="index.html#type-printer">printer</a></code></dt><dt class="spec value" id="val-pp_bool"><a href="#val-pp_bool" class="anchor"></a><code><span class="keyword">val</span> pp_bool : bool <a href="index.html#type-printer">printer</a></code></dt><dt class="spec value" id="val-pp_string"><a href="#val-pp_string" class="anchor"></a><code><span class="keyword">val</span> pp_string : string <a href="index.html#type-printer">printer</a></code></dt><dt class="spec value" id="val-pp_list"><a href="#val-pp_list" class="anchor"></a><code><span class="keyword">val</span> pp_list : <span class="type-var">'a</span> <a href="index.html#type-printer">printer</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-list">list</a> <a href="index.html#type-printer">printer</a></code></dt></dl></section><section><header><h2 id="testing"><a href="#testing" class="anchor"></a>Testing</h2></header><dl><dt class="spec value" id="val-add_test"><a href="#val-add_test" class="anchor"></a><code><span class="keyword">val</span> add_test : ?&#8288;name:string <span>&#45;&gt;</span> (<span class="type-var">'f</span>, unit) <a href="index.html#type-gens">gens</a> <span>&#45;&gt;</span> <span class="type-var">'f</span> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>add_test name generators test_fn</code> adds <code>test_fn</code> to the list of eligible tests to be run when the program is invoked. At runtime, random data will be sent to <code>generators</code> to create the input necessary to run <code>test_fn</code>. Any failures will be printed annotated with <code>name</code>.</p></dd></dl><section><header><h3 id="aborting"><a href="#aborting" class="anchor"></a>Aborting Tests</h3></header><dl><dt class="spec value" id="val-guard"><a href="#val-guard" class="anchor"></a><code><span class="keyword">val</span> guard : bool <span>&#45;&gt;</span> unit</code></dt><dd><p><code>guard b</code> aborts a test if <code>b</code> is false. The test will not be recorded or reported as a failure.</p></dd></dl><dl><dt class="spec value" id="val-bad_test"><a href="#val-bad_test" class="anchor"></a><code><span class="keyword">val</span> bad_test : unit <span>&#45;&gt;</span> <span class="type-var">'a</span></code></dt><dd><p><code>bad_test ()</code> aborts a test. The test will not be recorded or reported as a failure.</p></dd></dl><dl><dt class="spec value" id="val-nonetheless"><a href="#val-nonetheless" class="anchor"></a><code><span class="keyword">val</span> nonetheless : <span class="type-var">'a</span> option <span>&#45;&gt;</span> <span class="type-var">'a</span></code></dt><dd><p><code>nonetheless o</code> aborts a test if <code>o</code> is None. The test will not be recorded or reported as a failure.</p></dd></dl></section><section><header><h3 id="failing"><a href="#failing" class="anchor"></a>Failing</h3></header><dl><dt class="spec value" id="val-fail"><a href="#val-fail" class="anchor"></a><code><span class="keyword">val</span> fail : string <span>&#45;&gt;</span> <span class="type-var">'a</span></code></dt><dd><p><code>fail message</code> generates a test failure and prints <code>message</code>.</p></dd></dl></section><section><header><h3 id="asserting"><a href="#asserting" class="anchor"></a>Asserting Properties</h3></header><dl><dt class="spec value" id="val-check"><a href="#val-check" class="anchor"></a><code><span class="keyword">val</span> check : bool <span>&#45;&gt;</span> unit</code></dt><dd><p><code>check b</code> generates a test failure if <code>b</code> is false. No useful information will be printed in this case.</p></dd></dl><dl><dt class="spec value" id="val-check_eq"><a href="#val-check_eq" class="anchor"></a><code><span class="keyword">val</span> check_eq : ?&#8288;pp:<span class="type-var">'a</span> <a href="index.html#type-printer">printer</a> <span>&#45;&gt;</span> ?&#8288;cmp:(<span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> int) <span>&#45;&gt;</span> ?&#8288;eq:(<span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> bool) <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>check_eq pp cmp eq x y</code> evaluates whether x and y are equal, and if they are not, raises a failure and prints an error message. Equality is evaluated as follows:</p><ol><li>use a provided <code>eq</code></li><li>if no <code>eq</code> is provided, use a provided <code>cmp</code></li><li>if neither <code>eq</code> nor <code>cmp</code> is provided, use Pervasives.compare</li></ol><p>If <code>pp</code> is provided, use this to print <code>x</code> and <code>y</code> if they are not equal. If <code>pp</code> is not provided, a best-effort printer will be generated from the printers for primitive generators and any printers registered with <code>with_printer</code> and used.</p></dd></dl></section></section></div></body></html>