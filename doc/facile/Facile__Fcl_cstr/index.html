<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Facile__Fcl_cstr (facile.Facile__Fcl_cstr)</title><link rel="stylesheet" href="../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../index.html">facile</a> &#x00BB; Facile__Fcl_cstr</nav><h1>Module <code>Facile__Fcl_cstr</code></h1><p>Posting Constraints and Building New Ones</p></header><aside><p><code> \paragraph{Overview} </code></p></aside><aside><p>This module defines the type <code>t</code> of constraints and functions to create and post constraints: mainly a <code>create</code> function which allows to build new constraints from scratch (this function is not needed when using standard FaCiLe predefined constraints) and the mostly useful <code>post</code> function which must be called to actually add a constraint to the constraint store.</p></aside><aside><p><code> \subsection{Basic} </code></p></aside><dl><dt class="spec exception" id="exception-DontKnow"><a href="#exception-DontKnow" class="anchor"></a><code><span class="keyword">exception</span> </code><code><span class="exception">DontKnow</span></code></dt><dd><p>Exception raised by the <code>check</code> function of a reified constraint when it is not known whether the constraint is satisfied or violated.</p></dd></dl><dl><dt class="spec type" id="type-priority"><a href="#type-priority" class="anchor"></a><code><span class="keyword">type</span> priority</code></dt><dd><p>Type of waking priority.</p></dd></dl><dl><dt class="spec value" id="val-immediate"><a href="#val-immediate" class="anchor"></a><code><span class="keyword">val</span> immediate : <a href="index.html#type-priority">priority</a></code></dt><dt class="spec value" id="val-normal"><a href="#val-normal" class="anchor"></a><code><span class="keyword">val</span> normal : <a href="index.html#type-priority">priority</a></code></dt><dt class="spec value" id="val-later"><a href="#val-later" class="anchor"></a><code><span class="keyword">val</span> later : <a href="index.html#type-priority">priority</a></code></dt><dd><p>Available priorities:</p><ul><li>immediate: as soon as possible, for quick updates;</li><li>normal: standard priority;</li><li>later: for time consuming constraints (e.g. <code>Gcc.cstr</code>, <code>Alldiff.cstr</code>...).</li></ul></dd></dl><dl><dt class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> t</code></dt><dd><p>The type of constraints.</p></dd></dl><dl><dt class="spec value" id="val-create"><a href="#val-create" class="anchor"></a><code><span class="keyword">val</span> create : ?&#8288;name:string <span>&#45;&gt;</span> ?&#8288;nb_wakings:int <span>&#45;&gt;</span> ?&#8288;fprint:(<a href="../../ocaml/Stdlib/index.html#type-out_channel">Stdlib.out_channel</a> <span>&#45;&gt;</span> unit) <span>&#45;&gt;</span> ?&#8288;priority:<a href="index.html#type-priority">priority</a> <span>&#45;&gt;</span> ?&#8288;init:(unit <span>&#45;&gt;</span> unit) <span>&#45;&gt;</span> ?&#8288;check:(unit <span>&#45;&gt;</span> bool) <span>&#45;&gt;</span> ?&#8288;not:(unit <span>&#45;&gt;</span> <a href="index.html#type-t">t</a>) <span>&#45;&gt;</span> (int <span>&#45;&gt;</span> bool) <span>&#45;&gt;</span> (<a href="index.html#type-t">t</a> <span>&#45;&gt;</span> unit) <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></dt><dd><p><code>create ?name ?nb_wakings ?fprint ?priority ?init ?check ?not update delay</code> builds a new constraint:</p><ul><li><code>name</code> is a describing string for the constraint. Default value is <code>&quot;anonymous&quot;</code>.</li><li><code>nb_wakings</code> is the number of calls to <code>Var.delay</code> with distinct &quot;<code>waking_id</code>&quot; arguments <code>Var.BASICFD.delay})</code> within the constraint own <code>delay</code> function (see below). Default value is <code>1</code>. Beware that if <code>nb_wakings</code> is greater than 1 and the optional <code>init</code> argument is not provided, <code>init</code> default behaviour is to do nothing (i.e. the <code>update</code> function will not be called).</li><li><code>fprint</code> should print the constraint on an output channel taken as its only argument. Default value is to print the <code>name</code> string.</li><li><code>priority</code> is either <code>immediate</code>, <code>normal</code> or <code>later</code>. Time costly constraints should be waken after quick ones. Default value is <code>normal</code>.</li><li><code>init</code> is useful to perform initialization of auxiliary data structures needed and maintained by the <code>update</code> function. <code>init ()</code> is called as soon as the constraint is posted. Default value is to call <code>(update 0)</code> if <code>nb_wakings</code> is equal to 1 to perform an initial propagation; if <code>nb_wakings</code> is greater than 1, default value is <code>fun () -&gt; ()</code>, i.e. it does nothing. Hence, an <code>init</code> argument must be provided if this is not the desired behaviour.</li><li><code>check</code> must be specified if the constraint is to be reifiable (as well as the <code>not</code> function). When the constraint is reified, <code>check ()</code> is called to verify whether the constraint is satisfied or violated, i.e. the constraint itself or its negation is entailed by the constraint store. It should return <code>true</code> if the constraint is satisfied, <code>false</code> if it is violated and raise <code>DontKnow</code> when it is not known. <code>check</code> <b>must not</b> change the domains of the variables involved in the constraint. Default: <code>Failure</code> exception is raised.</li><li><code>not</code> must be specified if the constraint is reifiable (as well as <code>check</code>). <code>not ()</code> should return a constraint which is the negation of the constraint being defined. When the constraint is reified, it is called to post the negation of the constraint whenever <code>check ()</code> return <code>false</code>, i.e. the negation is entailed by the constraint store. Default: <code>Failure</code> exception is raised.</li><li><code>update</code> is a mandatory argument which propagates the constraint, i.e. filters domains and checks consistency. This function takes an integer as its unique parameter, according to the optional <code>waking_id</code> argument given to the <code>Var.delay</code> calls featured in the constraint own <code>delay</code> function (see below). When a waking event occurs, this function is called with the corresponding integer &quot;<code>waking_id</code>&quot;, and must return <code>true</code> when the constraint is (partially) satisfied <em>for this event</em>, <code>false</code> if further propagations have to be performed, and raise <code>Stak.Fail</code> whenever an inconsistency is detected. The whole constraint is solved when <code>update 0</code>, ..., <code>update (nb_wakings-1)</code> have all returned <code>true</code>. E.g. a global constraint on an array of variables can be aware of which variable has triggered the awakening by providing the integer index of the variable as its &quot;<code>waking_id</code>&quot; to the <code>Var.delay</code> function. <code>update</code> is called with <code>0</code> by default when the <code>nb_wakings</code> argument has been omitted; in this case, the constraint is solved as soon as <code>update</code> returns <code>true</code>.</li><li><code>delay</code> schedules the awakening of the constraint <code>ct</code> (which is taken as its unique argument), i.e. the execution of its <code>update</code> function. If <code>update id</code> should be called (because it may propagates) when one of the events contained in the events <code>Var.ATTR.on-underscorerefine})</code> list <code>es</code> occurred on variable <code>v</code>, then <code>Var.delay es v ~waking_id:id ct</code> should be called within the body of the <code>delay</code> function. Beware that <b>all the &quot;<code>waking_id</code>s&quot; must be contiguous integers ranging from</b> <code>0</code> <b>to</b> <code>nb_wakings-1</code>, otherwise the behaviour is unspecified. <code>delay</code> is a mandatory argument.</li></ul></dd></dl><dl><dt class="spec value" id="val-post"><a href="#val-post" class="anchor"></a><code><span class="keyword">val</span> post : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>post c</code> posts the constraint <code>c</code> to the constraint store.</p></dd></dl><dl><dt class="spec value" id="val-one"><a href="#val-one" class="anchor"></a><code><span class="keyword">val</span> one : <a href="index.html#type-t">t</a></code></dt><dt class="spec value" id="val-zero"><a href="#val-zero" class="anchor"></a><code><span class="keyword">val</span> zero : <a href="index.html#type-t">t</a></code></dt><dd><p>The constraint which succeeds (resp. fails) immediately.</p></dd></dl><aside><p><code> \subsection{Access} </code></p></aside><dl><dt class="spec value" id="val-id"><a href="#val-id" class="anchor"></a><code><span class="keyword">val</span> id : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> int</code></dt><dd><p><code>id c</code> returns a unique integer identifying the constraint <code>c</code>.</p></dd></dl><dl><dt class="spec value" id="val-name"><a href="#val-name" class="anchor"></a><code><span class="keyword">val</span> name : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> string</code></dt><dd><p><code>name c</code> returns the name of the constraint <code>c</code>.</p></dd></dl><dl><dt class="spec value" id="val-priority"><a href="#val-priority" class="anchor"></a><code><span class="keyword">val</span> priority : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-priority">priority</a></code></dt><dd><p><code>priority c</code> returns the priority of the constraint <code>c</code>.</p></dd></dl><dl><dt class="spec value" id="val-fprint"><a href="#val-fprint" class="anchor"></a><code><span class="keyword">val</span> fprint : <a href="../../ocaml/Stdlib/index.html#type-out_channel">Stdlib.out_channel</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>fprint chan c</code> prints the constraint <code>c</code> on channel <code>chan</code>. Calls the <code>fprint</code> function passed to <code>create</code>.</p></dd></dl><dl><dt class="spec value" id="val-is_solved"><a href="#val-is_solved" class="anchor"></a><code><span class="keyword">val</span> is_solved : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> bool</code></dt><dd><p><code>is_solved c</code> returns <code>true</code> if <code>c</code> is satisfied and <code>false</code> otherwise.</p></dd></dl><dl><dt class="spec value" id="val-active_store"><a href="#val-active_store" class="anchor"></a><code><span class="keyword">val</span> active_store : unit <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> list</code></dt><dd><p><code>active_store ()</code> returns the list of all active constraints, i.e. whose <code>update</code> functions have returned <code>false</code>.</p></dd></dl><dl><dt class="spec value" id="val-not"><a href="#val-not" class="anchor"></a><code><span class="keyword">val</span> not : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></dt><dd><p><code>not c</code> returns the negation of <code>c</code>.</p></dd></dl></div></body></html>