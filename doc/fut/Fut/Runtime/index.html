<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Runtime (fut.Fut.Runtime)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../../index.html">fut</a> &#x00BB; <a href="../index.html">Fut</a> &#x00BB; Runtime</nav><h1>Module <code>Fut.Runtime</code></h1><p>Runtime system configuration and interaction.</p></header><dl><dt class="spec value" id="val-name"><a href="#val-name" class="anchor"></a><code><span class="keyword">val </span>name : string</code></dt><dd><p><code>name</code> is the backend name.</p></dd></dl><section><header><h2 id="exn_trap"><a href="#exn_trap" class="anchor"></a>Exception trap</h2><p>See also the section about <a href="../index.html#exceptions"><span>exceptions</span></a>.</p></header><dl><dt class="spec type" id="type-exn_ctx"><a href="#type-exn_ctx" class="anchor"></a><code><span class="keyword">type </span>exn_ctx</code><span class="keyword"> = </span><code>[ </code><table class="variant"><tr id="type-exn_ctx.Queue" class="anchored"><td class="def constructor"><a href="#type-exn_ctx.Queue" class="anchor"></a><code><span class="keyword">| </span></code><code>`Queue<span class="keyword"> of </span>string</code></td></tr><tr id="type-exn_ctx.Future" class="anchored"><td class="def constructor"><a href="#type-exn_ctx.Future" class="anchor"></a><code><span class="keyword">| </span></code><code>`Future</code></td></tr><tr id="type-exn_ctx.Finalizer" class="anchored"><td class="def constructor"><a href="#type-exn_ctx.Finalizer" class="anchor"></a><code><span class="keyword">| </span></code><code>`Finalizer</code></td></tr><tr id="type-exn_ctx.Backend" class="anchored"><td class="def constructor"><a href="#type-exn_ctx.Backend" class="anchor"></a><code><span class="keyword">| </span></code><code>`Backend</code></td></tr><tr id="type-exn_ctx.Fd_action" class="anchored"><td class="def constructor"><a href="#type-exn_ctx.Fd_action" class="anchor"></a><code><span class="keyword">| </span></code><code>`Fd_action</code></td></tr><tr id="type-exn_ctx.Timer_action" class="anchored"><td class="def constructor"><a href="#type-exn_ctx.Timer_action" class="anchor"></a><code><span class="keyword">| </span></code><code>`Timer_action</code></td></tr><tr id="type-exn_ctx.Signal_action" class="anchored"><td class="def constructor"><a href="#type-exn_ctx.Signal_action" class="anchor"></a><code><span class="keyword">| </span></code><code>`Signal_action</code></td></tr><tr id="type-exn_ctx.Runtime_action" class="anchored"><td class="def constructor"><a href="#type-exn_ctx.Runtime_action" class="anchor"></a><code><span class="keyword">| </span></code><code>`Runtime_action</code></td></tr><tr id="type-exn_ctx.Exn_trap" class="anchored"><td class="def constructor"><a href="#type-exn_ctx.Exn_trap" class="anchor"></a><code><span class="keyword">| </span></code><code>`Exn_trap</code></td></tr></table><code> ]</code></dt><dd><p>The type for exception contexts.</p></dd></dl><dl><dt class="spec type" id="type-exn_info"><a href="#type-exn_info" class="anchor"></a><code><span class="keyword">type </span>exn_info</code><code><span class="keyword"> = </span><a href="index.html#type-exn_ctx">exn_ctx</a><span class="keyword"> * </span>exn<span class="keyword"> * </span>Printexc.raw_backtrace</code></dt><dd><p>The type for info about trapped exceptions. The context, the exception, and the backtrace.</p></dd></dl><dl><dt class="spec value" id="val-set_exn_trap"><a href="#val-set_exn_trap" class="anchor"></a><code><span class="keyword">val </span>set_exn_trap : (<a href="index.html#type-exn_info">exn_info</a> <span>&#45;&gt;</span> unit) <span>&#45;&gt;</span> unit</code></dt><dd><p><code>set_exn_trap h</code> is a function called whenever the runtime system traps an exception.</p></dd></dl><dl><dt class="spec value" id="val-pp_exn_info"><a href="#val-pp_exn_info" class="anchor"></a><code><span class="keyword">val </span>pp_exn_info : Format.formatter <span>&#45;&gt;</span> <a href="index.html#type-exn_info">exn_info</a> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>pp_exn_info ppf i</code> prints an unspecified representation of <code>i</code> on <code>ppf</code>.</p></dd></dl></section><section><header><h2 id="actions"><a href="#actions" class="anchor"></a>Actions</h2></header><dl><dt class="spec type" id="type-abort"><a href="#type-abort" class="anchor"></a><code><span class="keyword">type </span>abort</code><code><span class="keyword"> = </span>unit <span>&#45;&gt;</span> unit</code></dt><dd><p>The type for action's abort functions. Calling an abort function associated to an <code>action</code> function has the following effects and must be guaranteed by the backends:</p><ul><li>If the <code>action</code> wasn't executed yet. It guarantees that <code>action</code> will never be called and will be eventually gc'd.</li><li>If the <code>action</code> was already executed, it has no effects.</li></ul></dd></dl><section><header><h3 id="runtime_actions"><a href="#runtime_actions" class="anchor"></a>Runtime actions</h3></header><dl><dt class="spec value" id="val-action"><a href="#val-action" class="anchor"></a><code><span class="keyword">val </span>action : (unit <span>&#45;&gt;</span> unit) <span>&#45;&gt;</span> unit</code></dt><dd><p><code>action a</code> executes <code>a ()</code> as soon as possible on the runtime system thread. Actions are executed in FIFO order as received.</p><p><b>Thread-safe.</b> This function can be called from other threads.</p></dd></dl></section><section><header><h3 id="signal_actions"><a href="#signal_actions" class="anchor"></a>Signal actions</h3></header><dl><dt class="spec value" id="val-signal_action"><a href="#val-signal_action" class="anchor"></a><code><span class="keyword">val </span>signal_action : int <span>&#45;&gt;</span> (<a href="index.html#type-abort">abort</a> <span>&#45;&gt;</span> (int <span>&#45;&gt;</span> unit)<span class="keyword"> * </span><span class="type-var">'a</span>) <span>&#45;&gt;</span> <span class="type-var">'a</span></code></dt><dd><p><code>signal_action s def</code> calls <code>def</code> with an <code>abort</code> function to get <code>(action,v)</code>. The function <code>action</code> is scheduled for execution whenever the next signal <code>s</code> is received and will be called once with <code>s</code> when that happens or never if <code>abort</code> was called before, see <a href="index.html#type-abort"><code>abort</code></a> for details. The value <code>v</code> is simply returned by <code>signal_action</code>.</p></dd></dl></section><section><header><h3 id="timer_actions"><a href="#timer_actions" class="anchor"></a>Timer actions</h3></header><dl><dt class="spec value" id="val-timer_action"><a href="#val-timer_action" class="anchor"></a><code><span class="keyword">val </span>timer_action : float <span>&#45;&gt;</span> (<a href="index.html#type-abort">abort</a> <span>&#45;&gt;</span> (float <span>&#45;&gt;</span> unit)<span class="keyword"> * </span><span class="type-var">'a</span>) <span>&#45;&gt;</span> <span class="type-var">'a</span></code></dt><dd><p><code>timer_action d def</code> calls <code>def</code> with an <code>abort</code> function to get <code>(action,v)</code>. The function <code>action</code> is scheduled for execution in <code>d</code> seconds and will be called once with the actualy delay that was performed or never if <code>abort</code> was called before, see <a href="index.html#type-abort"><code>abort</code></a> for details. The value <code>v</code> is simply returned by <code>timer_action</code>.</p></dd></dl></section><section><header><h3 id="fd_actions"><a href="#fd_actions" class="anchor"></a>File descriptor actions and closing</h3></header><dl><dt class="spec value" id="val-fd_action"><a href="#val-fd_action" class="anchor"></a><code><span class="keyword">val </span>fd_action : [ `R<span class="keyword"> | </span>`W ] <span>&#45;&gt;</span> Unix.file_descr <span>&#45;&gt;</span> (bool <span>&#45;&gt;</span> unit) <span>&#45;&gt;</span> unit</code></dt><dd><p><code>fd_action fds fd a</code> executes <code>a true</code> whenever <code>fd</code> is in the state <code>fds</code>. If <code>fd</code> is closed <code>a false</code> executed.</p></dd></dl><dl><dt class="spec value" id="val-fd_close"><a href="#val-fd_close" class="anchor"></a><code><span class="keyword">val </span>fd_close : Unix.file_descr <span>&#45;&gt;</span> unit</code></dt><dd><p>TODO</p></dd></dl></section></section><section><header><h2 id="workers"><a href="#workers" class="anchor"></a>Workers</h2><p><b>Note.</b> Most of the time a worker maps to a system thread, but the exact semantics is backend dependent. Workers are typically used to determine the future of futures queues.</p><p><b>Threads.</b> If a backend uses threads it guarantees that the number of threads is <code>0</code> before any call is made to <a href="../index.html#val-apply"><code>Fut.apply</code></a> or <a href="index.html#val-set_worker_count"><code>set_worker_count</code></a>. This allows to fork TODO we need more to be able to fork.</p></header><dl><dt class="spec value" id="val-worker_count"><a href="#val-worker_count" class="anchor"></a><code><span class="keyword">val </span>worker_count : unit <span>&#45;&gt;</span> int</code></dt><dd><p><code>worker_count ()</code> is the number of workers used by the backend.</p></dd></dl><dl><dt class="spec value" id="val-set_worker_count"><a href="#val-set_worker_count" class="anchor"></a><code><span class="keyword">val </span>set_worker_count : int <span>&#45;&gt;</span> unit</code></dt><dd><p><code>set_worker_count n</code> sets the number of workers to <code>n</code>.</p><dl><dt>raises Invalid_argument</dt><dd><p>if <code>n</code> is negative.</p><p><b>Note.</b> Clients don't need to call this function explicitely, backends will automatically adjust workers once <a href="../index.html#val-apply"><code>Fut.apply</code></a> is called. Also if the number of workers is set to <code>0</code>, a new call to <a href="../index.html#val-apply"><code>Fut.apply</code></a> may change the worker count again.</p><p><b>Warning.</b> In most backends calling this function explicitely with <code>n &gt; 0</code> makes the program multithreaded..</p></dd></dl></dd></dl></section></div></body></html>