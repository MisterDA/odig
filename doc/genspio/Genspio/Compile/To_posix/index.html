<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>To_posix (genspio.Genspio.Compile.To_posix)</title><link rel="stylesheet" href="../../../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – <a href="../../../index.html">genspio</a> &#x00BB; <a href="../../index.html">Genspio</a> &#x00BB; <a href="../index.html">Compile</a> &#x00BB; To_posix</nav><h1>Module <code>Compile.To_posix</code></h1><p>Compiler from <a href="../../EDSL/index.html#type-t"><code>EDSL.t</code></a> to POSIX shell scripts (one-liners or multiline scripts).</p></header><dl><dt class="spec type" id="type-internal_error_details"><a href="#type-internal_error_details" class="anchor"></a><code><span class="keyword">type</span> internal_error_details</code><code> = <a href="../../Standard_compiler/index.html#type-internal_error_details">Standard_compiler.internal_error_details</a></code><code> = </code><code>{</code><table class="record"><tr id="type-internal_error_details.variable" class="anchored"><td class="def field"><a href="#type-internal_error_details.variable" class="anchor"></a><code>variable : string;</code></td><td class="doc"><p>The incriminated issue was stored in a shell variable.</p></td></tr><tr id="type-internal_error_details.content" class="anchored"><td class="def field"><a href="#type-internal_error_details.content" class="anchor"></a><code>content : string;</code></td><td class="doc"><p>The shell-code that produced the <code>variable</code>.</p></td></tr><tr id="type-internal_error_details.code" class="anchored"><td class="def field"><a href="#type-internal_error_details.code" class="anchor"></a><code>code : string;</code></td><td class="doc"><p>Pretty-printed version of the above EDSL code.</p></td></tr></table><code>}</code></dt><dd><p>When a compiled script runs into an error, these details are accessible to the user.</p></dd></dl><dl><dt class="spec type" id="type-death_message"><a href="#type-death_message" class="anchor"></a><code><span class="keyword">type</span> death_message</code><code> = <a href="../../Standard_compiler/index.html#type-death_message">Standard_compiler.death_message</a></code><code> = </code><table class="variant"><tr id="type-death_message.User" class="anchored"><td class="def constructor"><a href="#type-death_message.User" class="anchor"></a><code>| </code><code><span class="constructor">User</span> <span class="keyword">of</span> string</code></td><td class="doc"><p>The argument of the <a href="../../EDSL/index.html#val-fail"><code>EDSL.fail</code></a> is the “user” case.</p></td></tr><tr id="type-death_message.C_string_failure" class="anchored"><td class="def constructor"><a href="#type-death_message.C_string_failure" class="anchor"></a><code>| </code><code><span class="constructor">C_string_failure</span> <span class="keyword">of</span> <a href="index.html#type-internal_error_details">internal_error_details</a></code></td><td class="doc"><p>The checking that a byte-array <i>is</i> a C-String can fail when the byte-array contains <code>'\x00'</code>.</p></td></tr><tr id="type-death_message.String_to_int_failure" class="anchored"><td class="def constructor"><a href="#type-death_message.String_to_int_failure" class="anchor"></a><code>| </code><code><span class="constructor">String_to_int_failure</span> <span class="keyword">of</span> <a href="index.html#type-internal_error_details">internal_error_details</a></code></td><td class="doc"><p><code>string_to_int</code> can obviously fail.</p></td></tr></table></dt><dd><p>The kinds of messages that can be output or stored before exiting a script.</p></dd></dl><dl><dt class="spec type" id="type-death_function"><a href="#type-death_function" class="anchor"></a><code><span class="keyword">type</span> death_function</code><code> = comment_stack:string list <span>&#45;&gt;</span> <a href="index.html#type-death_message">death_message</a> <span>&#45;&gt;</span> string</code></dt><dd><p>When failing (either with <a href="../../EDSL/index.html#val-fail"><code>EDSL.fail</code></a> or because of internal reasons) the compiler uses a customizable function to output the “error” message and then quiting the process.</p></dd></dl><dl><dt class="spec type" id="type-compilation_error"><a href="#type-compilation_error" class="anchor"></a><code><span class="keyword">type</span> compilation_error</code><code> = <a href="../../Standard_compiler/index.html#type-compilation_error">Standard_compiler.compilation_error</a></code><code> = </code><code>{</code><table class="record"><tr id="type-compilation_error.error" class="anchored"><td class="def field"><a href="#type-compilation_error.error" class="anchor"></a><code>error : [ `No_fail_configured of <a href="index.html#type-death_message">death_message</a> | `Max_argument_length of string | `Not_a_c_string of string ];</code></td><td class="doc"><p>Error description.</p></td></tr><tr id="type-compilation_error.code" class="anchored"><td class="def field"><a href="#type-compilation_error.code" class="anchor"></a><code>code : string option;</code></td><td class="doc"><p>Chunk of relevant, pretty-printed EDSL code.</p></td></tr><tr id="type-compilation_error.comment_backtrace" class="anchored"><td class="def field"><a href="#type-compilation_error.comment_backtrace" class="anchor"></a><code>comment_backtrace : string list;</code></td><td class="doc"><p>Stack of `Comment` constructs at the point of the error.</p></td></tr></table><code>}</code></dt><dd><p>The potential compilation error.</p></dd></dl><dl><dt class="spec value" id="val-pp_error"><a href="#val-pp_error" class="anchor"></a><code><span class="keyword">val</span> pp_error : <a href="../../../../ocaml/Stdlib/Format/index.html#type-formatter">Stdlib.Format.formatter</a> <span>&#45;&gt;</span> <a href="index.html#type-compilation_error">compilation_error</a> <span>&#45;&gt;</span> unit</code></dt><dd><p>Printer for error values.</p></dd></dl><dl><dt class="spec value" id="val-error_to_string"><a href="#val-error_to_string" class="anchor"></a><code><span class="keyword">val</span> error_to_string : <a href="index.html#type-compilation_error">compilation_error</a> <span>&#45;&gt;</span> string</code></dt><dd><p>Convenience display of error values.</p></dd></dl><dl><dt class="spec type" id="type-parameters"><a href="#type-parameters" class="anchor"></a><code><span class="keyword">type</span> parameters</code><code> = </code><code>{</code><table class="record"><tr id="type-parameters.style" class="anchored"><td class="def field"><a href="#type-parameters.style" class="anchor"></a><code>style : [ `Multi_line | `One_liner ];</code></td><td class="doc"><p>The kind of script to output: in one-liners sequences are separated with <code>&quot;;&quot;</code>, in multi-line scripts, sequences are separated with new lines.</p></td></tr><tr id="type-parameters.max_argument_length" class="anchored"><td class="def field"><a href="#type-parameters.max_argument_length" class="anchor"></a><code>max_argument_length : int option;</code></td><td class="doc"><p>A limit on the length of the literal command line arguments generated by the compiler.</p><ul><li><code>None</code> means “do not check.”</li><li>The default value for is <code>Some 100_000</code>, meaning that ≥ 100 000 B arguments will make the compiler fail with an exception.</li></ul></td></tr><tr id="type-parameters.fail_with" class="anchored"><td class="def field"><a href="#type-parameters.fail_with" class="anchor"></a><code>fail_with : [ `Kill of string | `Nothing | `Trap_and_kill of int * string ];</code></td><td class="doc"><p>How to implement the <code>EDSL.fail</code> construct (which appears also internally e.g. when <span class="xref-unresolved" title="unresolved reference to &quot;EDSL.to_c_string&quot;"><a href="../../index.html#module-EDSL"><code>EDSL</code></a>.to_c_string</span> fails.).</p><ul><li><code>`Nothing</code>: the compiler will fail to compile <code>fail</code> constructs.</li><li><code>`Kill signal_name</code>: the compiler will store the “toplevel” process id of the script and <a href="../../EDSL/index.html#val-fail"><code>EDSL.fail</code></a> will be trying to kill the script with the signal <code>signal_name</code> (e.g. <code>&quot;USR2&quot;</code>).</li><li><code>`Trap_and_kill (exit_status, signal_name)</code>: the <a href="../../EDSL/index.html#val-fail"><code>EDSL.fail</code></a> construct will kill the script with <code>signal_name</code> <b>and</b> the signal will be caught with the POSIX <code>&quot;trap&quot;</code> command in order to exit with <code>exit_status</code>.</li></ul></td></tr><tr id="type-parameters.print_failure" class="anchored"><td class="def field"><a href="#type-parameters.print_failure" class="anchor"></a><code>print_failure : <a href="index.html#type-death_function">death_function</a>;</code></td><td class="doc"><p>How to deal with the <a href="index.html#type-death_message"><code>death_message</code></a> in case of failure. The function should return a shell command, like the result of compiling a <code>unit EDSL.t</code> expression or what <span class="xref-unresolved" title="unresolved reference to &quot;Sys.command&quot;"><code>Sys</code>.command</span> can work with.</p></td></tr></table><code>}</code></dt><dd><p>Configuration of the compilation to POSIX shell scripts.</p></dd></dl><dl><dt class="spec value" id="val-failure_to_stderr"><a href="#val-failure_to_stderr" class="anchor"></a><code><span class="keyword">val</span> failure_to_stderr : <a href="index.html#type-death_function">death_function</a></code></dt><dd><p>The default <a href="index.html#type-death_function"><code>death_function</code></a> just prints to <code>stderr</code>.</p></dd></dl><dl><dt class="spec value" id="val-one_liner"><a href="#val-one_liner" class="anchor"></a><code><span class="keyword">val</span> one_liner : <a href="index.html#type-parameters">parameters</a></code></dt><dd><p>The default parameters for one-liners: </p><pre><code class="ml">{
  style = `One_liner;
  max_argument_length = Some 100_000;
  fail_with = `Trap_and_kill (78, &quot;USR2&quot;);
  print_failure = failure_to_stderr;
}</code></pre></dd></dl><dl><dt class="spec value" id="val-multi_line"><a href="#val-multi_line" class="anchor"></a><code><span class="keyword">val</span> multi_line : <a href="index.html#type-parameters">parameters</a></code></dt><dd><p>The default parameters for multi-liners (similar to <a href="index.html#val-one_liner"><code>one_liner</code></a>).</p></dd></dl><dl><dt class="spec value" id="val-default_options"><a href="#val-default_options" class="anchor"></a><code><span class="keyword">val</span> default_options : <a href="index.html#type-parameters">parameters</a></code></dt><dd><p>The default value for <code>?option</code> in <a href="index.html#val-string"><code>string</code></a>, which is <a href="index.html#val-one_liner"><code>one_liner</code></a>.</p></dd></dl><dl><dt class="spec value" id="val-string"><a href="#val-string" class="anchor"></a><code><span class="keyword">val</span> string : ?&#8288;options:<a href="index.html#type-parameters">parameters</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="../../EDSL/index.html#type-t">EDSL.t</a> <span>&#45;&gt;</span> (string, <a href="index.html#type-compilation_error">compilation_error</a>) <a href="../../../../ocaml/Stdlib/index.html#type-result">Stdlib.result</a></code></dt><dd><p>Compile a Genspio expression to a POSIX shell “phrase” (one-liner or multi-line) according to the <code>?options</code> (see <a href="index.html#type-parameters"><code>parameters</code></a>).</p></dd></dl></div></body></html>