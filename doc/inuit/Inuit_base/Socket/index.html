<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Socket (inuit.Inuit_base.Socket)</title><link rel="stylesheet" href="../../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../../index.html">inuit</a> &#x00BB; <a href="../index.html">Inuit_base</a> &#x00BB; Socket</nav><h1>Module <code>Inuit_base.Socket</code></h1></header><dl><dt class="spec type" id="type-controller"><a href="#type-controller" class="anchor"></a><code><span class="keyword">type</span> 'a controller</code></dt><dd><p>A <code>message Socket.controller</code> is a bidirectional stream of <code>message</code>. The creator of a value of this type can:</p><ul><li>be notified when connection is established or lost,</li><li>be notified when a value of type <code>message</code> is received,</li><li>send messages to the other end,</li><li>terminates the connection.</li></ul></dd></dl><dl><dt class="spec value" id="val-make"><a href="#val-make" class="anchor"></a><code><span class="keyword">val</span> make : receive:(<span class="type-var">'a</span> <span>&#45;&gt;</span> unit) <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-controller">controller</a></code></dt><dd><p><code>make ~receive</code> creates a new controller that will call <code>receive</code> when a message is received.</p></dd></dl><dl><dt class="spec value" id="val-set_receive"><a href="#val-set_receive" class="anchor"></a><code><span class="keyword">val</span> set_receive : <span class="type-var">'a</span> <a href="index.html#type-controller">controller</a> <span>&#45;&gt;</span> (<span class="type-var">'a</span> <span>&#45;&gt;</span> unit) <span>&#45;&gt;</span> unit</code></dt><dd><p><code>set_receive</code> sets the callback invoked when a message is received.</p><p><code>set_on_closed</code> sets the callback invoked when the connection terminates. Closing is definitive (it can happen at most once).</p></dd></dl><dl><dt class="spec value" id="val-set_on_closed"><a href="#val-set_on_closed" class="anchor"></a><code><span class="keyword">val</span> set_on_closed : <span class="type-var">'a</span> <a href="index.html#type-controller">controller</a> <span>&#45;&gt;</span> (unit <span>&#45;&gt;</span> unit) <span>&#45;&gt;</span> unit</code></dt><dd><p><code>set_on_closed</code> sets the callback invoked when the connection terminates. Closing is definitive (it can happen at most once).</p><p><code>set_on_connected</code> sets the callback invoked when the connection is established. It can be invoked at most once.</p></dd></dl><dl><dt class="spec value" id="val-set_on_connected"><a href="#val-set_on_connected" class="anchor"></a><code><span class="keyword">val</span> set_on_connected : <span class="type-var">'a</span> <a href="index.html#type-controller">controller</a> <span>&#45;&gt;</span> (unit <span>&#45;&gt;</span> unit) <span>&#45;&gt;</span> unit</code></dt><dd><p><code>set_on_connected</code> sets the callback invoked when the connection is established. It can be invoked at most once.</p></dd></dl><dl><dt class="spec value" id="val-send"><a href="#val-send" class="anchor"></a><code><span class="keyword">val</span> send : <span class="type-var">'msg</span> <a href="index.html#type-controller">controller</a> <span>&#45;&gt;</span> <span class="type-var">'msg</span> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>send ctrl msg</code> sends one message to the other end. <code>status (endpoint ctrl)</code> should be <code>`Connected</code> for this to succeed. Fail with <code>Invalid_argument</code> otherwise.</p></dd></dl><dl><dt class="spec value" id="val-close"><a href="#val-close" class="anchor"></a><code><span class="keyword">val</span> close : <span class="type-var">'msg</span> <a href="index.html#type-controller">controller</a> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>close ctrl</code> terminates the connection now. If <code>status (endpoint ctrl)</code> is <code>`Pending</code> or <code>`Connected</code>, it is updated to <code>`Closed</code> and <code>on_closed</code> callback is invoked. If <code>status (endpoint ctrl)</code> is already <code>`Closed</code>, nothing happens.</p></dd></dl><dl><dt class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> 'a t</code></dt><dd><p>A handle exposed to higher-level code to connect sockets together.</p></dd></dl><dl><dt class="spec value" id="val-endpoint"><a href="#val-endpoint" class="anchor"></a><code><span class="keyword">val</span> endpoint : <span class="type-var">'a</span> <a href="index.html#type-controller">controller</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-t">t</a></code></dt><dt class="spec value" id="val-status"><a href="#val-status" class="anchor"></a><code><span class="keyword">val</span> status : <span class="type-var">'msg</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> [ `Pending | `Connected | `Closed ]</code></dt><dd><p>Get the status of the socket. Possible statuses are:</p><ul><li><code>`Pending</code>, connection has not been established yet, no message should be sent yet.</li><li><code>`Connected</code>, connection has been established, messages can be sent.</li><li><code>`Closed</code>, connection is terminated, no messages can be sent anymore.</li></ul></dd></dl><dl><dt class="spec value" id="val-connect"><a href="#val-connect" class="anchor"></a><code><span class="keyword">val</span> connect : a:<span class="type-var">'msg</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> b:<span class="type-var">'msg</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> unit</code></dt><dd><p>Connect two sockets together. Both should be in <code>`Pending</code> status. Fail with <code>Invalid_argument</code> otherwise.</p></dd></dl></div></body></html>