<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Make (irmin.Irmin.Make)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../../index.html">irmin</a> &#x00BB; <a href="../index.html">Irmin</a> &#x00BB; Make</nav><h1>Module <code>Irmin.Make</code></h1><p>Simple store creator. Use the same type of all of the internal keys and store all the values in the same store.</p><nav class="toc"><ul><li><a href="#irmin-stores">Irmin stores</a></li><li><a href="#reads">Reads</a></li><li><a href="#transactions">Transactions</a></li><li><a href="#clones">Clones</a></li><li><a href="#watches">Watches</a></li><li><a href="#merges-and-common-ancestors.">Merges and Common Ancestors.</a></li><li><a href="#history">History</a></li><li><a href="#value-types">Value Types</a></li></ul></nav></header><h3 class="heading">Parameters</h3><ul><li><code><a href="argument-1-AO/index.html">AO</a> : <a href="../index.html#module-type-AO_MAKER">AO_MAKER</a></code></li><li><code><a href="argument-2-RW/index.html">RW</a> : <a href="../index.html#module-type-RW_MAKER">RW_MAKER</a></code></li><li><code><a href="argument-3-M/index.html">M</a> : <a href="../Metadata/index.html#module-type-S">Metadata.S</a></code></li><li><code><a href="argument-4-C/index.html">C</a> : <a href="../Contents/index.html#module-type-S">Contents.S</a></code></li><li><code><a href="argument-5-P/index.html">P</a> : <a href="../Path/index.html#module-type-S">Path.S</a></code></li><li><code><a href="argument-6-B/index.html">B</a> : <a href="../Branch/index.html#module-type-S">Branch.S</a></code></li><li><code><a href="argument-7-H/index.html">H</a> : <a href="../Hash/index.html#module-type-S">Hash.S</a></code></li></ul><h3 class="heading">Signature</h3><section><header><h2 id="irmin-stores"><a href="#irmin-stores" class="anchor"></a>Irmin stores</h2><p>Irmin stores are tree-like read-write stores with extended capabilities. They allow an application (or a collection of applications) to work with multiple local states, which can be forked and merged programmatically, without having to rely on a global state. In a way very similar to version control systems, Irmin local states are called <i>branches</i>.</p><p>There are two kinds of store in Irmin: the ones based on <span class="xref-unresolved" title="unresolved reference to &quot;persistent&quot;"><span>persistent</span></span> named branches and the ones based <span class="xref-unresolved" title="unresolved reference to &quot;temporary&quot;"><span>temporary</span></span> detached heads. These exist relative to a local, larger (and shared) store, and have some (shared) contents. This is exactly the same as usual version control systems, that the informed user can see as an implicit purely functional data-structure.</p></header><dl><dt class="spec type" id="type-repo"><a href="#type-repo" class="anchor"></a><code><span class="keyword">type </span>repo</code></dt><dd><p>The type for Irmin repositories.</p></dd></dl><dl><dt class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><code><span class="keyword">type </span>t</code></dt><dd><p>The type for Irmin stores.</p></dd></dl><dl><dt class="spec type" id="type-step"><a href="#type-step" class="anchor"></a><code><span class="keyword">type </span>step</code><code><span class="keyword"> = </span><a href="argument-5-P/index.html#type-step">P.step</a></code></dt><dd><p>The type for <a href="index.html#type-key"><code>key</code></a> steps.</p></dd></dl><dl><dt class="spec type" id="type-key"><a href="#type-key" class="anchor"></a><code><span class="keyword">type </span>key</code><code><span class="keyword"> = </span><a href="argument-5-P/index.html#type-t">P.t</a></code></dt><dd><p>The type for store keys. A key is a sequence of <a href="index.html#type-step"><code>step</code></a>s.</p></dd></dl><dl><dt class="spec type" id="type-metadata"><a href="#type-metadata" class="anchor"></a><code><span class="keyword">type </span>metadata</code><code><span class="keyword"> = </span><a href="argument-3-M/index.html#type-t">M.t</a></code></dt><dd><p>The type for store metadata.</p></dd></dl><dl><dt class="spec type" id="type-contents"><a href="#type-contents" class="anchor"></a><code><span class="keyword">type </span>contents</code><code><span class="keyword"> = </span><a href="argument-4-C/index.html#type-t">C.t</a></code></dt><dd><p>The type for store contents.</p></dd></dl><dl><dt class="spec type" id="type-node"><a href="#type-node" class="anchor"></a><code><span class="keyword">type </span>node</code></dt><dd><p>The type for store nodes.</p></dd></dl><dl><dt class="spec type" id="type-tree"><a href="#type-tree" class="anchor"></a><code><span class="keyword">type </span>tree</code><span class="keyword"> = </span><code>[ </code><table class="variant"><tr id="type-tree.Node" class="anchored"><td class="def constructor"><a href="#type-tree.Node" class="anchor"></a><code><span class="keyword">| </span></code><code>`Node<span class="keyword"> of </span><a href="index.html#type-node">node</a></code></td></tr><tr id="type-tree.Contents" class="anchored"><td class="def constructor"><a href="#type-tree.Contents" class="anchor"></a><code><span class="keyword">| </span></code><code>`Contents<span class="keyword"> of </span><a href="index.html#type-contents">contents</a><span class="keyword"> * </span><a href="index.html#type-metadata">metadata</a></code></td></tr></table><code> ]</code></dt><dd><p>The type for store trees.</p></dd></dl><dl><dt class="spec type" id="type-commit"><a href="#type-commit" class="anchor"></a><code><span class="keyword">type </span>commit</code></dt><dd><p>Type for commit identifiers. Similar to Git's commit SHA1s.</p></dd></dl><dl><dt class="spec type" id="type-branch"><a href="#type-branch" class="anchor"></a><code><span class="keyword">type </span>branch</code><code><span class="keyword"> = </span><a href="argument-6-B/index.html#type-t">B.t</a></code></dt><dd><p>Type for persistent branch names. Branches usually share a common global namespace and it's the user's responsibility to avoid name clashes.</p></dd></dl><dl><dt class="spec type" id="type-slice"><a href="#type-slice" class="anchor"></a><code><span class="keyword">type </span>slice</code></dt><dd><p>Type for store slices.</p></dd></dl><dl><dt class="spec type" id="type-lca_error"><a href="#type-lca_error" class="anchor"></a><code><span class="keyword">type </span>lca_error</code><span class="keyword"> = </span><code>[ </code><table class="variant"><tr id="type-lca_error.Max_depth_reached" class="anchored"><td class="def constructor"><a href="#type-lca_error.Max_depth_reached" class="anchor"></a><code><span class="keyword">| </span></code><code>`Max_depth_reached</code></td></tr><tr id="type-lca_error.Too_many_lcas" class="anchored"><td class="def constructor"><a href="#type-lca_error.Too_many_lcas" class="anchor"></a><code><span class="keyword">| </span></code><code>`Too_many_lcas</code></td></tr></table><code> ]</code></dt><dd><p>The type for errors associated with functions computing least common ancestors</p></dd></dl><dl><dt class="spec type" id="type-ff_error"><a href="#type-ff_error" class="anchor"></a><code><span class="keyword">type </span>ff_error</code><span class="keyword"> = </span><code>[ </code><table class="variant"><tr id="type-ff_error.No_change" class="anchored"><td class="def constructor"><a href="#type-ff_error.No_change" class="anchor"></a><code><span class="keyword">| </span></code><code>`No_change</code></td></tr><tr id="type-ff_error.Rejected" class="anchored"><td class="def constructor"><a href="#type-ff_error.Rejected" class="anchor"></a><code><span class="keyword">| </span></code><code>`Rejected</code></td></tr><tr id="type-ff_error.lca_error" class="anchored"><td class="def type"><a href="#type-ff_error.lca_error" class="anchor"></a><code><span class="keyword">| </span></code><code><a href="index.html#type-lca_error">lca_error</a></code></td></tr></table><code> ]</code></dt><dd><p>The type for errors for <code>fast_forward</code>.</p></dd></dl><dl><dt class="spec module" id="module-Repo"><a href="#module-Repo" class="anchor"></a><code><span class="keyword">module </span><a href="Repo/index.html">Repo</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>Repositories.</p></dd></dl><dl><dt class="spec value" id="val-empty"><a href="#val-empty" class="anchor"></a><code><span class="keyword">val </span>empty : <a href="index.html#type-repo">repo</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> Lwt.t</code></dt><dd><p><code>empty repo</code> is a temporary, empty store. Becomes a normal temporary store after the first update.</p></dd></dl><dl><dt class="spec value" id="val-master"><a href="#val-master" class="anchor"></a><code><span class="keyword">val </span>master : <a href="index.html#type-repo">repo</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> Lwt.t</code></dt><dd><p><code>master repo</code> is a persistent store based on <code>r</code>'s master branch. This operation is cheap, can be repeated multiple times.</p></dd></dl><dl><dt class="spec value" id="val-of_branch"><a href="#val-of_branch" class="anchor"></a><code><span class="keyword">val </span>of_branch : <a href="index.html#type-repo">repo</a> <span>&#45;&gt;</span> <a href="index.html#type-branch">branch</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> Lwt.t</code></dt><dd><p><code>of_branch r name</code> is a persistent store based on the branch <code>name</code>. Similar to <code>master</code>, but use <code>name</code> instead <span class="xref-unresolved" title="unresolved reference to &quot;Branch.S.master&quot;"><span class="xref-unresolved" title="unresolved reference to &quot;Branch.S&quot;"><a href="index.html#module-Branch"><code>Branch</code></a>.S</span>.master</span>.</p></dd></dl><dl><dt class="spec value" id="val-of_commit"><a href="#val-of_commit" class="anchor"></a><code><span class="keyword">val </span>of_commit : <a href="index.html#type-commit">commit</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> Lwt.t</code></dt><dd><p><code>of_commit c</code> is a temporary store, based on the commit <code>c</code>.</p><p>Temporary stores do not have stable names: instead they can be addressed using the hash of the current commit. Temporary stores are similar to Git's detached heads. In a temporary store, all the operations are performed relative to the current head and update operations can modify the current head: the current stores's head will automatically become the new head obtained after performing the update.</p></dd></dl><dl><dt class="spec value" id="val-repo"><a href="#val-repo" class="anchor"></a><code><span class="keyword">val </span>repo : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-repo">repo</a></code></dt><dd><p><code>repo t</code> is the repository containing <code>t</code>.</p></dd></dl><dl><dt class="spec value" id="val-tree"><a href="#val-tree" class="anchor"></a><code><span class="keyword">val </span>tree : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-tree">tree</a> Lwt.t</code></dt><dd><p><code>tree t</code> is <code>t</code>'s current tree. Contents is not allowed at the root of the tree.</p></dd></dl><dl><dt class="spec module" id="module-Status"><a href="#module-Status" class="anchor"></a><code><span class="keyword">module </span><a href="Status/index.html">Status</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p><code>Status</code> provides base functions for store statuses.</p></dd></dl><dl><dt class="spec value" id="val-status"><a href="#val-status" class="anchor"></a><code><span class="keyword">val </span>status : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="Status/index.html#type-t">Status.t</a></code></dt><dd><p><code>status t</code> is <code>t</code>'s status. It can either be a branch, a commit or empty.</p></dd></dl><dl><dt class="spec module" id="module-Head"><a href="#module-Head" class="anchor"></a><code><span class="keyword">module </span><a href="Head/index.html">Head</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>Managing the store's heads.</p></dd></dl><dl><dt class="spec module" id="module-Commit"><a href="#module-Commit" class="anchor"></a><code><span class="keyword">module </span><a href="Commit/index.html">Commit</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span><span class="keyword"> with </span><span class="keyword">type </span><a href="Commit/Hash/index.html#type-t">Hash.t</a><span class="keyword"> = </span><a href="argument-7-H/index.html#type-t">H.t</a></code></dt><dd><p><code>Commit</code> defines immutable objects to describe store updates.</p></dd></dl><dl><dt class="spec module" id="module-Contents"><a href="#module-Contents" class="anchor"></a><code><span class="keyword">module </span><a href="Contents/index.html">Contents</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span><span class="keyword"> with </span><span class="keyword">type </span><a href="Contents/Hash/index.html#type-t">Hash.t</a><span class="keyword"> = </span><a href="argument-7-H/index.html#type-t">H.t</a></code></dt><dd><p><code>Contents</code> provides base functions for the store's contents.</p></dd></dl><aside><p>Managing store's trees.</p></aside><div class="spec module" id="module-Tree"><a href="#module-Tree" class="anchor"></a><code><span class="keyword">module </span><a href="Tree/index.html">Tree</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span><span class="keyword"> with </span><span class="keyword">type </span><a href="Tree/Hash/index.html#type-t">Hash.t</a><span class="keyword"> = </span><a href="argument-7-H/index.html#type-t">H.t</a></code></div></section><section><header><h2 id="reads"><a href="#reads" class="anchor"></a>Reads</h2></header><dl><dt class="spec value" id="val-kind"><a href="#val-kind" class="anchor"></a><code><span class="keyword">val </span>kind : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-key">key</a> <span>&#45;&gt;</span> [ `Contents<span class="keyword"> | </span>`Node ] option Lwt.t</code></dt><dd><p><code>kind</code> is <a href="Tree/index.html#val-kind"><code>Tree.kind</code></a> applied to <code>t</code>'s root tree.</p></dd></dl><dl><dt class="spec value" id="val-list"><a href="#val-list" class="anchor"></a><code><span class="keyword">val </span>list : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-key">key</a> <span>&#45;&gt;</span> (<a href="index.html#type-step">step</a><span class="keyword"> * </span>[ `Contents<span class="keyword"> | </span>`Node ]) list Lwt.t</code></dt><dd><p><code>list t</code> is <a href="Tree/index.html#val-list"><code>Tree.list</code></a> applied to <code>t</code>'s root tree.</p></dd></dl><dl><dt class="spec value" id="val-mem"><a href="#val-mem" class="anchor"></a><code><span class="keyword">val </span>mem : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-key">key</a> <span>&#45;&gt;</span> bool Lwt.t</code></dt><dd><p><code>mem t</code> is <a href="Tree/index.html#val-mem"><code>Tree.mem</code></a> applied to <code>t</code>'s root tree.</p></dd></dl><dl><dt class="spec value" id="val-mem_tree"><a href="#val-mem_tree" class="anchor"></a><code><span class="keyword">val </span>mem_tree : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-key">key</a> <span>&#45;&gt;</span> bool Lwt.t</code></dt><dd><p><code>mem_tree t</code> is <a href="Tree/index.html#val-mem_tree"><code>Tree.mem_tree</code></a> applied to <code>t</code>'s root tree.</p></dd></dl><dl><dt class="spec value" id="val-find_all"><a href="#val-find_all" class="anchor"></a><code><span class="keyword">val </span>find_all : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-key">key</a> <span>&#45;&gt;</span> (<a href="index.html#type-contents">contents</a><span class="keyword"> * </span><a href="index.html#type-metadata">metadata</a>) option Lwt.t</code></dt><dd><p><code>find_all t</code> is <a href="Tree/index.html#val-find_all"><code>Tree.find_all</code></a> applied to <code>t</code>'s root tree.</p></dd></dl><dl><dt class="spec value" id="val-find"><a href="#val-find" class="anchor"></a><code><span class="keyword">val </span>find : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-key">key</a> <span>&#45;&gt;</span> <a href="index.html#type-contents">contents</a> option Lwt.t</code></dt><dd><p><code>find t</code> is <a href="Tree/index.html#val-find"><code>Tree.find</code></a> applied to <code>t</code>'s root tree.</p></dd></dl><dl><dt class="spec value" id="val-get_all"><a href="#val-get_all" class="anchor"></a><code><span class="keyword">val </span>get_all : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-key">key</a> <span>&#45;&gt;</span> (<a href="index.html#type-contents">contents</a><span class="keyword"> * </span><a href="index.html#type-metadata">metadata</a>) Lwt.t</code></dt><dd><p><code>get_all t</code> is <a href="Tree/index.html#val-get_all"><code>Tree.get_all</code></a> applied on <code>t</code>'s root tree.</p></dd></dl><dl><dt class="spec value" id="val-get"><a href="#val-get" class="anchor"></a><code><span class="keyword">val </span>get : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-key">key</a> <span>&#45;&gt;</span> <a href="index.html#type-contents">contents</a> Lwt.t</code></dt><dd><p><code>get t</code> is <a href="Tree/index.html#val-get"><code>Tree.get</code></a> applied to <code>t</code>'s root tree.</p></dd></dl><dl><dt class="spec value" id="val-find_tree"><a href="#val-find_tree" class="anchor"></a><code><span class="keyword">val </span>find_tree : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-key">key</a> <span>&#45;&gt;</span> <a href="index.html#type-tree">tree</a> option Lwt.t</code></dt><dd><p><code>find_tree t</code> is <a href="Tree/index.html#val-find_tree"><code>Tree.find_tree</code></a> applied to <code>t</code>'s root tree.</p></dd></dl><dl><dt class="spec value" id="val-get_tree"><a href="#val-get_tree" class="anchor"></a><code><span class="keyword">val </span>get_tree : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-key">key</a> <span>&#45;&gt;</span> <a href="index.html#type-tree">tree</a> Lwt.t</code></dt><dd><p><code>get_tree t k</code> is <a href="Tree/index.html#val-get_tree"><code>Tree.get_tree</code></a> applied to <code>t</code>'s root tree.</p></dd></dl></section><section><header><h2 id="transactions"><a href="#transactions" class="anchor"></a>Transactions</h2></header><dl><dt class="spec type" id="type-transaction"><a href="#type-transaction" class="anchor"></a><code><span class="keyword">type </span>'a transaction</code><code><span class="keyword"> = </span>?&#8288;allow_empty:bool <span>&#45;&gt;</span> ?&#8288;strategy:[ `Set<span class="keyword"> | </span>`Test_and_set<span class="keyword"> | </span>`Merge ] <span>&#45;&gt;</span> ?&#8288;max_depth:int <span>&#45;&gt;</span> ?&#8288;n:int <span>&#45;&gt;</span> info:<a href="../Info/index.html#type-f">Info.f</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> unit Lwt.t</code></dt><dd><p>The type for transactions.</p></dd></dl><dl><dt class="spec value" id="val-with_tree"><a href="#val-with_tree" class="anchor"></a><code><span class="keyword">val </span>with_tree : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-key">key</a> <span>&#45;&gt;</span> (<a href="index.html#type-tree">tree</a> option <span>&#45;&gt;</span> <a href="index.html#type-tree">tree</a> option Lwt.t) <a href="index.html#type-transaction">transaction</a></code></dt><dd><p><code>with_tree t k ~info f</code> replaces <i>atomically</i> the subtree <code>v</code> under <code>k</code> in the store <code>t</code> by the contents of the tree <code>f v</code>, using the commit info <code>info ()</code>.</p><p>If <code>v = f v</code> and <code>allow_empty</code> is unset (default) then, the operation is a no-op.</p><p>If <code>v != f v</code> and no other changes happen concurrently, <code>f v</code> becomes the new subtree under <code>k</code>. If other changes happen concurrently to that operations, the semantics depend on the value of <code>strategy</code>:</p><ul><li>if <code>strategy = `Set</code>, the <em>last write wins</em>.</li><li>if <code>strategy = `Test_and_set</code> (default), the transaction is restarted.</li><li>if <code>strategy = `Merge</code>, concurrent changes are merged with <code>f
         v</code>. If the merge has a conflict, the transaction is restarted.</li></ul><p><b>Note:</b> Irmin transactions provides <a href="https://en.wikipedia.org/wiki/Snapshot_isolation">snapshot isolation</a> guarantees: reads and writes are isolated in every transaction, but only write conflicts are visible on commit.</p></dd></dl><dl><dt class="spec value" id="val-set"><a href="#val-set" class="anchor"></a><code><span class="keyword">val </span>set : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-key">key</a> <span>&#45;&gt;</span> ?&#8288;metadata:<a href="index.html#type-metadata">metadata</a> <span>&#45;&gt;</span> <a href="index.html#type-contents">contents</a> <a href="index.html#type-transaction">transaction</a></code></dt><dd><p><code>set t k ~info v</code> is <code>with_tree t k ~info (fun tree -&gt; Tree.add
      tree [] v)</code>.</p></dd></dl><dl><dt class="spec value" id="val-set_tree"><a href="#val-set_tree" class="anchor"></a><code><span class="keyword">val </span>set_tree : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-key">key</a> <span>&#45;&gt;</span> <a href="index.html#type-tree">tree</a> <a href="index.html#type-transaction">transaction</a></code></dt><dd><p><code>set_tree t k ~info v</code> is <code>with_tree t k ~info (fun tree -&gt;
      Tree.add_tree tree [] v)</code>.</p></dd></dl><dl><dt class="spec value" id="val-remove"><a href="#val-remove" class="anchor"></a><code><span class="keyword">val </span>remove : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-key">key</a> <a href="index.html#type-transaction">transaction</a></code></dt><dd><p><code>remove t i k</code> is <code>with_tree t i k (fun tree -&gt; Tree.remove tree
      [])</code>.</p></dd></dl></section><section><header><h2 id="clones"><a href="#clones" class="anchor"></a>Clones</h2></header><dl><dt class="spec value" id="val-clone"><a href="#val-clone" class="anchor"></a><code><span class="keyword">val </span>clone : src:<a href="index.html#type-t">t</a> <span>&#45;&gt;</span> dst:<a href="index.html#type-branch">branch</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> Lwt.t</code></dt><dd><p><code>clone ~src ~dst</code> makes <code>dst</code> points to <code>Head.get src</code>. <code>dst</code> is created if needed. Remove the current contents en <code>dst</code> if <code>src</code> is <a href="index.html#val-empty"><code>empty</code></a>.</p></dd></dl></section><section><header><h2 id="watches"><a href="#watches" class="anchor"></a>Watches</h2></header><dl><dt class="spec type" id="type-watch"><a href="#type-watch" class="anchor"></a><code><span class="keyword">type </span>watch</code></dt><dd><p>The type for store watches.</p></dd></dl><dl><dt class="spec value" id="val-watch"><a href="#val-watch" class="anchor"></a><code><span class="keyword">val </span>watch : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> ?&#8288;init:<a href="index.html#type-commit">commit</a> <span>&#45;&gt;</span> (<a href="index.html#type-commit">commit</a> <a href="../index.html#type-diff">diff</a> <span>&#45;&gt;</span> unit Lwt.t) <span>&#45;&gt;</span> <a href="index.html#type-watch">watch</a> Lwt.t</code></dt><dd><p><code>watch t f</code> calls <code>f</code> every time the contents of <code>t</code>'s head is updated.</p><p><b>Note:</b> even if <code>f</code> might skip some head updates, it will never be called concurrently: all consecutive calls to <code>f</code> are done in sequence, so we ensure that the previous one ended before calling the next one.</p></dd></dl><dl><dt class="spec value" id="val-watch_key"><a href="#val-watch_key" class="anchor"></a><code><span class="keyword">val </span>watch_key : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-key">key</a> <span>&#45;&gt;</span> ?&#8288;init:<a href="index.html#type-commit">commit</a> <span>&#45;&gt;</span> ((<a href="index.html#type-commit">commit</a><span class="keyword"> * </span><a href="index.html#type-tree">tree</a>) <a href="../index.html#type-diff">diff</a> <span>&#45;&gt;</span> unit Lwt.t) <span>&#45;&gt;</span> <a href="index.html#type-watch">watch</a> Lwt.t</code></dt><dd><p><code>watch_key t key f</code> calls <code>f</code> every time the <code>key</code>'s value is added, removed or updated. If the current branch is deleted, no signal is sent to the watcher.</p></dd></dl><dl><dt class="spec value" id="val-unwatch"><a href="#val-unwatch" class="anchor"></a><code><span class="keyword">val </span>unwatch : <a href="index.html#type-watch">watch</a> <span>&#45;&gt;</span> unit Lwt.t</code></dt><dd><p><code>unwatch w</code> disable <code>w</code>. Return once the <code>w</code> is fully disabled.</p></dd></dl></section><section><header><h2 id="merges-and-common-ancestors."><a href="#merges-and-common-ancestors." class="anchor"></a>Merges and Common Ancestors.</h2></header><dl><dt class="spec type" id="type-merge"><a href="#type-merge" class="anchor"></a><code><span class="keyword">type </span>'a merge</code><code><span class="keyword"> = </span>info:<a href="../Info/index.html#type-f">Info.f</a> <span>&#45;&gt;</span> ?&#8288;max_depth:int <span>&#45;&gt;</span> ?&#8288;n:int <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> (unit,Â <a href="../Merge/index.html#type-conflict">Merge.conflict</a>) Result.result Lwt.t</code></dt><dd><p>The type for merge functions.</p></dd></dl><dl><dt class="spec value" id="val-merge"><a href="#val-merge" class="anchor"></a><code><span class="keyword">val </span>merge : into:<a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <a href="index.html#type-merge">merge</a></code></dt><dd><p><code>merge ~into i t</code> merges <code>t</code>'s current branch into <code>x</code>'s current branch using the info <code>i</code>. After that operation, the two stores are still independent. Similar to <code>git merge &lt;branch&gt;</code>.</p></dd></dl><dl><dt class="spec value" id="val-merge_with_branch"><a href="#val-merge_with_branch" class="anchor"></a><code><span class="keyword">val </span>merge_with_branch : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-branch">branch</a> <a href="index.html#type-merge">merge</a></code></dt><dd><p>Same as <a href="index.html#type-merge"><code>merge</code></a> but with a branch ID.</p></dd></dl><dl><dt class="spec value" id="val-merge_with_commit"><a href="#val-merge_with_commit" class="anchor"></a><code><span class="keyword">val </span>merge_with_commit : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-commit">commit</a> <a href="index.html#type-merge">merge</a></code></dt><dd><p>Same as <a href="index.html#type-merge"><code>merge</code></a> but with a commit ID.</p></dd></dl><dl><dt class="spec value" id="val-lcas"><a href="#val-lcas" class="anchor"></a><code><span class="keyword">val </span>lcas : ?&#8288;max_depth:int <span>&#45;&gt;</span> ?&#8288;n:int <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> (<a href="index.html#type-commit">commit</a> list,Â <a href="index.html#type-lca_error">lca_error</a>) Result.result Lwt.t</code></dt><dd><p><code>lca ?max_depth ?n msg t1 t2</code> returns the collection of least common ancestors between the heads of <code>t1</code> and <code>t2</code> branches.</p><ul><li><code>max_depth</code> is the maximum depth of the exploration (default is <code>max_int</code>). Return <code>Error `Max_depth_reached</code> if this depth is exceeded.</li><li><code>n</code> is the maximum expected number of lcas. Stop the exploration as soon as <code>n</code> lcas are found. Return <code>Error
      `Too_many_lcas</code> if more <code>lcas</code> are found.</li></ul></dd></dl><dl><dt class="spec value" id="val-lcas_with_branch"><a href="#val-lcas_with_branch" class="anchor"></a><code><span class="keyword">val </span>lcas_with_branch : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> ?&#8288;max_depth:int <span>&#45;&gt;</span> ?&#8288;n:int <span>&#45;&gt;</span> <a href="index.html#type-branch">branch</a> <span>&#45;&gt;</span> (<a href="index.html#type-commit">commit</a> list,Â <a href="index.html#type-lca_error">lca_error</a>) Result.result Lwt.t</code></dt><dd><p>Same as <a href="index.html#val-lcas"><code>lcas</code></a> but takes a branch ID as argument.</p></dd></dl><dl><dt class="spec value" id="val-lcas_with_commit"><a href="#val-lcas_with_commit" class="anchor"></a><code><span class="keyword">val </span>lcas_with_commit : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> ?&#8288;max_depth:int <span>&#45;&gt;</span> ?&#8288;n:int <span>&#45;&gt;</span> <a href="index.html#type-commit">commit</a> <span>&#45;&gt;</span> (<a href="index.html#type-commit">commit</a> list,Â <a href="index.html#type-lca_error">lca_error</a>) Result.result Lwt.t</code></dt><dd><p>Same as <a href="index.html#val-lcas"><code>lcas</code></a> but takes a commit ID as argument.</p></dd></dl></section><section><header><h2 id="history"><a href="#history" class="anchor"></a>History</h2></header><dl><dt class="spec module" id="module-History"><a href="#module-History" class="anchor"></a><code><span class="keyword">module </span>History : Graph.Sig.P<span class="keyword"> with </span><span class="keyword">type </span><a href="index.html#module-History">History</a>.V.t<span class="keyword"> = </span><a href="index.html#type-commit">commit</a></code></dt><dd><p>An history is a DAG of heads.</p></dd></dl><dl><dt class="spec value" id="val-history"><a href="#val-history" class="anchor"></a><code><span class="keyword">val </span>history : ?&#8288;depth:int <span>&#45;&gt;</span> ?&#8288;min:<a href="index.html#type-commit">commit</a> list <span>&#45;&gt;</span> ?&#8288;max:<a href="index.html#type-commit">commit</a> list <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#module-History">History</a>.t Lwt.t</code></dt><dd><p><code>history ?depth ?min ?max t</code> is a view of the history of the store <code>t</code>, of depth at most <code>depth</code>, starting from the <code>max</code> (or from the <code>t</code>'s head if the list of heads is empty) and stopping at <code>min</code> if specified.</p></dd></dl><dl><dt class="spec module" id="module-Branch"><a href="#module-Branch" class="anchor"></a><code><span class="keyword">module </span><a href="Branch/index.html">Branch</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>Manipulate branches.</p></dd></dl><dl><dt class="spec module" id="module-Key"><a href="#module-Key" class="anchor"></a><code><span class="keyword">module </span><a href="Key/index.html">Key</a> : <a href="../Path/index.html#module-type-S">Path.S</a><span class="keyword"> with </span><span class="keyword">type </span><a href="../Path/module-type-S/index.html#type-t">t</a><span class="keyword"> = </span><a href="index.html#type-key">key</a><span class="keyword"> and </span><span class="keyword">type </span><a href="../Path/module-type-S/index.html#type-step">step</a><span class="keyword"> = </span><a href="index.html#type-step">step</a></code></dt><dd><p><code>Key</code> provides base functions for the stores's paths.</p></dd></dl><dl><dt class="spec module" id="module-Metadata"><a href="#module-Metadata" class="anchor"></a><code><span class="keyword">module </span><a href="Metadata/index.html">Metadata</a> : <a href="../Metadata/index.html#module-type-S">Metadata.S</a><span class="keyword"> with </span><span class="keyword">type </span><a href="../Metadata/module-type-S/index.html#type-t">t</a><span class="keyword"> = </span><a href="index.html#type-metadata">metadata</a></code></dt><dd><p><code>Metadata</code> provides base functions for node metadata.</p></dd></dl></section><section><header><h2 id="value-types"><a href="#value-types" class="anchor"></a>Value Types</h2></header><dl><dt class="spec value" id="val-step_t"><a href="#val-step_t" class="anchor"></a><code><span class="keyword">val </span>step_t : <a href="index.html#type-step">step</a> <a href="../Type/index.html#type-t">Type.t</a></code></dt><dd><p><code>step_t</code> is the value type for <a href="index.html#type-step"><code>step</code></a>.</p></dd></dl><dl><dt class="spec value" id="val-key_t"><a href="#val-key_t" class="anchor"></a><code><span class="keyword">val </span>key_t : <a href="index.html#type-key">key</a> <a href="../Type/index.html#type-t">Type.t</a></code></dt><dd><p><code>key_t</code> is the value type for <a href="index.html#type-key"><code>key</code></a>.</p></dd></dl><dl><dt class="spec value" id="val-metadata_t"><a href="#val-metadata_t" class="anchor"></a><code><span class="keyword">val </span>metadata_t : <a href="index.html#type-metadata">metadata</a> <a href="../Type/index.html#type-t">Type.t</a></code></dt><dd><p><code>metadata_t</code> is the value type for <a href="index.html#type-metadata"><code>metadata</code></a>.</p></dd></dl><dl><dt class="spec value" id="val-contents_t"><a href="#val-contents_t" class="anchor"></a><code><span class="keyword">val </span>contents_t : <a href="index.html#type-contents">contents</a> <a href="../Type/index.html#type-t">Type.t</a></code></dt><dd><p><code>contents_t</code> is the value type for <a href="index.html#type-contents"><code>contents</code></a>.</p></dd></dl><dl><dt class="spec value" id="val-node_t"><a href="#val-node_t" class="anchor"></a><code><span class="keyword">val </span>node_t : <a href="index.html#type-node">node</a> <a href="../Type/index.html#type-t">Type.t</a></code></dt><dd><p><code>node_t</code> is the value type for <a href="index.html#type-node"><code>node</code></a>.</p></dd></dl><dl><dt class="spec value" id="val-tree_t"><a href="#val-tree_t" class="anchor"></a><code><span class="keyword">val </span>tree_t : <a href="index.html#type-tree">tree</a> <a href="../Type/index.html#type-t">Type.t</a></code></dt><dd><p><code>tree_t</code> is the value type for <a href="index.html#type-tree"><code>tree</code></a>.</p></dd></dl><dl><dt class="spec value" id="val-commit_t"><a href="#val-commit_t" class="anchor"></a><code><span class="keyword">val </span>commit_t : <a href="index.html#type-repo">repo</a> <span>&#45;&gt;</span> <a href="index.html#type-commit">commit</a> <a href="../Type/index.html#type-t">Type.t</a></code></dt><dd><p><code>commit_t r</code> is the value type for <a href="index.html#type-commit"><code>commit</code></a>.</p></dd></dl><dl><dt class="spec value" id="val-branch_t"><a href="#val-branch_t" class="anchor"></a><code><span class="keyword">val </span>branch_t : <a href="index.html#type-branch">branch</a> <a href="../Type/index.html#type-t">Type.t</a></code></dt><dd><p><code>branch_t</code> is the value type for <a href="index.html#type-branch"><code>branch</code></a>.</p></dd></dl><dl><dt class="spec value" id="val-slice_t"><a href="#val-slice_t" class="anchor"></a><code><span class="keyword">val </span>slice_t : <a href="index.html#type-slice">slice</a> <a href="../Type/index.html#type-t">Type.t</a></code></dt><dd><p><code>slice_t</code> is the value type for <a href="index.html#type-slice"><code>slice</code></a>.</p></dd></dl><dl><dt class="spec value" id="val-kind_t"><a href="#val-kind_t" class="anchor"></a><code><span class="keyword">val </span>kind_t : [ `Node<span class="keyword"> | </span>`Contents ] <a href="../Type/index.html#type-t">Type.t</a></code></dt><dd><p><code>kind_t</code> is the value type for values returned by <a href="index.html#val-kind"><code>kind</code></a>.</p></dd></dl><dl><dt class="spec value" id="val-lca_error_t"><a href="#val-lca_error_t" class="anchor"></a><code><span class="keyword">val </span>lca_error_t : <a href="index.html#type-lca_error">lca_error</a> <a href="../Type/index.html#type-t">Type.t</a></code></dt><dd><p><code>lca_error_t</code> is the value type for <a href="index.html#type-lca_error"><code>lca_error</code></a>.</p></dd></dl><dl><dt class="spec value" id="val-ff_error_t"><a href="#val-ff_error_t" class="anchor"></a><code><span class="keyword">val </span>ff_error_t : <a href="index.html#type-ff_error">ff_error</a> <a href="../Type/index.html#type-t">Type.t</a></code></dt><dd><p><code>ff_error_t</code> is the value type for <a href="index.html#type-ff_error"><code>ff_error</code></a>.</p></dd></dl><dl><dt class="spec module" id="module-Private"><a href="#module-Private" class="anchor"></a><code><span class="keyword">module </span><a href="Private/index.html">Private</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>Private functions, which might be used by the backends.</p></dd></dl></section></div></body></html>