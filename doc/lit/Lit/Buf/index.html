<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Buf (lit.Lit.Buf)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – <a href="../../index.html">lit</a> &#x00BB; <a href="../index.html">Lit</a> &#x00BB; Buf</nav><h1>Module <code>Lit.Buf</code></h1><p>Buffers.</p><p>Buffers are linear arrays of scalars of a given <span class="xref-unresolved" title="unresolved reference to &quot;Gg.Ba.scalar_type&quot;"><span>scalar type</span></span>. At a given point in time the scalars may exist only on the CPU side, only on the GPU side or on both sides (synchronized or not).</p><nav class="toc"><ul><li><a href="#buffer-usage">Buffer usage</a></li><li><a href="#buffers">Buffers</a></li><li><a href="#gpu-buffer">GPU buffer</a><ul><li><a href="#mapping-the-gpu-buffer-in-cpu">Mapping the GPU buffer in CPU</a></li></ul></li><li><a href="#cpu-buffer">CPU buffer</a></li></ul></nav></header><section><header><h2 id="buffer-usage"><a href="#buffer-usage" class="anchor"></a>Buffer usage</h2></header><dl><dt class="spec type" id="type-usage"><a href="#type-usage" class="anchor"></a><code><span class="keyword">type </span>usage</code><span class="keyword"> = </span><code>[ </code><table class="variant"><tr id="type-usage.Static_draw" class="anchored"><td class="def constructor"><a href="#type-usage.Static_draw" class="anchor"></a><code><span class="keyword">| </span></code><code>`Static_draw</code></td></tr><tr id="type-usage.Static_read" class="anchored"><td class="def constructor"><a href="#type-usage.Static_read" class="anchor"></a><code><span class="keyword">| </span></code><code>`Static_read</code></td></tr><tr id="type-usage.Static_copy" class="anchored"><td class="def constructor"><a href="#type-usage.Static_copy" class="anchor"></a><code><span class="keyword">| </span></code><code>`Static_copy</code></td></tr><tr id="type-usage.Stream_draw" class="anchored"><td class="def constructor"><a href="#type-usage.Stream_draw" class="anchor"></a><code><span class="keyword">| </span></code><code>`Stream_draw</code></td></tr><tr id="type-usage.Stream_read" class="anchored"><td class="def constructor"><a href="#type-usage.Stream_read" class="anchor"></a><code><span class="keyword">| </span></code><code>`Stream_read</code></td></tr><tr id="type-usage.Stream_copy" class="anchored"><td class="def constructor"><a href="#type-usage.Stream_copy" class="anchor"></a><code><span class="keyword">| </span></code><code>`Stream_copy</code></td></tr><tr id="type-usage.Dynamic_draw" class="anchored"><td class="def constructor"><a href="#type-usage.Dynamic_draw" class="anchor"></a><code><span class="keyword">| </span></code><code>`Dynamic_draw</code></td></tr><tr id="type-usage.Dynamic_read" class="anchored"><td class="def constructor"><a href="#type-usage.Dynamic_read" class="anchor"></a><code><span class="keyword">| </span></code><code>`Dynamic_read</code></td></tr><tr id="type-usage.Dynamic_copy" class="anchored"><td class="def constructor"><a href="#type-usage.Dynamic_copy" class="anchor"></a><code><span class="keyword">| </span></code><code>`Dynamic_copy</code></td></tr></table><code> ]</code></dt><dd><p>The type for buffer usage hints. First part of the name identifies the data access pattern:</p><ul><li><code>`Static_*</code>, specify once and use many times.</li><li><code>`Stream_*</code>, specify once and use once or a few times.</li><li><code>`Dynamic_*</code>, specify and use many times.</li></ul><p>Second part of the name distinguishes the data flow:</p><ul><li><code>`*_Draw</code>, CPU to GPU.</li><li><code>`*_Read</code>, GPU to CPU.</li><li><code>`*_Copy</code>, GPU to GPU.</li></ul></dd></dl><dl><dt class="spec value" id="val-pp_usage"><a href="#val-pp_usage" class="anchor"></a><code><span class="keyword">val </span>pp_usage : Format.formatter <span>&#45;&gt;</span> <a href="index.html#type-usage">usage</a> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>pp_usage ppf usage</code> prints an uspecified representation of <code>usage</code> on <code>ppf</code>.</p></dd></dl></section><section><header><h2 id="buffers"><a href="#buffers" class="anchor"></a>Buffers</h2></header><dl><dt class="spec type" id="type-init"><a href="#type-init" class="anchor"></a><code><span class="keyword">type </span>('a, 'b) init</code><span class="keyword"> = </span><code>[ </code><table class="variant"><tr id="type-init.Gg.buffer" class="anchored"><td class="def type"><a href="#type-init.Gg.buffer" class="anchor"></a><code><span class="keyword">| </span></code><code>Gg.buffer</code></td></tr><tr id="type-init.Cpu" class="anchored"><td class="def constructor"><a href="#type-init.Cpu" class="anchor"></a><code><span class="keyword">| </span></code><code>`Cpu<span class="keyword"> of </span>Gg.Ba.scalar_type<span class="keyword"> * </span>int</code></td></tr><tr id="type-init.Gpu" class="anchored"><td class="def constructor"><a href="#type-init.Gpu" class="anchor"></a><code><span class="keyword">| </span></code><code>`Gpu<span class="keyword"> of </span>Gg.Ba.scalar_type<span class="keyword"> * </span>int</code></td></tr></table><code> ]</code></dt><dd><p>The type for buffer data initialisation.</p><ul><li><span class="xref-unresolved" title="unresolved reference to &quot;Gg.buffer&quot;"><code>Gg</code>.buffer</span> value, uses the buffer for the CPU side buffer and will allocate a corresponding buffer on the GPU.</li><li><code>`Cpu (st, count)</code>, allocates a CPU side buffer of scalar type <code>st</code> with <code>count</code> scalars and will allocate a corresponding buffer on the GPU.</li><li><code>`Gpu (st, count)</code>, allocates no CPU side buffer, will allocate a GPU buffer of scalar type <code>st</code> with <code>count</code> scalars.</li></ul></dd></dl><dl><dt class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><code><span class="keyword">type </span>t</code><code><span class="keyword"> = </span><a href="../index.html#type-buf">buf</a></code></dt><dd><p>The type for buffers.</p></dd></dl><dl><dt class="spec value" id="val-create"><a href="#val-create" class="anchor"></a><code><span class="keyword">val </span>create : ?&#8288;cpu_autorelease:bool <span>&#45;&gt;</span> ?&#8288;usage:<a href="index.html#type-usage">usage</a> <span>&#45;&gt;</span> (<span class="type-var">'a</span>, <span class="type-var">'b</span>) <a href="index.html#type-init">init</a> <span>&#45;&gt;</span> <a href="../index.html#type-buf">buf</a></code></dt><dd><p><code>create cpu_autorelease usage init</code> is a buffer value such that:</p><ul><li><code>init</code> is the buffer initialisation, see <a href="index.html#type-init"><code>init</code></a>.</li><li><code>usage</code>, hint specifiying the buffer usage, see <a href="index.html#type-usage"><code>usage</code></a> (defaults to <code>`Static_draw</code>).</li><li><code>cpu_autorelease</code>, if <code>true</code> (default) the CPU buffer is automatically released by <span class="xref-unresolved" title="unresolved reference to &quot;set_cpu_&quot;"><span>setting</span></span> it to <code>None</code> once it is uploaded to the GPU buffer.</li></ul><p>Note that while CPU and GPU buffer length may change, their scalar type is immutable.</p><p>At creation time <a href="index.html#val-gpu_upload"><code>gpu_upload</code></a> is <code>true</code> this means that the GPU buffer will be automatically created the first time the buffer is used.</p></dd></dl><dl><dt class="spec value" id="val-usage"><a href="#val-usage" class="anchor"></a><code><span class="keyword">val </span>usage : <a href="../index.html#type-buf">buf</a> <span>&#45;&gt;</span> <a href="index.html#type-usage">usage</a></code></dt><dd><p><code>usage b</code> is the usage of <code>b</code>.</p></dd></dl><dl><dt class="spec value" id="val-scalar_type"><a href="#val-scalar_type" class="anchor"></a><code><span class="keyword">val </span>scalar_type : <a href="../index.html#type-buf">buf</a> <span>&#45;&gt;</span> Gg.Ba.scalar_type</code></dt><dd><p><code>scalar_type b</code> is the scalar type of <code>b</code>.</p></dd></dl><dl><dt class="spec value" id="val-pp"><a href="#val-pp" class="anchor"></a><code><span class="keyword">val </span>pp : Format.formatter <span>&#45;&gt;</span> <a href="../index.html#type-buf">buf</a> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>pp ppf b</code> prints an unspecified representation of <code>b</code> on <code>ppf</code>.</p></dd></dl></section><section><header><h2 id="gpu-buffer"><a href="#gpu-buffer" class="anchor"></a>GPU buffer</h2></header><dl><dt class="spec value" id="val-gpu_count"><a href="#val-gpu_count" class="anchor"></a><code><span class="keyword">val </span>gpu_count : <a href="../index.html#type-buf">buf</a> <span>&#45;&gt;</span> int</code></dt><dd><p><code>gpu_count b</code> is the number of scalars in the GPU buffer of <code>b</code>.</p></dd></dl><dl><dt class="spec value" id="val-gpu_exists"><a href="#val-gpu_exists" class="anchor"></a><code><span class="keyword">val </span>gpu_exists : <a href="../index.html#type-buf">buf</a> <span>&#45;&gt;</span> bool</code></dt><dd><p><code>gpu_exists b</code> is <code>true</code> if the GPU buffer of <code>b</code> exists.</p></dd></dl><dl><dt class="spec value" id="val-gpu_upload"><a href="#val-gpu_upload" class="anchor"></a><code><span class="keyword">val </span>gpu_upload : <a href="../index.html#type-buf">buf</a> <span>&#45;&gt;</span> bool</code></dt><dd><p><code>gpu_upload b</code> is <code>true</code> if the CPU scalars will uploaded to the GPU next time the renderer uses the buffer.</p></dd></dl><dl><dt class="spec value" id="val-set_gpu_upload"><a href="#val-set_gpu_upload" class="anchor"></a><code><span class="keyword">val </span>set_gpu_upload : <a href="../index.html#type-buf">buf</a> <span>&#45;&gt;</span> bool <span>&#45;&gt;</span> unit</code></dt><dd><p><code>set_gpu_upload b u</code> if <code>u</code> is <code>true</code> sets <code>b</code> to upload its CPU buffer to the GPU buffer next time the renderer sees the buffer.</p><p><b>Warning</b> If <a href="index.html#val-cpu"><code>cpu</code></a> is <code>None</code> at the time of upload this will zero any existing data on the GPU buffer.</p></dd></dl><dl><dt class="spec value" id="val-sync_gpu_to_cpu"><a href="#val-sync_gpu_to_cpu" class="anchor"></a><code><span class="keyword">val </span>sync_gpu_to_cpu : <a href="../index.html#type-renderer">renderer</a> <span>&#45;&gt;</span> <a href="../index.html#type-buf">buf</a> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>gpu_to_cpu r b</code> reads back <code>b</code>'s GPU buffer into <code>b</code>'s CPU buffer. A CPU buffer is created in none existed yet or if the size of the CPU buffer is different from the size of the GPU buffer.</p><dl><dt>raises Invalid_argument</dt><dd><p>if <a href="index.html#val-gpu_exists"><code>Buf.gpu_exists</code></a> is <code>false</code>.</p></dd></dl></dd></dl><section><header><h3 id="mapping-the-gpu-buffer-in-cpu"><a href="#mapping-the-gpu-buffer-in-cpu" class="anchor"></a>Mapping the GPU buffer in CPU</h3></header><dl><dt class="spec value" id="val-gpu_map"><a href="#val-gpu_map" class="anchor"></a><code><span class="keyword">val </span>gpu_map : <a href="../index.html#type-renderer">renderer</a> <span>&#45;&gt;</span> [ `R<span class="keyword"> | </span>`W<span class="keyword"> | </span>`RW ] <span>&#45;&gt;</span> <a href="../index.html#type-buf">buf</a> <span>&#45;&gt;</span> (<span class="type-var">'a</span>, <span class="type-var">'b</span>) Gg.Ba.ba_scalar_type <span>&#45;&gt;</span> (<span class="type-var">'a</span>, <span class="type-var">'b</span>) Gg.bigarray</code></dt><dd><p><code>gpu_map r access b st</code> maps the GPU buffer of <code>b</code> with access <code>access</code>.</p><p><b>Warning.</b> A mapped buffer cannot be used in a render operation, you need to <code>unmap</code> it first. Once unmapped the bigarray becomes invalid. Don't try to access it, it may result in program termination.</p><dl><dt>raises Invalid_argument</dt><dd><p>if <code>st</code> does not match <code>buf</code>'s scalar type.</p></dd></dl></dd></dl><dl><dt class="spec value" id="val-gpu_unmap"><a href="#val-gpu_unmap" class="anchor"></a><code><span class="keyword">val </span>gpu_unmap : <a href="../index.html#type-renderer">renderer</a> <span>&#45;&gt;</span> <a href="../index.html#type-buf">buf</a> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>gpu_unmap r b</code> unmaps the buffer <code>b</code>.</p><p><b>Warning.</b> This invalidates the memory pointed to by the bigarray returned by <a href="index.html#val-gpu_map"><code>gpu_map</code></a> or <code>gpu_map_buffer</code>, do not try to access it after this function has been called it may result in program termination.</p></dd></dl></section></section><section><header><h2 id="cpu-buffer"><a href="#cpu-buffer" class="anchor"></a>CPU buffer</h2></header><dl><dt class="spec value" id="val-cpu_count"><a href="#val-cpu_count" class="anchor"></a><code><span class="keyword">val </span>cpu_count : <a href="../index.html#type-buf">buf</a> <span>&#45;&gt;</span> int</code></dt><dd><p><code>cpu_count b</code> is the number of scalars in the CPU buffer of <code>b</code>.</p></dd></dl><dl><dt class="spec value" id="val-cpu_exists"><a href="#val-cpu_exists" class="anchor"></a><code><span class="keyword">val </span>cpu_exists : <a href="../index.html#type-buf">buf</a> <span>&#45;&gt;</span> bool</code></dt><dd><p><code>cpu_exists b</code> is <code>true</code> if the CPU buffer of <code>b</code> exists.</p></dd></dl><dl><dt class="spec value" id="val-cpu"><a href="#val-cpu" class="anchor"></a><code><span class="keyword">val </span>cpu : <a href="../index.html#type-buf">buf</a> <span>&#45;&gt;</span> (<span class="type-var">'a</span>, <span class="type-var">'b</span>) Gg.Ba.ba_scalar_type <span>&#45;&gt;</span> (<span class="type-var">'a</span>, <span class="type-var">'b</span>) Gg.bigarray option</code></dt><dd><p><code>cpu b st</code> is the CPU buffer of <code>b</code> (if any).</p><p><b>Note.</b> If you want changes you made to the buffer to be picked up by the GPU side buffer you must call <a href="index.html#val-set_gpu_upload"><code>set_gpu_upload</code></a>.</p><dl><dt>raises Invalid_argument</dt><dd><p>if scalar type <code>st</code> is not the scalar type of <code>b</code>.</p></dd></dl></dd></dl><dl><dt class="spec value" id="val-cpu_buffer"><a href="#val-cpu_buffer" class="anchor"></a><code><span class="keyword">val </span>cpu_buffer : <a href="../index.html#type-buf">buf</a> <span>&#45;&gt;</span> Gg.buffer option</code></dt><dd><p><code>cpu_buffer</code> is like <a href="index.html#val-cpu"><code>cpu</code></a> but returns a <span class="xref-unresolved" title="unresolved reference to &quot;Gg.buffer&quot;"><code>Gg</code>.buffer</span> value.</p></dd></dl><dl><dt class="spec value" id="val-get_cpu"><a href="#val-get_cpu" class="anchor"></a><code><span class="keyword">val </span>get_cpu : <a href="../index.html#type-buf">buf</a> <span>&#45;&gt;</span> (<span class="type-var">'a</span>, <span class="type-var">'b</span>) Gg.Ba.ba_scalar_type <span>&#45;&gt;</span> (<span class="type-var">'a</span>, <span class="type-var">'b</span>) Gg.bigarray</code></dt><dd><p><code>get_cpu b st</code> is <code>cpu b st</code> but raises if there's no cpu buffer.</p><dl><dt>raises Invalid_argument</dt><dd><p>if <code>cpu b st</code> raises or if <code>cpu_exists b</code> is <code>false</code>.</p></dd></dl></dd></dl><dl><dt class="spec value" id="val-get_cpu_buffer"><a href="#val-get_cpu_buffer" class="anchor"></a><code><span class="keyword">val </span>get_cpu_buffer : <a href="../index.html#type-buf">buf</a> <span>&#45;&gt;</span> Gg.buffer</code></dt><dd><p><code>get_cpu_buffer</code> is like <a href="index.html#val-get_cpu"><code>get_cpu</code></a> but returns a <span class="xref-unresolved" title="unresolved reference to &quot;Gg.buffer&quot;"><code>Gg</code>.buffer</span> value</p></dd></dl><dl><dt class="spec value" id="val-set_cpu"><a href="#val-set_cpu" class="anchor"></a><code><span class="keyword">val </span>set_cpu : <a href="../index.html#type-buf">buf</a> <span>&#45;&gt;</span> (<span class="type-var">'a</span>, <span class="type-var">'b</span>) Gg.bigarray option <span>&#45;&gt;</span> unit</code></dt><dd><p><code>set_cpu b ba</code> sets the CPU buffer of <code>b</code> to <code>ba</code>.</p><p><b>Note.</b> If you want changes to the scalars to be picked up by the GPU side buffer you must call <a href="index.html#val-set_gpu_upload"><code>set_gpu_upload</code></a>.</p><dl><dt>raises Invalid_argument</dt><dd><p>if the bigarray kind of <code>b</code> is not compatible with the scalar type of <code>b</code>.</p></dd></dl></dd></dl><dl><dt class="spec value" id="val-set_cpu_buffer"><a href="#val-set_cpu_buffer" class="anchor"></a><code><span class="keyword">val </span>set_cpu_buffer : <a href="../index.html#type-buf">buf</a> <span>&#45;&gt;</span> Gg.buffer option <span>&#45;&gt;</span> unit</code></dt><dd><p><code>set_cpu_buffer</code> is like <a href="index.html#val-set_cpu"><code>set_cpu</code></a> but uses a <span class="xref-unresolved" title="unresolved reference to &quot;Gg.buffer&quot;"><code>Gg</code>.buffer</span> value.</p></dd></dl><dl><dt class="spec value" id="val-cpu_autorelease"><a href="#val-cpu_autorelease" class="anchor"></a><code><span class="keyword">val </span>cpu_autorelease : <a href="../index.html#type-buf">buf</a> <span>&#45;&gt;</span> bool</code></dt><dd><p><code>cpu_autorelease buf</code> is <code>true</code> if the CPU buffer is set to <code>None</code> once uploaded to the GPU.</p></dd></dl><dl><dt class="spec value" id="val-set_cpu_autorelease"><a href="#val-set_cpu_autorelease" class="anchor"></a><code><span class="keyword">val </span>set_cpu_autorelease : <a href="../index.html#type-buf">buf</a> <span>&#45;&gt;</span> bool <span>&#45;&gt;</span> unit</code></dt><dd><p><code>set_cpu_autorelease b bool</code> sets the autorelease behaviour to <code>bool</code>.</p></dd></dl><dl><dt class="spec value" id="val-sync_cpu_to_gpu"><a href="#val-sync_cpu_to_gpu" class="anchor"></a><code><span class="keyword">val </span>sync_cpu_to_gpu : <a href="../index.html#type-renderer">renderer</a> <span>&#45;&gt;</span> <a href="../index.html#type-buf">buf</a> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>sync_cpu_to_gpu r b</code> uploads the CPU buffer of <code>b</code> to the GPU buffer. A GPU buffer is created if none existed yet.</p><dl><dt>raises Invalid_argument</dt><dd><p>if <a href="index.html#val-cpu_exists"><code>Buf.cpu_exists</code></a> is <code>false</code>.</p></dd></dl></dd></dl></section></div></body></html>