<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Lwt_main (lwt.Lwt_main)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../index.html">lwt</a> &#x00BB; Lwt_main</nav><h1>Module <code>Lwt_main</code></h1><p>Main loop and event queue</p></header><aside><p>This module controls the ``main-loop'' of Lwt.</p></aside><dl><dt class="spec value" id="val-run"><a href="#val-run" class="anchor"></a><code><span class="keyword">val </span>run : <span class="type-var">'a</span> Lwt.t <span>&#45;&gt;</span> <span class="type-var">'a</span></code></dt><dd><p><code>run p</code> calls the Lwt scheduler repeatedly until <code>p</code> resolves, and returns the value of <code>p</code> if it is fulfilled. If <code>p</code> is rejected with an exception, that exception is raised.</p><p>Every native or bytecode program that uses Lwt should always use this function for evaluating a promise at the top level (such as its main function or main loop), otherwise promises that depend on I/O operations will not be resolved.</p><p>Example:</p><pre><code class="ml">let main () = Lwt_io.write_line Lwt_io.stdout &quot;hello world&quot;

let () = Lwt_main.run @@ main ()</code></pre><p>When targeting JavaScript, <code>Lwt_main.run</code> is not available, but neither it's necessary since the JS environment automatically takes care of the I/O considerations.</p><p>Note that you should avoid using <code>run</code> inside threads</p><ul><li>The calling threads will not resume before <code>run</code> returns.</li><li>Successive invocations of <code>run</code> are serialized: an invocation of <code>run</code> will not terminate before all subsequent invocations are terminated.</li></ul><p>Note also that it is not safe to call <code>run</code> in a function registered with <code>Pervasives.at_exit</code>, use the <a href="index.html#val-at_exit"><code>at_exit</code></a> function of this module instead.</p></dd></dl><dl><dt class="spec value" id="val-yield"><a href="#val-yield" class="anchor"></a><code><span class="keyword">val </span>yield : unit <span>&#45;&gt;</span> unit Lwt.t</code></dt><dd><p><code>yield ()</code> is a threads which suspends itself and then resumes as soon as possible and terminates.</p></dd></dl><dl><dt class="spec value" id="val-enter_iter_hooks"><a href="#val-enter_iter_hooks" class="anchor"></a><code><span class="keyword">val </span>enter_iter_hooks : (unit <span>&#45;&gt;</span> unit) Lwt_sequence.t</code></dt><dd><p>Functions that are called before the main iteration.</p></dd></dl><dl><dt class="spec value" id="val-leave_iter_hooks"><a href="#val-leave_iter_hooks" class="anchor"></a><code><span class="keyword">val </span>leave_iter_hooks : (unit <span>&#45;&gt;</span> unit) Lwt_sequence.t</code></dt><dd><p>Functions that are called after the main iteration.</p></dd></dl><dl><dt class="spec value" id="val-exit_hooks"><a href="#val-exit_hooks" class="anchor"></a><code><span class="keyword">val </span>exit_hooks : (unit <span>&#45;&gt;</span> unit Lwt.t) Lwt_sequence.t</code></dt><dd><p>Sets of functions executed just before the program exit.</p><p>Notes:</p><ul><li>each hook is called exactly one time</li><li>exceptions raised by hooks are ignored</li></ul></dd></dl><dl><dt class="spec value" id="val-at_exit"><a href="#val-at_exit" class="anchor"></a><code><span class="keyword">val </span>at_exit : (unit <span>&#45;&gt;</span> unit Lwt.t) <span>&#45;&gt;</span> unit</code></dt><dd><p><code>at_exit hook</code> adds hook at the left of <code>exit_hooks</code></p></dd></dl></div></body></html>