<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Lwt_daemon (lwt_log.Lwt_daemon)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../index.html">lwt_log</a> &#x00BB; Lwt_daemon</nav><h1>Module <code>Lwt_daemon</code></h1><p>Daemon helpers</p></header><dl><dt class="spec value" id="val-daemonize"><a href="#val-daemonize" class="anchor"></a><code><span class="keyword">val </span>daemonize : ?&#8288;syslog:bool <span>&#45;&gt;</span> ?&#8288;stdin:[ `Dev_null<span class="keyword"> | </span>`Close<span class="keyword"> | </span>`Keep ] <span>&#45;&gt;</span> ?&#8288;stdout:[ `Dev_null<span class="keyword"> | </span>`Close<span class="keyword"> | </span>`Keep<span class="keyword"> | </span>`Log_default<span class="keyword"> | </span>`Log of Lwt_log.logger ] <span>&#45;&gt;</span> ?&#8288;stderr:[ `Dev_null<span class="keyword"> | </span>`Close<span class="keyword"> | </span>`Keep<span class="keyword"> | </span>`Log_default<span class="keyword"> | </span>`Log of Lwt_log.logger ] <span>&#45;&gt;</span> ?&#8288;directory:string <span>&#45;&gt;</span> ?&#8288;umask:[ `Keep<span class="keyword"> | </span>`Set of int ] <span>&#45;&gt;</span> unit <span>&#45;&gt;</span> unit</code></dt><dd><p>Put the current running process into daemon mode. I.e. it forks and exit the parent, detach it from its controlling terminal, and redict standard intputs/outputs..</p><p>Notes:</p><ul><li>you must be sure that there is no pending threads when calling this function, otherwise they may be canceled.</li></ul><p>If <code>syslog</code> is <code>true</code> (the default), then <span class="xref-unresolved" title="unresolved reference to &quot;Lwt_log.default&quot;"><code>Lwt_log</code>.default</span> is set to <code>Lwt_log.syslog ~facility:`Daemon ()</code>, otherwise it is kept unchanged.</p><p><code>stdin</code> is one of:</p><ul><li><code>`Dev_null</code> which means that <code>Unix.stdin</code> is reopened as <code>/dev/null</code>, this is the default behavior</li><li><code>`Close</code> means that <code>Unix.stdin</code> is simply closed</li><li><code>`Keep</code> means that <code>Unix.stdin</code> is left unchanged</li></ul><p><code>stdout</code> and <code>stderr</code> control how the two associated file descriptors are redirected:</p><ul><li><code>`Dev_null</code> means that the output is redirected to <code>/dev/null</code></li><li><code>`Close</code> means that the file descriptor is closed</li><li><code>`Keep</code> means that it is left unchanged</li><li><code>`Log logger</code> means that the output is redirected to this logger</li><li><code>`Log_default</code> means that the output is redirected to the default logger</li></ul><p>Both <code>stdout</code> and <code>stderr</code> default to <code>`Log_default</code>.</p><p>Warning: do not redirect an output to a logger logging into this output. For example, this code will create an infinite loop:</p><pre><code class="ml">let logger = Lwt_log.channel ~close_mode:`Keep ~channel:Lwt_io.stderr () in
Lwt_daemon.daemonize ~syslog:false ~stderr:(`Log logger) ();
prerr_endline &quot;foo&quot;</code></pre><p>The current working directory is set to <code>directory</code>, which defaults to <code>&quot;/&quot;</code>.</p><p><code>umask</code> may be one of:</p><ul><li><code>`Keep</code> which means that the umask is left unchanged</li><li><code>`Set n</code> which means that the umask is set to <code>n</code></li></ul><p>It defaults to <code>`Set 0o022</code>.</p></dd></dl></div></body></html>