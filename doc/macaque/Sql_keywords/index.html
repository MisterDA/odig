<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Sql_keywords (macaque.Sql_keywords)</title><link rel="stylesheet" href="../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../index.html">macaque</a> &#x00BB; Sql_keywords</nav><h1>Module <code>Sql_keywords</code></h1></header><dl><dt class="spec type" id="type-reserved_keyword_status"><a href="#type-reserved_keyword_status" class="anchor"></a><code><span class="keyword">type</span> reserved_keyword_status</code><code> = </code><code>{</code><table class="record"><tr id="type-reserved_keyword_status.reserved_in_sql2003" class="anchored"><td class="def field"><a href="#type-reserved_keyword_status.reserved_in_sql2003" class="anchor"></a><code>reserved_in_sql2003 : bool;</code></td></tr><tr id="type-reserved_keyword_status.reserved_in_postgresql" class="anchored"><td class="def field"><a href="#type-reserved_keyword_status.reserved_in_postgresql" class="anchor"></a><code>reserved_in_postgresql : bool;</code></td></tr></table><code>}</code></dt><dd><p>Most lowercase identifier are perfectly fine as far as Macaque is concerned, but some may fail at &quot;sql query generation time&quot; because they turn out to be SQL reserved keywords. This runtime failure has been reported by Vincent Valat.</p><p>We here have a list of SQL keywords and are careful to warn the user when one is used, and to &quot;escape&quot; it into a non-reserved identifier.</p><p>Macaque currently only supports PostgreSQL, so it would make sense to care about PostgreSQL reserved keywords only, but this will hopefully change someday in the future so I decided to also consider reserved keywords as defined in the 2003 SQL standard.</p></dd></dl><dl><dt class="spec value" id="val-reserved_keywords"><a href="#val-reserved_keywords" class="anchor"></a><code><span class="keyword">val</span> reserved_keywords : (string * <a href="index.html#type-reserved_keyword_status">reserved_keyword_status</a>) list</code></dt><dt class="spec value" id="val-normalize_keyword_case"><a href="#val-normalize_keyword_case" class="anchor"></a><code><span class="keyword">val</span> normalize_keyword_case : string <span>&#45;&gt;</span> string</code></dt><dd><p>SQL compatibility warning:</p><p>We are going to &quot;quote&quot; identifiers that correspond to reserved keywords, so that the query still stays syntactically correct. An issue with automatic quoting is that quoted identifiers, beside being allowed to contain reserved words, are taken in a case-sensitive manner while the rest of SQL is case-insensitive, in the sense that they are implicitly normalized by the SQL server.</p><p>Now there are funny problem that may arise with this: if you define a table as tAbLe, it will internally be define as TABLE (if normalized to uppercase) on the server side, and requesting the table &quot;tAbLe&quot; will then fail with a &quot;table not found&quot; error.</p><p>Our choice is therefore to case-normalize reserved identifiers before quoting them.</p><p>Finally, PostGreSQL does not follow the SQL norm of normalizing identifiers to uppercase, it instead normalizes to lowercase. As long as Macaque is pgsql-only, we choose lowercase here, but that will have to be runtime-configurable in a hopeful future where Macaque gets ported to other backends.</p></dd></dl><dl><dt class="spec value" id="val-keyword_safe"><a href="#val-keyword_safe" class="anchor"></a><code><span class="keyword">val</span> keyword_safe : string <span>&#45;&gt;</span> string</code></dt><dd><p>It is rather awkward to protect SQL identifiers here, at the parser level. It would make more sense to preserve the user-input identifier as far as possible, that is upto the SQL query generation. However, this would require sharing the keyword-base code between the Camlp4 extension (which needs to have it to generate the warnings) and the output code, which is rather awkward to do with the .cmo loading scheme used for Camlp4 extensions. Doing everything in the extension is just more convenient.</p></dd></dl></div></body></html>