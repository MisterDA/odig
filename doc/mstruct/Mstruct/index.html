<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Mstruct (mstruct.Mstruct)</title><link rel="stylesheet" href="../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – <a href="../index.html">mstruct</a> &#x00BB; Mstruct</nav><h1>Module <code>Mstruct</code></h1><p>Mutable byte windows on top of Cstruct bigarrays</p><nav class="toc"><ul><li><a href="#errors">Errors</a></li><li><a href="#setters">Setters</a></li><li><a href="#little-endian">Little endian</a></li><li><a href="#bigarrays">Bigarrays</a></li><li><a href="#cstructs">Cstructs</a></li></ul></nav></header><dl><dt class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> t</code></dt><dd><p>Type for mutable windows on top of bigarrays, with bounds automatically updated when values are read/write in the buffer.</p></dd></dl><dl><dt class="spec value" id="val-create"><a href="#val-create" class="anchor"></a><code><span class="keyword">val</span> create : int <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></dt><dd><p>Create a new buffer.</p></dd></dl><dl><dt class="spec value" id="val-of_string"><a href="#val-of_string" class="anchor"></a><code><span class="keyword">val</span> of_string : ?&#8288;allocator:(int <span>&#45;&gt;</span> <a href="../../cstruct/Cstruct/index.html#type-t">Cstruct.t</a>) <span>&#45;&gt;</span> string <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></dt><dd><p>Create a buffer from a string.</p></dd></dl><dl><dt class="spec value" id="val-to_string"><a href="#val-to_string" class="anchor"></a><code><span class="keyword">val</span> to_string : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> string</code></dt><dd><p>Create a string from a buffer.</p></dd></dl><dl><dt class="spec value" id="val-length"><a href="#val-length" class="anchor"></a><code><span class="keyword">val</span> length : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> int</code></dt><dd><p>Get the buffer length.</p></dd></dl><dl><dt class="spec value" id="val-offset"><a href="#val-offset" class="anchor"></a><code><span class="keyword">val</span> offset : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> int</code></dt><dd><p>Get the buffer offset.</p></dd></dl><dl><dt class="spec value" id="val-sub"><a href="#val-sub" class="anchor"></a><code><span class="keyword">val</span> sub : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> int <span>&#45;&gt;</span> int <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></dt><dd><p>Return a sub-window of the given buffer window.</p></dd></dl><dl><dt class="spec value" id="val-clone"><a href="#val-clone" class="anchor"></a><code><span class="keyword">val</span> clone : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></dt><dd><p>Clone the window buffer (the actual contents is still shared).</p></dd></dl><dl><dt class="spec value" id="val-shift"><a href="#val-shift" class="anchor"></a><code><span class="keyword">val</span> shift : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> int <span>&#45;&gt;</span> unit</code></dt><dd><p>Shift the buffer window. Negative offsets are supported.</p></dd></dl><dl><dt class="spec value" id="val-index"><a href="#val-index" class="anchor"></a><code><span class="keyword">val</span> index : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> char <span>&#45;&gt;</span> int option</code></dt><dd><p>Return the offset corresponding to the first occurence of the character in the given string.</p></dd></dl><section><header><h3 id="errors"><a href="#errors" class="anchor"></a>Errors</h3></header><dl><dt class="spec exception" id="exception-Parse_error"><a href="#exception-Parse_error" class="anchor"></a><code><span class="keyword">exception</span> </code><code><span class="exception">Parse_error</span> <span class="keyword">of</span> string</code></dt><dd><p>Parse error</p></dd></dl><dl><dt class="spec value" id="val-parse_error_buf"><a href="#val-parse_error_buf" class="anchor"></a><code><span class="keyword">val</span> parse_error_buf : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> (<span class="type-var">'a</span>, unit, string, <span class="type-var">'b</span>) <a href="../../ocaml/Stdlib/index.html#type-format4">Stdlib.format4</a> <span>&#45;&gt;</span> <span class="type-var">'a</span></code></dt><dd><p>Print an error message, the buffer contents and raise a exception</p></dd></dl><dl><dt class="spec value" id="val-parse_error"><a href="#val-parse_error" class="anchor"></a><code><span class="keyword">val</span> parse_error : (<span class="type-var">'a</span>, unit, string, <span class="type-var">'b</span>) <a href="../../ocaml/Stdlib/index.html#type-format4">Stdlib.format4</a> <span>&#45;&gt;</span> <span class="type-var">'a</span></code></dt><dd><p>Print an error message and raise an exception</p></dd></dl><dl><dt class="spec value" id="val-hexdump"><a href="#val-hexdump" class="anchor"></a><code><span class="keyword">val</span> hexdump : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> unit</code></dt><dd><p>Same as <code>Cstruct.hexdump</code>.</p></dd></dl><dl><dt class="spec value" id="val-hexdump_to_buffer"><a href="#val-hexdump_to_buffer" class="anchor"></a><code><span class="keyword">val</span> hexdump_to_buffer : <a href="../../ocaml/Stdlib/Buffer/index.html#type-t">Stdlib.Buffer.t</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> unit</code></dt><dd><p>Same as <code>Cstruct.hexdump_to_buffer</code></p></dd></dl><dl><dt class="spec value" id="val-debug"><a href="#val-debug" class="anchor"></a><code><span class="keyword">val</span> debug : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> string</code></dt><dd><p>Same as <code>Cstruct.debug</code>.</p></dd></dl><aside><p><code>Basic IO operations</code></p></aside><aside><p>Get/set big-endian integers of various sizes.</p></aside><dl><dt class="spec value" id="val-get_char"><a href="#val-get_char" class="anchor"></a><code><span class="keyword">val</span> get_char : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> char</code></dt><dd><p><code>get_char buf</code> return the character stored in <code>buf</code>.</p></dd></dl><dl><dt class="spec value" id="val-get_uint8"><a href="#val-get_uint8" class="anchor"></a><code><span class="keyword">val</span> get_uint8 : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> int</code></dt><dd><p><code>get_uint8 buf</code> is the 8 bit unsigned integer stored in <code>buf</code>.</p></dd></dl><dl><dt class="spec value" id="val-get_be_uint16"><a href="#val-get_be_uint16" class="anchor"></a><code><span class="keyword">val</span> get_be_uint16 : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> int</code></dt><dd><p><code>get_uint16 buf</code> is the 16 bit long big-endian unsigned integer stored in <code>buf</code>.</p></dd></dl><dl><dt class="spec value" id="val-get_be_uint32"><a href="#val-get_be_uint32" class="anchor"></a><code><span class="keyword">val</span> get_be_uint32 : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> int32</code></dt><dd><p><code>get_uint32 buf</code> is the 32 bit long big-endian unsigned integer stored in <code>buf</code>.</p></dd></dl><dl><dt class="spec value" id="val-get_be_uint64"><a href="#val-get_be_uint64" class="anchor"></a><code><span class="keyword">val</span> get_be_uint64 : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> int64</code></dt><dd><p><code>get_uint64 buf</code> is the 64 bit long big-endian unsigned integer stored in <code>buf</code>.</p></dd></dl><dl><dt class="spec value" id="val-get_string"><a href="#val-get_string" class="anchor"></a><code><span class="keyword">val</span> get_string : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> int <span>&#45;&gt;</span> string</code></dt><dd><p><code>get_string buf len</code> is the string of size <code>len</code> stored in <code>buf</code>.</p></dd></dl><dl><dt class="spec value" id="val-pick_string"><a href="#val-pick_string" class="anchor"></a><code><span class="keyword">val</span> pick_string : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> int <span>&#45;&gt;</span> string option</code></dt><dd><p><code>pick_string buf len</code> looks for the string of size <code>len</code> in the buffer, without consuming it. Return <code>None</code> if the buffer is bigger than <code>len</code>.</p></dd></dl><dl><dt class="spec value" id="val-get_delim"><a href="#val-get_delim" class="anchor"></a><code><span class="keyword">val</span> get_delim : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> char <span>&#45;&gt;</span> (<a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span>) <span>&#45;&gt;</span> <span class="type-var">'a</span> option</code></dt><dd><p><code>get_delim buf c fn</code> builds a subwindow of <code>buf</code> by looking at the first occurence of the character <code>c</code>. Once the window is built, apply <code>fn</code> on the resulting buffer. Return <code>None</code> if <code>c</code> does not appear in the current buffer.</p></dd></dl><dl><dt class="spec value" id="val-get_string_delim"><a href="#val-get_string_delim" class="anchor"></a><code><span class="keyword">val</span> get_string_delim : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> char <span>&#45;&gt;</span> string option</code></dt><dd><p><code>get_string_delim buf c</code> returns the string appearing between the start of the buffer <code>buf</code> and ending at the first occurence of the character <code>c</code>. Return <code>None</code> if <code>c</code> does not appear in <code>buf</code>.</p></dd></dl></section><section><header><h3 id="setters"><a href="#setters" class="anchor"></a>Setters</h3></header><dl><dt class="spec value" id="val-set_char"><a href="#val-set_char" class="anchor"></a><code><span class="keyword">val</span> set_char : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> char <span>&#45;&gt;</span> unit</code></dt><dd><p><code>set_char buf off c</code> write the character <code>c</code> in <code>buf</code> at offset <code>off</code>.</p></dd></dl><dl><dt class="spec value" id="val-set_uint8"><a href="#val-set_uint8" class="anchor"></a><code><span class="keyword">val</span> set_uint8 : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> int <span>&#45;&gt;</span> unit</code></dt><dd><p><code>set_uint8 buf</code> write the 8 bit long integer stored in <code>buf</code>.</p></dd></dl><dl><dt class="spec value" id="val-set_be_uint16"><a href="#val-set_be_uint16" class="anchor"></a><code><span class="keyword">val</span> set_be_uint16 : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> int <span>&#45;&gt;</span> unit</code></dt><dd><p><code>set_uint16 buf i</code> writes the 16 bit long big-endian unsigned integer <code>i</code> in <code>buf</code>.</p></dd></dl><dl><dt class="spec value" id="val-set_be_uint32"><a href="#val-set_be_uint32" class="anchor"></a><code><span class="keyword">val</span> set_be_uint32 : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> int32 <span>&#45;&gt;</span> unit</code></dt><dd><p><code>set_uint32 buf i</code> writes the 32 bit long big-endian unsigned integer <code>i</code> in <code>buf</code>.</p></dd></dl><dl><dt class="spec value" id="val-set_be_uint64"><a href="#val-set_be_uint64" class="anchor"></a><code><span class="keyword">val</span> set_be_uint64 : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> int64 <span>&#45;&gt;</span> unit</code></dt><dd><p><code>set_uint64 buf i</code> writes the 64 bit long big-endian unsigned integer <code>i</code> in <code>buf</code>.</p></dd></dl><dl><dt class="spec value" id="val-set_string"><a href="#val-set_string" class="anchor"></a><code><span class="keyword">val</span> set_string : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> unit</code></dt><dd><p><code>set_string buf str</code> write the string <code>str</code> into <code>buf</code>.</p></dd></dl></section><section><header><h3 id="little-endian"><a href="#little-endian" class="anchor"></a>Little endian</h3></header><dl><dt class="spec value" id="val-get_le_uint16"><a href="#val-get_le_uint16" class="anchor"></a><code><span class="keyword">val</span> get_le_uint16 : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> int</code></dt><dd><p><code>get_uint16 buf</code> is the 16 bit long little-endian unsigned integer stored in <code>buf</code>.</p></dd></dl><dl><dt class="spec value" id="val-get_le_uint32"><a href="#val-get_le_uint32" class="anchor"></a><code><span class="keyword">val</span> get_le_uint32 : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> int32</code></dt><dd><p><code>get_uint32 buf</code> is the 32 bit long little-endian unsigned integer stored in <code>buf</code>.</p></dd></dl><dl><dt class="spec value" id="val-get_le_uint64"><a href="#val-get_le_uint64" class="anchor"></a><code><span class="keyword">val</span> get_le_uint64 : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> int64</code></dt><dd><p><code>get_uint64 buf</code> is the 64 bit long little-endian unsigned integer stored in <code>buf</code>.</p></dd></dl><dl><dt class="spec value" id="val-set_le_uint16"><a href="#val-set_le_uint16" class="anchor"></a><code><span class="keyword">val</span> set_le_uint16 : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> int <span>&#45;&gt;</span> unit</code></dt><dd><p><code>set_uint16 buf i</code> writes the 16 bit long little-endian unsigned integer <code>i</code> in <code>buf</code>.</p></dd></dl><dl><dt class="spec value" id="val-set_le_uint32"><a href="#val-set_le_uint32" class="anchor"></a><code><span class="keyword">val</span> set_le_uint32 : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> int32 <span>&#45;&gt;</span> unit</code></dt><dd><p><code>set_uint32 buf i</code> writes the 32 bit long little-endian unsigned integer <code>i</code> in <code>buf</code>.</p></dd></dl><dl><dt class="spec value" id="val-set_le_uint64"><a href="#val-set_le_uint64" class="anchor"></a><code><span class="keyword">val</span> set_le_uint64 : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> int64 <span>&#45;&gt;</span> unit</code></dt><dd><p><code>set_uint64 buf i</code> writes the 64 bit long little-endian unsigned integer <code>i</code> in <code>buf</code>.</p></dd></dl></section><section><header><h3 id="bigarrays"><a href="#bigarrays" class="anchor"></a>Bigarrays</h3></header><dl><dt class="spec value" id="val-of_bigarray"><a href="#val-of_bigarray" class="anchor"></a><code><span class="keyword">val</span> of_bigarray : ?&#8288;off:int <span>&#45;&gt;</span> ?&#8288;len:int <span>&#45;&gt;</span> <a href="../../cstruct/Cstruct/index.html#type-buffer">Cstruct.buffer</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></dt><dd><p><code>of_bigarray ~off ~len b</code> is the mstruct contained in <code>b</code> starting at <code>off</code>, of length <code>len</code>.</p></dd></dl><dl><dt class="spec value" id="val-to_bigarray"><a href="#val-to_bigarray" class="anchor"></a><code><span class="keyword">val</span> to_bigarray : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../../cstruct/Cstruct/index.html#type-buffer">Cstruct.buffer</a></code></dt><dd><p>Accessor. Return the underlying bigarray.</p></dd></dl></section><section><header><h3 id="cstructs"><a href="#cstructs" class="anchor"></a>Cstructs</h3></header><dl><dt class="spec value" id="val-of_cstruct"><a href="#val-of_cstruct" class="anchor"></a><code><span class="keyword">val</span> of_cstruct : <a href="../../cstruct/Cstruct/index.html#type-t">Cstruct.t</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></dt><dd><p>Create mutable cstruct.</p></dd></dl><dl><dt class="spec value" id="val-to_cstruct"><a href="#val-to_cstruct" class="anchor"></a><code><span class="keyword">val</span> to_cstruct : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../../cstruct/Cstruct/index.html#type-t">Cstruct.t</a></code></dt><dd><p>Create an immutable cstruct.</p></dd></dl><dl><dt class="spec value" id="val-with_mstruct"><a href="#val-with_mstruct" class="anchor"></a><code><span class="keyword">val</span> with_mstruct : <a href="../../cstruct/Cstruct/index.html#type-t">Cstruct.t</a> <span>&#45;&gt;</span> (<a href="index.html#type-t">t</a> <span>&#45;&gt;</span> unit) <span>&#45;&gt;</span> unit</code></dt><dd><p><code>with_mstruct c f</code> apply <code>f</code> to <code>of_cstruct c</code>.</p></dd></dl></section></div></body></html>