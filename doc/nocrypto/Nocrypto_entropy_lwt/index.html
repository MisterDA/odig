<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Nocrypto_entropy_lwt (nocrypto.Nocrypto_entropy_lwt)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../index.html">nocrypto</a> &#x00BB; Nocrypto_entropy_lwt</nav><h1>Module <code>Nocrypto_entropy_lwt</code></h1><p><b>RNG</b> seeding on <b>Lwt/Unix</b>.</p><p>This module provides RNG seeding from the Unix kernel RNG, typically</p><pre><code class="ml">/dev/urandom</code></pre><p>. It uses <code>Lwt</code> for periodic background reseeding.</p><p>Calling <a href="index.html#val-initialize"><span>initialize</span></a> is enough to bring the RNG into a working state. In addition, a background task is set up to periodically reseed the RNG.</p><p><code>initialize</code> is idempotent as long as the default generator is unchanged. It is harmless to call it several times.</p><p>Note that <code>initialize</code> returns a thread. While the reseeding task has only been created once this thread completes, the initial seeding is done before the function returns. Is is safe to use the RNG immediately after the invocation.</p><h2 id="usage"><a href="#usage" class="anchor"></a>Usage</h2><p>Seed during module initialization, not waiting for the background seeding to start:</p><pre><code class="ml">let _ = Nocrypto_entropy_lwt.initialize () </code></pre><p>Seed just before the main function, not waiting for the background seeding to start:</p><pre><code class="ml">let () =
  ignore (Nocrypto_entropy_lwt.initialize ());
  Lwt_main.run (main ()) </code></pre><p>Seed just before the main function, and wait for the background seeding to start before proceeding:</p><pre><code class="ml">let () =
  Lwt_main.run (Nocrypto_entropy_lwt.initialize () &gt;&gt;= main) </code></pre><nav class="toc"><ul><li><a href="#default-generator-initialization">Default generator initialization</a></li><li><a href="#background-seeding">Background seeding</a></li></ul></nav></header><section><header><h2 id="default-generator-initialization"><a href="#default-generator-initialization" class="anchor"></a>Default generator initialization</h2></header><dl><dt class="spec value" id="val-initialize"><a href="#val-initialize" class="anchor"></a><code><span class="keyword">val </span>initialize : unit <span>&#45;&gt;</span> unit Lwt.t</code></dt><dd><p>Immediately seeds the current defalt generator using <span class="xref-unresolved" title="unresolved reference to &quot;Nocrypto_entropy_unix.initialize&quot;"><code>Nocrypto_entropy_unix</code>.initialize</span>. The initial seeding is finished before the function returns.</p><p>It then invokes <a href="index.html#val-attach"><span>attach</span></a>. Once the returned thread completes, a background reseeding task has been attached to the defalt generator.</p></dd></dl></section><section><header><h2 id="background-seeding"><a href="#background-seeding" class="anchor"></a>Background seeding</h2></header><dl><dt class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><code><span class="keyword">type </span>t</code></dt><dd><p>Represents background reseeding task.</p></dd></dl><dl><dt class="spec value" id="val-attach"><a href="#val-attach" class="anchor"></a><code><span class="keyword">val </span>attach : period:int <span>&#45;&gt;</span> ?&#8288;device:string <span>&#45;&gt;</span> Nocrypto.Rng.g <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> Lwt.t</code></dt><dd><p><code>attach ~period ~device g</code> instruments the lwt event loop to mix in bytes from <code>device</code> into <code>g</code> whenever external events cause the loop to wake up, but no more often than once every <code>period</code> seconds.</p><p><code>device</code> defaults to <span class="xref-unresolved" title="unresolved reference to &quot;Nocrypto_entropy_unix.sys_rng&quot;"><code>Nocrypto_entropy_unix</code>.sys_rng</span>.</p></dd></dl><dl><dt class="spec value" id="val-stop"><a href="#val-stop" class="anchor"></a><code><span class="keyword">val </span>stop : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> unit Lwt.t</code></dt><dd><p>Stops the reseeding task associated with <code>t</code>. Idempotent.</p></dd></dl></section></div></body></html>