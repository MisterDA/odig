<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Closure_offsets (ocaml.Closure_offsets)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../index.html">ocaml</a> &#x00BB; Closure_offsets</nav><h1>Module <code>Closure_offsets</code></h1><p>Assign numerical offsets, within closure blocks, for code pointers and environment entries.</p></header><dl><dt class="spec type" id="type-result"><a href="#type-result" class="anchor"></a><code><span class="keyword">type </span>result</code><code><span class="keyword"> = </span><span class="keyword">private </span></code><code>{</code><table class="record"><tr id="type-result.function_offsets" class="anchored"><td class="def field"><a href="#type-result.function_offsets" class="anchor"></a><code>function_offsets : int Closure_id.Map.t;</code></td></tr><tr id="type-result.free_variable_offsets" class="anchored"><td class="def field"><a href="#type-result.free_variable_offsets" class="anchor"></a><code>free_variable_offsets : int Var_within_closure.Map.t;</code></td></tr></table><code>}</code></dt></dl><dl><dt class="spec value" id="val-compute"><a href="#val-compute" class="anchor"></a><code><span class="keyword">val </span>compute : Flambda.program <span>&#45;&gt;</span> <a href="index.html#type-result">result</a></code></dt><dt class="spec value" id="val-compute_reexported_offsets"><a href="#val-compute_reexported_offsets" class="anchor"></a><code><span class="keyword">val </span>compute_reexported_offsets : Flambda.program <span>&#45;&gt;</span> current_unit_offset_fun:int Closure_id.Map.t <span>&#45;&gt;</span> current_unit_offset_fv:int Var_within_closure.Map.t <span>&#45;&gt;</span> imported_units_offset_fun:int Closure_id.Map.t <span>&#45;&gt;</span> imported_units_offset_fv:int Var_within_closure.Map.t <span>&#45;&gt;</span> int Closure_id.Map.t<span class="keyword"> * </span>int Var_within_closure.Map.t</code></dt><dd><p>If compilation unit <code>C</code> references <code>B</code>, which contains functions inlined from another compilation unit <code>A</code>, then we may need to know the layout of closures inside (or constructed by code inside) a.cmx in order to compile c.cmx. Unfortunately a.cmx is permitted to be absent during such compilation; c.cmx will be compiled using just b.cmx. As such, when building the .cmx export information for a given compilation unit, we also include information about the layout of any closures that it depends on from other compilation units. This means that when situations as just describe arise, we always have access to the necessary closure offsets.</p></dd></dl></div></body></html>