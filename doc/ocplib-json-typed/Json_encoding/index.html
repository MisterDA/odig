<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Json_encoding (ocplib-json-typed.Json_encoding)</title><link rel="stylesheet" href="../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../index.html">ocplib-json-typed</a> &#x00BB; Json_encoding</nav><h1>Module <code>Json_encoding</code></h1><p>JSON structure description using dependently typed combinators.</p><nav class="toc"><ul><li><a href="#dependent-types-describing-json-document-structures">Dependent types describing JSON document structures</a></li><li><a href="#constructors-and-destructors-for-">Constructors and destructors for <em></em></a></li><li><a href="#json-type-combinators-for-simple-immediates">JSON type combinators for simple immediates</a></li><li><a href="#json-type-combinators-for-objects">JSON type combinators for objects</a></li><li><a href="#json-type-combinators-for-arrays">JSON type combinators for arrays</a></li><li><a href="#json-type-combinators-for-unions">JSON type combinators for unions</a></li><li><a href="#json-generic-type-combinators">JSON generic type combinators</a></li><li><a href="#exporting-encodings-as-json-schemas">Exporting <code>encoding</code>s as JSON schemas</a></li><li><a href="#errors">Errors</a></li><li><a href="#advanced-interface-for-using-a-custom-json-representation">Advanced interface for using a custom JSON representation</a></li></ul></nav></header><section><header><h3 id="dependent-types-describing-json-document-structures"><a href="#dependent-types-describing-json-document-structures" class="anchor"></a>Dependent types describing JSON document structures</h3></header><dl><dt class="spec type" id="type-encoding"><a href="#type-encoding" class="anchor"></a><code><span class="keyword">type</span> 'a encoding</code></dt><dd><p>An encoding between an OCaml data type (the parameter) and a JSON representation. To be built using the predefined combinators provided by this module.</p><p>For instance, here is an encoding, of type <code>(int * string)
    encoding</code>, mapping values of type <code>int * string</code> to JSON objects with a field <code>code</code> of whose value is a number and a field <code>message</code> whose value is a string.</p><p><code>let enc = obj2 (req &quot;code&quot; int) (req &quot;message&quot; string)</code></p><p>This encoding serves three purposes:</p><p>1. Output an OCaml value of type <code>'a</code> to an intermediate JSON representation using <a href="index.html#val-construct"><code>construct</code></a>. To be printed to actual JSON using an external library. 2. Input a JSON intermediate structure (already parsed with an external library) to produce an OCaml value of type <code>'a</code>. 3. Describe this encoding in JSON-schema format for inter-operability: you describe the encoding of your internal types, and obtain machine-readable descriptions of the formats as a byproduct. Specific documentation combinators are provided for that purpose.</p><p>By default, this library provides functions that work on the <a href="../Json_repr/index.html#type-ezjsonm"><code>Json_repr.ezjsonm</code></a> data type, compatible with <span class="xref-unresolved" title="unresolved reference to &quot;Ezjsonm.value&quot;"><code>Ezjsonm</code>.value</span>. However, encodings are not tied with this representation. See functor <a href="Make/index.html"><code>Make</code></a> and module <a href="../Json_repr/index.html"><code>Json_repr</code></a> for using another format.</p></dd></dl></section><section><header><h3 id="constructors-and-destructors-for-"><a href="#constructors-and-destructors-for-" class="anchor"></a>Constructors and destructors for <em></em></h3></header><dl><dt class="spec value" id="val-construct"><a href="#val-construct" class="anchor"></a><code><span class="keyword">val</span> construct : <span class="type-var">'t</span> <a href="index.html#type-encoding">encoding</a> <span>&#45;&gt;</span> <span class="type-var">'t</span> <span>&#45;&gt;</span> <a href="../Json_repr/index.html#type-ezjsonm">Json_repr.ezjsonm</a></code></dt><dd><p>Builds a json value from an OCaml value and an encoding.</p><p>This function works with JSON data represented in the <a href="../Json_repr/index.html#type-ezjsonm"><code>Json_repr.ezjsonm</code></a> format. See functor <a href="Make/index.html"><code>Make</code></a> for using another representation.</p></dd></dl><dl><dt class="spec value" id="val-destruct"><a href="#val-destruct" class="anchor"></a><code><span class="keyword">val</span> destruct : <span class="type-var">'t</span> <a href="index.html#type-encoding">encoding</a> <span>&#45;&gt;</span> <a href="../Json_repr/index.html#type-ezjsonm">Json_repr.ezjsonm</a> <span>&#45;&gt;</span> <span class="type-var">'t</span></code></dt><dd><p>Reads an OCaml value from a JSON value and an encoding. May raise <code>Cannot_destruct</code>.</p><p>This function works with JSON data represented in the <a href="../Json_repr/index.html#type-ezjsonm"><code>Json_repr.ezjsonm</code></a> format. See functor <a href="Make/index.html"><code>Make</code></a> for using another representation.</p></dd></dl></section><section><header><h3 id="json-type-combinators-for-simple-immediates"><a href="#json-type-combinators-for-simple-immediates" class="anchor"></a>JSON type combinators for simple immediates</h3></header><dl><dt class="spec value" id="val-unit"><a href="#val-unit" class="anchor"></a><code><span class="keyword">val</span> unit : unit <a href="index.html#type-encoding">encoding</a></code></dt><dd><p>An encoding of an OCaml unit by any (ignored) JSON.</p></dd></dl><dl><dt class="spec value" id="val-null"><a href="#val-null" class="anchor"></a><code><span class="keyword">val</span> null : unit <a href="index.html#type-encoding">encoding</a></code></dt><dd><p>An encoding of an OCaml unit by a JSON null.</p></dd></dl><dl><dt class="spec value" id="val-empty"><a href="#val-empty" class="anchor"></a><code><span class="keyword">val</span> empty : unit <a href="index.html#type-encoding">encoding</a></code></dt><dd><p>An encoding of an OCaml unit by an empty JSON object.</p></dd></dl><dl><dt class="spec value" id="val-int"><a href="#val-int" class="anchor"></a><code><span class="keyword">val</span> int : int <a href="index.html#type-encoding">encoding</a></code></dt><dd><p>An encoding of an OCaml int by a JSON number.</p><p>When destructing, the JSON number cannot have a fractional part, and must be between <code>-2^30</code> and <code>2^30-1</code> (these bounds are chosen to be compatible with both 32-bit and 64bit native OCaml compilers as well as JavaScript). When constructing, the value coming from the OCaml world is assumed to be valid, otherwise an <code>Invalid_argument</code> will be raised (can only happen on 64-bit systems).</p><p>Use <a href="index.html#val-int32"><code>int32</code></a> or <a href="index.html#val-int53"><code>int53</code></a> for a greater range. Use <a href="index.html#val-ranged_int"><code>ranged_int</code></a> to restrict to an interval.</p></dd></dl><dl><dt class="spec value" id="val-int32"><a href="#val-int32" class="anchor"></a><code><span class="keyword">val</span> int32 : int32 <a href="index.html#type-encoding">encoding</a></code></dt><dd><p>An encoding of an OCaml int32 by a JSON number.</p><p>Must be a floating point without fractional part and between <code>-2^31</code> and <code>2^31-1</code> when destructing. Never fails when constructing, as all 32-bit integers are included in JSON numbers.</p></dd></dl><dl><dt class="spec value" id="val-int53"><a href="#val-int53" class="anchor"></a><code><span class="keyword">val</span> int53 : int64 <a href="index.html#type-encoding">encoding</a></code></dt><dd><p>An encoding of a JSON-representable OCaml int64 by a JSON number.</p><p>Restricted to the <code>-2^53</code> to <code>2^53</code> range, as this is the limit of representable integers in JSON numbers. Must be a floating point without fractional part and in this range when destructing. When constructing, the value coming from the OCaml world is assumed to be in this range, otherwise an <code>Invalid_argument</code> will be raised.</p></dd></dl><dl><dt class="spec value" id="val-ranged_int"><a href="#val-ranged_int" class="anchor"></a><code><span class="keyword">val</span> ranged_int : minimum:int <span>&#45;&gt;</span> maximum:int <span>&#45;&gt;</span> string <span>&#45;&gt;</span> int <a href="index.html#type-encoding">encoding</a></code></dt><dd><p>An encoding of an OCaml int by a JSON number restricted to a specific range.</p><p>The bounds must be between <code>-2^30</code> and <code>2^30-1</code>.</p><p>The inclusive bounds are checked when destructing. When constructing, the value coming from the OCaml world is assumed to be within the bounds, otherwise an <code>Invalid_argument</code> will be raised. The string parameter is a name used to tweak the error messages.</p></dd></dl><dl><dt class="spec value" id="val-ranged_int32"><a href="#val-ranged_int32" class="anchor"></a><code><span class="keyword">val</span> ranged_int32 : minimum:int32 <span>&#45;&gt;</span> maximum:int32 <span>&#45;&gt;</span> string <span>&#45;&gt;</span> int32 <a href="index.html#type-encoding">encoding</a></code></dt><dd><p>An encoding of an OCaml int32 by a JSON number restricted to a specific range.</p><p>The bounds must be between <code>-2^31</code> and <code>2^31-1</code>.</p><p>The inclusive bounds are checked when destructing. When constructing, the value coming from the OCaml world is assumed to be within the bounds, otherwise an <code>Invalid_argument</code> will be raised. The string parameter is a name used to tweak the error messages.</p></dd></dl><dl><dt class="spec value" id="val-ranged_int53"><a href="#val-ranged_int53" class="anchor"></a><code><span class="keyword">val</span> ranged_int53 : minimum:int64 <span>&#45;&gt;</span> maximum:int64 <span>&#45;&gt;</span> string <span>&#45;&gt;</span> int64 <a href="index.html#type-encoding">encoding</a></code></dt><dd><p>An encoding of an OCaml int64 by a JSON number restricted to a specific range.</p><p>The bounds must be between <code>-2^53</code> and <code>2^53</code>.</p><p>The inclusive bounds are checked when destructing. When constructing, the value coming from the OCaml world is assumed to be within the bounds, otherwise an <code>Invalid_argument</code> will be raised. The string parameter is a name used to tweak the error messages.</p></dd></dl><dl><dt class="spec value" id="val-bool"><a href="#val-bool" class="anchor"></a><code><span class="keyword">val</span> bool : bool <a href="index.html#type-encoding">encoding</a></code></dt><dd><p>An encoding of an OCaml boolean by a JSON one.</p></dd></dl><dl><dt class="spec value" id="val-string"><a href="#val-string" class="anchor"></a><code><span class="keyword">val</span> string : string <a href="index.html#type-encoding">encoding</a></code></dt><dd><p>An encoding of an OCaml string by a JSON one.</p></dd></dl><dl><dt class="spec value" id="val-string_enum"><a href="#val-string_enum" class="anchor"></a><code><span class="keyword">val</span> string_enum : (string * <span class="type-var">'a</span>) list <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-encoding">encoding</a></code></dt><dd><p>An encoding of a closed set of OCaml values by JSON strings.</p></dd></dl><dl><dt class="spec value" id="val-constant"><a href="#val-constant" class="anchor"></a><code><span class="keyword">val</span> constant : string <span>&#45;&gt;</span> unit <a href="index.html#type-encoding">encoding</a></code></dt><dd><p>An encoding of a constant string.</p></dd></dl><dl><dt class="spec value" id="val-bytes"><a href="#val-bytes" class="anchor"></a><code><span class="keyword">val</span> bytes : bytes <a href="index.html#type-encoding">encoding</a></code></dt><dd><p>An encoding of an OCaml mutable string by a JSON string.</p></dd></dl><dl><dt class="spec value" id="val-float"><a href="#val-float" class="anchor"></a><code><span class="keyword">val</span> float : float <a href="index.html#type-encoding">encoding</a></code></dt><dd><p>An encoding of an OCaml float by a JSON number.</p></dd></dl><dl><dt class="spec value" id="val-ranged_float"><a href="#val-ranged_float" class="anchor"></a><code><span class="keyword">val</span> ranged_float : minimum:float <span>&#45;&gt;</span> maximum:float <span>&#45;&gt;</span> string <span>&#45;&gt;</span> float <a href="index.html#type-encoding">encoding</a></code></dt><dd><p>An encoding of an OCaml float by a JSON number with range constraints</p></dd></dl><dl><dt class="spec value" id="val-option"><a href="#val-option" class="anchor"></a><code><span class="keyword">val</span> option : <span class="type-var">'a</span> <a href="index.html#type-encoding">encoding</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> option <a href="index.html#type-encoding">encoding</a></code></dt><dd><p>An encoding of an OCaml option by a nullable JSON value. Raises <code>Invalid_argument</code> when nesting options â€“ i.e., when building <code>'a option
    option encoding</code>. Also raises <code>Invalid_argument</code> when used on the encoding of <code>null</code>.</p></dd></dl></section><section><header><h3 id="json-type-combinators-for-objects"><a href="#json-type-combinators-for-objects" class="anchor"></a>JSON type combinators for objects</h3></header><dl><dt class="spec type" id="type-field"><a href="#type-field" class="anchor"></a><code><span class="keyword">type</span> 'a field</code></dt><dd><p>A first class handle to a JSON field.</p></dd></dl><dl><dt class="spec value" id="val-req"><a href="#val-req" class="anchor"></a><code><span class="keyword">val</span> req : ?&#8288;title:string <span>&#45;&gt;</span> ?&#8288;description:string <span>&#45;&gt;</span> string <span>&#45;&gt;</span> <span class="type-var">'t</span> <a href="index.html#type-encoding">encoding</a> <span>&#45;&gt;</span> <span class="type-var">'t</span> <a href="index.html#type-field">field</a></code></dt><dd><p>A required field of a given its type.</p></dd></dl><dl><dt class="spec value" id="val-opt"><a href="#val-opt" class="anchor"></a><code><span class="keyword">val</span> opt : ?&#8288;title:string <span>&#45;&gt;</span> ?&#8288;description:string <span>&#45;&gt;</span> string <span>&#45;&gt;</span> <span class="type-var">'t</span> <a href="index.html#type-encoding">encoding</a> <span>&#45;&gt;</span> <span class="type-var">'t</span> option <a href="index.html#type-field">field</a></code></dt><dd><p>An optional field of a given type, using an OCaml <code>option</code>.</p></dd></dl><dl><dt class="spec value" id="val-dft"><a href="#val-dft" class="anchor"></a><code><span class="keyword">val</span> dft : ?&#8288;title:string <span>&#45;&gt;</span> ?&#8288;description:string <span>&#45;&gt;</span> string <span>&#45;&gt;</span> <span class="type-var">'t</span> <a href="index.html#type-encoding">encoding</a> <span>&#45;&gt;</span> <span class="type-var">'t</span> <span>&#45;&gt;</span> <span class="type-var">'t</span> <a href="index.html#type-field">field</a></code></dt><dd><p>An optional field of a given type, ommited when equal to a default value.</p></dd></dl><dl><dt class="spec value" id="val-obj1"><a href="#val-obj1" class="anchor"></a><code><span class="keyword">val</span> obj1 : <span class="type-var">'f1</span> <a href="index.html#type-field">field</a> <span>&#45;&gt;</span> <span class="type-var">'f1</span> <a href="index.html#type-encoding">encoding</a></code></dt><dd><p>An encoding of an OCaml value by a singleton object.</p></dd></dl><dl><dt class="spec value" id="val-obj2"><a href="#val-obj2" class="anchor"></a><code><span class="keyword">val</span> obj2 : <span class="type-var">'f1</span> <a href="index.html#type-field">field</a> <span>&#45;&gt;</span> <span class="type-var">'f2</span> <a href="index.html#type-field">field</a> <span>&#45;&gt;</span> (<span class="type-var">'f1</span> * <span class="type-var">'f2</span>) <a href="index.html#type-encoding">encoding</a></code></dt><dd><p>An encoding of an OCaml pair by a JSON object with two fields.</p></dd></dl><dl><dt class="spec value" id="val-obj3"><a href="#val-obj3" class="anchor"></a><code><span class="keyword">val</span> obj3 : <span class="type-var">'f1</span> <a href="index.html#type-field">field</a> <span>&#45;&gt;</span> <span class="type-var">'f2</span> <a href="index.html#type-field">field</a> <span>&#45;&gt;</span> <span class="type-var">'f3</span> <a href="index.html#type-field">field</a> <span>&#45;&gt;</span> (<span class="type-var">'f1</span> * <span class="type-var">'f2</span> * <span class="type-var">'f3</span>) <a href="index.html#type-encoding">encoding</a></code></dt><dd><p>An encoding of an OCaml triple by a JSON object with three fields.</p></dd></dl><dl><dt class="spec value" id="val-obj4"><a href="#val-obj4" class="anchor"></a><code><span class="keyword">val</span> obj4 : <span class="type-var">'f1</span> <a href="index.html#type-field">field</a> <span>&#45;&gt;</span> <span class="type-var">'f2</span> <a href="index.html#type-field">field</a> <span>&#45;&gt;</span> <span class="type-var">'f3</span> <a href="index.html#type-field">field</a> <span>&#45;&gt;</span> <span class="type-var">'f4</span> <a href="index.html#type-field">field</a> <span>&#45;&gt;</span> (<span class="type-var">'f1</span> * <span class="type-var">'f2</span> * <span class="type-var">'f3</span> * <span class="type-var">'f4</span>) <a href="index.html#type-encoding">encoding</a></code></dt><dd><p>An encoding of an OCaml quadruple by a JSON object with four fields.</p></dd></dl><dl><dt class="spec value" id="val-obj5"><a href="#val-obj5" class="anchor"></a><code><span class="keyword">val</span> obj5 : <span class="type-var">'f1</span> <a href="index.html#type-field">field</a> <span>&#45;&gt;</span> <span class="type-var">'f2</span> <a href="index.html#type-field">field</a> <span>&#45;&gt;</span> <span class="type-var">'f3</span> <a href="index.html#type-field">field</a> <span>&#45;&gt;</span> <span class="type-var">'f4</span> <a href="index.html#type-field">field</a> <span>&#45;&gt;</span> <span class="type-var">'f5</span> <a href="index.html#type-field">field</a> <span>&#45;&gt;</span> (<span class="type-var">'f1</span> * <span class="type-var">'f2</span> * <span class="type-var">'f3</span> * <span class="type-var">'f4</span> * <span class="type-var">'f5</span>) <a href="index.html#type-encoding">encoding</a></code></dt><dd><p>An encoding of an OCaml quintuple by a JSON object with five fields.</p></dd></dl><dl><dt class="spec value" id="val-obj6"><a href="#val-obj6" class="anchor"></a><code><span class="keyword">val</span> obj6 : <span class="type-var">'f1</span> <a href="index.html#type-field">field</a> <span>&#45;&gt;</span> <span class="type-var">'f2</span> <a href="index.html#type-field">field</a> <span>&#45;&gt;</span> <span class="type-var">'f3</span> <a href="index.html#type-field">field</a> <span>&#45;&gt;</span> <span class="type-var">'f4</span> <a href="index.html#type-field">field</a> <span>&#45;&gt;</span> <span class="type-var">'f5</span> <a href="index.html#type-field">field</a> <span>&#45;&gt;</span> <span class="type-var">'f6</span> <a href="index.html#type-field">field</a> <span>&#45;&gt;</span> (<span class="type-var">'f1</span> * <span class="type-var">'f2</span> * <span class="type-var">'f3</span> * <span class="type-var">'f4</span> * <span class="type-var">'f5</span> * <span class="type-var">'f6</span>) <a href="index.html#type-encoding">encoding</a></code></dt><dd><p>An encoding of an OCaml sextuple by a JSON object with six fields.</p></dd></dl><dl><dt class="spec value" id="val-obj7"><a href="#val-obj7" class="anchor"></a><code><span class="keyword">val</span> obj7 : <span class="type-var">'f1</span> <a href="index.html#type-field">field</a> <span>&#45;&gt;</span> <span class="type-var">'f2</span> <a href="index.html#type-field">field</a> <span>&#45;&gt;</span> <span class="type-var">'f3</span> <a href="index.html#type-field">field</a> <span>&#45;&gt;</span> <span class="type-var">'f4</span> <a href="index.html#type-field">field</a> <span>&#45;&gt;</span> <span class="type-var">'f5</span> <a href="index.html#type-field">field</a> <span>&#45;&gt;</span> <span class="type-var">'f6</span> <a href="index.html#type-field">field</a> <span>&#45;&gt;</span> <span class="type-var">'f7</span> <a href="index.html#type-field">field</a> <span>&#45;&gt;</span> (<span class="type-var">'f1</span> * <span class="type-var">'f2</span> * <span class="type-var">'f3</span> * <span class="type-var">'f4</span> * <span class="type-var">'f5</span> * <span class="type-var">'f6</span> * <span class="type-var">'f7</span>) <a href="index.html#type-encoding">encoding</a></code></dt><dd><p>An encoding of an OCaml septuple by a JSON object with seven fields.</p></dd></dl><dl><dt class="spec value" id="val-obj8"><a href="#val-obj8" class="anchor"></a><code><span class="keyword">val</span> obj8 : <span class="type-var">'f1</span> <a href="index.html#type-field">field</a> <span>&#45;&gt;</span> <span class="type-var">'f2</span> <a href="index.html#type-field">field</a> <span>&#45;&gt;</span> <span class="type-var">'f3</span> <a href="index.html#type-field">field</a> <span>&#45;&gt;</span> <span class="type-var">'f4</span> <a href="index.html#type-field">field</a> <span>&#45;&gt;</span> <span class="type-var">'f5</span> <a href="index.html#type-field">field</a> <span>&#45;&gt;</span> <span class="type-var">'f6</span> <a href="index.html#type-field">field</a> <span>&#45;&gt;</span> <span class="type-var">'f7</span> <a href="index.html#type-field">field</a> <span>&#45;&gt;</span> <span class="type-var">'f8</span> <a href="index.html#type-field">field</a> <span>&#45;&gt;</span> (<span class="type-var">'f1</span> * <span class="type-var">'f2</span> * <span class="type-var">'f3</span> * <span class="type-var">'f4</span> * <span class="type-var">'f5</span> * <span class="type-var">'f6</span> * <span class="type-var">'f7</span> * <span class="type-var">'f8</span>) <a href="index.html#type-encoding">encoding</a></code></dt><dd><p>An encoding of an OCaml octuple by a JSON object with eight fields.</p></dd></dl><dl><dt class="spec value" id="val-obj9"><a href="#val-obj9" class="anchor"></a><code><span class="keyword">val</span> obj9 : <span class="type-var">'f1</span> <a href="index.html#type-field">field</a> <span>&#45;&gt;</span> <span class="type-var">'f2</span> <a href="index.html#type-field">field</a> <span>&#45;&gt;</span> <span class="type-var">'f3</span> <a href="index.html#type-field">field</a> <span>&#45;&gt;</span> <span class="type-var">'f4</span> <a href="index.html#type-field">field</a> <span>&#45;&gt;</span> <span class="type-var">'f5</span> <a href="index.html#type-field">field</a> <span>&#45;&gt;</span> <span class="type-var">'f6</span> <a href="index.html#type-field">field</a> <span>&#45;&gt;</span> <span class="type-var">'f7</span> <a href="index.html#type-field">field</a> <span>&#45;&gt;</span> <span class="type-var">'f8</span> <a href="index.html#type-field">field</a> <span>&#45;&gt;</span> <span class="type-var">'f9</span> <a href="index.html#type-field">field</a> <span>&#45;&gt;</span> (<span class="type-var">'f1</span> * <span class="type-var">'f2</span> * <span class="type-var">'f3</span> * <span class="type-var">'f4</span> * <span class="type-var">'f5</span> * <span class="type-var">'f6</span> * <span class="type-var">'f7</span> * <span class="type-var">'f8</span> * <span class="type-var">'f9</span>) <a href="index.html#type-encoding">encoding</a></code></dt><dd><p>An encoding of an OCaml nonuple by a JSON object with nine fields.</p></dd></dl><dl><dt class="spec value" id="val-obj10"><a href="#val-obj10" class="anchor"></a><code><span class="keyword">val</span> obj10 : <span class="type-var">'f1</span> <a href="index.html#type-field">field</a> <span>&#45;&gt;</span> <span class="type-var">'f2</span> <a href="index.html#type-field">field</a> <span>&#45;&gt;</span> <span class="type-var">'f3</span> <a href="index.html#type-field">field</a> <span>&#45;&gt;</span> <span class="type-var">'f4</span> <a href="index.html#type-field">field</a> <span>&#45;&gt;</span> <span class="type-var">'f5</span> <a href="index.html#type-field">field</a> <span>&#45;&gt;</span> <span class="type-var">'f6</span> <a href="index.html#type-field">field</a> <span>&#45;&gt;</span> <span class="type-var">'f7</span> <a href="index.html#type-field">field</a> <span>&#45;&gt;</span> <span class="type-var">'f8</span> <a href="index.html#type-field">field</a> <span>&#45;&gt;</span> <span class="type-var">'f9</span> <a href="index.html#type-field">field</a> <span>&#45;&gt;</span> <span class="type-var">'f10</span> <a href="index.html#type-field">field</a> <span>&#45;&gt;</span> (<span class="type-var">'f1</span> * <span class="type-var">'f2</span> * <span class="type-var">'f3</span> * <span class="type-var">'f4</span> * <span class="type-var">'f5</span> * <span class="type-var">'f6</span> * <span class="type-var">'f7</span> * <span class="type-var">'f8</span> * <span class="type-var">'f9</span> * <span class="type-var">'f10</span>) <a href="index.html#type-encoding">encoding</a></code></dt><dd><p>An encoding of an OCaml decuple by a JSON object with ten fields.</p></dd></dl><dl><dt class="spec value" id="val-merge_objs"><a href="#val-merge_objs" class="anchor"></a><code><span class="keyword">val</span> merge_objs : <span class="type-var">'o1</span> <a href="index.html#type-encoding">encoding</a> <span>&#45;&gt;</span> <span class="type-var">'o2</span> <a href="index.html#type-encoding">encoding</a> <span>&#45;&gt;</span> (<span class="type-var">'o1</span> * <span class="type-var">'o2</span>) <a href="index.html#type-encoding">encoding</a></code></dt><dd><p>Merge two object <code>encoding</code>s. For describing heavyweight objects with a lot of fields. The ocaml type is a pair of tuples, but the JSON object is flat. Both arguments must be object encodings, otherwise a future <a href="index.html#val-construct"><code>construct</code></a>, <a href="index.html#val-destruct"><code>destruct</code></a> or <a href="index.html#val-schema"><code>schema</code></a> will fail with <code>Invalid_argument</code>.</p></dd></dl></section><section><header><h3 id="json-type-combinators-for-arrays"><a href="#json-type-combinators-for-arrays" class="anchor"></a>JSON type combinators for arrays</h3></header><dl><dt class="spec value" id="val-array"><a href="#val-array" class="anchor"></a><code><span class="keyword">val</span> array : <span class="type-var">'a</span> <a href="index.html#type-encoding">encoding</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> array <a href="index.html#type-encoding">encoding</a></code></dt><dd><p>An encoding of an OCaml array by a JSON one.</p></dd></dl><dl><dt class="spec value" id="val-list"><a href="#val-list" class="anchor"></a><code><span class="keyword">val</span> list : <span class="type-var">'a</span> <a href="index.html#type-encoding">encoding</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> list <a href="index.html#type-encoding">encoding</a></code></dt><dd><p>An encoding of an OCaml list by a JSON one.</p></dd></dl><dl><dt class="spec value" id="val-assoc"><a href="#val-assoc" class="anchor"></a><code><span class="keyword">val</span> assoc : <span class="type-var">'a</span> <a href="index.html#type-encoding">encoding</a> <span>&#45;&gt;</span> (string * <span class="type-var">'a</span>) list <a href="index.html#type-encoding">encoding</a></code></dt><dd><p>An encoding of an OCaml associative list by a JSON object.</p></dd></dl><dl><dt class="spec value" id="val-tup1"><a href="#val-tup1" class="anchor"></a><code><span class="keyword">val</span> tup1 : <span class="type-var">'f1</span> <a href="index.html#type-encoding">encoding</a> <span>&#45;&gt;</span> <span class="type-var">'f1</span> <a href="index.html#type-encoding">encoding</a></code></dt><dd><p>An encoding of an OCaml value by a singleton array.</p></dd></dl><dl><dt class="spec value" id="val-tup2"><a href="#val-tup2" class="anchor"></a><code><span class="keyword">val</span> tup2 : <span class="type-var">'f1</span> <a href="index.html#type-encoding">encoding</a> <span>&#45;&gt;</span> <span class="type-var">'f2</span> <a href="index.html#type-encoding">encoding</a> <span>&#45;&gt;</span> (<span class="type-var">'f1</span> * <span class="type-var">'f2</span>) <a href="index.html#type-encoding">encoding</a></code></dt><dd><p>An encoding of an OCaml pair by a JSON array with two cells.</p></dd></dl><dl><dt class="spec value" id="val-tup3"><a href="#val-tup3" class="anchor"></a><code><span class="keyword">val</span> tup3 : <span class="type-var">'f1</span> <a href="index.html#type-encoding">encoding</a> <span>&#45;&gt;</span> <span class="type-var">'f2</span> <a href="index.html#type-encoding">encoding</a> <span>&#45;&gt;</span> <span class="type-var">'f3</span> <a href="index.html#type-encoding">encoding</a> <span>&#45;&gt;</span> (<span class="type-var">'f1</span> * <span class="type-var">'f2</span> * <span class="type-var">'f3</span>) <a href="index.html#type-encoding">encoding</a></code></dt><dd><p>An encoding of an OCaml triple by a JSON array with three cells.</p></dd></dl><dl><dt class="spec value" id="val-tup4"><a href="#val-tup4" class="anchor"></a><code><span class="keyword">val</span> tup4 : <span class="type-var">'f1</span> <a href="index.html#type-encoding">encoding</a> <span>&#45;&gt;</span> <span class="type-var">'f2</span> <a href="index.html#type-encoding">encoding</a> <span>&#45;&gt;</span> <span class="type-var">'f3</span> <a href="index.html#type-encoding">encoding</a> <span>&#45;&gt;</span> <span class="type-var">'f4</span> <a href="index.html#type-encoding">encoding</a> <span>&#45;&gt;</span> (<span class="type-var">'f1</span> * <span class="type-var">'f2</span> * <span class="type-var">'f3</span> * <span class="type-var">'f4</span>) <a href="index.html#type-encoding">encoding</a></code></dt><dd><p>An encoding of an OCaml quadruple by a JSON array with four cells.</p></dd></dl><dl><dt class="spec value" id="val-tup5"><a href="#val-tup5" class="anchor"></a><code><span class="keyword">val</span> tup5 : <span class="type-var">'f1</span> <a href="index.html#type-encoding">encoding</a> <span>&#45;&gt;</span> <span class="type-var">'f2</span> <a href="index.html#type-encoding">encoding</a> <span>&#45;&gt;</span> <span class="type-var">'f3</span> <a href="index.html#type-encoding">encoding</a> <span>&#45;&gt;</span> <span class="type-var">'f4</span> <a href="index.html#type-encoding">encoding</a> <span>&#45;&gt;</span> <span class="type-var">'f5</span> <a href="index.html#type-encoding">encoding</a> <span>&#45;&gt;</span> (<span class="type-var">'f1</span> * <span class="type-var">'f2</span> * <span class="type-var">'f3</span> * <span class="type-var">'f4</span> * <span class="type-var">'f5</span>) <a href="index.html#type-encoding">encoding</a></code></dt><dd><p>An encoding of an OCaml quintuple by a JSON array with five cells.</p></dd></dl><dl><dt class="spec value" id="val-tup6"><a href="#val-tup6" class="anchor"></a><code><span class="keyword">val</span> tup6 : <span class="type-var">'f1</span> <a href="index.html#type-encoding">encoding</a> <span>&#45;&gt;</span> <span class="type-var">'f2</span> <a href="index.html#type-encoding">encoding</a> <span>&#45;&gt;</span> <span class="type-var">'f3</span> <a href="index.html#type-encoding">encoding</a> <span>&#45;&gt;</span> <span class="type-var">'f4</span> <a href="index.html#type-encoding">encoding</a> <span>&#45;&gt;</span> <span class="type-var">'f5</span> <a href="index.html#type-encoding">encoding</a> <span>&#45;&gt;</span> <span class="type-var">'f6</span> <a href="index.html#type-encoding">encoding</a> <span>&#45;&gt;</span> (<span class="type-var">'f1</span> * <span class="type-var">'f2</span> * <span class="type-var">'f3</span> * <span class="type-var">'f4</span> * <span class="type-var">'f5</span> * <span class="type-var">'f6</span>) <a href="index.html#type-encoding">encoding</a></code></dt><dd><p>An encoding of an OCaml sextuple by a JSON array with six cells.</p></dd></dl><dl><dt class="spec value" id="val-tup7"><a href="#val-tup7" class="anchor"></a><code><span class="keyword">val</span> tup7 : <span class="type-var">'f1</span> <a href="index.html#type-encoding">encoding</a> <span>&#45;&gt;</span> <span class="type-var">'f2</span> <a href="index.html#type-encoding">encoding</a> <span>&#45;&gt;</span> <span class="type-var">'f3</span> <a href="index.html#type-encoding">encoding</a> <span>&#45;&gt;</span> <span class="type-var">'f4</span> <a href="index.html#type-encoding">encoding</a> <span>&#45;&gt;</span> <span class="type-var">'f5</span> <a href="index.html#type-encoding">encoding</a> <span>&#45;&gt;</span> <span class="type-var">'f6</span> <a href="index.html#type-encoding">encoding</a> <span>&#45;&gt;</span> <span class="type-var">'f7</span> <a href="index.html#type-encoding">encoding</a> <span>&#45;&gt;</span> (<span class="type-var">'f1</span> * <span class="type-var">'f2</span> * <span class="type-var">'f3</span> * <span class="type-var">'f4</span> * <span class="type-var">'f5</span> * <span class="type-var">'f6</span> * <span class="type-var">'f7</span>) <a href="index.html#type-encoding">encoding</a></code></dt><dd><p>An encoding of an OCaml septuple by a JSON array with seven cells.</p></dd></dl><dl><dt class="spec value" id="val-tup8"><a href="#val-tup8" class="anchor"></a><code><span class="keyword">val</span> tup8 : <span class="type-var">'f1</span> <a href="index.html#type-encoding">encoding</a> <span>&#45;&gt;</span> <span class="type-var">'f2</span> <a href="index.html#type-encoding">encoding</a> <span>&#45;&gt;</span> <span class="type-var">'f3</span> <a href="index.html#type-encoding">encoding</a> <span>&#45;&gt;</span> <span class="type-var">'f4</span> <a href="index.html#type-encoding">encoding</a> <span>&#45;&gt;</span> <span class="type-var">'f5</span> <a href="index.html#type-encoding">encoding</a> <span>&#45;&gt;</span> <span class="type-var">'f6</span> <a href="index.html#type-encoding">encoding</a> <span>&#45;&gt;</span> <span class="type-var">'f7</span> <a href="index.html#type-encoding">encoding</a> <span>&#45;&gt;</span> <span class="type-var">'f8</span> <a href="index.html#type-encoding">encoding</a> <span>&#45;&gt;</span> (<span class="type-var">'f1</span> * <span class="type-var">'f2</span> * <span class="type-var">'f3</span> * <span class="type-var">'f4</span> * <span class="type-var">'f5</span> * <span class="type-var">'f6</span> * <span class="type-var">'f7</span> * <span class="type-var">'f8</span>) <a href="index.html#type-encoding">encoding</a></code></dt><dd><p>An encoding of an OCaml octuple by a JSON array with eight cells.</p></dd></dl><dl><dt class="spec value" id="val-tup9"><a href="#val-tup9" class="anchor"></a><code><span class="keyword">val</span> tup9 : <span class="type-var">'f1</span> <a href="index.html#type-encoding">encoding</a> <span>&#45;&gt;</span> <span class="type-var">'f2</span> <a href="index.html#type-encoding">encoding</a> <span>&#45;&gt;</span> <span class="type-var">'f3</span> <a href="index.html#type-encoding">encoding</a> <span>&#45;&gt;</span> <span class="type-var">'f4</span> <a href="index.html#type-encoding">encoding</a> <span>&#45;&gt;</span> <span class="type-var">'f5</span> <a href="index.html#type-encoding">encoding</a> <span>&#45;&gt;</span> <span class="type-var">'f6</span> <a href="index.html#type-encoding">encoding</a> <span>&#45;&gt;</span> <span class="type-var">'f7</span> <a href="index.html#type-encoding">encoding</a> <span>&#45;&gt;</span> <span class="type-var">'f8</span> <a href="index.html#type-encoding">encoding</a> <span>&#45;&gt;</span> <span class="type-var">'f9</span> <a href="index.html#type-encoding">encoding</a> <span>&#45;&gt;</span> (<span class="type-var">'f1</span> * <span class="type-var">'f2</span> * <span class="type-var">'f3</span> * <span class="type-var">'f4</span> * <span class="type-var">'f5</span> * <span class="type-var">'f6</span> * <span class="type-var">'f7</span> * <span class="type-var">'f8</span> * <span class="type-var">'f9</span>) <a href="index.html#type-encoding">encoding</a></code></dt><dd><p>An encoding of an OCaml nonuple by a JSON array with nine cells.</p></dd></dl><dl><dt class="spec value" id="val-tup10"><a href="#val-tup10" class="anchor"></a><code><span class="keyword">val</span> tup10 : <span class="type-var">'f1</span> <a href="index.html#type-encoding">encoding</a> <span>&#45;&gt;</span> <span class="type-var">'f2</span> <a href="index.html#type-encoding">encoding</a> <span>&#45;&gt;</span> <span class="type-var">'f3</span> <a href="index.html#type-encoding">encoding</a> <span>&#45;&gt;</span> <span class="type-var">'f4</span> <a href="index.html#type-encoding">encoding</a> <span>&#45;&gt;</span> <span class="type-var">'f5</span> <a href="index.html#type-encoding">encoding</a> <span>&#45;&gt;</span> <span class="type-var">'f6</span> <a href="index.html#type-encoding">encoding</a> <span>&#45;&gt;</span> <span class="type-var">'f7</span> <a href="index.html#type-encoding">encoding</a> <span>&#45;&gt;</span> <span class="type-var">'f8</span> <a href="index.html#type-encoding">encoding</a> <span>&#45;&gt;</span> <span class="type-var">'f9</span> <a href="index.html#type-encoding">encoding</a> <span>&#45;&gt;</span> <span class="type-var">'f10</span> <a href="index.html#type-encoding">encoding</a> <span>&#45;&gt;</span> (<span class="type-var">'f1</span> * <span class="type-var">'f2</span> * <span class="type-var">'f3</span> * <span class="type-var">'f4</span> * <span class="type-var">'f5</span> * <span class="type-var">'f6</span> * <span class="type-var">'f7</span> * <span class="type-var">'f8</span> * <span class="type-var">'f9</span> * <span class="type-var">'f10</span>) <a href="index.html#type-encoding">encoding</a></code></dt><dd><p>An encoding of an OCaml decuple by a JSON array with ten cells.</p></dd></dl><dl><dt class="spec value" id="val-merge_tups"><a href="#val-merge_tups" class="anchor"></a><code><span class="keyword">val</span> merge_tups : <span class="type-var">'a1</span> <a href="index.html#type-encoding">encoding</a> <span>&#45;&gt;</span> <span class="type-var">'a2</span> <a href="index.html#type-encoding">encoding</a> <span>&#45;&gt;</span> (<span class="type-var">'a1</span> * <span class="type-var">'a2</span>) <a href="index.html#type-encoding">encoding</a></code></dt><dd><p>Merge two tuple <code>encoding</code>s. For describing heavyweight arrays with a lot of cells. The ocaml type is a pair of tuples, but the JSON array is flat, with the elements of the first tuple before the ones of the second. Both arguments must be tuple encodings, otherwise a future <a href="index.html#val-construct"><code>construct</code></a>, <a href="index.html#val-destruct"><code>destruct</code></a> or <a href="index.html#val-schema"><code>schema</code></a> will fail with <code>Invalid_argument</code>.</p></dd></dl></section><section><header><h3 id="json-type-combinators-for-unions"><a href="#json-type-combinators-for-unions" class="anchor"></a>JSON type combinators for unions</h3></header><dl><dt class="spec type" id="type-case"><a href="#type-case" class="anchor"></a><code><span class="keyword">type</span> 't case</code></dt><dd><p>A case for describing union types using <a href="index.html#val-union"><code>union</code></a> ans <a href="index.html#type-case"><code>case</code></a>.</p></dd></dl><dl><dt class="spec value" id="val-case"><a href="#val-case" class="anchor"></a><code><span class="keyword">val</span> case : <span class="type-var">'a</span> <a href="index.html#type-encoding">encoding</a> <span>&#45;&gt;</span> (<span class="type-var">'t</span> <span>&#45;&gt;</span> <span class="type-var">'a</span> option) <span>&#45;&gt;</span> (<span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'t</span>) <span>&#45;&gt;</span> <span class="type-var">'t</span> <a href="index.html#type-case">case</a></code></dt><dd><p>To be used inside a <a href="index.html#val-union"><code>union</code></a>. Takes a <code>encoding</code> for a specific case, and a converter to and from a type common to all cases (<code>'t</code>). Usually, it consists in boxing / deboxing the specific data in an OCaml sum type contructor.</p></dd></dl><dl><dt class="spec value" id="val-union"><a href="#val-union" class="anchor"></a><code><span class="keyword">val</span> union : <span class="type-var">'t</span> <a href="index.html#type-case">case</a> list <span>&#45;&gt;</span> <span class="type-var">'t</span> <a href="index.html#type-encoding">encoding</a></code></dt><dd><p>A utility to build destructors for custom encoded sum types.</p></dd></dl></section><section><header><h3 id="json-generic-type-combinators"><a href="#json-generic-type-combinators" class="anchor"></a>JSON generic type combinators</h3></header><dl><dt class="spec value" id="val-custom"><a href="#val-custom" class="anchor"></a><code><span class="keyword">val</span> custom : (<span class="type-var">'t</span> <span>&#45;&gt;</span> <a href="../Json_repr/index.html#type-ezjsonm">Json_repr.ezjsonm</a>) <span>&#45;&gt;</span> (<a href="../Json_repr/index.html#type-ezjsonm">Json_repr.ezjsonm</a> <span>&#45;&gt;</span> <span class="type-var">'t</span>) <span>&#45;&gt;</span> schema:<a href="../Json_schema/index.html#type-schema">Json_schema.schema</a> <span>&#45;&gt;</span> <span class="type-var">'t</span> <a href="index.html#type-encoding">encoding</a></code></dt><dd><p>A simple custom encoding using the <a href="../Json_repr/index.html#type-ezjsonm"><code>Json_repr.ezjsonm</code></a> intermediate representation for the conversion functions. The resulting encoding is usable with any other instanciation of functor <a href="Make/index.html"><code>Make</code></a>, internal conversions may be performed needed. The second transformer function can <code>raise (Cannot_destruct ([ (* location *)], exn))</code> to indicate an error, which will be relocated correctly.</p></dd></dl><dl><dt class="spec value" id="val-conv"><a href="#val-conv" class="anchor"></a><code><span class="keyword">val</span> conv : (<span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'b</span>) <span>&#45;&gt;</span> (<span class="type-var">'b</span> <span>&#45;&gt;</span> <span class="type-var">'a</span>) <span>&#45;&gt;</span> ?&#8288;schema:<a href="../Json_schema/index.html#type-schema">Json_schema.schema</a> <span>&#45;&gt;</span> <span class="type-var">'b</span> <a href="index.html#type-encoding">encoding</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-encoding">encoding</a></code></dt><dd><p>An encoding adapter, with an optional handwritten schema. The second transformer function can <code>raise (Cannot_destruct ([], exn))</code> to indicate an error, which will be relocated correctly.</p></dd></dl><dl><dt class="spec value" id="val-mu"><a href="#val-mu" class="anchor"></a><code><span class="keyword">val</span> mu : string <span>&#45;&gt;</span> ?&#8288;title:string <span>&#45;&gt;</span> ?&#8288;description:string <span>&#45;&gt;</span> (<span class="type-var">'a</span> <a href="index.html#type-encoding">encoding</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-encoding">encoding</a>) <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-encoding">encoding</a></code></dt><dd><p>A fixpoint combinator. Links a recursive OCaml type to an internal JSON schema reference, by allowing to use the encoding inside its own definition. The first parameter is a path, that must be unique and respect the format of <a href="../Json_schema/index.html#val-add_definition"><code>Json_schema.add_definition</code></a>. It is used to encode the recursivity as a named reference in the JSON schema.</p><p>Here is an example to turn a standard OCaml list into either <code>&quot;nil&quot;</code> for <code>[]</code> or <code>{&quot;hd&quot;:hd,&quot;tl&quot;:tl}</code> for <code>hd::tl</code>.</p><pre><code class="ml">let reclist itemencoding =
        mu &quot;list&quot; @@ fun self -&gt;
        union
          [ case (string_enum [ &quot;nil&quot;, () ])
              (function [] -&gt; Some () | _ :: _ -&gt; None)
              (fun () -&gt; []) ;
            case (obj2 (req &quot;hd&quot; itemencoding) (req &quot;tl&quot; self))
              (function hd :: tl -&gt; Some (hd, tl) | [] -&gt; None)
              (fun (hd, tl) -&gt; hd :: tl) ]) </code></pre></dd></dl><dl><dt class="spec value" id="val-any_ezjson_value"><a href="#val-any_ezjson_value" class="anchor"></a><code><span class="keyword">val</span> any_ezjson_value : <a href="../Json_repr/index.html#type-ezjsonm">Json_repr.ezjsonm</a> <a href="index.html#type-encoding">encoding</a></code></dt><dd><p>A raw JSON value in ezjsonm representation.</p></dd></dl><dl><dt class="spec value" id="val-any_document"><a href="#val-any_document" class="anchor"></a><code><span class="keyword">val</span> any_document : <a href="../Json_repr/index.html#type-any">Json_repr.any</a> <a href="index.html#type-encoding">encoding</a></code></dt><dd><p>A valid JSON document (i.e. an array or object value).</p></dd></dl><dl><dt class="spec value" id="val-any_schema"><a href="#val-any_schema" class="anchor"></a><code><span class="keyword">val</span> any_schema : <a href="../Json_schema/index.html#type-schema">Json_schema.schema</a> <a href="index.html#type-encoding">encoding</a></code></dt><dd><p>The encoding of a JSON schema, linked to its OCaml definiton.</p></dd></dl></section><section><header><h3 id="exporting-encodings-as-json-schemas"><a href="#exporting-encodings-as-json-schemas" class="anchor"></a>Exporting <code>encoding</code>s as JSON schemas</h3></header><dl><dt class="spec value" id="val-schema"><a href="#val-schema" class="anchor"></a><code><span class="keyword">val</span> schema : ?&#8288;definitions_path:string <span>&#45;&gt;</span> <span class="type-var">'t</span> <a href="index.html#type-encoding">encoding</a> <span>&#45;&gt;</span> <a href="../Json_schema/index.html#type-schema">Json_schema.schema</a></code></dt><dd><p>Describe an encoding in JSON schema format. May raise <a href="index.html#exception-Bad_schema"><code>Bad_schema</code></a>.</p></dd></dl><dl><dt class="spec value" id="val-def"><a href="#val-def" class="anchor"></a><code><span class="keyword">val</span> def : string <span>&#45;&gt;</span> ?&#8288;title:string <span>&#45;&gt;</span> ?&#8288;description:string <span>&#45;&gt;</span> <span class="type-var">'t</span> <a href="index.html#type-encoding">encoding</a> <span>&#45;&gt;</span> <span class="type-var">'t</span> <a href="index.html#type-encoding">encoding</a></code></dt><dd><p>Name a definition so its occurences can be shared in the JSON schema. The first parameter is a path, that must be unique and respect the format of <a href="../Json_schema/index.html#val-add_definition"><code>Json_schema.add_definition</code></a>.</p></dd></dl></section><section><header><h3 id="errors"><a href="#errors" class="anchor"></a>Errors</h3></header><dl><dt class="spec exception" id="exception-Cannot_destruct"><a href="#exception-Cannot_destruct" class="anchor"></a><code><span class="keyword">exception</span> </code><code><span class="exception">Cannot_destruct</span> <span class="keyword">of</span> <a href="../Json_query/index.html#type-path">Json_query.path</a> * exn</code></dt><dd><p>Exception raised by destructors, with the location in the original JSON structure and the specific error.</p></dd></dl><dl><dt class="spec exception" id="exception-Unexpected"><a href="#exception-Unexpected" class="anchor"></a><code><span class="keyword">exception</span> </code><code><span class="exception">Unexpected</span> <span class="keyword">of</span> string * string</code></dt><dd><p>Unexpected kind of data encountered (w/ the expectation).</p></dd></dl><dl><dt class="spec exception" id="exception-No_case_matched"><a href="#exception-No_case_matched" class="anchor"></a><code><span class="keyword">exception</span> </code><code><span class="exception">No_case_matched</span> <span class="keyword">of</span> exn list</code></dt><dd><p>Some <a href="index.html#val-union"><code>union</code></a> couldn't be destructed, w/ the reasons for each <a href="index.html#type-case"><code>case</code></a>.</p></dd></dl><dl><dt class="spec exception" id="exception-Bad_array_size"><a href="#exception-Bad_array_size" class="anchor"></a><code><span class="keyword">exception</span> </code><code><span class="exception">Bad_array_size</span> <span class="keyword">of</span> int * int</code></dt><dd><p>Array of unexpected size encountered (w/ the expectation).</p></dd></dl><dl><dt class="spec exception" id="exception-Missing_field"><a href="#exception-Missing_field" class="anchor"></a><code><span class="keyword">exception</span> </code><code><span class="exception">Missing_field</span> <span class="keyword">of</span> string</code></dt><dd><p>Missing field in an object.</p></dd></dl><dl><dt class="spec exception" id="exception-Unexpected_field"><a href="#exception-Unexpected_field" class="anchor"></a><code><span class="keyword">exception</span> </code><code><span class="exception">Unexpected_field</span> <span class="keyword">of</span> string</code></dt><dd><p>Supernumerary field in an object.</p></dd></dl><dl><dt class="spec exception" id="exception-Bad_schema"><a href="#exception-Bad_schema" class="anchor"></a><code><span class="keyword">exception</span> </code><code><span class="exception">Bad_schema</span> <span class="keyword">of</span> exn</code></dt><dd><p>Bad custom schema encountered.</p></dd></dl><dl><dt class="spec value" id="val-print_error"><a href="#val-print_error" class="anchor"></a><code><span class="keyword">val</span> print_error : ?&#8288;print_unknown:(<a href="../../ocaml/Stdlib/Format/index.html#type-formatter">Stdlib.Format.formatter</a> <span>&#45;&gt;</span> exn <span>&#45;&gt;</span> unit) <span>&#45;&gt;</span> <a href="../../ocaml/Stdlib/Format/index.html#type-formatter">Stdlib.Format.formatter</a> <span>&#45;&gt;</span> exn <span>&#45;&gt;</span> unit</code></dt><dd><p>Produces a human readable version of an error.</p></dd></dl></section><section><header><h3 id="advanced-interface-for-using-a-custom-json-representation"><a href="#advanced-interface-for-using-a-custom-json-representation" class="anchor"></a>Advanced interface for using a custom JSON representation</h3></header><div class="spec module" id="module-Make"><a href="#module-Make" class="anchor"></a><code><span class="keyword">module</span> <a href="Make/index.html">Make</a> : <span class="keyword">functor</span> (<a href="Make/argument-1-Repr/index.html">Repr</a> : <a href="../Json_repr/index.html#module-type-Repr">Json_repr.Repr</a>) <span>&#45;&gt;</span> <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><dl><dt class="spec type" id="type-repr_agnostic_custom"><a href="#type-repr_agnostic_custom" class="anchor"></a><code><span class="keyword">type</span> 't repr_agnostic_custom</code><code> = </code><code>{</code><table class="record"><tr id="type-repr_agnostic_custom.write" class="anchored"><td class="def field"><a href="#type-repr_agnostic_custom.write" class="anchor"></a><code>write : rt. (<span class="keyword">module</span> <a href="../Json_repr/module-type-Repr/index.html">Json_repr.Repr</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="../Json_repr/module-type-Repr/index.html#type-value">value</a> = <span class="type-var">'rt</span>) <span>&#45;&gt;</span> <span class="type-var">'t</span> <span>&#45;&gt;</span> <span class="type-var">'rt</span>;</code></td></tr><tr id="type-repr_agnostic_custom.read" class="anchored"><td class="def field"><a href="#type-repr_agnostic_custom.read" class="anchor"></a><code>read : rf. (<span class="keyword">module</span> <a href="../Json_repr/module-type-Repr/index.html">Json_repr.Repr</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="../Json_repr/module-type-Repr/index.html#type-value">value</a> = <span class="type-var">'rf</span>) <span>&#45;&gt;</span> <span class="type-var">'rf</span> <span>&#45;&gt;</span> <span class="type-var">'t</span>;</code></td></tr></table><code>}</code></dt><dd><p>Custom encoders for an OCaml type, given both custom conversion functions. The actual representation is not known in advance, so the conversion functions have to examine / construct the JSON value through the first class modules they are passed. The <code>read</code> transformer function can <code>raise (Cannot_destruct ([], &quot;message&quot;))</code> to indicate an error, which will be relocated correctly.</p><p>Here is an example of how to build such a value for a type <code>'t</code>.</p><pre><code class="ml">let read
        : type tf. (module Json_repr.Repr with type value = tf) -&gt; tf -&gt; 't
        = fun (module Repr_f) repr -&gt;
          match Repr_f.view repr with
          | `Null (* destruct the JSON using [Repr_f.view] *) -&gt;
            (* create a value of type 't *)
          | _ -&gt;
            (* or fail with this wrapping exception *)
            raise (Cannot_destruct ([ (* location *) ], (* exn *))) in
      let write
        : type tf. (module Json_repr.Repr with type value = tf) -&gt; 't -&gt; tf
        = fun (module Repr_f) v -&gt;
          (* examine the value and produce a JSON using [Repr_f.repr] *)
          Repr_f.repr `Null in
      { read ; write } </code></pre></dd></dl><dl><dt class="spec value" id="val-repr_agnostic_custom"><a href="#val-repr_agnostic_custom" class="anchor"></a><code><span class="keyword">val</span> repr_agnostic_custom : <span class="type-var">'t</span> <a href="index.html#type-repr_agnostic_custom">repr_agnostic_custom</a> <span>&#45;&gt;</span> schema:<a href="../Json_schema/index.html#type-schema">Json_schema.schema</a> <span>&#45;&gt;</span> <span class="type-var">'t</span> <a href="index.html#type-encoding">encoding</a></code></dt><dd><p>A custom encoding, using custom encoders and a schema.</p></dd></dl><dl><dt class="spec value" id="val-any_value"><a href="#val-any_value" class="anchor"></a><code><span class="keyword">val</span> any_value : <a href="../Json_repr/index.html#type-any">Json_repr.any</a> <a href="index.html#type-encoding">encoding</a></code></dt><dd><p>A raw JSON value in its original representation.</p></dd></dl><dl><dt class="spec value" id="val-is_nullable"><a href="#val-is_nullable" class="anchor"></a><code><span class="keyword">val</span> is_nullable : <span class="type-var">'t</span> <a href="index.html#type-encoding">encoding</a> <span>&#45;&gt;</span> bool</code></dt><dd><p>Returns <code>true</code> is the encoding might construct <code>null</code>.</p></dd></dl></section></div></body></html>