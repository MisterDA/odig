<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>OpamCudf (opam-lib.OpamCudf)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – <a href="../index.html">opam-lib</a> &#x00BB; OpamCudf</nav><h1>Module <code>OpamCudf</code></h1><p>Cudf interface</p><nav class="toc"><ul><li><a href="#pretty-printing">Pretty-printing</a></li></ul></nav></header><dl><dt class="spec module" id="module-Set"><a href="#module-Set" class="anchor"></a><code><span class="keyword">module </span>Set : OpamStd.SET<span class="keyword"> with </span><span class="keyword">type </span><a href="index.html#module-Set">Set</a>.elt<span class="keyword"> = </span>Cudf.package</code></dt><dd><p>Cudf sets</p></dd></dl><dl><dt class="spec module" id="module-Map"><a href="#module-Map" class="anchor"></a><code><span class="keyword">module </span>Map : OpamStd.MAP<span class="keyword"> with </span><span class="keyword">type </span><a href="index.html#module-Map">Map</a>.key<span class="keyword"> = </span>Cudf.package</code></dt><dd><p>Cudf maps</p></dd></dl><dl><dt class="spec module" id="module-Graph"><a href="#module-Graph" class="anchor"></a><code><span class="keyword">module </span><a href="Graph/index.html">Graph</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>Cudf graph</p></dd></dl><dl><dt class="spec value" id="val-diff"><a href="#val-diff" class="anchor"></a><code><span class="keyword">val </span>diff : Cudf.universe <span>&#45;&gt;</span> Cudf.universe <span>&#45;&gt;</span> <a href="index.html#module-Set">Set</a>.t<span class="keyword"> * </span><a href="index.html#module-Set">Set</a>.t</code></dt><dd><p>Computation of differences between universe. Returns the sets of packages to install and remove respectively.</p></dd></dl><dl><dt class="spec module" id="module-ActionGraph"><a href="#module-ActionGraph" class="anchor"></a><code><span class="keyword">module </span>ActionGraph : OpamActionGraph.SIG<span class="keyword"> with </span><span class="keyword">type </span><a href="index.html#module-ActionGraph">ActionGraph</a>.package<span class="keyword"> = </span>Cudf.package</code></dt><dd><p>Cudf action graph</p></dd></dl><dl><dt class="spec type" id="type-conflict"><a href="#type-conflict" class="anchor"></a><code><span class="keyword">type </span>conflict</code></dt><dd><p>Abstract type that may be returned in case of conflicts</p></dd></dl><dl><dt class="spec value" id="val-dependencies"><a href="#val-dependencies" class="anchor"></a><code><span class="keyword">val </span>dependencies : Cudf.universe <span>&#45;&gt;</span> Cudf.package list <span>&#45;&gt;</span> Cudf.package list</code></dt><dd><p>Return the transitive closure of dependencies of <code>set</code>, sorted in topological order</p></dd></dl><dl><dt class="spec value" id="val-reverse_dependencies"><a href="#val-reverse_dependencies" class="anchor"></a><code><span class="keyword">val </span>reverse_dependencies : Cudf.universe <span>&#45;&gt;</span> Cudf.package list <span>&#45;&gt;</span> Cudf.package list</code></dt><dd><p>Return the transitive closure of dependencies of <code>set</code>, sorted in topological order</p></dd></dl><dl><dt class="spec value" id="val-check_request"><a href="#val-check_request" class="anchor"></a><code><span class="keyword">val </span>check_request : ?&#8288;explain:bool <span>&#45;&gt;</span> version_map:int OpamPackage.Map.t <span>&#45;&gt;</span> Cudf.universe <span>&#45;&gt;</span> Cudf_types.vpkg OpamTypes.request <span>&#45;&gt;</span> (Cudf.universe, <a href="index.html#type-conflict">conflict</a>) OpamTypes.result</code></dt><dd><p>Check if a request is satisfiable and return the reasons why not unless <code>explain</code> is set to <code>false</code></p></dd></dl><dl><dt class="spec value" id="val-get_final_universe"><a href="#val-get_final_universe" class="anchor"></a><code><span class="keyword">val </span>get_final_universe : version_map:int OpamPackage.Map.t <span>&#45;&gt;</span> Cudf.universe <span>&#45;&gt;</span> Cudf_types.vpkg OpamTypes.request <span>&#45;&gt;</span> (Cudf.universe, <a href="index.html#type-conflict">conflict</a>) OpamTypes.result</code></dt><dd><p>Compute the final universe state using the external solver.</p></dd></dl><dl><dt class="spec value" id="val-actions_of_diff"><a href="#val-actions_of_diff" class="anchor"></a><code><span class="keyword">val </span>actions_of_diff : (<a href="index.html#module-Set">Set</a>.t<span class="keyword"> * </span><a href="index.html#module-Set">Set</a>.t) <span>&#45;&gt;</span> Cudf.package OpamTypes.atomic_action list</code></dt><dd><p>Compute the list of actions to match the difference between two universe. Remark: the result order is unspecified, ie. need to use <code>atomic_actions</code> to get a solution which respects the topological order induced by dependencies.</p></dd></dl><dl><dt class="spec exception" id="exception-Cyclic_actions"><a href="#exception-Cyclic_actions" class="anchor"></a><code><span class="keyword">exception </span></code><code><span class="exception">Cyclic_actions</span><span class="keyword"> of </span>Cudf.package OpamTypes.action list list</code></dt></dl><dl><dt class="spec value" id="val-atomic_actions"><a href="#val-atomic_actions" class="anchor"></a><code><span class="keyword">val </span>atomic_actions : simple_universe:Cudf.universe <span>&#45;&gt;</span> complete_universe:Cudf.universe <span>&#45;&gt;</span> [&lt; Cudf.package OpamTypes.highlevel_action ] list <span>&#45;&gt;</span> <a href="index.html#module-ActionGraph">ActionGraph</a>.t</code></dt><dd><p>Computes the actions to process from a solution, from the actions obtained by a simple universe diff. The 'simple' universe should not contain build dependencies and will be used for resolution ; <code>complete_universe</code> should include build-deps, it's used to get the dependency ordering of actions.</p><p>Returns a graph of atomic actions, i.e. only removals and installs. Use <code>reduce_actions</code> to reduce it to a graph including reinstall and up/down-grade actions.</p><p>May raise <code>Cyclic_actions</code>.</p></dd></dl><dl><dt class="spec value" id="val-compute_root_causes"><a href="#val-compute_root_causes" class="anchor"></a><code><span class="keyword">val </span>compute_root_causes : <a href="index.html#module-ActionGraph">ActionGraph</a>.t <span>&#45;&gt;</span> OpamPackage.Name.Set.t <span>&#45;&gt;</span> Cudf.package OpamTypes.cause <a href="index.html#module-Map">Map</a>.t</code></dt><dd><p>Heuristic to compute the likely cause of all actions in a graph from the set of packages passed in the original request. Assumes a reduced graph.</p></dd></dl><dl><dt class="spec value" id="val-resolve"><a href="#val-resolve" class="anchor"></a><code><span class="keyword">val </span>resolve : extern:bool <span>&#45;&gt;</span> version_map:int OpamPackage.Map.t <span>&#45;&gt;</span> Cudf.universe <span>&#45;&gt;</span> Cudf_types.vpkg OpamTypes.request <span>&#45;&gt;</span> (Cudf.universe, <a href="index.html#type-conflict">conflict</a>) OpamTypes.result</code></dt><dd><p>Resolve a CUDF request. The result is either a conflict holding an explanation of the error, or a resulting universe. <code>~extern</code> specifies whether the external solver should be used</p></dd></dl><dl><dt class="spec value" id="val-to_actions"><a href="#val-to_actions" class="anchor"></a><code><span class="keyword">val </span>to_actions : (Cudf.universe <span>&#45;&gt;</span> Cudf.universe) <span>&#45;&gt;</span> Cudf.universe <span>&#45;&gt;</span> (Cudf.universe, <a href="index.html#type-conflict">conflict</a>) OpamTypes.result <span>&#45;&gt;</span> (Cudf.package OpamTypes.atomic_action list, <a href="index.html#type-conflict">conflict</a>) OpamTypes.result</code></dt><dd><p>Computes a list of actions to proceed from the result of <code>resolve</code>. Note however than the action list is not yet complete: the transitive closure of reinstallations is not yet completed, as it requires to fold over the dependency graph in considering the optional dependencies. The first argument specifies a function that will be applied to the starting universe before computation: useful to re-add orphan packages.</p></dd></dl><dl><dt class="spec value" id="val-remove"><a href="#val-remove" class="anchor"></a><code><span class="keyword">val </span>remove : Cudf.universe <span>&#45;&gt;</span> Cudf_types.pkgname <span>&#45;&gt;</span> Cudf_types.constr <span>&#45;&gt;</span> Cudf.universe</code></dt><dd><p><code>remove universe name constr</code> Remove all the packages called <code>name</code> satisfying the constraints <code>constr</code> in the universe <code>universe</code>.</p></dd></dl><dl><dt class="spec value" id="val-uninstall_all"><a href="#val-uninstall_all" class="anchor"></a><code><span class="keyword">val </span>uninstall_all : Cudf.universe <span>&#45;&gt;</span> Cudf.universe</code></dt><dd><p>Uninstall all the package in the universe.</p></dd></dl><dl><dt class="spec value" id="val-install"><a href="#val-install" class="anchor"></a><code><span class="keyword">val </span>install : Cudf.universe <span>&#45;&gt;</span> Cudf.package <span>&#45;&gt;</span> Cudf.universe</code></dt><dd><p>Install a package in the universe. We don't care about any invariant here (eg. the resulting universe can have mutliple versions of the same package installed).</p></dd></dl><dl><dt class="spec value" id="val-remove_all_uninstalled_versions_but"><a href="#val-remove_all_uninstalled_versions_but" class="anchor"></a><code><span class="keyword">val </span>remove_all_uninstalled_versions_but : Cudf.universe <span>&#45;&gt;</span> string <span>&#45;&gt;</span> Cudf_types.constr <span>&#45;&gt;</span> Cudf.universe</code></dt><dd><p>Remove all the versions of a given package, but the one given as argument.</p></dd></dl><dl><dt class="spec value" id="val-s_source"><a href="#val-s_source" class="anchor"></a><code><span class="keyword">val </span>s_source : string</code></dt><dd><p>Cudf labels for package fields in the cudf format (use for the field Cudf.pkg_extra and with Cudf.lookup_package_property)</p><p>the original OPAM package name (as string)</p></dd></dl><dl><dt class="spec value" id="val-s_source_number"><a href="#val-s_source_number" class="anchor"></a><code><span class="keyword">val </span>s_source_number : string</code></dt><dd><p>the original OPAM package name (as string)</p><p>the original OPAM package version (as string)</p></dd></dl><dl><dt class="spec value" id="val-s_reinstall"><a href="#val-s_reinstall" class="anchor"></a><code><span class="keyword">val </span>s_reinstall : string</code></dt><dd><p>the original OPAM package version (as string)</p><p>a package to be reinstalled (a bool)</p></dd></dl><dl><dt class="spec value" id="val-s_installed_root"><a href="#val-s_installed_root" class="anchor"></a><code><span class="keyword">val </span>s_installed_root : string</code></dt><dd><p>a package to be reinstalled (a bool)</p><p>true if this package belongs to the roots (&quot;installed manually&quot;) packages</p></dd></dl><dl><dt class="spec value" id="val-s_pinned"><a href="#val-s_pinned" class="anchor"></a><code><span class="keyword">val </span>s_pinned : string</code></dt><dd><p>true if this package belongs to the roots (&quot;installed manually&quot;) packages</p><p>true if the package is pinned to this version</p></dd></dl><dl><dt class="spec value" id="val-s_version_lag"><a href="#val-s_version_lag" class="anchor"></a><code><span class="keyword">val </span>s_version_lag : string</code></dt><dd><p>true if the package is pinned to this version</p><p>the number of versions of the package since this one</p></dd></dl><section><header><h3 id="pretty-printing"><a href="#pretty-printing" class="anchor"></a>Pretty-printing</h3></header><dl><dt class="spec value" id="val-string_of_vpkgs"><a href="#val-string_of_vpkgs" class="anchor"></a><code><span class="keyword">val </span>string_of_vpkgs : Cudf_types.vpkg list <span>&#45;&gt;</span> string</code></dt><dd><p>Convert a package constraint to something readable.</p></dd></dl><dl><dt class="spec value" id="val-make_conflicts"><a href="#val-make_conflicts" class="anchor"></a><code><span class="keyword">val </span>make_conflicts : version_map:int OpamTypes.package_map <span>&#45;&gt;</span> Cudf.universe <span>&#45;&gt;</span> Algo.Diagnostic.diagnosis <span>&#45;&gt;</span> (<span class="type-var">'a</span>, <a href="index.html#type-conflict">conflict</a>) OpamTypes.result</code></dt><dt class="spec value" id="val-cycle_conflict"><a href="#val-cycle_conflict" class="anchor"></a><code><span class="keyword">val </span>cycle_conflict : version_map:int OpamTypes.package_map <span>&#45;&gt;</span> Cudf.universe <span>&#45;&gt;</span> string list list <span>&#45;&gt;</span> (<span class="type-var">'a</span>, <a href="index.html#type-conflict">conflict</a>) OpamTypes.result</code></dt><dt class="spec value" id="val-string_of_conflict"><a href="#val-string_of_conflict" class="anchor"></a><code><span class="keyword">val </span>string_of_conflict : (OpamTypes.atom <span>&#45;&gt;</span> string) <span>&#45;&gt;</span> <a href="index.html#type-conflict">conflict</a> <span>&#45;&gt;</span> string</code></dt><dd><p>Convert a conflict to something readable by the user. The first argument should return a string like &quot;lwt&lt;3.2.1 is not available because...&quot; when called on an unavailable package (the reason can't be known this deep in the solver)</p></dd></dl><dl><dt class="spec value" id="val-strings_of_conflict"><a href="#val-strings_of_conflict" class="anchor"></a><code><span class="keyword">val </span>strings_of_conflict : (OpamTypes.atom <span>&#45;&gt;</span> string) <span>&#45;&gt;</span> <a href="index.html#type-conflict">conflict</a> <span>&#45;&gt;</span> string list<span class="keyword"> * </span>string list<span class="keyword"> * </span>string list</code></dt><dd><p>Returns three lists of strings:</p><ul><li>the final reasons why the request can't be satisfied</li><li>the dependency chains explaining it</li><li>the cycles in the actions to process (exclusive with the other two)</li></ul></dd></dl><dl><dt class="spec value" id="val-conflict_chains"><a href="#val-conflict_chains" class="anchor"></a><code><span class="keyword">val </span>conflict_chains : <a href="index.html#type-conflict">conflict</a> <span>&#45;&gt;</span> OpamFormula.t list list</code></dt><dt class="spec value" id="val-dump_universe"><a href="#val-dump_universe" class="anchor"></a><code><span class="keyword">val </span>dump_universe : Pervasives.out_channel <span>&#45;&gt;</span> Cudf.universe <span>&#45;&gt;</span> unit</code></dt><dd><p>Dumps the given cudf universe to the given channel</p></dd></dl><dl><dt class="spec value" id="val-string_of_atom"><a href="#val-string_of_atom" class="anchor"></a><code><span class="keyword">val </span>string_of_atom : Cudf_types.vpkg <span>&#45;&gt;</span> string</code></dt><dd><p>Pretty-print atoms</p></dd></dl><dl><dt class="spec value" id="val-string_of_request"><a href="#val-string_of_request" class="anchor"></a><code><span class="keyword">val </span>string_of_request : Cudf_types.vpkg OpamTypes.request <span>&#45;&gt;</span> string</code></dt><dd><p>Pretty-print requests</p></dd></dl><dl><dt class="spec value" id="val-string_of_universe"><a href="#val-string_of_universe" class="anchor"></a><code><span class="keyword">val </span>string_of_universe : Cudf.universe <span>&#45;&gt;</span> string</code></dt><dd><p>Pretty-print the universe</p></dd></dl><dl><dt class="spec value" id="val-string_of_packages"><a href="#val-string_of_packages" class="anchor"></a><code><span class="keyword">val </span>string_of_packages : Cudf.package list <span>&#45;&gt;</span> string</code></dt><dd><p>Pretty-print of packages</p></dd></dl><dl><dt class="spec value" id="val-cudf2opam"><a href="#val-cudf2opam" class="anchor"></a><code><span class="keyword">val </span>cudf2opam : Cudf.package <span>&#45;&gt;</span> OpamTypes.package</code></dt><dd><p>Convert a cudf package back to an OPAM package</p></dd></dl><dl><dt class="spec value" id="val-packages"><a href="#val-packages" class="anchor"></a><code><span class="keyword">val </span>packages : Cudf.universe <span>&#45;&gt;</span> Cudf.package list</code></dt><dd><p>Returns the list of packages in a Cudf universe</p></dd></dl><dl><dt class="spec value" id="val-external_solver_available"><a href="#val-external_solver_available" class="anchor"></a><code><span class="keyword">val </span>external_solver_available : unit <span>&#45;&gt;</span> bool</code></dt><dd><h3 id="external-solver"><a href="#external-solver" class="anchor"></a>External solver</h3></dd></dl><dl><dt class="spec value" id="val-to_cudf"><a href="#val-to_cudf" class="anchor"></a><code><span class="keyword">val </span>to_cudf : Cudf.universe <span>&#45;&gt;</span> Cudf_types.vpkg OpamTypes.request <span>&#45;&gt;</span> Cudf.preamble<span class="keyword"> * </span>Cudf.universe<span class="keyword"> * </span>Cudf.request</code></dt><dd><p>Converts an OPAM request to a Cudf request</p></dd></dl></section></div></body></html>