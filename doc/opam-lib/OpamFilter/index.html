<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>OpamFilter (opam-lib.OpamFilter)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../index.html">opam-lib</a> &#x00BB; OpamFilter</nav><h1>Module <code>OpamFilter</code></h1><p>Manage filters</p></header><aside><p>Filters are a small language of formulas over strings and booleans used for conditions and text replacements. It has relational operators over strings (using version-number comparison), And, Or and Not boolean operations, dynamic casting (using strings &quot;true&quot; and &quot;false&quot;), and string interpolation. Variables are resolved using a user function returning an option, undefined values are propagated.</p><p>String interpolation uses the syntax '%<i>dentifier</i>%'</p><p>Identifiers have the form </p><pre>[package:]var[?str_if_true:str_if_false_or_undef]v}.
    The last optional part specifies a conversion from boolean to static strings.

    The syntax [pkg1+pkg2+pkgn:var] is allowed as a shortcut to
    [pkg1:var &amp; pkg2:var &amp; pkgn:var].

    The special variable [pkg:enable] is allowed as a shortcut for
    [pkg:installed?enable:disable]</pre></aside><dl><dt class="spec value" id="val-to_string"><a href="#val-to_string" class="anchor"></a><code><span class="keyword">val </span>to_string : OpamTypes.filter <span>&#45;&gt;</span> string</code></dt><dd><p>Pretty-print</p></dd></dl><dl><dt class="spec value" id="val-fold_down_left"><a href="#val-fold_down_left" class="anchor"></a><code><span class="keyword">val </span>fold_down_left : (<span class="type-var">'a</span> <span>&#45;&gt;</span> OpamTypes.filter <span>&#45;&gt;</span> <span class="type-var">'a</span>) <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> OpamTypes.filter <span>&#45;&gt;</span> <span class="type-var">'a</span></code></dt><dd><p>Folds on the tree of a filter</p></dd></dl><dl><dt class="spec value" id="val-variables"><a href="#val-variables" class="anchor"></a><code><span class="keyword">val </span>variables : OpamTypes.filter <span>&#45;&gt;</span> OpamTypes.full_variable list</code></dt><dd><p>Returns all the variables appearing in a filter (including the ones within string interpolations</p></dd></dl><dl><dt class="spec type" id="type-env"><a href="#type-env" class="anchor"></a><code><span class="keyword">type </span>env</code><code><span class="keyword"> = </span>OpamTypes.full_variable <span>&#45;&gt;</span> OpamTypes.variable_contents option</code></dt><dd><p>Type of filter environment.</p></dd></dl><dl><dt class="spec type" id="type-fident"><a href="#type-fident" class="anchor"></a><code><span class="keyword">type </span>fident</code><code><span class="keyword"> = </span>OpamTypes.name list<span class="keyword"> * </span>OpamTypes.variable<span class="keyword"> * </span>(string<span class="keyword"> * </span>string) option</code></dt><dd><p>The type of filter idents with (optionally multiple) qualifying package names and optional string converter</p></dd></dl><dl><dt class="spec value" id="val-expand_string"><a href="#val-expand_string" class="anchor"></a><code><span class="keyword">val </span>expand_string : <a href="index.html#type-env">env</a> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> string</code></dt><dd><p>Rewrites string interpolations within a string</p></dd></dl><dl><dt class="spec value" id="val-eval"><a href="#val-eval" class="anchor"></a><code><span class="keyword">val </span>eval : ?&#8288;default:OpamTypes.variable_contents <span>&#45;&gt;</span> <a href="index.html#type-env">env</a> <span>&#45;&gt;</span> OpamTypes.filter <span>&#45;&gt;</span> OpamTypes.variable_contents</code></dt><dd><p>Computes the value of a filter. May raise <code>Failure</code> if <code>default</code> isn't provided</p></dd></dl><dl><dt class="spec value" id="val-eval_to_bool"><a href="#val-eval_to_bool" class="anchor"></a><code><span class="keyword">val </span>eval_to_bool : ?&#8288;default:bool <span>&#45;&gt;</span> <a href="index.html#type-env">env</a> <span>&#45;&gt;</span> OpamTypes.filter <span>&#45;&gt;</span> bool</code></dt><dd><p>Like <code>to_value</code> but casts the result to a bool. Raises <code>Invalid_argument</code> if not a valid bool and no default supplied.</p></dd></dl><dl><dt class="spec value" id="val-opt_eval_to_bool"><a href="#val-opt_eval_to_bool" class="anchor"></a><code><span class="keyword">val </span>opt_eval_to_bool : <a href="index.html#type-env">env</a> <span>&#45;&gt;</span> OpamTypes.filter option <span>&#45;&gt;</span> bool</code></dt><dd><p>Same as <code>eval_to_bool</code>, but takes an option as filter and returns always <code>true</code> on <code>None</code>, <code>false</code> when the filter is <code>Undefined</code>. This is the most common behaviour for using &quot;filters&quot; for filtering</p></dd></dl><dl><dt class="spec value" id="val-eval_to_string"><a href="#val-eval_to_string" class="anchor"></a><code><span class="keyword">val </span>eval_to_string : ?&#8288;default:string <span>&#45;&gt;</span> <a href="index.html#type-env">env</a> <span>&#45;&gt;</span> OpamTypes.filter <span>&#45;&gt;</span> string</code></dt><dd><p>Like <code>to_value</code> but casts the result to a string</p></dd></dl><dl><dt class="spec value" id="val-ident_of_var"><a href="#val-ident_of_var" class="anchor"></a><code><span class="keyword">val </span>ident_of_var : OpamTypes.full_variable <span>&#45;&gt;</span> <a href="index.html#type-fident">fident</a></code></dt><dd><p>Wraps a full_variable into a fident accessor</p></dd></dl><dl><dt class="spec value" id="val-ident_of_string"><a href="#val-ident_of_string" class="anchor"></a><code><span class="keyword">val </span>ident_of_string : string <span>&#45;&gt;</span> <a href="index.html#type-fident">fident</a></code></dt><dd><p>A fident accessor directly referring a variable with the given name</p></dd></dl><dl><dt class="spec value" id="val-ident_value"><a href="#val-ident_value" class="anchor"></a><code><span class="keyword">val </span>ident_value : ?&#8288;default:OpamTypes.variable_contents <span>&#45;&gt;</span> <a href="index.html#type-env">env</a> <span>&#45;&gt;</span> <a href="index.html#type-fident">fident</a> <span>&#45;&gt;</span> OpamTypes.variable_contents</code></dt><dd><p>Resolves a filter ident. Like <code>eval</code>, may raise Failure if no default is provided</p></dd></dl><dl><dt class="spec value" id="val-ident_string"><a href="#val-ident_string" class="anchor"></a><code><span class="keyword">val </span>ident_string : ?&#8288;default:string <span>&#45;&gt;</span> <a href="index.html#type-env">env</a> <span>&#45;&gt;</span> <a href="index.html#type-fident">fident</a> <span>&#45;&gt;</span> string</code></dt><dd><p>Like <code>ident_value</code>, but casts the result to a string</p></dd></dl><dl><dt class="spec value" id="val-ident_bool"><a href="#val-ident_bool" class="anchor"></a><code><span class="keyword">val </span>ident_bool : ?&#8288;default:bool <span>&#45;&gt;</span> <a href="index.html#type-env">env</a> <span>&#45;&gt;</span> <a href="index.html#type-fident">fident</a> <span>&#45;&gt;</span> bool</code></dt><dd><p>Like <code>ident_value</code>, but casts the result to a bool</p></dd></dl><dl><dt class="spec value" id="val-expand_interpolations_in_file"><a href="#val-expand_interpolations_in_file" class="anchor"></a><code><span class="keyword">val </span>expand_interpolations_in_file : <a href="index.html#type-env">env</a> <span>&#45;&gt;</span> OpamTypes.basename <span>&#45;&gt;</span> unit</code></dt><dd><p>Rewrites <code>basename</code>.in to <code>basename</code>, expanding interpolations</p></dd></dl><dl><dt class="spec value" id="val-commands"><a href="#val-commands" class="anchor"></a><code><span class="keyword">val </span>commands : <a href="index.html#type-env">env</a> <span>&#45;&gt;</span> OpamTypes.command list <span>&#45;&gt;</span> string list list</code></dt><dd><p>Processes filters evaluation in a command list: parameter expansion and conditional filtering</p></dd></dl><dl><dt class="spec value" id="val-single_command"><a href="#val-single_command" class="anchor"></a><code><span class="keyword">val </span>single_command : <a href="index.html#type-env">env</a> <span>&#45;&gt;</span> OpamTypes.arg list <span>&#45;&gt;</span> string list</code></dt><dd><p>Process a simpler command, without filters</p></dd></dl><dl><dt class="spec value" id="val-commands_variables"><a href="#val-commands_variables" class="anchor"></a><code><span class="keyword">val </span>commands_variables : OpamTypes.command list <span>&#45;&gt;</span> OpamTypes.full_variable list</code></dt><dd><p>Extracts variables appearing in a list of commands</p></dd></dl></div></body></html>