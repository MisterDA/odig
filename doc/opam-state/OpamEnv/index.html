<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>OpamEnv (opam-state.OpamEnv)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../index.html">opam-state</a> &#x00BB; OpamEnv</nav><h1>Module <code>OpamEnv</code></h1><p>Process environment setup and handling, shell configuration</p><nav class="toc"><ul><li><a href="#environment-handling">Environment handling</a></li><li><a href="#shell-and-initialisation-support">Shell and initialisation support</a></li></ul></nav></header><section><header><h3 id="environment-handling"><a href="#environment-handling" class="anchor"></a>Environment handling</h3></header><dl><dt class="spec value" id="val-get_full"><a href="#val-get_full" class="anchor"></a><code><span class="keyword">val </span>get_full : ?&#8288;set_opamroot:bool <span>&#45;&gt;</span> ?&#8288;set_opamswitch:bool <span>&#45;&gt;</span> force_path:bool <span>&#45;&gt;</span> ?&#8288;updates:OpamTypes.env_update list <span>&#45;&gt;</span> <span class="type-var">'a</span> OpamStateTypes.switch_state <span>&#45;&gt;</span> OpamTypes.env</code></dt><dd><p>Get the current environment with OPAM specific additions. If <code>force_path</code>, the PATH is modified to ensure opam dirs are leading. <code>set_opamroot</code> and <code>set_opamswitch</code> can be additionally used to set the <code>OPAMROOT</code> and <code>OPAMSWITCH</code> variables.</p></dd></dl><dl><dt class="spec value" id="val-get_opam"><a href="#val-get_opam" class="anchor"></a><code><span class="keyword">val </span>get_opam : ?&#8288;set_opamroot:bool <span>&#45;&gt;</span> ?&#8288;set_opamswitch:bool <span>&#45;&gt;</span> force_path:bool <span>&#45;&gt;</span> <span class="type-var">'a</span> OpamStateTypes.switch_state <span>&#45;&gt;</span> OpamTypes.env</code></dt><dd><p>Get only environment modified by OPAM. If <code>force_path</code>, the PATH is modified to ensure opam dirs are leading. <code>set_opamroot</code> and <code>set_opamswitch</code> can be additionally used to set the <code>OPAMROOT</code> and <code>OPAMSWITCH</code> variables.</p></dd></dl><dl><dt class="spec value" id="val-get_opam_raw"><a href="#val-get_opam_raw" class="anchor"></a><code><span class="keyword">val </span>get_opam_raw : ?&#8288;set_opamroot:bool <span>&#45;&gt;</span> ?&#8288;set_opamswitch:bool <span>&#45;&gt;</span> force_path:bool <span>&#45;&gt;</span> OpamTypes.dirname <span>&#45;&gt;</span> OpamTypes.switch <span>&#45;&gt;</span> OpamTypes.env</code></dt><dd><p>Like <code>get_opam</code>, but reads the cache file from the given opam root and switch instead of computing the environment from a switch state</p></dd></dl><dl><dt class="spec value" id="val-get_pure"><a href="#val-get_pure" class="anchor"></a><code><span class="keyword">val </span>get_pure : ?&#8288;updates:OpamTypes.env_update list <span>&#45;&gt;</span> unit <span>&#45;&gt;</span> OpamTypes.env</code></dt><dd><p>Returns the running environment, with any opam modifications cleaned out, and optionally the given updates</p></dd></dl><dl><dt class="spec value" id="val-add"><a href="#val-add" class="anchor"></a><code><span class="keyword">val </span>add : OpamTypes.env <span>&#45;&gt;</span> OpamTypes.env_update list <span>&#45;&gt;</span> OpamTypes.env</code></dt><dd><p>Update an environment, including reverting opam changes that could have been previously applied (therefore, don't apply to an already updated env as returned by e.g. <code>get_full</code>!)</p></dd></dl><dl><dt class="spec value" id="val-updates"><a href="#val-updates" class="anchor"></a><code><span class="keyword">val </span>updates : ?&#8288;set_opamroot:bool <span>&#45;&gt;</span> ?&#8288;set_opamswitch:bool <span>&#45;&gt;</span> ?&#8288;force_path:bool <span>&#45;&gt;</span> <span class="type-var">'a</span> OpamStateTypes.switch_state <span>&#45;&gt;</span> OpamTypes.env_update list</code></dt><dd><p>Like <code>get_opam</code> computes environment modification by OPAM , but returns these <code>updates</code> instead of the new environment.</p></dd></dl><dl><dt class="spec value" id="val-is_up_to_date"><a href="#val-is_up_to_date" class="anchor"></a><code><span class="keyword">val </span>is_up_to_date : <span class="type-var">'a</span> OpamStateTypes.switch_state <span>&#45;&gt;</span> bool</code></dt><dd><p>Check if the shell environment is in sync with the current OPAM switch (or if OPAMNOENVNOTICE has been set, in which case we just assume it's up to date)</p></dd></dl><dl><dt class="spec value" id="val-is_up_to_date_switch"><a href="#val-is_up_to_date_switch" class="anchor"></a><code><span class="keyword">val </span>is_up_to_date_switch : OpamTypes.dirname <span>&#45;&gt;</span> OpamTypes.switch <span>&#45;&gt;</span> bool</code></dt><dd><p>Check if the shell environment is in sync with the given opam root and switch (or if OPAMNOENVNOTICE has been set, in which case we just assume it's up to date)</p></dd></dl><dl><dt class="spec value" id="val-compute_updates"><a href="#val-compute_updates" class="anchor"></a><code><span class="keyword">val </span>compute_updates : ?&#8288;force_path:bool <span>&#45;&gt;</span> <span class="type-var">'a</span> OpamStateTypes.switch_state <span>&#45;&gt;</span> OpamTypes.env_update list</code></dt><dd><p>Returns the current environment updates to configure the current switch with its set of installed packages</p></dd></dl><dl><dt class="spec value" id="val-eval_string"><a href="#val-eval_string" class="anchor"></a><code><span class="keyword">val </span>eval_string : <span class="type-var">'a</span> OpamStateTypes.global_state <span>&#45;&gt;</span> ?&#8288;set_opamswitch:bool <span>&#45;&gt;</span> OpamTypes.switch option <span>&#45;&gt;</span> string</code></dt><dd><p>The shell command to run by the user to set his OPAM environment, adapted to the current shell (as returned by <code>eval `opam config env`</code>)</p></dd></dl><dl><dt class="spec value" id="val-path"><a href="#val-path" class="anchor"></a><code><span class="keyword">val </span>path : force_path:bool <span>&#45;&gt;</span> OpamTypes.dirname <span>&#45;&gt;</span> OpamTypes.switch <span>&#45;&gt;</span> string</code></dt><dd><p>Returns the updated contents of the PATH variable for the given opam root and switch (set <code>force_path</code> to ensure the opam path is leading)</p></dd></dl><dl><dt class="spec value" id="val-full_with_path"><a href="#val-full_with_path" class="anchor"></a><code><span class="keyword">val </span>full_with_path : force_path:bool <span>&#45;&gt;</span> ?&#8288;updates:OpamTypes.env_update list <span>&#45;&gt;</span> OpamTypes.dirname <span>&#45;&gt;</span> OpamTypes.switch <span>&#45;&gt;</span> OpamTypes.env</code></dt><dd><p>Returns the full environment with only the PATH variable updated, as per <code>path</code></p></dd></dl></section><section><header><h3 id="shell-and-initialisation-support"><a href="#shell-and-initialisation-support" class="anchor"></a>Shell and initialisation support</h3></header><dl><dt class="spec value" id="val-setup"><a href="#val-setup" class="anchor"></a><code><span class="keyword">val </span>setup : OpamTypes.dirname <span>&#45;&gt;</span> interactive:bool <span>&#45;&gt;</span> ?&#8288;dot_profile:OpamTypes.filename <span>&#45;&gt;</span> ?&#8288;update_config:bool <span>&#45;&gt;</span> ?&#8288;env_hook:bool <span>&#45;&gt;</span> ?&#8288;completion:bool <span>&#45;&gt;</span> OpamTypes.shell <span>&#45;&gt;</span> unit</code></dt><dd><p>Sets the opam configuration in the user shell, after detailing the process and asking the user if either <code>update_config</code> or <code>shell_hook</code> are unset</p></dd></dl><dl><dt class="spec value" id="val-update_user_setup"><a href="#val-update_user_setup" class="anchor"></a><code><span class="keyword">val </span>update_user_setup : OpamTypes.dirname <span>&#45;&gt;</span> ?&#8288;dot_profile:OpamTypes.filename <span>&#45;&gt;</span> OpamTypes.shell <span>&#45;&gt;</span> unit</code></dt><dd><p>Update the user configuration in $HOME for good opam integration.</p></dd></dl><dl><dt class="spec value" id="val-write_static_init_scripts"><a href="#val-write_static_init_scripts" class="anchor"></a><code><span class="keyword">val </span>write_static_init_scripts : OpamTypes.dirname <span>&#45;&gt;</span> ?&#8288;completion:bool <span>&#45;&gt;</span> ?&#8288;env_hook:bool <span>&#45;&gt;</span> unit <span>&#45;&gt;</span> unit</code></dt><dd><p>Write the generic scripts in ~/.opam/opam-init needed to import state for various shells. If specified, completion and env_hook files can also be written or removed (the default is to keep them as they are)</p></dd></dl><dl><dt class="spec value" id="val-write_custom_init_scripts"><a href="#val-write_custom_init_scripts" class="anchor"></a><code><span class="keyword">val </span>write_custom_init_scripts : OpamTypes.dirname <span>&#45;&gt;</span> (string<span class="keyword"> * </span>string) list <span>&#45;&gt;</span> unit</code></dt><dd><p>Write into <code>OpamPath.hooks_dir</code> the given custom scripts (listed as (filename, content)), normally provided by opamrc (<code>OpamFile.InitConfig</code>)</p></dd></dl><dl><dt class="spec value" id="val-write_dynamic_init_scripts"><a href="#val-write_dynamic_init_scripts" class="anchor"></a><code><span class="keyword">val </span>write_dynamic_init_scripts : <span class="type-var">'a</span> OpamStateTypes.switch_state <span>&#45;&gt;</span> unit</code></dt><dd><p>Update the shell scripts containing the current switch configuration in ~/.opam/opam-init ; prints a warning and skips if a write lock on the global state can't be acquired (note: it would be better to acquire a write lock beforehand, but only when working on the switch selected in ~/.opam/config)</p></dd></dl><dl><dt class="spec value" id="val-clear_dynamic_init_scripts"><a href="#val-clear_dynamic_init_scripts" class="anchor"></a><code><span class="keyword">val </span>clear_dynamic_init_scripts : OpamStateTypes.rw OpamStateTypes.global_state <span>&#45;&gt;</span> unit</code></dt><dd><p>Removes the dynamic init scripts setting the variables for any given switch.</p></dd></dl><dl><dt class="spec value" id="val-check_and_print_env_warning"><a href="#val-check_and_print_env_warning" class="anchor"></a><code><span class="keyword">val </span>check_and_print_env_warning : <span class="type-var">'a</span> OpamStateTypes.switch_state <span>&#45;&gt;</span> unit</code></dt><dd><p>Print a warning if the environment is not set-up properly. (General message)</p></dd></dl></section></div></body></html>