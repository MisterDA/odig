<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>OpamGlobalState (opam-state.OpamGlobalState)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../index.html">opam-state</a> &#x00BB; OpamGlobalState</nav><h1>Module <code>OpamGlobalState</code></h1><p>Loading and handling of the global state of an opam root</p></header><dl><dt class="spec value" id="val-load"><a href="#val-load" class="anchor"></a><code><span class="keyword">val </span>load : <span class="type-var">'a</span> OpamStateTypes.lock <span>&#45;&gt;</span> <span class="type-var">'a</span> OpamStateTypes.global_state</code></dt><dd><p>Loads the global state (from the opam root obtained through <code>OpamStateConfig.(!r.root)</code>)</p></dd></dl><dl><dt class="spec value" id="val-with_"><a href="#val-with_" class="anchor"></a><code><span class="keyword">val </span>with_ : <span class="type-var">'a</span> OpamStateTypes.lock <span>&#45;&gt;</span> (<span class="type-var">'a</span> OpamStateTypes.global_state <span>&#45;&gt;</span> <span class="type-var">'b</span>) <span>&#45;&gt;</span> <span class="type-var">'b</span></code></dt><dd><p>Loads the global state as <code>load</code>, and calls the given function while keeping it locked (as per the <code>lock</code> argument), releasing the lock afterwards</p></dd></dl><dl><dt class="spec value" id="val-all_installed"><a href="#val-all_installed" class="anchor"></a><code><span class="keyword">val </span>all_installed : <span class="type-var">'a</span> OpamStateTypes.global_state <span>&#45;&gt;</span> OpamTypes.package_set</code></dt><dd><p>The set of all installed packages, in any switch</p></dd></dl><dl><dt class="spec value" id="val-switches"><a href="#val-switches" class="anchor"></a><code><span class="keyword">val </span>switches : <span class="type-var">'a</span> OpamStateTypes.global_state <span>&#45;&gt;</span> OpamTypes.switch list</code></dt><dt class="spec value" id="val-fold_switches"><a href="#val-fold_switches" class="anchor"></a><code><span class="keyword">val </span>fold_switches : (OpamTypes.switch <span>&#45;&gt;</span> OpamTypes.switch_selections <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'a</span>) <span>&#45;&gt;</span> <span class="type-var">'b</span> OpamStateTypes.global_state <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'a</span></code></dt><dt class="spec value" id="val-switch_exists"><a href="#val-switch_exists" class="anchor"></a><code><span class="keyword">val </span>switch_exists : <span class="type-var">'a</span> OpamStateTypes.global_state <span>&#45;&gt;</span> OpamTypes.switch <span>&#45;&gt;</span> bool</code></dt><dd><p>Checks a switch for existence: either configured in the opam root, or an existing local switch with a configuration file pointing to the current root</p></dd></dl><dl><dt class="spec value" id="val-installed_versions"><a href="#val-installed_versions" class="anchor"></a><code><span class="keyword">val </span>installed_versions : <span class="type-var">'a</span> OpamStateTypes.global_state <span>&#45;&gt;</span> OpamTypes.name <span>&#45;&gt;</span> OpamTypes.switch list OpamTypes.package_map</code></dt><dd><p>Returns the map of installed instances of the package name towards the list of switches they are installed in</p></dd></dl><dl><dt class="spec value" id="val-repos_list"><a href="#val-repos_list" class="anchor"></a><code><span class="keyword">val </span>repos_list : <span class="type-var">'a</span> OpamStateTypes.global_state <span>&#45;&gt;</span> OpamTypes.repository_name list</code></dt><dd><p>Default list of repositories to get packages from, ordered by decreasing priority. This can be overriden by switch-specific selections, and does not have to include all configured repositories.</p></dd></dl><dl><dt class="spec value" id="val-unlock"><a href="#val-unlock" class="anchor"></a><code><span class="keyword">val </span>unlock : <span class="type-var">'a</span> OpamStateTypes.global_state <span>&#45;&gt;</span> OpamStateTypes.unlocked OpamStateTypes.global_state</code></dt><dd><p>Releases any locks on the given global_state</p></dd></dl><dl><dt class="spec value" id="val-with_write_lock"><a href="#val-with_write_lock" class="anchor"></a><code><span class="keyword">val </span>with_write_lock : ?&#8288;dontblock:bool <span>&#45;&gt;</span> <span class="type-var">'a</span> OpamStateTypes.global_state <span>&#45;&gt;</span> (OpamStateTypes.rw OpamStateTypes.global_state <span>&#45;&gt;</span> <span class="type-var">'b</span><span class="keyword"> * </span><span class="type-var">'c</span> OpamStateTypes.global_state) <span>&#45;&gt;</span> <span class="type-var">'b</span><span class="keyword"> * </span><span class="type-var">'a</span> OpamStateTypes.global_state</code></dt><dd><p>Calls the provided function, ensuring a temporary write lock on the given global state</p></dd></dl><dl><dt class="spec value" id="val-write"><a href="#val-write" class="anchor"></a><code><span class="keyword">val </span>write : OpamStateTypes.rw OpamStateTypes.global_state <span>&#45;&gt;</span> unit</code></dt><dd><p>Writes back the global configuration file ~/.opam/config</p></dd></dl><dl><dt class="spec value" id="val-fix_switch_list"><a href="#val-fix_switch_list" class="anchor"></a><code><span class="keyword">val </span>fix_switch_list : <span class="type-var">'a</span> OpamStateTypes.global_state <span>&#45;&gt;</span> <span class="type-var">'a</span> OpamStateTypes.global_state</code></dt><dd><p>Updates the configured list of switches, making sure the current switch is registered if it is set and exists, and removing any non-existing switches. Writes back to disk if possible (ie lock is available)</p></dd></dl></div></body></html>