<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>OpamRepositoryState (opam-state.OpamRepositoryState)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../index.html">opam-state</a> &#x00BB; OpamRepositoryState</nav><h1>Module <code>OpamRepositoryState</code></h1><p>loading and handling of the repository state of an opam root (i.e. what is in ~/.opam/repo)</p></header><dl><dt class="spec module" id="module-Cache"><a href="#module-Cache" class="anchor"></a><code><span class="keyword">module </span><a href="Cache/index.html">Cache</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>Caching of repository loading (marshall of all parsed opam files)</p></dd></dl><dl><dt class="spec value" id="val-load"><a href="#val-load" class="anchor"></a><code><span class="keyword">val </span>load : <span class="type-var">'a</span> OpamStateTypes.lock <span>&#45;&gt;</span> [&lt; OpamStateTypes.unlocked ] OpamStateTypes.global_state <span>&#45;&gt;</span> <span class="type-var">'a</span> OpamStateTypes.repos_state</code></dt><dt class="spec value" id="val-with_"><a href="#val-with_" class="anchor"></a><code><span class="keyword">val </span>with_ : <span class="type-var">'a</span> OpamStateTypes.lock <span>&#45;&gt;</span> [&lt; OpamStateTypes.unlocked ] OpamStateTypes.global_state <span>&#45;&gt;</span> (<span class="type-var">'a</span> OpamStateTypes.repos_state <span>&#45;&gt;</span> <span class="type-var">'b</span>) <span>&#45;&gt;</span> <span class="type-var">'b</span></code></dt><dd><p>Loads the repository state as <code>load</code>, and calls the given function while keeping it locked (as per the <code>lock</code> argument), releasing the lock afterwards</p></dd></dl><dl><dt class="spec value" id="val-find_package_opt"><a href="#val-find_package_opt" class="anchor"></a><code><span class="keyword">val </span>find_package_opt : <span class="type-var">'a</span> OpamStateTypes.repos_state <span>&#45;&gt;</span> OpamTypes.repository_name list <span>&#45;&gt;</span> OpamTypes.package <span>&#45;&gt;</span> (OpamTypes.repository_name<span class="keyword"> * </span>OpamFile.OPAM.t) option</code></dt><dd><p>Returns the repo of origin and metadata corresponding to a package, if found, from a sorted list of repositories (highest priority first)</p></dd></dl><dl><dt class="spec value" id="val-build_index"><a href="#val-build_index" class="anchor"></a><code><span class="keyword">val </span>build_index : <span class="type-var">'a</span> OpamStateTypes.repos_state <span>&#45;&gt;</span> OpamTypes.repository_name list <span>&#45;&gt;</span> OpamFile.OPAM.t OpamPackage.Map.t</code></dt><dd><p>Given the repos state, and a list of repos to use (highest priority first), build a map of all existing package definitions</p></dd></dl><dl><dt class="spec value" id="val-get_repo"><a href="#val-get_repo" class="anchor"></a><code><span class="keyword">val </span>get_repo : <span class="type-var">'a</span> OpamStateTypes.repos_state <span>&#45;&gt;</span> OpamTypes.repository_name <span>&#45;&gt;</span> OpamTypes.repository</code></dt><dd><p>Finds a package repository definition from its name (assuming it's in ROOT/repos/)</p></dd></dl><dl><dt class="spec value" id="val-load_repo_opams"><a href="#val-load_repo_opams" class="anchor"></a><code><span class="keyword">val </span>load_repo_opams : OpamTypes.repository <span>&#45;&gt;</span> OpamFile.OPAM.t OpamPackage.Map.t</code></dt><dd><p>Load all the metadata within the local mirror of the given repository, without cache</p></dd></dl><dl><dt class="spec value" id="val-unlock"><a href="#val-unlock" class="anchor"></a><code><span class="keyword">val </span>unlock : <span class="type-var">'a</span> OpamStateTypes.repos_state <span>&#45;&gt;</span> OpamStateTypes.unlocked OpamStateTypes.repos_state</code></dt><dd><p>Releases any locks on the given repos_state</p></dd></dl><dl><dt class="spec value" id="val-with_write_lock"><a href="#val-with_write_lock" class="anchor"></a><code><span class="keyword">val </span>with_write_lock : ?&#8288;dontblock:bool <span>&#45;&gt;</span> <span class="type-var">'a</span> OpamStateTypes.repos_state <span>&#45;&gt;</span> (OpamStateTypes.rw OpamStateTypes.repos_state <span>&#45;&gt;</span> <span class="type-var">'b</span><span class="keyword"> * </span>OpamStateTypes.rw OpamStateTypes.repos_state) <span>&#45;&gt;</span> <span class="type-var">'b</span><span class="keyword"> * </span><span class="type-var">'a</span> OpamStateTypes.repos_state</code></dt><dd><p>Calls the provided function, ensuring a temporary write lock on the given repository state</p></dd></dl><dl><dt class="spec value" id="val-write_config"><a href="#val-write_config" class="anchor"></a><code><span class="keyword">val </span>write_config : OpamStateTypes.rw OpamStateTypes.repos_state <span>&#45;&gt;</span> unit</code></dt><dd><p>Writes the repositories config file back to disk</p></dd></dl></div></body></html>