<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>OpamStateTypes (opam-state.OpamStateTypes)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../index.html">opam-state</a> &#x00BB; OpamStateTypes</nav><h1>Module <code>OpamStateTypes</code></h1><p>Defines the types holding global, repository and switch states</p></header><aside><p>Client state</p></aside><aside><p>Phantom types to indicate the locking state of a state, and allow or not on-disk operations.</p><p>Note that each state load is itself locking enough to return a consistent state: a read lock is only needed when the consistency of the actions depend on the fact that the given state doesn't change during the run (e.g. an update that depends on it). In particular, all query commands don't need a read lock.</p><p>Subtyping is by guarantees given on the operations allowed, <code>rw</code> giving the most and being the smallest type, so that it is safe to coerce <code>(rw t :&gt; ro t)</code>.</p></aside><dl><dt class="spec type" id="type-rw"><a href="#type-rw" class="anchor"></a><code><span class="keyword">type </span>rw</code><span class="keyword"> = </span><code>[ </code><table class="variant"><tr id="type-rw.Lock_write" class="anchored"><td class="def constructor"><a href="#type-rw.Lock_write" class="anchor"></a><code><span class="keyword">| </span></code><code>`Lock_write</code></td></tr></table><code> ]</code></dt><dd><p>Phantom type for readwrite-locked state (ensures that there are no concurrent reads or writes)</p></dd></dl><dl><dt class="spec type" id="type-ro"><a href="#type-ro" class="anchor"></a><code><span class="keyword">type </span>ro</code><span class="keyword"> = </span><code>[ </code><table class="variant"><tr id="type-ro.Lock_read" class="anchored"><td class="def constructor"><a href="#type-ro.Lock_read" class="anchor"></a><code><span class="keyword">| </span></code><code>`Lock_read</code></td></tr><tr id="type-ro.rw" class="anchored"><td class="def type"><a href="#type-ro.rw" class="anchor"></a><code><span class="keyword">| </span></code><code><a href="index.html#type-rw">rw</a></code></td></tr></table><code> ]</code></dt><dd><p>Type for read-locked state (ensures that there are no concurrent writes)</p></dd></dl><dl><dt class="spec type" id="type-unlocked"><a href="#type-unlocked" class="anchor"></a><code><span class="keyword">type </span>unlocked</code><span class="keyword"> = </span><code>[ </code><table class="variant"><tr id="type-unlocked.Lock_none" class="anchored"><td class="def constructor"><a href="#type-unlocked.Lock_none" class="anchor"></a><code><span class="keyword">| </span></code><code>`Lock_none</code></td></tr><tr id="type-unlocked.ro" class="anchored"><td class="def type"><a href="#type-unlocked.ro" class="anchor"></a><code><span class="keyword">| </span></code><code><a href="index.html#type-ro">ro</a></code></td></tr></table><code> ]</code></dt><dd><p>Type for unlocked state (single file reads should still be ok)</p></dd></dl><dl><dt class="spec type" id="type-lock"><a href="#type-lock" class="anchor"></a><code><span class="keyword">type </span>+'a lock</code><code><span class="keyword"> = </span>[&lt; <a href="index.html#type-unlocked">unlocked</a> Lock_write ]<span class="keyword"> as </span>a</code></dt><dd><p>The super-type for all lock types</p></dd></dl><dl><dt class="spec type" id="type-global_state"><a href="#type-global_state" class="anchor"></a><code><span class="keyword">type </span>+'lock global_state</code><code><span class="keyword"> = </span></code><code>{</code><table class="record"><tr id="type-global_state.global_lock" class="anchored"><td class="def field"><a href="#type-global_state.global_lock" class="anchor"></a><code>global_lock : OpamSystem.lock;</code></td></tr><tr id="type-global_state.root" class="anchored"><td class="def field"><a href="#type-global_state.root" class="anchor"></a><code>root : OpamPath.t;</code></td><td class="doc"><p>The global OPAM root path (caution: this is stored here but some code may rely on OpamStateConfig.root_dir ; in other words, multiple root handling isn't really supported at the moment)</p></td></tr><tr id="type-global_state.config" class="anchored"><td class="def field"><a href="#type-global_state.config" class="anchor"></a><code>config : OpamFile.Config.t;</code></td><td class="doc"><p>The main configuration file. A note of caution: this corresponds to the configuration as loaded from the file: to get the current options, which may be overriden through the command-line or environment, see OpamStateConfig</p></td></tr><tr id="type-global_state.global_variables" class="anchored"><td class="def field"><a href="#type-global_state.global_variables" class="anchor"></a><code>global_variables : (OpamTypes.variable_contents option Lazy.t<span class="keyword"> * </span>string) OpamVariable.Map.t;</code></td><td class="doc"><p>A map of variables that have been defined globally, e.g. through `.opam/config`. They may need evaluation so are stored as lazy values. The extra string is the supplied variable documentation</p></td></tr></table><code>}</code><code><span class="keyword"> constraint </span><span class="type-var">'lock</span> = <span class="type-var">'lock</span> <a href="index.html#type-lock">lock</a></code></dt><dd><p>Global state corresponding to an opam root and its configuration</p></dd></dl><dl><dt class="spec type" id="type-repos_state"><a href="#type-repos_state" class="anchor"></a><code><span class="keyword">type </span>+'lock repos_state</code><code><span class="keyword"> = </span></code><code>{</code><table class="record"><tr id="type-repos_state.repos_lock" class="anchored"><td class="def field"><a href="#type-repos_state.repos_lock" class="anchor"></a><code>repos_lock : OpamSystem.lock;</code></td></tr><tr id="type-repos_state.repos_global" class="anchored"><td class="def field"><a href="#type-repos_state.repos_global" class="anchor"></a><code>repos_global : <a href="index.html#type-unlocked">unlocked</a> <a href="index.html#type-global_state">global_state</a>;</code></td></tr><tr id="type-repos_state.repositories" class="anchored"><td class="def field"><a href="#type-repos_state.repositories" class="anchor"></a><code>repositories : OpamTypes.repository OpamTypes.repository_name_map;</code></td><td class="doc"><p>The list of repositories</p></td></tr><tr id="type-repos_state.repos_definitions" class="anchored"><td class="def field"><a href="#type-repos_state.repos_definitions" class="anchor"></a><code>repos_definitions : OpamFile.Repo.t OpamTypes.repository_name_map;</code></td><td class="doc"><p>The contents of each repo's <code>repo</code> file</p></td></tr><tr id="type-repos_state.repo_opams" class="anchored"><td class="def field"><a href="#type-repos_state.repo_opams" class="anchor"></a><code>repo_opams : OpamFile.OPAM.t OpamTypes.package_map OpamTypes.repository_name_map;</code></td><td class="doc"><p>All opam files that can be found in the configured repositories</p></td></tr></table><code>}</code><code><span class="keyword"> constraint </span><span class="type-var">'lock</span> = <span class="type-var">'lock</span> <a href="index.html#type-lock">lock</a></code></dt><dd><p>State corresponding to the repo/ subdir: all available packages and metadata, for each repository.</p></dd></dl><dl><dt class="spec type" id="type-switch_state"><a href="#type-switch_state" class="anchor"></a><code><span class="keyword">type </span>+'lock switch_state</code><code><span class="keyword"> = </span></code><code>{</code><table class="record"><tr id="type-switch_state.switch_lock" class="anchored"><td class="def field"><a href="#type-switch_state.switch_lock" class="anchor"></a><code>switch_lock : OpamSystem.lock;</code></td></tr><tr id="type-switch_state.switch_global" class="anchored"><td class="def field"><a href="#type-switch_state.switch_global" class="anchor"></a><code>switch_global : <a href="index.html#type-unlocked">unlocked</a> <a href="index.html#type-global_state">global_state</a>;</code></td></tr><tr id="type-switch_state.switch_repos" class="anchored"><td class="def field"><a href="#type-switch_state.switch_repos" class="anchor"></a><code>switch_repos : <a href="index.html#type-unlocked">unlocked</a> <a href="index.html#type-repos_state">repos_state</a>;</code></td></tr><tr id="type-switch_state.switch" class="anchored"><td class="def field"><a href="#type-switch_state.switch" class="anchor"></a><code>switch : OpamTypes.switch;</code></td><td class="doc"><p>The current active switch</p></td></tr><tr id="type-switch_state.compiler_packages" class="anchored"><td class="def field"><a href="#type-switch_state.compiler_packages" class="anchor"></a><code>compiler_packages : OpamTypes.package_set;</code></td><td class="doc"><p>The packages that form the base of the current compiler</p></td></tr><tr id="type-switch_state.switch_config" class="anchored"><td class="def field"><a href="#type-switch_state.switch_config" class="anchor"></a><code>switch_config : OpamFile.Switch_config.t;</code></td><td class="doc"><p>The configuration file for this switch</p></td></tr><tr id="type-switch_state.repos_package_index" class="anchored"><td class="def field"><a href="#type-switch_state.repos_package_index" class="anchor"></a><code>repos_package_index : OpamFile.OPAM.t OpamTypes.package_map;</code></td><td class="doc"><p>Metadata of all packages that could be found in the configured repositories (ignoring installed or pinned packages)</p></td></tr><tr id="type-switch_state.opams" class="anchored"><td class="def field"><a href="#type-switch_state.opams" class="anchor"></a><code>opams : OpamFile.OPAM.t OpamTypes.package_map;</code></td><td class="doc"><p>The metadata of all packages, gathered from repo, local cache and pinning overlays. This includes URL and descr data (even if they were originally in separate files), as well as the original metadata directory (that can be used to retrieve the files/ subdir)</p></td></tr><tr id="type-switch_state.conf_files" class="anchored"><td class="def field"><a href="#type-switch_state.conf_files" class="anchor"></a><code>conf_files : OpamFile.Dot_config.t OpamTypes.package_map;</code></td><td class="doc"><p>The opam-config of installed packages (from &quot;.opam-switch/config/pkgname.config&quot;)</p></td></tr><tr id="type-switch_state.packages" class="anchored"><td class="def field"><a href="#type-switch_state.packages" class="anchor"></a><code>packages : OpamTypes.package_set;</code></td><td class="doc"><p>The set of all known packages</p></td></tr><tr id="type-switch_state.available_packages" class="anchored"><td class="def field"><a href="#type-switch_state.available_packages" class="anchor"></a><code>available_packages : OpamTypes.package_set Lazy.t;</code></td><td class="doc"><p>The set of available packages, filtered by their <code>available:</code> field</p></td></tr><tr id="type-switch_state.pinned" class="anchored"><td class="def field"><a href="#type-switch_state.pinned" class="anchor"></a><code>pinned : OpamTypes.package_set;</code></td><td class="doc"><p>The set of pinned packages (their metadata, including pinning target, is in <code>opams</code>)</p></td></tr><tr id="type-switch_state.installed" class="anchored"><td class="def field"><a href="#type-switch_state.installed" class="anchor"></a><code>installed : OpamTypes.package_set;</code></td><td class="doc"><p>The set of all installed packages</p></td></tr><tr id="type-switch_state.installed_opams" class="anchored"><td class="def field"><a href="#type-switch_state.installed_opams" class="anchor"></a><code>installed_opams : OpamFile.OPAM.t OpamTypes.package_map;</code></td><td class="doc"><p>The cached metadata of installed packages (may differ from the metadata that is in <code>opams</code> for updated packages)</p></td></tr><tr id="type-switch_state.installed_roots" class="anchored"><td class="def field"><a href="#type-switch_state.installed_roots" class="anchor"></a><code>installed_roots : OpamTypes.package_set;</code></td><td class="doc"><p>The set of packages explicitly installed by the user. Some of them may happen not to be installed at some point, but this indicates that the user would like them installed.</p></td></tr><tr id="type-switch_state.reinstall" class="anchored"><td class="def field"><a href="#type-switch_state.reinstall" class="anchor"></a><code>reinstall : OpamTypes.package_set;</code></td><td class="doc"><p>The set of packages which needs to be reinstalled</p></td></tr></table><code>}</code><code><span class="keyword"> constraint </span><span class="type-var">'lock</span> = <span class="type-var">'lock</span> <a href="index.html#type-lock">lock</a></code></dt><dd><p>State of a given switch: options, available and installed packages, etc.</p></dd></dl></div></body></html>