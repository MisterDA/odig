<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>OpamUpdate (opam-state.OpamUpdate)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../index.html">opam-state</a> &#x00BB; OpamUpdate</nav><h1>Module <code>OpamUpdate</code></h1><p>Synchronisation and downloading of repositories and package sources</p></header><dl><dt class="spec value" id="val-repositories"><a href="#val-repositories" class="anchor"></a><code><span class="keyword">val </span>repositories : OpamStateTypes.rw OpamStateTypes.repos_state <span>&#45;&gt;</span> OpamTypes.repository list <span>&#45;&gt;</span> OpamTypes.repository list<span class="keyword"> * </span>OpamStateTypes.rw OpamStateTypes.repos_state</code></dt><dd><p>Update the given repositories from their upstream, and returns the updated state. This also saves the updated cached state, and the updated repository config (it may be changed by e.g. redirects). The returned list is the list of repositories for which the update failed.</p></dd></dl><dl><dt class="spec value" id="val-dev_packages"><a href="#val-dev_packages" class="anchor"></a><code><span class="keyword">val </span>dev_packages : OpamStateTypes.rw OpamStateTypes.switch_state <span>&#45;&gt;</span> ?&#8288;working_dir:OpamTypes.package_set <span>&#45;&gt;</span> OpamTypes.package_set <span>&#45;&gt;</span> bool<span class="keyword"> * </span>OpamStateTypes.rw OpamStateTypes.switch_state<span class="keyword"> * </span>OpamTypes.package_set</code></dt><dd><p><code>update_dev_packages t</code> checks for upstream changes for packages first in the switch cache and then in the global cache. Return the packages whose contents have changed upstream.</p><p>Packages that are members of the <code>working_dir</code> and are bound to a local directory under version control are synchronised with its working state, bypassing version control.</p><p>Side-effect: update the reinstall file, adding installed changed packages to the current switch to-reinstall set.</p><p>The returned boolean is true if all updates were successful.</p></dd></dl><dl><dt class="spec value" id="val-dev_package"><a href="#val-dev_package" class="anchor"></a><code><span class="keyword">val </span>dev_package : OpamStateTypes.rw OpamStateTypes.switch_state <span>&#45;&gt;</span> ?&#8288;working_dir:bool <span>&#45;&gt;</span> OpamTypes.package <span>&#45;&gt;</span> ((OpamStateTypes.rw OpamStateTypes.switch_state <span>&#45;&gt;</span> OpamStateTypes.rw OpamStateTypes.switch_state)<span class="keyword"> * </span>bool) OpamProcess.job</code></dt><dd><p>Updates a single dev or pinned package from its upstream. If <code>working_dir</code> is set, and the package is bound to a local, version-controlled dir, use the working dir state instead of what has been commited to version control.</p><p>Returns true if changed, false otherwise, and a switch_state update function, applying possible changes in packages metadata</p></dd></dl><dl><dt class="spec value" id="val-pinned_packages"><a href="#val-pinned_packages" class="anchor"></a><code><span class="keyword">val </span>pinned_packages : OpamStateTypes.rw OpamStateTypes.switch_state <span>&#45;&gt;</span> ?&#8288;working_dir:OpamTypes.name_set <span>&#45;&gt;</span> OpamTypes.name_set <span>&#45;&gt;</span> OpamStateTypes.rw OpamStateTypes.switch_state<span class="keyword"> * </span>OpamTypes.package_set</code></dt><dd><p>A subset of update_dev_packages that only takes packages names and only works on pinned packages. Also updates the reinstall file of the current switch</p></dd></dl><dl><dt class="spec value" id="val-pinned_package"><a href="#val-pinned_package" class="anchor"></a><code><span class="keyword">val </span>pinned_package : OpamStateTypes.rw OpamStateTypes.switch_state <span>&#45;&gt;</span> ?&#8288;version:OpamTypes.version <span>&#45;&gt;</span> ?&#8288;working_dir:bool <span>&#45;&gt;</span> OpamTypes.name <span>&#45;&gt;</span> ((OpamStateTypes.rw OpamStateTypes.switch_state <span>&#45;&gt;</span> OpamStateTypes.rw OpamStateTypes.switch_state)<span class="keyword"> * </span>bool) OpamProcess.job</code></dt><dd><p>Updates a dev pinned package from its upstream; returns true if changed, false otherwise, and a switch_state update function that applies possible changes in packages metadata. Updates the on-disk overlay</p></dd></dl><dl><dt class="spec value" id="val-download_package_source"><a href="#val-download_package_source" class="anchor"></a><code><span class="keyword">val </span>download_package_source : <span class="type-var">'a</span> OpamStateTypes.switch_state <span>&#45;&gt;</span> OpamTypes.package <span>&#45;&gt;</span> OpamTypes.dirname <span>&#45;&gt;</span> unit OpamTypes.download option OpamProcess.job</code></dt><dd><p>Download or synchronise the upstream source for the given package into the given directory. Also places all of the package extra files (that have a known hash) into the cache. For non-VC remotes, verifies the checksum if any</p></dd></dl><dl><dt class="spec value" id="val-cleanup_source"><a href="#val-cleanup_source" class="anchor"></a><code><span class="keyword">val </span>cleanup_source : <span class="type-var">'a</span> OpamStateTypes.switch_state <span>&#45;&gt;</span> OpamFile.OPAM.t option <span>&#45;&gt;</span> OpamFile.OPAM.t <span>&#45;&gt;</span> unit</code></dt><dd><p><code>cleanup_source old_opam_option new_opam</code> checks if the remote URL has changed between <code>old_opam_option</code> and <code>new_opam</code>, and, depending on that, cleans up the source directory of the package (<code>OpamPath.Switch.sources</code>) if needed.</p></dd></dl><dl><dt class="spec value" id="val-fetch_dev_package"><a href="#val-fetch_dev_package" class="anchor"></a><code><span class="keyword">val </span>fetch_dev_package : OpamFile.URL.t <span>&#45;&gt;</span> OpamTypes.dirname <span>&#45;&gt;</span> ?&#8288;working_dir:bool <span>&#45;&gt;</span> OpamTypes.package <span>&#45;&gt;</span> unit OpamTypes.download OpamProcess.job</code></dt><dd><p>Low-level function to retrieve the package source into its local cache</p></dd></dl></div></body></html>