<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Make (resource_cache.Resource_cache__.Cache.Make)</title><link rel="stylesheet" href="../../../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../../../index.html">resource_cache</a> &#x00BB; <a href="../../index.html">Resource_cache__</a> &#x00BB; <a href="../index.html">Cache</a> &#x00BB; Make</nav><h1>Module <code>Cache.Make</code></h1></header><h3 class="heading">Parameters</h3><ul><li><code><a href="argument-1-R/index.html">R</a> : <a href="../index.html#module-type-Resource_intf">Resource_intf</a></code></li></ul><h3 class="heading">Signature</h3><div class="spec module" id="module-Status"><a href="#module-Status" class="anchor"></a><code><span class="keyword">module</span> <a href="Status/index.html">Status</a> : <a href="../index.html#module-type-Status_intf">Status_intf</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="../module-type-Status_intf/Key/index.html#type-t">Key.t</a> = <a href="argument-1-R/Key/index.html#type-t">R.Key.t</a></code></div><dl><dt class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> t</code></dt></dl><dl><dt class="spec value" id="val-init"><a href="#val-init" class="anchor"></a><code><span class="keyword">val</span> init : config:<a href="../Config/index.html#type-t">Config.t</a> <span>&#45;&gt;</span> <a href="argument-1-R/Common_args/index.html#type-t">R.Common_args.t</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></dt><dt class="spec value" id="val-status"><a href="#val-status" class="anchor"></a><code><span class="keyword">val</span> status : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="Status/index.html#type-t">Status.t</a></code></dt><dt class="spec value" id="val-config"><a href="#val-config" class="anchor"></a><code><span class="keyword">val</span> config : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../Config/index.html#type-t">Config.t</a></code></dt><dt class="spec value" id="val-with_"><a href="#val-with_" class="anchor"></a><code><span class="keyword">val</span> with_ : ?&#8288;open_timeout:<a href="../../../../core_kernel/Core_kernel__Time_intf/module-type-S/Time/Span/index.html#type-t">Core.Time.Span.t</a> <span>&#45;&gt;</span> ?&#8288;give_up:unit <a href="../../../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async.Deferred.t</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="argument-1-R/Key/index.html#type-t">R.Key.t</a> <span>&#45;&gt;</span> f:(<a href="argument-1-R/index.html#type-t">R.t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="../../../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async.Deferred.t</a>) <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="../../../../async_kernel/Async_kernel__/Deferred_or_error/index.html#type-t">Async.Deferred.Or_error.t</a></code></dt><dd><p><code>with_ t key ~f</code> calls <code>f resource</code> where <code>resource</code> is either:</p><p>1) An existing cached resource that was opened with key' such that <code>R.Key.equal key key'</code> 2) A newly opened resource created by <code>R.open_ key common_args</code>, respecting the limits of <code>t.config</code></p><p>Returns an error if:</p><ul><li>the cache is closed</li><li><code>R.open_</code> returned an error</li><li>no resource is obtained before <code>give_up</code> is determined</li></ul><p>If <code>f</code> raises, the exception is not caught, but the <code>resource</code> will be closed and the <code>Cache</code> will remain in a working state (no resources are lost).</p></dd></dl><dl><dt class="spec value" id="val-with_'"><a href="#val-with_'" class="anchor"></a><code><span class="keyword">val</span> with_' : ?&#8288;open_timeout:<a href="../../../../core_kernel/Core_kernel__Time_intf/module-type-S/Time/Span/index.html#type-t">Core.Time.Span.t</a> <span>&#45;&gt;</span> ?&#8288;give_up:unit <a href="../../../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async.Deferred.t</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="argument-1-R/Key/index.html#type-t">R.Key.t</a> <span>&#45;&gt;</span> f:(<a href="argument-1-R/index.html#type-t">R.t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="../../../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async.Deferred.t</a>) <span>&#45;&gt;</span> [ `Ok of <span class="type-var">'a</span> | `Gave_up_waiting_for_resource | `Error_opening_resource of <a href="../../../../core_kernel/Core_kernel/Error/index.html#type-t">Core.Error.t</a> | `Cache_is_closed ] <a href="../../../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async.Deferred.t</a></code></dt><dd><p>Like <code>with_</code> but classify the different errors</p></dd></dl><dl><dt class="spec value" id="val-with_any"><a href="#val-with_any" class="anchor"></a><code><span class="keyword">val</span> with_any : ?&#8288;open_timeout:<a href="../../../../core_kernel/Core_kernel__Time_intf/module-type-S/Time/Span/index.html#type-t">Core.Time.Span.t</a> <span>&#45;&gt;</span> ?&#8288;give_up:unit <a href="../../../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async.Deferred.t</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="argument-1-R/Key/index.html#type-t">R.Key.t</a> list <span>&#45;&gt;</span> f:(<a href="argument-1-R/index.html#type-t">R.t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="../../../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async.Deferred.t</a>) <span>&#45;&gt;</span> (<a href="argument-1-R/Key/index.html#type-t">R.Key.t</a> * <span class="type-var">'a</span>) <a href="../../../../async_kernel/Async_kernel__/Deferred_or_error/index.html#type-t">Async.Deferred.Or_error.t</a></code></dt><dd><p>Like <code>with_</code> and <code>with_'</code> except <code>f</code> is run on the first matching available resource (or the first resource that has availability to be opened). Preference is given towards those earlier in <code>args_list</code> when possible</p></dd></dl><dl><dt class="spec value" id="val-with_any'"><a href="#val-with_any'" class="anchor"></a><code><span class="keyword">val</span> with_any' : ?&#8288;open_timeout:<a href="../../../../core_kernel/Core_kernel__Time_intf/module-type-S/Time/Span/index.html#type-t">Core.Time.Span.t</a> <span>&#45;&gt;</span> ?&#8288;give_up:unit <a href="../../../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async.Deferred.t</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="argument-1-R/Key/index.html#type-t">R.Key.t</a> list <span>&#45;&gt;</span> f:(<a href="argument-1-R/index.html#type-t">R.t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="../../../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async.Deferred.t</a>) <span>&#45;&gt;</span> [ `Ok of <a href="argument-1-R/Key/index.html#type-t">R.Key.t</a> * <span class="type-var">'a</span> | `Error_opening_resource of <a href="argument-1-R/Key/index.html#type-t">R.Key.t</a> * <a href="../../../../core_kernel/Core_kernel/Error/index.html#type-t">Core.Error.t</a> | `Gave_up_waiting_for_resource | `Cache_is_closed ] <a href="../../../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async.Deferred.t</a></code></dt><dt class="spec value" id="val-with_any_loop"><a href="#val-with_any_loop" class="anchor"></a><code><span class="keyword">val</span> with_any_loop : ?&#8288;open_timeout:<a href="../../../../core_kernel/Core_kernel__Time_intf/module-type-S/Time/Span/index.html#type-t">Core.Time.Span.t</a> <span>&#45;&gt;</span> ?&#8288;give_up:unit <a href="../../../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async.Deferred.t</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="argument-1-R/Key/index.html#type-t">R.Key.t</a> list <span>&#45;&gt;</span> f:(<a href="argument-1-R/index.html#type-t">R.t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="../../../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async.Deferred.t</a>) <span>&#45;&gt;</span> [ `Ok of <a href="argument-1-R/Key/index.html#type-t">R.Key.t</a> * <span class="type-var">'a</span> | `Error_opening_all_resources of (<a href="argument-1-R/Key/index.html#type-t">R.Key.t</a> * <a href="../../../../core_kernel/Core_kernel/Error/index.html#type-t">Core.Error.t</a>) list | `Gave_up_waiting_for_resource | `Cache_is_closed ] <a href="../../../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async.Deferred.t</a></code></dt><dd><p>Tries <code>with_any'</code> in a loop (removing args that have open errors) until receiving an <code>`Ok</code>, or until it has failed to open all resources in <code>args_list</code>.</p></dd></dl><dl><dt class="spec value" id="val-close_started"><a href="#val-close_started" class="anchor"></a><code><span class="keyword">val</span> close_started : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> bool</code></dt><dt class="spec value" id="val-close_finished"><a href="#val-close_finished" class="anchor"></a><code><span class="keyword">val</span> close_finished : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> unit <a href="../../../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async.Deferred.t</a></code></dt><dt class="spec value" id="val-close_and_flush"><a href="#val-close_and_flush" class="anchor"></a><code><span class="keyword">val</span> close_and_flush : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> unit <a href="../../../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async.Deferred.t</a></code></dt><dd><p>Close all currently open resources and prevent the creation of new ones. All subsequent calls to <code>with_</code> and <code>immediate</code> fail with <code>`Cache_is_closed</code>. Any jobs that are waiting for a connection will return with <code>`Cache_is_closed</code>. The returned <code>Deferred.t</code> is determined when all jobs have finished running and all resources have been closed.</p></dd></dl></div></body></html>