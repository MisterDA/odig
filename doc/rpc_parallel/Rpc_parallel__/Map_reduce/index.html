<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Map_reduce (rpc_parallel.Rpc_parallel__.Map_reduce)</title><link rel="stylesheet" href="../../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../../index.html">rpc_parallel</a> &#x00BB; <a href="../index.html">Rpc_parallel__</a> &#x00BB; Map_reduce</nav><h1>Module <code>Rpc_parallel__.Map_reduce</code></h1><nav class="toc"><ul><li><a href="#map-functions">Map functions</a></li><li><a href="#map-reduce">Map-reduce</a></li></ul></nav></header><aside><p>A parallel map/reduce library. See examples/add_numbers.ml and examples/number_stats.ml for examples.</p></aside><div class="spec module" id="module-Config"><a href="#module-Config" class="anchor"></a><code><span class="keyword">module</span> <a href="Config/index.html">Config</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="spec module-type" id="module-type-Worker"><a href="#module-type-Worker" class="anchor"></a><code><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-Worker/index.html">Worker</a> = <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><section><header><h5 id="map-functions"><a href="#map-functions" class="anchor"></a>Map functions</h5></header><aside><p><code>Map_function</code> modules must be created using the <code>Make_map_function</code> or <code>Make_map_function_with_init</code> functors. The init variety allows you to specify an <code>init</code> function that takes a &quot;param&quot; argument. The non-init variety is equivalent to the init variety with <code>init</code> equal to <code>return</code> and a <code>unit</code> &quot;param&quot; argument. Similarly, <code>Map_reduce_function</code> modules must be created using the <code>Make_map_combine_function</code> or <code>Make_map_combine_function_with_init</code> functors.</p></aside><div class="spec module-type" id="module-type-Map_function"><a href="#module-type-Map_function" class="anchor"></a><code><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-Map_function/index.html">Map_function</a> = <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="spec module-type" id="module-type-Map_function_with_init_spec"><a href="#module-type-Map_function_with_init_spec" class="anchor"></a><code><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-Map_function_with_init_spec/index.html">Map_function_with_init_spec</a> = <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="spec module" id="module-Make_map_function_with_init"><a href="#module-Make_map_function_with_init" class="anchor"></a><code><span class="keyword">module</span> <a href="Make_map_function_with_init/index.html">Make_map_function_with_init</a> : <span class="keyword">functor</span> (<a href="Make_map_function_with_init/argument-1-S/index.html">S</a> : <a href="index.html#module-type-Map_function_with_init_spec">Map_function_with_init_spec</a>) <span>&#45;&gt;</span> <a href="index.html#module-type-Map_function">Map_function</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="Make_map_function_with_init/Param/index.html#type-t">Param.t</a> = <a href="Make_map_function_with_init/argument-1-S/Param/index.html#type-t">S.Param.t</a> <span class="keyword">and</span> <span class="keyword">type</span> <a href="Make_map_function_with_init/Input/index.html#type-t">Input.t</a> = <a href="Make_map_function_with_init/argument-1-S/Input/index.html#type-t">S.Input.t</a> <span class="keyword">and</span> <span class="keyword">type</span> <a href="Make_map_function_with_init/Output/index.html#type-t">Output.t</a> = <a href="Make_map_function_with_init/argument-1-S/Output/index.html#type-t">S.Output.t</a></code></div><div class="spec module-type" id="module-type-Map_function_spec"><a href="#module-type-Map_function_spec" class="anchor"></a><code><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-Map_function_spec/index.html">Map_function_spec</a> = <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="spec module" id="module-Make_map_function"><a href="#module-Make_map_function" class="anchor"></a><code><span class="keyword">module</span> <a href="Make_map_function/index.html">Make_map_function</a> : <span class="keyword">functor</span> (<a href="Make_map_function/argument-1-S/index.html">S</a> : <a href="index.html#module-type-Map_function_spec">Map_function_spec</a>) <span>&#45;&gt;</span> <a href="index.html#module-type-Map_function">Map_function</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="Make_map_function/Param/index.html#type-t">Param.t</a> = unit <span class="keyword">and</span> <span class="keyword">type</span> <a href="Make_map_function/Input/index.html#type-t">Input.t</a> = <a href="Make_map_function/argument-1-S/Input/index.html#type-t">S.Input.t</a> <span class="keyword">and</span> <span class="keyword">type</span> <a href="Make_map_function/Output/index.html#type-t">Output.t</a> = <a href="Make_map_function/argument-1-S/Output/index.html#type-t">S.Output.t</a></code></div><dl><dt class="spec value" id="val-map_unordered"><a href="#val-map_unordered" class="anchor"></a><code><span class="keyword">val</span> map_unordered : <a href="Config/index.html#type-t">Config.t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="../../../async_kernel/Async_kernel__Pipe/Reader/index.html#type-t">Async.Pipe.Reader.t</a> <span>&#45;&gt;</span> m:(<span class="keyword">module</span> <a href="module-type-Map_function/index.html">Map_function</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="module-type-Map_function/Input/index.html#type-t">Input.t</a> = <span class="type-var">'a</span> <span class="keyword">and</span> <span class="keyword">type</span> <a href="module-type-Map_function/Output/index.html#type-t">Output.t</a> = <span class="type-var">'b</span> <span class="keyword">and</span> <span class="keyword">type</span> <a href="module-type-Map_function/Param/index.html#type-t">Param.t</a> = <span class="type-var">'param</span>) <span>&#45;&gt;</span> param:<span class="type-var">'param</span> <span>&#45;&gt;</span> (<span class="type-var">'b</span> * int) <a href="../../../async_kernel/Async_kernel__Pipe/Reader/index.html#type-t">Async.Pipe.Reader.t</a> <a href="../../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async.Deferred.t</a></code></dt><dd><p>The <code>map_unordered</code> operation takes <code>'a Pipe.Reader.t</code> along with a <code>Map_function</code> and sends the <code>'a</code> values to workers for mapping. Each pair in the resulting <code>('b * int)
    Pipe.Reader.t</code> contains the mapped value and the index of the value in the input pipe.</p></dd></dl><dl><dt class="spec value" id="val-map"><a href="#val-map" class="anchor"></a><code><span class="keyword">val</span> map : <a href="Config/index.html#type-t">Config.t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="../../../async_kernel/Async_kernel__Pipe/Reader/index.html#type-t">Async.Pipe.Reader.t</a> <span>&#45;&gt;</span> m:(<span class="keyword">module</span> <a href="module-type-Map_function/index.html">Map_function</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="module-type-Map_function/Input/index.html#type-t">Input.t</a> = <span class="type-var">'a</span> <span class="keyword">and</span> <span class="keyword">type</span> <a href="module-type-Map_function/Output/index.html#type-t">Output.t</a> = <span class="type-var">'b</span> <span class="keyword">and</span> <span class="keyword">type</span> <a href="module-type-Map_function/Param/index.html#type-t">Param.t</a> = <span class="type-var">'param</span>) <span>&#45;&gt;</span> param:<span class="type-var">'param</span> <span>&#45;&gt;</span> <span class="type-var">'b</span> <a href="../../../async_kernel/Async_kernel__Pipe/Reader/index.html#type-t">Async.Pipe.Reader.t</a> <a href="../../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async.Deferred.t</a></code></dt><dd><p>The <code>map</code> operation is similar to <code>map_unordered</code>, but the result is a <code>'b
    Pipe.Reader.t</code> where the mapped values are guaranteed to be in the same order as the input values.</p></dd></dl><dl><dt class="spec value" id="val-find_map"><a href="#val-find_map" class="anchor"></a><code><span class="keyword">val</span> find_map : <a href="Config/index.html#type-t">Config.t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="../../../async_kernel/Async_kernel__Pipe/Reader/index.html#type-t">Async.Pipe.Reader.t</a> <span>&#45;&gt;</span> m:(<span class="keyword">module</span> <a href="module-type-Map_function/index.html">Map_function</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="module-type-Map_function/Input/index.html#type-t">Input.t</a> = <span class="type-var">'a</span> <span class="keyword">and</span> <span class="keyword">type</span> <a href="module-type-Map_function/Output/index.html#type-t">Output.t</a> = <span class="type-var">'b</span> option <span class="keyword">and</span> <span class="keyword">type</span> <a href="module-type-Map_function/Param/index.html#type-t">Param.t</a> = <span class="type-var">'param</span>) <span>&#45;&gt;</span> param:<span class="type-var">'param</span> <span>&#45;&gt;</span> <span class="type-var">'b</span> option <a href="../../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async.Deferred.t</a></code></dt><dd><p>The <code>find_map</code> operation takes <code>'a Pipe.Reader.t</code> along with a <code>Map_function</code> that returns <code>'b option</code> values. As soon as <code>map</code> returns <code>Some value</code>, all workers are stopped and <code>Some value</code> is returned. If <code>map</code> never returns <code>Some value</code> then <code>None</code> is returned. If more than one worker returns <code>Some value</code>, one value is chosen arbitrarily and returned.</p></dd></dl></section><section><header><h5 id="map-reduce"><a href="#map-reduce" class="anchor"></a>Map-reduce</h5><p>functions</p></header><div class="spec module-type" id="module-type-Map_reduce_function"><a href="#module-type-Map_reduce_function" class="anchor"></a><code><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-Map_reduce_function/index.html">Map_reduce_function</a> = <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="spec module-type" id="module-type-Map_reduce_function_with_init_spec"><a href="#module-type-Map_reduce_function_with_init_spec" class="anchor"></a><code><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-Map_reduce_function_with_init_spec/index.html">Map_reduce_function_with_init_spec</a> = <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="spec module" id="module-Make_map_reduce_function_with_init"><a href="#module-Make_map_reduce_function_with_init" class="anchor"></a><code><span class="keyword">module</span> <a href="Make_map_reduce_function_with_init/index.html">Make_map_reduce_function_with_init</a> : <span class="keyword">functor</span> (<a href="Make_map_reduce_function_with_init/argument-1-S/index.html">S</a> : <a href="index.html#module-type-Map_reduce_function_with_init_spec">Map_reduce_function_with_init_spec</a>) <span>&#45;&gt;</span> <a href="index.html#module-type-Map_reduce_function">Map_reduce_function</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="Make_map_reduce_function_with_init/Param/index.html#type-t">Param.t</a> = <a href="Make_map_reduce_function_with_init/argument-1-S/Param/index.html#type-t">S.Param.t</a> <span class="keyword">and</span> <span class="keyword">type</span> <a href="Make_map_reduce_function_with_init/Accum/index.html#type-t">Accum.t</a> = <a href="Make_map_reduce_function_with_init/argument-1-S/Accum/index.html#type-t">S.Accum.t</a> <span class="keyword">and</span> <span class="keyword">type</span> <a href="Make_map_reduce_function_with_init/Input/index.html#type-t">Input.t</a> = <a href="Make_map_reduce_function_with_init/argument-1-S/Input/index.html#type-t">S.Input.t</a></code></div><div class="spec module-type" id="module-type-Map_reduce_function_spec"><a href="#module-type-Map_reduce_function_spec" class="anchor"></a><code><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-Map_reduce_function_spec/index.html">Map_reduce_function_spec</a> = <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="spec module" id="module-Make_map_reduce_function"><a href="#module-Make_map_reduce_function" class="anchor"></a><code><span class="keyword">module</span> <a href="Make_map_reduce_function/index.html">Make_map_reduce_function</a> : <span class="keyword">functor</span> (<a href="Make_map_reduce_function/argument-1-S/index.html">S</a> : <a href="index.html#module-type-Map_reduce_function_spec">Map_reduce_function_spec</a>) <span>&#45;&gt;</span> <a href="index.html#module-type-Map_reduce_function">Map_reduce_function</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="Make_map_reduce_function/Param/index.html#type-t">Param.t</a> = unit <span class="keyword">and</span> <span class="keyword">type</span> <a href="Make_map_reduce_function/Accum/index.html#type-t">Accum.t</a> = <a href="Make_map_reduce_function/argument-1-S/Accum/index.html#type-t">S.Accum.t</a> <span class="keyword">and</span> <span class="keyword">type</span> <a href="Make_map_reduce_function/Input/index.html#type-t">Input.t</a> = <a href="Make_map_reduce_function/argument-1-S/Input/index.html#type-t">S.Input.t</a></code></div><dl><dt class="spec value" id="val-map_reduce_commutative"><a href="#val-map_reduce_commutative" class="anchor"></a><code><span class="keyword">val</span> map_reduce_commutative : <a href="Config/index.html#type-t">Config.t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="../../../async_kernel/Async_kernel__Pipe/Reader/index.html#type-t">Async.Pipe.Reader.t</a> <span>&#45;&gt;</span> m:(<span class="keyword">module</span> <a href="module-type-Map_reduce_function/index.html">Map_reduce_function</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="module-type-Map_reduce_function/Accum/index.html#type-t">Accum.t</a> = <span class="type-var">'accum</span> <span class="keyword">and</span> <span class="keyword">type</span> <a href="module-type-Map_reduce_function/Input/index.html#type-t">Input.t</a> = <span class="type-var">'a</span> <span class="keyword">and</span> <span class="keyword">type</span> <a href="module-type-Map_reduce_function/Param/index.html#type-t">Param.t</a> = <span class="type-var">'param</span>) <span>&#45;&gt;</span> param:<span class="type-var">'param</span> <span>&#45;&gt;</span> <span class="type-var">'accum</span> option <a href="../../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async.Deferred.t</a></code></dt><dd><p>The <code>map_reduce_commutative</code> operation takes <code>'a Pipe.Reader.t</code> along with a <code>Map_reduce_function</code> and applies the <code>map</code> function to <code>'a</code> values (in an unspecified order), resulting in <code>'accum</code> values. The <code>combine</code> function is then called to combine the <code>'accum</code> values (in an unspecified order) into a single <code>'accum</code> value. Commutative map-reduce assumes that <code>combine</code> is associative and commutative.</p></dd></dl><dl><dt class="spec value" id="val-map_reduce"><a href="#val-map_reduce" class="anchor"></a><code><span class="keyword">val</span> map_reduce : <a href="Config/index.html#type-t">Config.t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <a href="../../../async_kernel/Async_kernel__Pipe/Reader/index.html#type-t">Async.Pipe.Reader.t</a> <span>&#45;&gt;</span> m:(<span class="keyword">module</span> <a href="module-type-Map_reduce_function/index.html">Map_reduce_function</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="module-type-Map_reduce_function/Accum/index.html#type-t">Accum.t</a> = <span class="type-var">'accum</span> <span class="keyword">and</span> <span class="keyword">type</span> <a href="module-type-Map_reduce_function/Input/index.html#type-t">Input.t</a> = <span class="type-var">'a</span> <span class="keyword">and</span> <span class="keyword">type</span> <a href="module-type-Map_reduce_function/Param/index.html#type-t">Param.t</a> = <span class="type-var">'param</span>) <span>&#45;&gt;</span> param:<span class="type-var">'param</span> <span>&#45;&gt;</span> <span class="type-var">'accum</span> option <a href="../../../async_kernel/Async_kernel/Deferred/index.html#type-t">Async.Deferred.t</a></code></dt><dd><p>The <code>map_reduce</code> operation makes strong guarantees about the order in which the values are processed by <code>combine</code>. For a list a_0, a_1, a_2, ..., a_n of <code>'a</code> values, the noncommutative map-reduce operation applies the <code>map</code> function to produce <code>acc_{i,i+1}</code> from each <code>a_i</code>. The <code>combine</code> function is used to compute <code>combine
    acc_{i,j} acc_{j,k}</code> for i&lt;j&lt;k, producing <code>acc_{i,k}</code>. The <code>map</code> and <code>combine</code> functions are called repeatedly until the entire list is reduced to a single <code>acc_{0,n+1}</code> value. Noncommutative map-reduce assumes that <code>combine</code> is associative.</p></dd></dl></section></div></body></html>