<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Expert (rpc_parallel.Rpc_parallel__Parallel_intf.Parallel.Expert)</title><link rel="stylesheet" href="../../../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../../../index.html">rpc_parallel</a> &#x00BB; <a href="../../index.html">Rpc_parallel__Parallel_intf</a> &#x00BB; <a href="../index.html">Parallel</a> &#x00BB; Expert</nav><h1>Module <code>Parallel.Expert</code></h1><p>If you want more direct control over your executable, you can use the <code>Expert</code> module instead of <code>start_app</code>. If you use <code>Expert</code>, you are responsible for starting the master and worker rpc servers. <code>worker_command_args</code> will be the arguments sent to each spawned worker. Running your executable with these args must follow a code path that calls <code>worker_init_before_async_exn</code> and then <code>start_worker_server_exn</code>. An easy way to do this is to use <code>worker_command</code>.</p></header><dl><dt class="spec value" id="val-start_master_server_exn"><a href="#val-start_master_server_exn" class="anchor"></a><code><span class="keyword">val</span> start_master_server_exn : ?&#8288;rpc_max_message_size:int <span>&#45;&gt;</span> ?&#8288;rpc_handshake_timeout:<a href="../../../../core_kernel/Core_kernel__Time_intf/module-type-S/Time/Span/index.html#type-t">Core.Time.Span.t</a> <span>&#45;&gt;</span> ?&#8288;rpc_heartbeat_config:<a href="../../../../async_rpc_kernel/Async_rpc_kernel__Rpc/Connection/Heartbeat_config/index.html#type-t">Async.Rpc.Connection.Heartbeat_config.t</a> <span>&#45;&gt;</span> worker_command_args:string list <span>&#45;&gt;</span> unit <span>&#45;&gt;</span> unit</code></dt><dd><p><code>start_master_server_exn</code> must be called in the single master process. It is necessary to be able to spawn workers. Raises if the process was spawned.</p></dd></dl><aside><p>You have two options for implementing the worker process, a simple one and a deprecated one.</p><p>Simple option: just make sure <code>worker_command</code> is somewhere in the command hierarchy of the same executable in which <code>start_master_server_exn</code> is called, with a subcommand path equal to <code>worker_command_args</code>. It is possible for multiple calls to <code>start_master_server_exn</code> to share the same <code>worker_command_args</code>.</p><p>Deprecated option: implement something at least as complicated yourself using <code>worker_init_before_async_exn</code> and <code>start_worker_server_exn</code>. This option may go away in the future.</p></aside><dl><dt class="spec value" id="val-worker_command"><a href="#val-worker_command" class="anchor"></a><code><span class="keyword">val</span> worker_command : <a href="../../../../async_extra/Async_extra/Command/index.html#type-t">Async.Command.t</a></code></dt></dl><div class="spec module" id="module-Worker_env"><a href="#module-Worker_env" class="anchor"></a><code><span class="keyword">module</span> <a href="Worker_env/index.html">Worker_env</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><dl><dt class="spec value" id="val-worker_init_before_async_exn"><a href="#val-worker_init_before_async_exn" class="anchor"></a><code><span class="keyword">val</span> worker_init_before_async_exn : unit <span>&#45;&gt;</span> <a href="Worker_env/index.html#type-t">Worker_env.t</a></code></dt><dd><p><code>worker_init_before_async_exn</code> must be called in a spawned worker process before the async scheduler has started. You must not read from stdin before this function call.</p><p>This has the side effect of calling <code>chdir</code>.</p></dd></dl><dl><dt class="spec value" id="val-start_worker_server_exn"><a href="#val-start_worker_server_exn" class="anchor"></a><code><span class="keyword">val</span> start_worker_server_exn : <a href="Worker_env/index.html#type-t">Worker_env.t</a> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>start_worker_server_exn</code> must be called in each spawned process. It is illegal to call both <code>start_master_server_exn</code> and <code>start_worker_server_exn</code> in the same process. Raises if the process was not spawned.</p><p>This has the side effect of scheduling a job that completes the daemonization of this process (if the process should daemonize). This includes redirecting stdout and stderr according to <code>redirect_stdout</code> and <code>redirect_stderr</code>. All writes to stdout before this job runs are blackholed. All writes to stderr before this job runs are redirected to the spawning process's stderr.</p></dd></dl></div></body></html>