<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Ssl (ssl.Ssl)</title><link rel="stylesheet" href="../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – <a href="../index.html">ssl</a> &#x00BB; Ssl</nav><h1>Module <code>Ssl</code></h1><p>Functions for making encrypted communications using the Secure Socket Layer (SSL). These are mostly bindings to the openssl library.</p><dl><dt>author</dt><dd>Samuel Mimram</dd></dl><nav class="toc"><ul><li><a href="#exceptions-and-errors">Exceptions and errors</a></li><li><a href="#communication">Communication</a><ul><li><a href="#threads">Threads</a></li><li><a href="#contexts">Contexts</a></li><li><a href="#ciphers">Ciphers</a></li><li><a href="#certificates">Certificates</a></li><li><a href="#creating,-connecting-and-closing-sockets">Creating, connecting and closing sockets</a></li><li><a href="#i/o-on-ssl-sockets">I/O on SSL sockets</a><ul><li><a href="#high-level-communication-functions">High-level communication functions</a></li></ul></li></ul></li></ul></nav></header><section><header><h2 id="exceptions-and-errors"><a href="#exceptions-and-errors" class="anchor"></a>Exceptions and errors</h2></header><dl><dt class="spec type" id="type-ssl_error"><a href="#type-ssl_error" class="anchor"></a><code><span class="keyword">type</span> ssl_error</code><code> = </code><table class="variant"><tr id="type-ssl_error.Error_none" class="anchored"><td class="def constructor"><a href="#type-ssl_error.Error_none" class="anchor"></a><code>| </code><code><span class="constructor">Error_none</span></code></td><td class="doc"><p>No error happened. This is never raised and should disappear in future versions.</p></td></tr><tr id="type-ssl_error.Error_ssl" class="anchored"><td class="def constructor"><a href="#type-ssl_error.Error_ssl" class="anchor"></a><code>| </code><code><span class="constructor">Error_ssl</span></code></td></tr><tr id="type-ssl_error.Error_want_read" class="anchored"><td class="def constructor"><a href="#type-ssl_error.Error_want_read" class="anchor"></a><code>| </code><code><span class="constructor">Error_want_read</span></code></td><td class="doc"><p>The operation did not complete; the same TLS/SSL I/O function should be called again later.</p></td></tr><tr id="type-ssl_error.Error_want_write" class="anchored"><td class="def constructor"><a href="#type-ssl_error.Error_want_write" class="anchor"></a><code>| </code><code><span class="constructor">Error_want_write</span></code></td><td class="doc"><p>The operation did not complete; the same TLS/SSL I/O function should be called again later.</p></td></tr><tr id="type-ssl_error.Error_want_x509_lookup" class="anchored"><td class="def constructor"><a href="#type-ssl_error.Error_want_x509_lookup" class="anchor"></a><code>| </code><code><span class="constructor">Error_want_x509_lookup</span></code></td><td class="doc"><p>The operation did not complete because an application callback set by <code>set_client_cert_cb</code> has asked to be called again. The TLS/SSL I/O function should be called again later. Details depend on the application.</p></td></tr><tr id="type-ssl_error.Error_syscall" class="anchored"><td class="def constructor"><a href="#type-ssl_error.Error_syscall" class="anchor"></a><code>| </code><code><span class="constructor">Error_syscall</span></code></td><td class="doc"><p>Some I/O error occurred. The OpenSSL error queue may contain more information on the error.</p></td></tr><tr id="type-ssl_error.Error_zero_return" class="anchored"><td class="def constructor"><a href="#type-ssl_error.Error_zero_return" class="anchor"></a><code>| </code><code><span class="constructor">Error_zero_return</span></code></td><td class="doc"><p>The TLS/SSL connection has been closed. If the protocol version is SSL 3.0 or TLS 1.0, this result code is returned only if a closure alert has occurred in the protocol, i.e. if the connection has been closed cleanly. Note that in this case <code>Error_zero_return</code> does not necessarily indicate that the underlying transport has been closed.</p></td></tr><tr id="type-ssl_error.Error_want_connect" class="anchored"><td class="def constructor"><a href="#type-ssl_error.Error_want_connect" class="anchor"></a><code>| </code><code><span class="constructor">Error_want_connect</span></code></td><td class="doc"><p>The operation did not complete; the same TLS/SSL I/O function should be called again later.</p></td></tr><tr id="type-ssl_error.Error_want_accept" class="anchored"><td class="def constructor"><a href="#type-ssl_error.Error_want_accept" class="anchor"></a><code>| </code><code><span class="constructor">Error_want_accept</span></code></td><td class="doc"><p>The operation did not complete; the same TLS/SSL I/O function should be called again later.</p></td></tr></table></dt><dd><p>An ssl error has occured (see SSL_get_error(3ssl) for details).</p></dd></dl><dl><dt class="spec type" id="type-bigarray"><a href="#type-bigarray" class="anchor"></a><code><span class="keyword">type</span> bigarray</code><code> = (char, <a href="../../ocaml/Bigarray/index.html#type-int8_unsigned_elt">Bigarray.int8_unsigned_elt</a>, <a href="../../ocaml/Bigarray/index.html#type-c_layout">Bigarray.c_layout</a>) <a href="../../ocaml/Bigarray/Array1/index.html#type-t">Bigarray.Array1.t</a></code></dt></dl><dl><dt class="spec exception" id="exception-Method_error"><a href="#exception-Method_error" class="anchor"></a><code><span class="keyword">exception</span> </code><code><span class="exception">Method_error</span></code></dt><dd><p>The SSL method could not be initalized.</p></dd></dl><dl><dt class="spec exception" id="exception-Context_error"><a href="#exception-Context_error" class="anchor"></a><code><span class="keyword">exception</span> </code><code><span class="exception">Context_error</span></code></dt><dt class="spec exception" id="exception-Cipher_error"><a href="#exception-Cipher_error" class="anchor"></a><code><span class="keyword">exception</span> </code><code><span class="exception">Cipher_error</span></code></dt><dt class="spec exception" id="exception-Diffie_hellman_error"><a href="#exception-Diffie_hellman_error" class="anchor"></a><code><span class="keyword">exception</span> </code><code><span class="exception">Diffie_hellman_error</span></code></dt><dt class="spec exception" id="exception-Ec_curve_error"><a href="#exception-Ec_curve_error" class="anchor"></a><code><span class="keyword">exception</span> </code><code><span class="exception">Ec_curve_error</span></code></dt><dt class="spec exception" id="exception-Certificate_error"><a href="#exception-Certificate_error" class="anchor"></a><code><span class="keyword">exception</span> </code><code><span class="exception">Certificate_error</span></code></dt><dd><p>The SSL server certificate could not be initialized.</p></dd></dl><dl><dt class="spec exception" id="exception-Private_key_error"><a href="#exception-Private_key_error" class="anchor"></a><code><span class="keyword">exception</span> </code><code><span class="exception">Private_key_error</span></code></dt><dd><p>The SSL server private key could not be intialized.</p></dd></dl><dl><dt class="spec exception" id="exception-Unmatching_keys"><a href="#exception-Unmatching_keys" class="anchor"></a><code><span class="keyword">exception</span> </code><code><span class="exception">Unmatching_keys</span></code></dt><dd><p>The SSL private key does not match the certificate public key.</p></dd></dl><dl><dt class="spec exception" id="exception-Invalid_socket"><a href="#exception-Invalid_socket" class="anchor"></a><code><span class="keyword">exception</span> </code><code><span class="exception">Invalid_socket</span></code></dt><dd><p>The given socket is invalid.</p></dd></dl><dl><dt class="spec exception" id="exception-Handler_error"><a href="#exception-Handler_error" class="anchor"></a><code><span class="keyword">exception</span> </code><code><span class="exception">Handler_error</span></code></dt><dd><p>The SSL handler could not be initialized.</p></dd></dl><dl><dt class="spec exception" id="exception-Connection_error"><a href="#exception-Connection_error" class="anchor"></a><code><span class="keyword">exception</span> </code><code><span class="exception">Connection_error</span> <span class="keyword">of</span> <a href="index.html#type-ssl_error">ssl_error</a></code></dt><dd><p>The connection could not be made with the SSL service.</p></dd></dl><dl><dt class="spec exception" id="exception-Accept_error"><a href="#exception-Accept_error" class="anchor"></a><code><span class="keyword">exception</span> </code><code><span class="exception">Accept_error</span> <span class="keyword">of</span> <a href="index.html#type-ssl_error">ssl_error</a></code></dt><dd><p>Failed to accept an SSL connection.</p></dd></dl><dl><dt class="spec exception" id="exception-Read_error"><a href="#exception-Read_error" class="anchor"></a><code><span class="keyword">exception</span> </code><code><span class="exception">Read_error</span> <span class="keyword">of</span> <a href="index.html#type-ssl_error">ssl_error</a></code></dt><dd><p>An error occured while reading data.</p></dd></dl><dl><dt class="spec exception" id="exception-Write_error"><a href="#exception-Write_error" class="anchor"></a><code><span class="keyword">exception</span> </code><code><span class="exception">Write_error</span> <span class="keyword">of</span> <a href="index.html#type-ssl_error">ssl_error</a></code></dt><dd><p>An error occured while writing data.</p></dd></dl><dl><dt class="spec type" id="type-verify_error"><a href="#type-verify_error" class="anchor"></a><code><span class="keyword">type</span> verify_error</code><code> = </code><table class="variant"><tr id="type-verify_error.Error_v_unable_to_get_issuer_cert" class="anchored"><td class="def constructor"><a href="#type-verify_error.Error_v_unable_to_get_issuer_cert" class="anchor"></a><code>| </code><code><span class="constructor">Error_v_unable_to_get_issuer_cert</span></code></td><td class="doc"><p>The issuer certificate could not be found: this occurs if the issuer certificate of an untrusted certificate cannot be found.</p></td></tr><tr id="type-verify_error.Error_v_unable_to_get_ctl" class="anchored"><td class="def constructor"><a href="#type-verify_error.Error_v_unable_to_get_ctl" class="anchor"></a><code>| </code><code><span class="constructor">Error_v_unable_to_get_ctl</span></code></td><td class="doc"><p>The CRL of a certificate could not be found.</p></td></tr><tr id="type-verify_error.Error_v_unable_to_decrypt_cert_signature" class="anchored"><td class="def constructor"><a href="#type-verify_error.Error_v_unable_to_decrypt_cert_signature" class="anchor"></a><code>| </code><code><span class="constructor">Error_v_unable_to_decrypt_cert_signature</span></code></td><td class="doc"><p>The certificate signature could not be decrypted. This means that the actual signature value could not be determined rather than it not matching the expected value, this is only meaningful for RSA keys.</p></td></tr><tr id="type-verify_error.Error_v_unable_to_decrypt_CRL_signature" class="anchored"><td class="def constructor"><a href="#type-verify_error.Error_v_unable_to_decrypt_CRL_signature" class="anchor"></a><code>| </code><code><span class="constructor">Error_v_unable_to_decrypt_CRL_signature</span></code></td><td class="doc"><p>The CRL signature could not be decrypted: this means that the actual signature value could not be determined rather than it not matching the expected value. Unused.</p></td></tr><tr id="type-verify_error.Error_v_unable_to_decode_issuer_public_key" class="anchored"><td class="def constructor"><a href="#type-verify_error.Error_v_unable_to_decode_issuer_public_key" class="anchor"></a><code>| </code><code><span class="constructor">Error_v_unable_to_decode_issuer_public_key</span></code></td><td class="doc"><p>The public key in the certificate SubjectPublicKeyInfo could not be read.</p></td></tr><tr id="type-verify_error.Error_v_cert_signature_failure" class="anchored"><td class="def constructor"><a href="#type-verify_error.Error_v_cert_signature_failure" class="anchor"></a><code>| </code><code><span class="constructor">Error_v_cert_signature_failure</span></code></td><td class="doc"><p>The signature of the certificate is invalid.</p></td></tr><tr id="type-verify_error.Error_v_CRL_signature_failure" class="anchored"><td class="def constructor"><a href="#type-verify_error.Error_v_CRL_signature_failure" class="anchor"></a><code>| </code><code><span class="constructor">Error_v_CRL_signature_failure</span></code></td><td class="doc"><p>The signature of the certificate is invalid.</p></td></tr><tr id="type-verify_error.Error_v_cert_not_yet_valid" class="anchored"><td class="def constructor"><a href="#type-verify_error.Error_v_cert_not_yet_valid" class="anchor"></a><code>| </code><code><span class="constructor">Error_v_cert_not_yet_valid</span></code></td><td class="doc"><p>The certificate is not yet valid: the notBefore date is after the current time.</p></td></tr><tr id="type-verify_error.Error_v_cert_has_expired" class="anchored"><td class="def constructor"><a href="#type-verify_error.Error_v_cert_has_expired" class="anchor"></a><code>| </code><code><span class="constructor">Error_v_cert_has_expired</span></code></td><td class="doc"><p>The certificate has expired: that is the notAfter date is before the current time.</p></td></tr><tr id="type-verify_error.Error_v_CRL_not_yet_valid" class="anchored"><td class="def constructor"><a href="#type-verify_error.Error_v_CRL_not_yet_valid" class="anchor"></a><code>| </code><code><span class="constructor">Error_v_CRL_not_yet_valid</span></code></td><td class="doc"><p>The CRL is not yet valid.</p></td></tr><tr id="type-verify_error.Error_v_CRL_has_expired" class="anchored"><td class="def constructor"><a href="#type-verify_error.Error_v_CRL_has_expired" class="anchor"></a><code>| </code><code><span class="constructor">Error_v_CRL_has_expired</span></code></td><td class="doc"><p>The CRL has expired.</p></td></tr><tr id="type-verify_error.Error_v_error_in_cert_not_before_field" class="anchored"><td class="def constructor"><a href="#type-verify_error.Error_v_error_in_cert_not_before_field" class="anchor"></a><code>| </code><code><span class="constructor">Error_v_error_in_cert_not_before_field</span></code></td><td class="doc"><p>The certificate notBefore field contains an invalid time.</p></td></tr><tr id="type-verify_error.Error_v_error_in_cert_not_after_field" class="anchored"><td class="def constructor"><a href="#type-verify_error.Error_v_error_in_cert_not_after_field" class="anchor"></a><code>| </code><code><span class="constructor">Error_v_error_in_cert_not_after_field</span></code></td><td class="doc"><p>The certificate notAfter field contains an invalid time.</p></td></tr><tr id="type-verify_error.Error_v_error_in_CRL_last_update_field" class="anchored"><td class="def constructor"><a href="#type-verify_error.Error_v_error_in_CRL_last_update_field" class="anchor"></a><code>| </code><code><span class="constructor">Error_v_error_in_CRL_last_update_field</span></code></td><td class="doc"><p>The CRL lastUpdate field contains an invalid time.</p></td></tr><tr id="type-verify_error.Error_v_error_in_CRL_next_update_field" class="anchored"><td class="def constructor"><a href="#type-verify_error.Error_v_error_in_CRL_next_update_field" class="anchor"></a><code>| </code><code><span class="constructor">Error_v_error_in_CRL_next_update_field</span></code></td><td class="doc"><p>The CRL nextUpdate field contains an invalid time.</p></td></tr><tr id="type-verify_error.Error_v_out_of_mem" class="anchored"><td class="def constructor"><a href="#type-verify_error.Error_v_out_of_mem" class="anchor"></a><code>| </code><code><span class="constructor">Error_v_out_of_mem</span></code></td><td class="doc"><p>An error occurred trying to allocate memory. This should never happen.</p></td></tr><tr id="type-verify_error.Error_v_depth_zero_self_signed_cert" class="anchored"><td class="def constructor"><a href="#type-verify_error.Error_v_depth_zero_self_signed_cert" class="anchor"></a><code>| </code><code><span class="constructor">Error_v_depth_zero_self_signed_cert</span></code></td><td class="doc"><p>The passed certificate is self signed and the same certificate cannot be found in the list of trusted certificates.</p></td></tr><tr id="type-verify_error.Error_v_self_signed_cert_in_chain" class="anchored"><td class="def constructor"><a href="#type-verify_error.Error_v_self_signed_cert_in_chain" class="anchor"></a><code>| </code><code><span class="constructor">Error_v_self_signed_cert_in_chain</span></code></td><td class="doc"><p>The certificate chain could be built up using the untrusted certificates but the root could not be found locally.</p></td></tr><tr id="type-verify_error.Error_v_unable_to_get_issuer_cert_locally" class="anchored"><td class="def constructor"><a href="#type-verify_error.Error_v_unable_to_get_issuer_cert_locally" class="anchor"></a><code>| </code><code><span class="constructor">Error_v_unable_to_get_issuer_cert_locally</span></code></td><td class="doc"><p>The issuer certificate of a locally looked up certificate could not be found. This normally means the list of trusted certificates is not complete.</p></td></tr><tr id="type-verify_error.Error_v_unable_to_verify_leaf_signature" class="anchored"><td class="def constructor"><a href="#type-verify_error.Error_v_unable_to_verify_leaf_signature" class="anchor"></a><code>| </code><code><span class="constructor">Error_v_unable_to_verify_leaf_signature</span></code></td><td class="doc"><p>No signatures could be verified because the chain contains only one certificate and it is not self signed.</p></td></tr><tr id="type-verify_error.Error_v_cert_chain_too_long" class="anchored"><td class="def constructor"><a href="#type-verify_error.Error_v_cert_chain_too_long" class="anchor"></a><code>| </code><code><span class="constructor">Error_v_cert_chain_too_long</span></code></td><td class="doc"><p>The certificate chain length is greater than the supplied maximum depth. Unused.</p></td></tr><tr id="type-verify_error.Error_v_cert_revoked" class="anchored"><td class="def constructor"><a href="#type-verify_error.Error_v_cert_revoked" class="anchor"></a><code>| </code><code><span class="constructor">Error_v_cert_revoked</span></code></td><td class="doc"><p>The certificate has been revoked.</p></td></tr><tr id="type-verify_error.Error_v_invalid_CA" class="anchored"><td class="def constructor"><a href="#type-verify_error.Error_v_invalid_CA" class="anchor"></a><code>| </code><code><span class="constructor">Error_v_invalid_CA</span></code></td><td class="doc"><p>A CA certificate is invalid. Either it is not a CA or its extensions are not consistent with the supplied purpose.</p></td></tr><tr id="type-verify_error.Error_v_path_length_exceeded" class="anchored"><td class="def constructor"><a href="#type-verify_error.Error_v_path_length_exceeded" class="anchor"></a><code>| </code><code><span class="constructor">Error_v_path_length_exceeded</span></code></td><td class="doc"><p>The basicConstraints pathlength parameter has been exceeded.</p></td></tr><tr id="type-verify_error.Error_v_invalid_purpose" class="anchored"><td class="def constructor"><a href="#type-verify_error.Error_v_invalid_purpose" class="anchor"></a><code>| </code><code><span class="constructor">Error_v_invalid_purpose</span></code></td><td class="doc"><p>The supplied certificate cannot be used for the specified purpose.</p></td></tr><tr id="type-verify_error.Error_v_cert_untrusted" class="anchored"><td class="def constructor"><a href="#type-verify_error.Error_v_cert_untrusted" class="anchor"></a><code>| </code><code><span class="constructor">Error_v_cert_untrusted</span></code></td><td class="doc"><p>The root CA is not marked as trusted for the specified purpose.</p></td></tr><tr id="type-verify_error.Error_v_cert_rejected" class="anchored"><td class="def constructor"><a href="#type-verify_error.Error_v_cert_rejected" class="anchor"></a><code>| </code><code><span class="constructor">Error_v_cert_rejected</span></code></td><td class="doc"><p>The root CA is marked to reject the specified purpose.</p></td></tr><tr id="type-verify_error.Error_v_subject_issuer_mismatch" class="anchored"><td class="def constructor"><a href="#type-verify_error.Error_v_subject_issuer_mismatch" class="anchor"></a><code>| </code><code><span class="constructor">Error_v_subject_issuer_mismatch</span></code></td><td class="doc"><p>The current candidate issuer certificate was rejected because its subject name did not match the issuer name of the current certificate.</p></td></tr><tr id="type-verify_error.Error_v_akid_skid_mismatch" class="anchored"><td class="def constructor"><a href="#type-verify_error.Error_v_akid_skid_mismatch" class="anchor"></a><code>| </code><code><span class="constructor">Error_v_akid_skid_mismatch</span></code></td><td class="doc"><p>The current candidate issuer certificate was rejected because its subject key identifier was present and did not match the authority key identifier current certificate.</p></td></tr><tr id="type-verify_error.Error_v_akid_issuer_serial_mismatch" class="anchored"><td class="def constructor"><a href="#type-verify_error.Error_v_akid_issuer_serial_mismatch" class="anchor"></a><code>| </code><code><span class="constructor">Error_v_akid_issuer_serial_mismatch</span></code></td><td class="doc"><p>The current candidate issuer certificate was rejected because its issuer name and serial number was present and did not match the authority key identifier of the current certificate.</p></td></tr><tr id="type-verify_error.Error_v_keyusage_no_certsign" class="anchored"><td class="def constructor"><a href="#type-verify_error.Error_v_keyusage_no_certsign" class="anchor"></a><code>| </code><code><span class="constructor">Error_v_keyusage_no_certsign</span></code></td><td class="doc"><p>The current candidate issuer certificate was rejected because its keyUsage extension does not permit certificate signing.</p></td></tr><tr id="type-verify_error.Error_v_application_verification" class="anchored"><td class="def constructor"><a href="#type-verify_error.Error_v_application_verification" class="anchor"></a><code>| </code><code><span class="constructor">Error_v_application_verification</span></code></td><td class="doc"><p>An application specific error. Unused.</p></td></tr></table></dt><dd><p>Why did the certificate verification fail?</p></dd></dl><dl><dt class="spec exception" id="exception-Verify_error"><a href="#exception-Verify_error" class="anchor"></a><code><span class="keyword">exception</span> </code><code><span class="exception">Verify_error</span> <span class="keyword">of</span> <a href="index.html#type-verify_error">verify_error</a></code></dt><dd><p>An error occured while verifying the certificate.</p></dd></dl></section><section><header><h2 id="communication"><a href="#communication" class="anchor"></a>Communication</h2></header><dl><dt class="spec value" id="val-init"><a href="#val-init" class="anchor"></a><code><span class="keyword">val</span> init : ?&#8288;thread_safe:bool <span>&#45;&gt;</span> unit <span>&#45;&gt;</span> unit</code></dt><dd><p>Initialize SSL functions. Should be called before calling any other function. The parameter <code>thread_safe</code> should be set to true if you use threads in you application (the same effect can achived by calling <code>Ssl_threads.init</code> first.</p></dd></dl><dl><dt class="spec value" id="val-get_error_string"><a href="#val-get_error_string" class="anchor"></a><code><span class="keyword">val</span> get_error_string : unit <span>&#45;&gt;</span> string</code></dt><dd><p>Retrieve a human-readable message that corresponds to the last error that occurred.</p></dd></dl><dl><dt class="spec type" id="type-protocol"><a href="#type-protocol" class="anchor"></a><code><span class="keyword">type</span> protocol</code><code> = </code><table class="variant"><tr id="type-protocol.SSLv23" class="anchored"><td class="def constructor"><a href="#type-protocol.SSLv23" class="anchor"></a><code>| </code><code><span class="constructor">SSLv23</span></code></td><td class="doc"><p>accept all possible protocols (SSLv2 if supported by openssl, SSLv3, TLSv1, TLSv1.1 and TLSv1.2)</p></td></tr><tr id="type-protocol.SSLv3" class="anchored"><td class="def constructor"><a href="#type-protocol.SSLv3" class="anchor"></a><code>| </code><code><span class="constructor">SSLv3</span></code></td><td class="doc"><p>only SSL v3 protocol</p></td></tr><tr id="type-protocol.TLSv1" class="anchored"><td class="def constructor"><a href="#type-protocol.TLSv1" class="anchor"></a><code>| </code><code><span class="constructor">TLSv1</span></code></td><td class="doc"><p>only TLS v1 protocol</p></td></tr><tr id="type-protocol.TLSv1_1" class="anchored"><td class="def constructor"><a href="#type-protocol.TLSv1_1" class="anchor"></a><code>| </code><code><span class="constructor">TLSv1_1</span></code></td><td class="doc"><p>only TLS v1.1 protocol</p></td></tr><tr id="type-protocol.TLSv1_2" class="anchored"><td class="def constructor"><a href="#type-protocol.TLSv1_2" class="anchor"></a><code>| </code><code><span class="constructor">TLSv1_2</span></code></td><td class="doc"><p>only TLS v1.2 protocol</p></td></tr></table></dt><dd><p>Protocol used by SSL.</p></dd></dl><dl><dt class="spec type" id="type-socket"><a href="#type-socket" class="anchor"></a><code><span class="keyword">type</span> socket</code></dt><dd><p>An SSL abstract socket.</p></dd></dl><section><header><h3 id="threads"><a href="#threads" class="anchor"></a>Threads</h3></header><aside><p>You should not have to use those functions. They are only here for internal use (they are needed to make the openssl library thread-safe, see the <code>Ssl_threads</code> module).</p></aside><dl><dt class="spec value" id="val-thread_safe"><a href="#val-thread_safe" class="anchor"></a><code><span class="keyword">val</span> thread_safe : bool <a href="../../ocaml/Stdlib/index.html#type-ref">Stdlib.ref</a></code></dt></dl></section><section><header><h3 id="contexts"><a href="#contexts" class="anchor"></a>Contexts</h3></header><dl><dt class="spec type" id="type-context"><a href="#type-context" class="anchor"></a><code><span class="keyword">type</span> context</code></dt><dd><p>A context. A context should be created by a server or client once per program life-time and holds mainly default values for the SSL structures which are later created for the connections.</p></dd></dl><dl><dt class="spec type" id="type-context_type"><a href="#type-context_type" class="anchor"></a><code><span class="keyword">type</span> context_type</code><code> = </code><table class="variant"><tr id="type-context_type.Client_context" class="anchored"><td class="def constructor"><a href="#type-context_type.Client_context" class="anchor"></a><code>| </code><code><span class="constructor">Client_context</span></code></td><td class="doc"><p>Client connections.</p></td></tr><tr id="type-context_type.Server_context" class="anchored"><td class="def constructor"><a href="#type-context_type.Server_context" class="anchor"></a><code>| </code><code><span class="constructor">Server_context</span></code></td><td class="doc"><p>Server connections.</p></td></tr><tr id="type-context_type.Both_context" class="anchored"><td class="def constructor"><a href="#type-context_type.Both_context" class="anchor"></a><code>| </code><code><span class="constructor">Both_context</span></code></td><td class="doc"><p>Client and server connections.</p></td></tr></table></dt><dd><p>Type of the context to create.</p></dd></dl><dl><dt class="spec value" id="val-create_context"><a href="#val-create_context" class="anchor"></a><code><span class="keyword">val</span> create_context : <a href="index.html#type-protocol">protocol</a> <span>&#45;&gt;</span> <a href="index.html#type-context_type">context_type</a> <span>&#45;&gt;</span> <a href="index.html#type-context">context</a></code></dt><dd><p>Create a context.</p></dd></dl><dl><dt class="spec value" id="val-use_certificate"><a href="#val-use_certificate" class="anchor"></a><code><span class="keyword">val</span> use_certificate : <a href="index.html#type-context">context</a> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> string <span>&#45;&gt;</span> unit</code></dt><dd><p><code>use_certificate ctx cert privkey</code> makes the context <code>ctx</code> use <code>cert</code> as * certificate's file name (in PEM format) and <code>privkey</code> as private key file * name.</p></dd></dl><dl><dt class="spec value" id="val-set_password_callback"><a href="#val-set_password_callback" class="anchor"></a><code><span class="keyword">val</span> set_password_callback : <a href="index.html#type-context">context</a> <span>&#45;&gt;</span> (bool <span>&#45;&gt;</span> string) <span>&#45;&gt;</span> unit</code></dt><dd><p>Set the callback function called to get passwords for encrypted PEM files. * The callback function takes a boolean argument which indicates if it's used * for reading/decryption (<code>false</code>) or writing/encryption (<code>true</code>).</p></dd></dl><dl><dt class="spec value" id="val-set_client_CA_list_from_file"><a href="#val-set_client_CA_list_from_file" class="anchor"></a><code><span class="keyword">val</span> set_client_CA_list_from_file : <a href="index.html#type-context">context</a> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> unit</code></dt><dd><p>Set the list of CAs sent to the client when requesting a client certificate.</p></dd></dl><dl><dt class="spec type" id="type-verify_mode"><a href="#type-verify_mode" class="anchor"></a><code><span class="keyword">type</span> verify_mode</code><code> = </code><table class="variant"><tr id="type-verify_mode.Verify_peer" class="anchored"><td class="def constructor"><a href="#type-verify_mode.Verify_peer" class="anchor"></a><code>| </code><code><span class="constructor">Verify_peer</span></code></td></tr><tr id="type-verify_mode.Verify_fail_if_no_peer_cert" class="anchored"><td class="def constructor"><a href="#type-verify_mode.Verify_fail_if_no_peer_cert" class="anchor"></a><code>| </code><code><span class="constructor">Verify_fail_if_no_peer_cert</span></code></td><td class="doc"><p>Implies <code>Verify_peer</code>.</p></td></tr><tr id="type-verify_mode.Verify_client_once" class="anchored"><td class="def constructor"><a href="#type-verify_mode.Verify_client_once" class="anchor"></a><code>| </code><code><span class="constructor">Verify_client_once</span></code></td><td class="doc"><p>Implies <code>Verify_peer</code>.</p></td></tr></table></dt><dd><p>Verification modes (see SSL_CTX_set_verify(3)).</p></dd></dl><dl><dt class="spec type" id="type-verify_callback"><a href="#type-verify_callback" class="anchor"></a><code><span class="keyword">type</span> verify_callback</code></dt><dd><p>A callback function for verification. Warning: this might change in the future.</p></dd></dl><dl><dt class="spec value" id="val-client_verify_callback"><a href="#val-client_verify_callback" class="anchor"></a><code><span class="keyword">val</span> client_verify_callback : <a href="index.html#type-verify_callback">verify_callback</a></code></dt><dd><p>Client's verification callback. Warning: this might change in the future.</p></dd></dl><dl><dt class="spec value" id="val-set_client_verify_callback_verbose"><a href="#val-set_client_verify_callback_verbose" class="anchor"></a><code><span class="keyword">val</span> set_client_verify_callback_verbose : bool <span>&#45;&gt;</span> unit</code></dt><dd><p>Set verbosity of <a href="index.html#val-client_verify_callback"><code>client_verify_callback</code></a></p></dd></dl><dl><dt class="spec value" id="val-set_verify"><a href="#val-set_verify" class="anchor"></a><code><span class="keyword">val</span> set_verify : <a href="index.html#type-context">context</a> <span>&#45;&gt;</span> <a href="index.html#type-verify_mode">verify_mode</a> list <span>&#45;&gt;</span> <a href="index.html#type-verify_callback">verify_callback</a> option <span>&#45;&gt;</span> unit</code></dt><dd><p>Set the verify mode and callback, see SSL_CTX_set_verify(3). * Warning: this might change in the future.</p></dd></dl><dl><dt class="spec value" id="val-set_verify_depth"><a href="#val-set_verify_depth" class="anchor"></a><code><span class="keyword">val</span> set_verify_depth : <a href="index.html#type-context">context</a> <span>&#45;&gt;</span> int <span>&#45;&gt;</span> unit</code></dt><dd><p>Set the maximum depth for the certificate chain verification that shall be allowed.</p></dd></dl></section><section><header><h3 id="ciphers"><a href="#ciphers" class="anchor"></a>Ciphers</h3></header><dl><dt class="spec type" id="type-cipher"><a href="#type-cipher" class="anchor"></a><code><span class="keyword">type</span> cipher</code></dt><dd><p>A cipher. It holds the algorithm information for a particular cipher which * are a core part of the SSL/TLS protocol.</p></dd></dl><dl><dt class="spec value" id="val-disable_protocols"><a href="#val-disable_protocols" class="anchor"></a><code><span class="keyword">val</span> disable_protocols : <a href="index.html#type-context">context</a> <span>&#45;&gt;</span> <a href="index.html#type-protocol">protocol</a> list <span>&#45;&gt;</span> unit</code></dt><dd><p>Disable all protocols from the list. * Note that <code>SSLv23</code> disables both SSLv2 and SSLv3 (as opposed to all the * protocols). *</p></dd></dl><dl><dt class="spec value" id="val-set_cipher_list"><a href="#val-set_cipher_list" class="anchor"></a><code><span class="keyword">val</span> set_cipher_list : <a href="index.html#type-context">context</a> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> unit</code></dt><dd><p>Set the list of available ciphers for a context. See man ciphers(1) for the format of the string.</p></dd></dl><dl><dt class="spec value" id="val-honor_cipher_order"><a href="#val-honor_cipher_order" class="anchor"></a><code><span class="keyword">val</span> honor_cipher_order : <a href="index.html#type-context">context</a> <span>&#45;&gt;</span> unit</code></dt><dd><p>When choosing a cipher, use the server's preferences instead of the client * preferences. When not set, the SSL server will always follow the clients * preferences. When set, the SSLv3/TLSv1 server will choose following its * own preferences. Because of the different protocol, for SSLv2 the server * will send its list of preferences to the client and the client chooses.</p></dd></dl><dl><dt class="spec value" id="val-init_dh_from_file"><a href="#val-init_dh_from_file" class="anchor"></a><code><span class="keyword">val</span> init_dh_from_file : <a href="index.html#type-context">context</a> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> unit</code></dt><dd><p>Init DH parameters from file</p></dd></dl><dl><dt class="spec value" id="val-init_ec_from_named_curve"><a href="#val-init_ec_from_named_curve" class="anchor"></a><code><span class="keyword">val</span> init_ec_from_named_curve : <a href="index.html#type-context">context</a> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> unit</code></dt><dd><p>Init EC curve from curve name</p></dd></dl><dl><dt class="spec value" id="val-get_cipher"><a href="#val-get_cipher" class="anchor"></a><code><span class="keyword">val</span> get_cipher : <a href="index.html#type-socket">socket</a> <span>&#45;&gt;</span> <a href="index.html#type-cipher">cipher</a></code></dt><dd><p>Get the cipher used by a socket.</p></dd></dl><dl><dt class="spec value" id="val-get_cipher_description"><a href="#val-get_cipher_description" class="anchor"></a><code><span class="keyword">val</span> get_cipher_description : <a href="index.html#type-cipher">cipher</a> <span>&#45;&gt;</span> string</code></dt><dd><p>Get a description of a cipher.</p></dd></dl><dl><dt class="spec value" id="val-get_cipher_name"><a href="#val-get_cipher_name" class="anchor"></a><code><span class="keyword">val</span> get_cipher_name : <a href="index.html#type-cipher">cipher</a> <span>&#45;&gt;</span> string</code></dt><dd><p>Get the name of a cipher.</p></dd></dl><dl><dt class="spec value" id="val-get_cipher_version"><a href="#val-get_cipher_version" class="anchor"></a><code><span class="keyword">val</span> get_cipher_version : <a href="index.html#type-cipher">cipher</a> <span>&#45;&gt;</span> string</code></dt><dd><p>Get the version of a cipher.</p></dd></dl></section><section><header><h3 id="certificates"><a href="#certificates" class="anchor"></a>Certificates</h3></header><dl><dt class="spec type" id="type-certificate"><a href="#type-certificate" class="anchor"></a><code><span class="keyword">type</span> certificate</code></dt><dd><p>A certificate.</p></dd></dl><dl><dt class="spec value" id="val-read_certificate"><a href="#val-read_certificate" class="anchor"></a><code><span class="keyword">val</span> read_certificate : string <span>&#45;&gt;</span> <a href="index.html#type-certificate">certificate</a></code></dt><dd><p><code>read_certificate fname</code> reads the certificate in the file <code>fname</code>.</p></dd></dl><dl><dt class="spec value" id="val-write_certificate"><a href="#val-write_certificate" class="anchor"></a><code><span class="keyword">val</span> write_certificate : string <span>&#45;&gt;</span> <a href="index.html#type-certificate">certificate</a> <span>&#45;&gt;</span> unit</code></dt><dt class="spec value" id="val-get_certificate"><a href="#val-get_certificate" class="anchor"></a><code><span class="keyword">val</span> get_certificate : <a href="index.html#type-socket">socket</a> <span>&#45;&gt;</span> <a href="index.html#type-certificate">certificate</a></code></dt><dd><p>Get the certificate used by a socket.</p></dd></dl><dl><dt class="spec value" id="val-get_issuer"><a href="#val-get_issuer" class="anchor"></a><code><span class="keyword">val</span> get_issuer : <a href="index.html#type-certificate">certificate</a> <span>&#45;&gt;</span> string</code></dt><dd><p>Get the issuer of a certificate.</p></dd></dl><dl><dt class="spec value" id="val-get_subject"><a href="#val-get_subject" class="anchor"></a><code><span class="keyword">val</span> get_subject : <a href="index.html#type-certificate">certificate</a> <span>&#45;&gt;</span> string</code></dt><dd><p>Get the subject of a certificate.</p></dd></dl><dl><dt class="spec value" id="val-load_verify_locations"><a href="#val-load_verify_locations" class="anchor"></a><code><span class="keyword">val</span> load_verify_locations : <a href="index.html#type-context">context</a> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> string <span>&#45;&gt;</span> unit</code></dt><dd><p><code>load_verify_locations ctxt cafile capath</code> specifies the locations for the context <code>ctx</code>, at which CA certificates for verification purposes are located. <code>cafile</code> should be the name of a CA certificates file in PEM format and <code>capath</code> should be the name of a directory which contains CA certificates in PEM format. Empty strings can be used in order not to specify on of the parameters (but not both).</p><dl><dt>raises Invalid_argument</dt><dd><p>if both strings are empty or if one of the files given in arguments could not be found.</p></dd></dl></dd></dl><dl><dt class="spec value" id="val-get_verify_result"><a href="#val-get_verify_result" class="anchor"></a><code><span class="keyword">val</span> get_verify_result : <a href="index.html#type-socket">socket</a> <span>&#45;&gt;</span> int</code></dt><dd><p>Get the verification result.</p></dd></dl></section><section><header><h3 id="creating,-connecting-and-closing-sockets"><a href="#creating,-connecting-and-closing-sockets" class="anchor"></a>Creating, connecting and closing sockets</h3></header><dl><dt class="spec value" id="val-embed_socket"><a href="#val-embed_socket" class="anchor"></a><code><span class="keyword">val</span> embed_socket : <a href="../../ocaml/Unix/index.html#type-file_descr">Unix.file_descr</a> <span>&#45;&gt;</span> <a href="index.html#type-context">context</a> <span>&#45;&gt;</span> <a href="index.html#type-socket">socket</a></code></dt><dd><p>Embed a Unix socket into an SSL socket.</p></dd></dl><dl><dt class="spec value" id="val-open_connection"><a href="#val-open_connection" class="anchor"></a><code><span class="keyword">val</span> open_connection : <a href="index.html#type-protocol">protocol</a> <span>&#45;&gt;</span> <a href="../../ocaml/Unix/index.html#type-sockaddr">Unix.sockaddr</a> <span>&#45;&gt;</span> <a href="index.html#type-socket">socket</a></code></dt><dd><p>Open an SSL connection.</p></dd></dl><dl><dt class="spec value" id="val-open_connection_with_context"><a href="#val-open_connection_with_context" class="anchor"></a><code><span class="keyword">val</span> open_connection_with_context : <a href="index.html#type-context">context</a> <span>&#45;&gt;</span> <a href="../../ocaml/Unix/index.html#type-sockaddr">Unix.sockaddr</a> <span>&#45;&gt;</span> <a href="index.html#type-socket">socket</a></code></dt><dd><p>Open an SSL connection with the specified context.</p></dd></dl><dl><dt class="spec value" id="val-shutdown_connection"><a href="#val-shutdown_connection" class="anchor"></a><code><span class="keyword">val</span> shutdown_connection : <a href="index.html#type-socket">socket</a> <span>&#45;&gt;</span> unit</code></dt><dd><p>Close an SSL connection opened with <code>open_connection</code>.</p></dd></dl><dl><dt class="spec value" id="val-set_client_SNI_hostname"><a href="#val-set_client_SNI_hostname" class="anchor"></a><code><span class="keyword">val</span> set_client_SNI_hostname : <a href="index.html#type-socket">socket</a> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> unit</code></dt><dd><p>Set the hostname the client is attempting to connect to using the Server * Name Indication (SNI) TLS extension.</p></dd></dl><dl><dt class="spec value" id="val-connect"><a href="#val-connect" class="anchor"></a><code><span class="keyword">val</span> connect : <a href="index.html#type-socket">socket</a> <span>&#45;&gt;</span> unit</code></dt><dd><p>Connect an SSL socket.</p></dd></dl><dl><dt class="spec value" id="val-accept"><a href="#val-accept" class="anchor"></a><code><span class="keyword">val</span> accept : <a href="index.html#type-socket">socket</a> <span>&#45;&gt;</span> unit</code></dt><dd><p>Accept an SSL connection.</p></dd></dl><dl><dt class="spec value" id="val-flush"><a href="#val-flush" class="anchor"></a><code><span class="keyword">val</span> flush : <a href="index.html#type-socket">socket</a> <span>&#45;&gt;</span> unit</code></dt><dd><p>Flush an SSL connection.</p></dd></dl><dl><dt class="spec value" id="val-shutdown"><a href="#val-shutdown" class="anchor"></a><code><span class="keyword">val</span> shutdown : <a href="index.html#type-socket">socket</a> <span>&#45;&gt;</span> unit</code></dt><dd><p>Close an SSL connection.</p></dd></dl></section><section><header><h3 id="i/o-on-ssl-sockets"><a href="#i/o-on-ssl-sockets" class="anchor"></a>I/O on SSL sockets</h3></header><dl><dt class="spec value" id="val-verify"><a href="#val-verify" class="anchor"></a><code><span class="keyword">val</span> verify : <a href="index.html#type-socket">socket</a> <span>&#45;&gt;</span> unit</code></dt><dd><p>Check the result of the verification of the X509 certificate presented by the peer, if any. Raises a <code>verify_error</code> on failure.</p></dd></dl><dl><dt class="spec value" id="val-file_descr_of_socket"><a href="#val-file_descr_of_socket" class="anchor"></a><code><span class="keyword">val</span> file_descr_of_socket : <a href="index.html#type-socket">socket</a> <span>&#45;&gt;</span> <a href="../../ocaml/Unix/index.html#type-file_descr">Unix.file_descr</a></code></dt><dd><p>Get the file descriptor associated with a socket. It is primarly useful for <code>select</code>ing on it; you should not write or read on it.</p></dd></dl><dl><dt class="spec value" id="val-read"><a href="#val-read" class="anchor"></a><code><span class="keyword">val</span> read : <a href="index.html#type-socket">socket</a> <span>&#45;&gt;</span> <a href="../../ocaml/Stdlib/Bytes/index.html#type-t">Stdlib.Bytes.t</a> <span>&#45;&gt;</span> int <span>&#45;&gt;</span> int <span>&#45;&gt;</span> int</code></dt><dd><p><code>read sock buf off len</code> receives data from a connected SSL socket.</p></dd></dl><dl><dt class="spec value" id="val-read_into_bigarray"><a href="#val-read_into_bigarray" class="anchor"></a><code><span class="keyword">val</span> read_into_bigarray : <a href="index.html#type-socket">socket</a> <span>&#45;&gt;</span> <a href="index.html#type-bigarray">bigarray</a> <span>&#45;&gt;</span> int <span>&#45;&gt;</span> int <span>&#45;&gt;</span> int</code></dt><dd><p><code>read_into_bigarray sock ba off len</code> receives data from a connected SSL socket. This function releases the runtime while the read takes place.</p></dd></dl><dl><dt class="spec value" id="val-read_into_bigarray_blocking"><a href="#val-read_into_bigarray_blocking" class="anchor"></a><code><span class="keyword">val</span> read_into_bigarray_blocking : <a href="index.html#type-socket">socket</a> <span>&#45;&gt;</span> <a href="index.html#type-bigarray">bigarray</a> <span>&#45;&gt;</span> int <span>&#45;&gt;</span> int <span>&#45;&gt;</span> int</code></dt><dd><p><code>read_into_bigarray_blocking sock ba off len</code> receives data from a connected SSL socket. This function DOES NOT release the runtime while the read takes place: it must be used with nonblocking sockets.</p></dd></dl><dl><dt class="spec value" id="val-write"><a href="#val-write" class="anchor"></a><code><span class="keyword">val</span> write : <a href="index.html#type-socket">socket</a> <span>&#45;&gt;</span> <a href="../../ocaml/Stdlib/Bytes/index.html#type-t">Stdlib.Bytes.t</a> <span>&#45;&gt;</span> int <span>&#45;&gt;</span> int <span>&#45;&gt;</span> int</code></dt><dd><p><code>write sock buf off len</code> sends data over a connected SSL socket.</p></dd></dl><dl><dt class="spec value" id="val-write_substring"><a href="#val-write_substring" class="anchor"></a><code><span class="keyword">val</span> write_substring : <a href="index.html#type-socket">socket</a> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> int <span>&#45;&gt;</span> int <span>&#45;&gt;</span> int</code></dt><dd><p><code>write_substring sock str off len</code> sends data over a connected SSL socket.</p></dd></dl><dl><dt class="spec value" id="val-write_bigarray"><a href="#val-write_bigarray" class="anchor"></a><code><span class="keyword">val</span> write_bigarray : <a href="index.html#type-socket">socket</a> <span>&#45;&gt;</span> <a href="index.html#type-bigarray">bigarray</a> <span>&#45;&gt;</span> int <span>&#45;&gt;</span> int <span>&#45;&gt;</span> int</code></dt><dd><p><code>write_bigarray sock ba off len</code> sends data over a connected SSL socket. This function releases the runtime while the read takes place.</p></dd></dl><dl><dt class="spec value" id="val-write_bigarray_blocking"><a href="#val-write_bigarray_blocking" class="anchor"></a><code><span class="keyword">val</span> write_bigarray_blocking : <a href="index.html#type-socket">socket</a> <span>&#45;&gt;</span> <a href="index.html#type-bigarray">bigarray</a> <span>&#45;&gt;</span> int <span>&#45;&gt;</span> int <span>&#45;&gt;</span> int</code></dt><dd><p><code>write_bigarray sock ba off len</code> sends data over a connected SSL socket. This function DOES NOT release the runtime while the read takes place: it must be used with nonblocking sockets.</p></dd></dl><section><header><h4 id="high-level-communication-functions"><a href="#high-level-communication-functions" class="anchor"></a>High-level communication functions</h4></header><dl><dt class="spec value" id="val-input_string"><a href="#val-input_string" class="anchor"></a><code><span class="keyword">val</span> input_string : <a href="index.html#type-socket">socket</a> <span>&#45;&gt;</span> string</code></dt><dd><p>Input a string on an SSL socket.</p></dd></dl><dl><dt class="spec value" id="val-output_string"><a href="#val-output_string" class="anchor"></a><code><span class="keyword">val</span> output_string : <a href="index.html#type-socket">socket</a> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> unit</code></dt><dd><p>Write a string on an SSL socket.</p></dd></dl><dl><dt class="spec value" id="val-input_char"><a href="#val-input_char" class="anchor"></a><code><span class="keyword">val</span> input_char : <a href="index.html#type-socket">socket</a> <span>&#45;&gt;</span> char</code></dt><dd><p>Input a character on an SSL socket.</p></dd></dl><dl><dt class="spec value" id="val-output_char"><a href="#val-output_char" class="anchor"></a><code><span class="keyword">val</span> output_char : <a href="index.html#type-socket">socket</a> <span>&#45;&gt;</span> char <span>&#45;&gt;</span> unit</code></dt><dd><p>Write a char on an SSL socket.</p></dd></dl><dl><dt class="spec value" id="val-input_int"><a href="#val-input_int" class="anchor"></a><code><span class="keyword">val</span> input_int : <a href="index.html#type-socket">socket</a> <span>&#45;&gt;</span> int</code></dt><dd><p>Input an integer on an SSL socket.</p></dd></dl><dl><dt class="spec value" id="val-output_int"><a href="#val-output_int" class="anchor"></a><code><span class="keyword">val</span> output_int : <a href="index.html#type-socket">socket</a> <span>&#45;&gt;</span> int <span>&#45;&gt;</span> unit</code></dt><dd><p>Write an integer on an SSL socket.</p></dd></dl></section></section></section></div></body></html>