<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>App (useri.Useri.App)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – <a href="../../index.html">useri</a> &#x00BB; <a href="../index.html">Useri</a> &#x00BB; App</nav><h1>Module <code>Useri.App</code></h1><p>Application</p></header><section><header><h2 id="environment"><a href="#environment" class="anchor"></a>Environment</h2></header><dl><dt class="spec value" id="val-env"><a href="#val-env" class="anchor"></a><code><span class="keyword">val </span>env : string <span>&#45;&gt;</span> default:<span class="type-var">'a</span> <span>&#45;&gt;</span> (string <span>&#45;&gt;</span> <span class="type-var">'a</span>) <span>&#45;&gt;</span> <span class="type-var">'a</span></code></dt><dd><p><code>env var ~default parse</code> lookups <code>var</code> in the environment, parses it with <code>parse</code> and returns the result. If <code>parse</code> raises or if <code>var</code> is not in the environment <code>default</code> is returned.</p><p>Data lookup depends on the <a href="index.html#type-backend"><span>backend</span></a>:</p><ul><li><code>`Tsdl</code> uses <span class="xref-unresolved" title="unresolved reference to &quot;Sys.getenv&quot;"><code>Sys</code>.getenv</span>.</li><li><code>`Jsoo</code> lookups the query string of <code>window.location</code> for the first matching <code>var=value</code> pair.</li></ul></dd></dl><dl><dt class="spec value" id="val-prefs_path"><a href="#val-prefs_path" class="anchor"></a><code><span class="keyword">val </span>prefs_path : org:string <span>&#45;&gt;</span> app:string <span>&#45;&gt;</span> (string, [ `Msg of string ]) Result.result</code></dt><dd><p><code>TODO</code> this should used the app name automatically. Unique to user and app.</p></dd></dl></section><section><header><h2 id="userquit"><a href="#userquit" class="anchor"></a>User requested quit</h2></header><dl><dt class="spec value" id="val-quit"><a href="#val-quit" class="anchor"></a><code><span class="keyword">val </span>quit : unit React.event</code></dt><dd><p><code>quit</code> occurs whenever the user requested to quit. The meaning depends on the <a href="index.html#type-backend"><span>backend</span></a>:</p><ul><li><code>`Tsdl</code>, this is only a hint, e.g. the last window was closed or a platform dependent way of quitting applications was invoked</li><li><code>`Jsoo</code>, the browser window is closing and it's your last chance to peform something</li></ul><p>.</p></dd></dl></section><section><header><h2 id="lifecycle"><a href="#lifecycle" class="anchor"></a>Init, run and release</h2></header><dl><dt class="spec value" id="val-init"><a href="#val-init" class="anchor"></a><code><span class="keyword">val </span>init : ?&#8288;name:string <span>&#45;&gt;</span> ?&#8288;surface:<a href="../Surface/index.html#type-t">Surface.t</a> <span>&#45;&gt;</span> unit <span>&#45;&gt;</span> (unit, [ `Msg of string ]) Result.result</code></dt><dd><p><code>init name surface</code> initialises an application named <code>name</code> (default derived from the executable name) with surface <code>surface</code> (defaults to a default <a href="../Surface/index.html#val-create"><code>Surface.create</code></a>.)</p></dd></dl><dl><dt class="spec value" id="val-run_step"><a href="#val-run_step" class="anchor"></a><code><span class="keyword">val </span>run_step : unit <span>&#45;&gt;</span> <a href="../Time/index.html#type-span">Time.span</a></code></dt><dd><p><code>run_step ()</code> gather as much user input as possible and returns the maximal timespan after which <a href="index.html#val-run_step"><code>run_step</code></a> should be called again.</p></dd></dl><dl><dt class="spec value" id="val-run"><a href="#val-run" class="anchor"></a><code><span class="keyword">val </span>run : ?&#8288;until:<span class="type-var">'a</span> React.event <span>&#45;&gt;</span> unit <span>&#45;&gt;</span> unit</code></dt><dd><p><code>run until</code> depends on the <a href="index.html#type-backend_scheme"><span>backend scheme</span></a>:</p><ul><li><code>`Sync</code> invokes <a href="index.html#val-run_step"><code>run_step</code></a> repeatedly and blocks until the first occurence of <code>until</code> (defaults to <a href="index.html#val-quit"><code>quit</code></a>). After <a href="index.html#val-run"><code>run</code></a> returned it can be called again.</li><li><code>`Async</code> returns immediately, <code>until</code> is irrelevant.</li></ul></dd></dl><dl><dt class="spec value" id="val-release"><a href="#val-release" class="anchor"></a><code><span class="keyword">val </span>release : ?&#8288;sinks:bool <span>&#45;&gt;</span> unit <span>&#45;&gt;</span> unit</code></dt><dd><p><code>release sinks ()</code> does the following:</p><ol><li>Makes the <a href="index.html#val-stop"><code>stop</code></a> event occur.</li><li>If <code>sinks</code> is <code>true</code> (default), calls <a href="index.html#val-release_sinks"><code>release_sinks</code></a>.</li><li>Reclaims other resources</li></ol><p>After a <a href="index.html#val-release"><code>release</code></a> it should be possible to <a href="index.html#val-init"><code>init</code></a> again.</p></dd></dl><dl><dt class="spec value" id="val-start"><a href="#val-start" class="anchor"></a><code><span class="keyword">val </span>start : unit React.event</code></dt><dd><p><code>start</code> occurs the first time either <a href="index.html#val-run_step"><code>run_step</code></a> or <a href="index.html#val-run"><code>run</code></a> is called.</p></dd></dl><dl><dt class="spec value" id="val-stop"><a href="#val-stop" class="anchor"></a><code><span class="keyword">val </span>stop : unit React.event</code></dt><dd><p><code>stop</code> occurs when <a href="index.html#val-release"><code>release</code></a> starts.</p></dd></dl></section><section><header><h2 id="event-and-signal-sinks"><a href="#event-and-signal-sinks" class="anchor"></a>Event and signal sinks</h2></header><dl><dt class="spec value" id="val-sink_event"><a href="#val-sink_event" class="anchor"></a><code><span class="keyword">val </span>sink_event : <span class="type-var">'a</span> React.event <span>&#45;&gt;</span> unit</code></dt><dd><p><code>sink_event e</code> keeps a reference on <code>e</code> until the app <code>exit</code>s.</p></dd></dl><dl><dt class="spec value" id="val-sink_signal"><a href="#val-sink_signal" class="anchor"></a><code><span class="keyword">val </span>sink_signal : <span class="type-var">'a</span> React.signal <span>&#45;&gt;</span> unit</code></dt><dd><p><code>sink_signal s</code> keeps a reference on <code>s</code> until the app <code>exit</code>s.</p></dd></dl><dl><dt class="spec value" id="val-release_sinks"><a href="#val-release_sinks" class="anchor"></a><code><span class="keyword">val </span>release_sinks : unit <span>&#45;&gt;</span> unit</code></dt><dd><p>Stops and release sink references. In the <code>`Jsoo</code> <a href="index.html#type-backend"><span>backend</span></a> stops are <span class="xref-unresolved" title="unresolved reference to &quot;React.strongstop&quot;"><span>strong</span></span>.</p></dd></dl></section><section><header><h2 id="launch-context"><a href="#launch-context" class="anchor"></a>Launch context</h2></header><dl><dt class="spec type" id="type-launch_context"><a href="#type-launch_context" class="anchor"></a><code><span class="keyword">type </span>launch_context</code><span class="keyword"> = </span><code>[ </code><table class="variant"><tr id="type-launch_context.Browser" class="anchored"><td class="def constructor"><a href="#type-launch_context.Browser" class="anchor"></a><code><span class="keyword">| </span></code><code>`Browser</code></td></tr><tr id="type-launch_context.Gui" class="anchored"><td class="def constructor"><a href="#type-launch_context.Gui" class="anchor"></a><code><span class="keyword">| </span></code><code>`Gui</code></td></tr><tr id="type-launch_context.Terminal" class="anchored"><td class="def constructor"><a href="#type-launch_context.Terminal" class="anchor"></a><code><span class="keyword">| </span></code><code>`Terminal</code></td></tr></table><code> ]</code></dt></dl><dl><dt class="spec value" id="val-launch_context"><a href="#val-launch_context" class="anchor"></a><code><span class="keyword">val </span>launch_context : <a href="index.html#type-launch_context">launch_context</a></code></dt><dd><p><code>launch_context</code> is the mechanism that started the program.</p></dd></dl><dl><dt class="spec value" id="val-pp_launch_context"><a href="#val-pp_launch_context" class="anchor"></a><code><span class="keyword">val </span>pp_launch_context : Format.formatter <span>&#45;&gt;</span> <a href="index.html#type-launch_context">launch_context</a> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>pp_launch_context ppf c</code> prints an unspecified representation of <code>c</code> on <code>ppf</code>.</p></dd></dl></section><section><header><h2 id="platform-and-backend"><a href="#platform-and-backend" class="anchor"></a>Platform and backend</h2></header><dl><dt class="spec value" id="val-platform"><a href="#val-platform" class="anchor"></a><code><span class="keyword">val </span>platform : string</code></dt><dd><p><code>platform</code> is the name of the platform you are running on.</p><p><b>Warning.</b> Do not expect different backend to report the same platform with the same string.</p></dd></dl><dl><dt class="spec type" id="type-backend"><a href="#type-backend" class="anchor"></a><code><span class="keyword">type </span>backend</code><span class="keyword"> = </span><code>[ </code><table class="variant"><tr id="type-backend.Tsdl" class="anchored"><td class="def constructor"><a href="#type-backend.Tsdl" class="anchor"></a><code><span class="keyword">| </span></code><code>`Tsdl</code></td></tr><tr id="type-backend.Jsoo" class="anchored"><td class="def constructor"><a href="#type-backend.Jsoo" class="anchor"></a><code><span class="keyword">| </span></code><code>`Jsoo</code></td></tr><tr id="type-backend.Other" class="anchored"><td class="def constructor"><a href="#type-backend.Other" class="anchor"></a><code><span class="keyword">| </span></code><code>`Other<span class="keyword"> of </span>string</code></td></tr></table><code> ]</code></dt><dd><p>The type for <code>Useri</code>'s backends.</p></dd></dl><dl><dt class="spec value" id="val-backend"><a href="#val-backend" class="anchor"></a><code><span class="keyword">val </span>backend : <a href="index.html#type-backend">backend</a></code></dt><dd><p><code>backend</code> is <code>Useri</code>'s current backend.</p></dd></dl><dl><dt class="spec value" id="val-pp_backend"><a href="#val-pp_backend" class="anchor"></a><code><span class="keyword">val </span>pp_backend : Format.formatter <span>&#45;&gt;</span> <a href="index.html#type-backend">backend</a> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>pp_backend ppf b</code> prints an unspecified representation of <code>c</code> on <code>ppf</code>.</p></dd></dl><dl><dt class="spec value" id="val-set_backend_logger"><a href="#val-set_backend_logger" class="anchor"></a><code><span class="keyword">val </span>set_backend_logger : ([ `Warning<span class="keyword"> | </span>`Error ] <span>&#45;&gt;</span> string <span>&#45;&gt;</span> unit) <span>&#45;&gt;</span> unit</code></dt><dd><p><code>set_backend_logger log</code> sets <code>log</code> to be called by backends whenever non-fatal internal warnings and errors are generated. The default function outputs and flushes to stderr.</p></dd></dl><dl><dt class="spec type" id="type-backend_scheme"><a href="#type-backend_scheme" class="anchor"></a><code><span class="keyword">type </span>backend_scheme</code><span class="keyword"> = </span><code>[ </code><table class="variant"><tr id="type-backend_scheme.Sync" class="anchored"><td class="def constructor"><a href="#type-backend_scheme.Sync" class="anchor"></a><code><span class="keyword">| </span></code><code>`Sync</code></td></tr><tr id="type-backend_scheme.Async" class="anchored"><td class="def constructor"><a href="#type-backend_scheme.Async" class="anchor"></a><code><span class="keyword">| </span></code><code>`Async</code></td></tr></table><code> ]</code></dt><dd><p>The type for backend scheme.</p><ul><li><code>`Sync</code>, the backend is synchronous the client of the library is in charge of running the event loop by using <a href="index.html#val-run_step"><code>run_step</code></a> or <a href="index.html#val-run"><code>run</code></a>.</li><li><code>`Async</code>, the backend is asynchronous, there's an inversion of control, the call to <a href="index.html#val-run"><code>run</code></a> won't block.</li></ul></dd></dl><dl><dt class="spec value" id="val-backend_scheme"><a href="#val-backend_scheme" class="anchor"></a><code><span class="keyword">val </span>backend_scheme : [ `Sync<span class="keyword"> | </span>`Async ]</code></dt><dd><p><code>backend_scheme</code> is the <code>Useri</code>'s current backend's scheme.</p></dd></dl><dl><dt class="spec value" id="val-pp_backend_scheme"><a href="#val-pp_backend_scheme" class="anchor"></a><code><span class="keyword">val </span>pp_backend_scheme : Format.formatter <span>&#45;&gt;</span> <a href="index.html#type-backend_scheme">backend_scheme</a> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>pp_backend_scheme ppf bs</code> prints and unspecified representation of <code>bs</code> on <code>ppf</code>.</p></dd></dl></section><section><header><h2 id="cpu-count"><a href="#cpu-count" class="anchor"></a>CPU count</h2></header><dl><dt class="spec type" id="type-cpu_count"><a href="#type-cpu_count" class="anchor"></a><code><span class="keyword">type </span>cpu_count</code><span class="keyword"> = </span><code>[ </code><table class="variant"><tr id="type-cpu_count.Known" class="anchored"><td class="def constructor"><a href="#type-cpu_count.Known" class="anchor"></a><code><span class="keyword">| </span></code><code>`Known<span class="keyword"> of </span>int</code></td></tr><tr id="type-cpu_count.Unknown" class="anchored"><td class="def constructor"><a href="#type-cpu_count.Unknown" class="anchor"></a><code><span class="keyword">| </span></code><code>`Unknown</code></td></tr></table><code> ]</code></dt><dd><p>The type for CPU counts.</p></dd></dl><dl><dt class="spec value" id="val-cpu_count"><a href="#val-cpu_count" class="anchor"></a><code><span class="keyword">val </span>cpu_count : <a href="index.html#type-cpu_count">cpu_count</a></code></dt><dd><p><code>cpu_count</code> is the number of CPU available.</p></dd></dl><dl><dt class="spec value" id="val-pp_cpu_count"><a href="#val-pp_cpu_count" class="anchor"></a><code><span class="keyword">val </span>pp_cpu_count : Format.formatter <span>&#45;&gt;</span> <a href="index.html#type-cpu_count">cpu_count</a> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>pp_cpu_count ppf c</code> prints an unspecified representation of <code>c</code> on <code>ppf</code>.</p></dd></dl></section></div></body></html>