<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>X509 (x509.X509)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../index.html">x509</a> &#x00BB; X509</nav><h1>Module <code>X509</code></h1><p>X509 encoding, generation, and validation.</p><p><code>X509</code> is a module for handling X.509 certificates, as described in <a href="https://tools.ietf.org/html/rfc5280">RFC 5280</a>. X.509 describes a hierarchical public key infrastructure, where all trust is delegated to certificate authorities (CA). The task of a CA is to sign certificate signing requests (CSR), which turns them into certificates, after verification that the requestor is eligible.</p><p>An X.509 certificate is an authentication token: a public key, a subject (e.g. server name), a validity period, optionally a purpose (usage), and various other optional <a href="Extension/index.html"><span>Extensions</span></a>.</p><p>The public keys of trusted CAs are distributed with the software, or configured manually. When an endpoint connects, it has to present its certificate chain, which are pairwise signed certificates. This chain is verified: the signatures have to be valid, the last certificate must be signed by a trusted CA, the name has to match the expected name, all certificates must be valid at the current time, and the purpose of each certificate must match its usage. An alternative validator checks that the hash of the server certificate matches the given hash.</p><p>This module provides <a href="Encoding/index.html"><span>parsers and unparsers</span></a> (PEM encoding) of ASN.1 encoded X.509 certificates, public and private RSA keys (<a href="http://tools.ietf.org/html/rfc5208">PKCS 8, RFC 5208</a>), and certificate signing requests (<a href="http://tools.ietf.org/html/rfc2986">PKCS 10, RFC 2986</a>) (both require parts of <a href="https://tools.ietf.org/html/rfc2985">PKCS9, RFC 2985</a>), <a href="Validation/index.html"><span>validation</span></a> of certificates, and construction of <a href="Authenticator/index.html"><span>authenticators</span></a>. Name validation, as defined in <a href="https://tools.ietf.org/html/rfc6125">RFC 6125</a>, is also implemented. The <a href="CA/index.html"><span>CA</span></a> module provides functionality to create and sign CSR.</p><p>Missing is the handling of online certificate status protocol, some X.509v3 extensions (such as policy and name constraints). The only supported key type is RSA.</p><p><em>0.6.2 - <a href="https://github.com/mirleft/ocaml-x509">homepage</a></em></p><nav class="toc"><ul><li><a href="#abstract-certificate-type">Abstract certificate type</a></li><li><a href="#basic-operations-on-a-certificate">Basic operations on a certificate</a></li></ul></nav></header><section><header><h2 id="abstract-certificate-type"><a href="#abstract-certificate-type" class="anchor"></a>Abstract certificate type</h2></header><dl><dt class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><code><span class="keyword">type </span>t</code></dt><dd><p>The abstract type of a certificate, with <a href="Encoding/Pem/Certificate/index.html"><span>encoding and decoding to PEM</span></a>.</p></dd></dl><dl><dt class="spec value" id="val-t_of_sexp"><a href="#val-t_of_sexp" class="anchor"></a><code><span class="keyword">val </span>t_of_sexp : Sexplib.Sexp.t <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></dt><dd><p><code>t_of_sexp sexp</code> is <code>certificate</code>, the unmarshalled <code>sexp</code>.</p></dd></dl><dl><dt class="spec value" id="val-sexp_of_t"><a href="#val-sexp_of_t" class="anchor"></a><code><span class="keyword">val </span>sexp_of_t : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> Sexplib.Sexp.t</code></dt><dd><p><code>sexp_of_t certificate</code> is <code>sexp</code>, the marshalled <code>certificate</code>.</p></dd></dl></section><section><header><h2 id="basic-operations-on-a-certificate"><a href="#basic-operations-on-a-certificate" class="anchor"></a>Basic operations on a certificate</h2></header><dl><dt class="spec type" id="type-key_type"><a href="#type-key_type" class="anchor"></a><code><span class="keyword">type </span>key_type</code><span class="keyword"> = </span><code>[ </code><table class="variant"><tr id="type-key_type.RSA" class="anchored"><td class="def constructor"><a href="#type-key_type.RSA" class="anchor"></a><code><span class="keyword">| </span></code><code>`RSA</code></td></tr><tr id="type-key_type.EC" class="anchored"><td class="def constructor"><a href="#type-key_type.EC" class="anchor"></a><code><span class="keyword">| </span></code><code>`EC<span class="keyword"> of </span>Asn.oid</code></td></tr></table><code> ]</code></dt><dd><p>The polymorphic variant of public key types.</p></dd></dl><dl><dt class="spec value" id="val-supports_keytype"><a href="#val-supports_keytype" class="anchor"></a><code><span class="keyword">val </span>supports_keytype : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-key_type">key_type</a> <span>&#45;&gt;</span> bool</code></dt><dd><p><code>supports_keytype certificate key_type</code> is <code>result</code>, whether public key of the <code>certificate</code> matches the given <code>key_type</code>.</p></dd></dl><dl><dt class="spec type" id="type-public_key"><a href="#type-public_key" class="anchor"></a><code><span class="keyword">type </span>public_key</code><span class="keyword"> = </span><code>[ </code><table class="variant"><tr id="type-public_key.RSA" class="anchored"><td class="def constructor"><a href="#type-public_key.RSA" class="anchor"></a><code><span class="keyword">| </span></code><code>`RSA<span class="keyword"> of </span>Nocrypto.Rsa.pub</code></td></tr><tr id="type-public_key.EC_pub" class="anchored"><td class="def constructor"><a href="#type-public_key.EC_pub" class="anchor"></a><code><span class="keyword">| </span></code><code>`EC_pub<span class="keyword"> of </span>Asn.oid</code></td></tr></table><code> ]</code></dt><dd><p>The polymorphic variant of public keys, with <a href="http://tools.ietf.org/html/rfc5208">PKCS 8</a> <a href="Encoding/Pem/Public_key/index.html"><span>encoding and decoding to PEM</span></a>.</p></dd></dl><dl><dt class="spec value" id="val-key_id"><a href="#val-key_id" class="anchor"></a><code><span class="keyword">val </span>key_id : <a href="index.html#type-public_key">public_key</a> <span>&#45;&gt;</span> Cstruct.t</code></dt><dd><p><code>key_id public_key</code> is <code>result</code>, the 160-bit <code>`SHA1</code> hash of the BIT STRING subjectPublicKey (excluding tag, length, and number of unused bits) for publicKeyInfo of <code>public_key</code>.</p><p><a href="https://tools.ietf.org/html/rfc5280#section-4.2.1.2">RFC 5280, 4.2.1.2, variant (1)</a></p></dd></dl><dl><dt class="spec value" id="val-key_fingerprint"><a href="#val-key_fingerprint" class="anchor"></a><code><span class="keyword">val </span>key_fingerprint : ?&#8288;hash:Nocrypto.Hash.hash <span>&#45;&gt;</span> <a href="index.html#type-public_key">public_key</a> <span>&#45;&gt;</span> Cstruct.t</code></dt><dd><p><code>key_fingerprint ?hash public_key</code> is <code>result</code>, the hash (by default SHA256) of the DER encoded public key (equivalent to `openssl x509 -noout -pubkey | openssl pkey -pubin -outform DER | openssl dgst -HASH`).</p></dd></dl><dl><dt class="spec type" id="type-private_key"><a href="#type-private_key" class="anchor"></a><code><span class="keyword">type </span>private_key</code><span class="keyword"> = </span><code>[ </code><table class="variant"><tr id="type-private_key.RSA" class="anchored"><td class="def constructor"><a href="#type-private_key.RSA" class="anchor"></a><code><span class="keyword">| </span></code><code>`RSA<span class="keyword"> of </span>Nocrypto.Rsa.priv</code></td></tr></table><code> ]</code></dt><dd><p>The polymorphic variant of private keys, with <a href="http://tools.ietf.org/html/rfc5208">PKCS 8</a> <a href="Encoding/Pem/Private_key/index.html"><span>encoding and decoding to PEM</span></a>.</p></dd></dl><dl><dt class="spec value" id="val-public_key"><a href="#val-public_key" class="anchor"></a><code><span class="keyword">val </span>public_key : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-public_key">public_key</a></code></dt><dd><p><code>public_key certificate</code> is <code>pubkey</code>, the public key of the <code>certificate</code>.</p></dd></dl><dl><dt class="spec value" id="val-hostnames"><a href="#val-hostnames" class="anchor"></a><code><span class="keyword">val </span>hostnames : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> string list</code></dt><dd><p><code>hostnames certficate</code> are <code>hostnames</code>, the list of hostnames this <code>certificate</code> is valid for. Currently, these are the DNS names of the <a href="https://tools.ietf.org/html/rfc5280#section-4.2.1.6">Subject Alternative Name</a> extension, if present, or otherwise the singleton list containing the common name.</p></dd></dl><dl><dt class="spec type" id="type-host"><a href="#type-host" class="anchor"></a><code><span class="keyword">type </span>host</code><span class="keyword"> = </span><code>[ </code><table class="variant"><tr id="type-host.Strict" class="anchored"><td class="def constructor"><a href="#type-host.Strict" class="anchor"></a><code><span class="keyword">| </span></code><code>`Strict<span class="keyword"> of </span>string</code></td></tr><tr id="type-host.Wildcard" class="anchored"><td class="def constructor"><a href="#type-host.Wildcard" class="anchor"></a><code><span class="keyword">| </span></code><code>`Wildcard<span class="keyword"> of </span>string</code></td></tr></table><code> ]</code></dt><dd><p>The polymorphic variant for hostname validation.</p></dd></dl><dl><dt class="spec value" id="val-supports_hostname"><a href="#val-supports_hostname" class="anchor"></a><code><span class="keyword">val </span>supports_hostname : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-host">host</a> <span>&#45;&gt;</span> bool</code></dt><dd><p><code>supports_hostname certificate host</code> is <code>result</code>, whether the <code>certificate</code> contains the given <code>host</code>, using <a href="index.html#val-hostnames"><code>hostnames</code></a>.</p></dd></dl><dl><dt class="spec value" id="val-common_name_to_string"><a href="#val-common_name_to_string" class="anchor"></a><code><span class="keyword">val </span>common_name_to_string : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> string</code></dt><dd><p><code>common_name_to_string certificate</code> is <code>common_name</code>, the common name of the subject of the <code>certificate</code>.</p></dd></dl><dl><dt class="spec type" id="type-component"><a href="#type-component" class="anchor"></a><code><span class="keyword">type </span>component</code><span class="keyword"> = </span><code>[ </code><table class="variant"><tr id="type-component.CN" class="anchored"><td class="def constructor"><a href="#type-component.CN" class="anchor"></a><code><span class="keyword">| </span></code><code>`CN<span class="keyword"> of </span>string</code></td></tr><tr id="type-component.Serialnumber" class="anchored"><td class="def constructor"><a href="#type-component.Serialnumber" class="anchor"></a><code><span class="keyword">| </span></code><code>`Serialnumber<span class="keyword"> of </span>string</code></td></tr><tr id="type-component.C" class="anchored"><td class="def constructor"><a href="#type-component.C" class="anchor"></a><code><span class="keyword">| </span></code><code>`C<span class="keyword"> of </span>string</code></td></tr><tr id="type-component.L" class="anchored"><td class="def constructor"><a href="#type-component.L" class="anchor"></a><code><span class="keyword">| </span></code><code>`L<span class="keyword"> of </span>string</code></td></tr><tr id="type-component.SP" class="anchored"><td class="def constructor"><a href="#type-component.SP" class="anchor"></a><code><span class="keyword">| </span></code><code>`SP<span class="keyword"> of </span>string</code></td></tr><tr id="type-component.O" class="anchored"><td class="def constructor"><a href="#type-component.O" class="anchor"></a><code><span class="keyword">| </span></code><code>`O<span class="keyword"> of </span>string</code></td></tr><tr id="type-component.OU" class="anchored"><td class="def constructor"><a href="#type-component.OU" class="anchor"></a><code><span class="keyword">| </span></code><code>`OU<span class="keyword"> of </span>string</code></td></tr><tr id="type-component.T" class="anchored"><td class="def constructor"><a href="#type-component.T" class="anchor"></a><code><span class="keyword">| </span></code><code>`T<span class="keyword"> of </span>string</code></td></tr><tr id="type-component.DNQ" class="anchored"><td class="def constructor"><a href="#type-component.DNQ" class="anchor"></a><code><span class="keyword">| </span></code><code>`DNQ<span class="keyword"> of </span>string</code></td></tr><tr id="type-component.Mail" class="anchored"><td class="def constructor"><a href="#type-component.Mail" class="anchor"></a><code><span class="keyword">| </span></code><code>`Mail<span class="keyword"> of </span>string</code></td></tr><tr id="type-component.DC" class="anchored"><td class="def constructor"><a href="#type-component.DC" class="anchor"></a><code><span class="keyword">| </span></code><code>`DC<span class="keyword"> of </span>string</code></td></tr><tr id="type-component.Given_name" class="anchored"><td class="def constructor"><a href="#type-component.Given_name" class="anchor"></a><code><span class="keyword">| </span></code><code>`Given_name<span class="keyword"> of </span>string</code></td></tr><tr id="type-component.Surname" class="anchored"><td class="def constructor"><a href="#type-component.Surname" class="anchor"></a><code><span class="keyword">| </span></code><code>`Surname<span class="keyword"> of </span>string</code></td></tr><tr id="type-component.Initials" class="anchored"><td class="def constructor"><a href="#type-component.Initials" class="anchor"></a><code><span class="keyword">| </span></code><code>`Initials<span class="keyword"> of </span>string</code></td></tr><tr id="type-component.Pseudonym" class="anchored"><td class="def constructor"><a href="#type-component.Pseudonym" class="anchor"></a><code><span class="keyword">| </span></code><code>`Pseudonym<span class="keyword"> of </span>string</code></td></tr><tr id="type-component.Generation" class="anchored"><td class="def constructor"><a href="#type-component.Generation" class="anchor"></a><code><span class="keyword">| </span></code><code>`Generation<span class="keyword"> of </span>string</code></td></tr><tr id="type-component.Other" class="anchored"><td class="def constructor"><a href="#type-component.Other" class="anchor"></a><code><span class="keyword">| </span></code><code>`Other<span class="keyword"> of </span>Asn.oid<span class="keyword"> * </span>string</code></td></tr></table><code> ]</code></dt><dd><p>The polymorphic variant of a distinguished name component, as defined in X.500.</p></dd></dl><dl><dt class="spec type" id="type-distinguished_name"><a href="#type-distinguished_name" class="anchor"></a><code><span class="keyword">type </span>distinguished_name</code><code><span class="keyword"> = </span><a href="index.html#type-component">component</a> list</code></dt><dd><p>A distinguished name is a list of <a href="index.html#type-component"><code>component</code></a>.</p></dd></dl><dl><dt class="spec value" id="val-distinguished_name_of_sexp"><a href="#val-distinguished_name_of_sexp" class="anchor"></a><code><span class="keyword">val </span>distinguished_name_of_sexp : Sexplib.Sexp.t <span>&#45;&gt;</span> <a href="index.html#type-distinguished_name">distinguished_name</a></code></dt><dd><p><code>distinguished_name_of_sexp sexp</code> is a <code>distinguished_name</code>, the unmarshalled <code>sexp</code>.</p></dd></dl><dl><dt class="spec value" id="val-sexp_of_distinguished_name"><a href="#val-sexp_of_distinguished_name" class="anchor"></a><code><span class="keyword">val </span>sexp_of_distinguished_name : <a href="index.html#type-distinguished_name">distinguished_name</a> <span>&#45;&gt;</span> Sexplib.Sexp.t</code></dt><dd><p><code>sexp_of_distinguished_name dn</code> is <code>sexp</code>, the marshalled <code>dn</code>.</p></dd></dl><dl><dt class="spec value" id="val-distinguished_name_to_string"><a href="#val-distinguished_name_to_string" class="anchor"></a><code><span class="keyword">val </span>distinguished_name_to_string : <a href="index.html#type-distinguished_name">distinguished_name</a> <span>&#45;&gt;</span> string</code></dt><dd><p><code>distinguished_name_to_string dn</code> is <code>string</code>, the string representation of the <a href="index.html#type-distinguished_name"><span>dn</span></a>.</p></dd></dl><dl><dt class="spec value" id="val-fingerprint"><a href="#val-fingerprint" class="anchor"></a><code><span class="keyword">val </span>fingerprint : Nocrypto.Hash.hash <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> Cstruct.t</code></dt><dd><p><code>fingerprint hash cert</code> is <code>digest</code>, the digest of <code>cert</code> using the specified <code>hash</code> algorithm</p></dd></dl><dl><dt class="spec value" id="val-subject"><a href="#val-subject" class="anchor"></a><code><span class="keyword">val </span>subject : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-distinguished_name">distinguished_name</a></code></dt><dd><p><code>subject certificate</code> is <code>dn</code>, the subject as <a href="index.html#type-distinguished_name"><span>dn</span></a> of the <code>certificate</code>.</p></dd></dl><dl><dt class="spec value" id="val-issuer"><a href="#val-issuer" class="anchor"></a><code><span class="keyword">val </span>issuer : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-distinguished_name">distinguished_name</a></code></dt><dd><p><code>issuer certificate</code> is <code>dn</code>, the issuer as <a href="index.html#type-distinguished_name"><span>dn</span></a> of the <code>certificate</code>.</p></dd></dl><dl><dt class="spec value" id="val-serial"><a href="#val-serial" class="anchor"></a><code><span class="keyword">val </span>serial : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> Z.t</code></dt><dd><p><code>serial certificate</code> is <code>sn</code>, the serial number of the <code>certificate</code>.</p></dd></dl><dl><dt class="spec value" id="val-validity"><a href="#val-validity" class="anchor"></a><code><span class="keyword">val </span>validity : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> Ptime.t<span class="keyword"> * </span>Ptime.t</code></dt><dd><p><code>validity certificate</code> is <code>from, until</code>, the validity of the certificate.</p></dd></dl><dl><dt class="spec module" id="module-Extension"><a href="#module-Extension" class="anchor"></a><code><span class="keyword">module </span><a href="Extension/index.html">Extension</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>X.509v3 extensions</p></dd></dl><dl><dt class="spec module" id="module-CA"><a href="#module-CA" class="anchor"></a><code><span class="keyword">module </span><a href="CA/index.html">CA</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>Certificate Authority operations</p></dd></dl><dl><dt class="spec module" id="module-CRL"><a href="#module-CRL" class="anchor"></a><code><span class="keyword">module </span><a href="CRL/index.html">CRL</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>X.509 Certificate Revocation Lists.</p></dd></dl><dl><dt class="spec module" id="module-Validation"><a href="#module-Validation" class="anchor"></a><code><span class="keyword">module </span><a href="Validation/index.html">Validation</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>X.509 Certificate Chain Validation.</p></dd></dl><dl><dt class="spec module" id="module-Authenticator"><a href="#module-Authenticator" class="anchor"></a><code><span class="keyword">module </span><a href="Authenticator/index.html">Authenticator</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>Authenticators of certificate chains</p></dd></dl><dl><dt class="spec module" id="module-Encoding"><a href="#module-Encoding" class="anchor"></a><code><span class="keyword">module </span><a href="Encoding/index.html">Encoding</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>Encodings</p></dd></dl></section></div></body></html>